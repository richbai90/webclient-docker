;;;;var _bHtmlWebClient=true;var _uniqueformid="";function IsObjectDefined(strObjectName){try{eval("var tmp = "+strObjectName+";");if(tmp!=undefined){return true;}}catch(e){return false;}return false;}function _eva(oEle,varValue){if(oEle._value){oEle._value(varValue);}else{oEle.value=varValue;}}function _ete(oEle,varValue){if(oEle._text){oEle._text(varValue);}else{oEle.text=varValue;}}function _een(oEle,boolEnable){if(oEle._enable){oEle._enable(boolEnable);}else{oEle.enable=boolEnable;}}function _ero(oEle,boolRO){if(oEle._readOnly){oEle._readOnly(boolRO);}else{oEle.readOnly=boolRO;}}function _ema(oEle,boolMandatory){oEle._mandatory(boolMandatory);}function _evi(oEle,boolVisible){oEle._visible(boolVisible);}function _slf(oEle,strFilter){oEle._filter(strFilter);}function _slraw(oEle,strSQL){oEle._rawSql(strSQL);}function _flp(oEle,strPath){oEle.path=strPath;oEle.Refresh();}function _eim(oEle,strURI){oEle._image(strURI);}function _etab(oEle,nTab){oEle._tab(nTab);}function _edataref(oEle,strBinding){oEle._dataRef(strBinding);}function _ecol(oEle,strCol){oEle.element.style.color=strCol;}function _emt(oEle,varValue){var oTD=oEle.htmldocument.getElementById(oEle.name+"_menutext");if(oTD!=null){varValue=varValue+"";if(varValue.indexOf("&")==0){varValue=varValue.substring(1);}oTD.innerHTML=varValue;}}function _ewi(oEle,intWidth){oEle.width=intWidth;oEle.element.style.width=intWidth;}function SwitchSupportworksView(strView){strView=app.string_replace(strView," ","_");if(strView!=""){app.application_navbar.activatebar(strView.toLowerCase());}}function XmlFile(){this.xpath=null;this.xmldom=null;}XmlFile.prototype.loadFromString=function(strXML){this.xmldom=app.create_xml_dom(app.trim(strXML));if(!this.xmldom){return false;}this[this.xmldom.documentElement.nodeName]=this._processNodes(this.xmldom.documentElement).odata;this._processedNodes=[];this._arrayifyNodes(this[this.xmldom.documentElement.nodeName]);return true;};XmlFile.prototype.loadFromHttp=function(strUrl,strParams){if(strParams==undefined||strParams==""){strParams="sessid="+app.session.sessionId;}else{strParams+="&sessid="+app.session.sessionId;}var strXML=app.get_http(strUrl,strParams,true,false);return this.loadFromString(strXML);};XmlFile.prototype._arrayifyNodes=function(obj){if(obj.length==undefined){obj.length=0;}if(obj.nodeValue==undefined){obj.nodeValue="";}for(var strChildName in obj){if(strChildName.charAt(0)=="@"||strChildName=="length"||strChildName=="nodeValue"||strChildName=="nodeName"||strChildName=="indexOf"){continue;}if(obj[strChildName]==null&&!isNaN(strChildName)){obj.splice(strChildName,1);}else{if($.type(obj[strChildName])!=="string"){this._arrayifyNodes(obj[strChildName]);}if(isNaN(strChildName)){obj[obj.length++]=obj[strChildName];}}}};XmlFile.prototype._processNodes=function(xml){var obj={};if(xml.nodeType==1){if(xml.attributes.length>0){obj["@attributes"]={};for(var j=0;j<xml.attributes.length;j++){var attribute=xml.attributes.item(j);obj["@attributes"][attribute.nodeName]=attribute.nodeValue;}}}else{if(xml.nodeType==3){obj=xml.nodeValue;}}var bArray=false;if(xml.hasChildNodes()){for(var i=0;i<xml.childNodes.length;i++){var item=xml.childNodes.item(i);var nodeName=item.nodeName;if(nodeName=="#text"){nodeName="nodeValue";}if(typeof(obj[nodeName])=="undefined"){var res=this._processNodes(item);if(res.isArray){var setChildArray=new Array();for(var cItemName in res.odata){var childObject=res.odata[cItemName];setChildArray[cItemName]=childObject;if(childObject instanceof Array){for(var cidx in childObject){setChildArray.push(childObject[cidx]);}}}obj[nodeName]=setChildArray;}else{obj[nodeName]=res.odata;}obj[nodeName].nodeName=nodeName;}else{if(typeof(obj[nodeName].length)=="undefined"){var old=obj[nodeName];obj[nodeName]=new Array();obj[nodeName].push(old);obj.nodeName=null;bArray=true;}var res=this._processNodes(item);if(res.isArray){obj[nodeName].push(res.odata[res.cname]);}else{res.odata.nodeName=nodeName;obj[nodeName].push(res.odata);}}}}return{"odata":obj,"cname":nodeName,"isArray":bArray};};XmlFile.prototype.load=function(strPath){alert("XmlFile.load : is not supported by the webclient");return false;};XmlFile.prototype.save=function(strPath){alert("XmlFile.save : is not supported by the webclient");return false;};XmlFile.prototype.xpathFindElement=function(strPath){if(window.ActiveXObject){var xpath=this.xmldom.selectNodes(strPath);}else{if(document.implementation&&document.implementation.createDocument){var xpath=xml.evaluate(strPath,this.xmldom,null,XPathResult.ANY_TYPE,null);}}return xpath;};XmlFile.prototype.getXpathValue=function(strPath){if(window.ActiveXObject){var xpath=this.xmldom.selectNodes(strPath);}else{if(document.implementation&&document.implementation.createDocument){var xpath=xml.evaluate(strPath,this.xmldom,null,XPathResult.ANY_TYPE,null);}}return xpath;};XmlFile.prototype.setXpathValue=function(strPath){alert("XmlFile.setXpathValue : is not supported by the webclient");return false;};XmlFile.prototype.setModified=function(strPath){alert("XmlFile.setModified : is not supported by the webclient");return false;};XmlFile.prototype.isModified=function(strPath){alert("XmlFile.isModified : is not supported by the webclient");return false;};XmlFile.prototype.xpathGetXml=function(strPath){alert("XmlFile.xpathGetXml : is not supported by the webclient");return false;};XmlFile.prototype.xpathSetXml=function(strPath){alert("XmlFile.xpathSetXml : is not supported by the webclient");return false;};function _new_xmlmethodcall(){return new XmlMethodCall();}function XmlMethodCall(){this._params=new Array();this._wcparams=new Array();this._complexparams=new Array();this._strcomplexparams=new Array();this._params_counter=new Array();this._data=new Array();this._complexdataparams=new Array();this._strcomplexdataparams=new Array();this._lastresult="";this._lasterror="";this.xmlDOM=null;}XmlMethodCall.prototype.SetValue=function(strParam,varValue){if(this._params[strParam]!=undefined){var intcounter=this._params_counter[strParam];if(intcounter==undefined){intcounter=1;}this._params[strParam+"__grpcounter__"+intcounter]=app.pfx(varValue);this._params_counter[strParam]=++intcounter;}else{this._params[strParam]=app.pfx(varValue);}};XmlMethodCall.prototype.SetWebclientParam=function(strParam,varValue){this._wcparams[strParam]=varValue;};XmlMethodCall.prototype.SetParam=function(strParam,varValue){this.SetValue(strParam,varValue);};XmlMethodCall.prototype.SetParamAsComplexType=function(strParentParam,varXmlString){var strParentParam=strParentParam+"_complexstr";if(this._params[strParentParam]!=undefined){var intcounter=this._params_counter[strParentParam];if(intcounter==undefined){intcounter=1;}this._params[strParentParam+"__grpcounter__"+intcounter]=varXmlString;this._params_counter[strParentParam]=++intcounter;}else{this._params[strParentParam]=varXmlString;}};XmlMethodCall.prototype.SetComplexValue=function(strParentParam,strParam,varValue){if(this._params[strParentParam]==undefined){this.SetParam(strParentParam,"_sw_complextype");}this._complexparams[strParam]=strParentParam+"__swcp__"+app.pfx(varValue);};XmlMethodCall.prototype.SetData=function(strParam,varValue){if(this._data[strParam]!=undefined){var intcounter=this._params_counter[strParam];if(intcounter==undefined){intcounter=1;}this._data[strParam+"__grpcounter__"+intcounter]=varValue;this._params_counter[strParam]=++intcounter;}else{this._data[strParam]=varValue;}};XmlMethodCall.prototype.SetDataAsComplexType=function(strParentParam,varXmlString){this.SetData(strParentParam+"_complexstr",varXmlString);};XmlMethodCall.prototype.Invoke=function(strType,strName,intShowEmptyDataParamTags,strFormID){if(strType.toLowerCase()=="mail"&&!app.global.IsConnectedToMailServer()){this._lasterror="The mail server is not running";return false;}if(intShowEmptyDataParamTags==undefined){intShowEmptyDataParamTags=0;}if(strFormID==undefined){strFormID=top._uniqueformid;}this.xmlDOM=null;var strParams="&_uniqueformid="+strFormID+"&_xmlmcservice="+strType+"&_xmlmcmethod="+strName+"&_xmlcemptydatatags="+intShowEmptyDataParamTags;for(strParam in this._wcparams){strParams+="&"+strParam+"="+app.pfu(this._wcparams[strParam]);}for(strParam in this._params){strParams+="&_xmlmcparam_"+strParam+"="+app.pfu(this._params[strParam]);}for(strParam in this._complexparams){strParams+="&_xmlmccomplexparam_"+strParam+"="+app.pfu(this._complexparams[strParam]);}for(strParam in this._data){strParams+="&_xmlmcdata_"+strParam+"="+app.pfu(this._data[strParam]);}app.debugstart(strType+":"+strName,"XmlMethodCall.Invoke");var strURL=app.get_service_url("swclass/xmlmethodcall","");var strXML=app.get_http(strURL,strParams,true,false);app.debugend(strType+":"+strName,"XmlMethodCall.Invoke");this._lastresult=strXML;if(strXML==false||strXML.indexOf("ERROR:")==0){if(strXML==false){strXML="The xmlmc url could not be loaded. The webserver may be down.";}return false;}else{this.xmlDOM=app.create_xml_dom(strXML);try{var intChildPos=(this.xmlDOM.childNodes.length==1)?0:1;}catch(e){this.xmlDOM=null;var strCode="-666";var strMsg="The response xml from XmlMethodCall is invalid. Please contact your Administrator.";this._lasterror=strMsg;return false;}var strFail=this.xmlDOM.childNodes[intChildPos].getAttribute("status");var bStatus=(strFail=="fail")?false:true;if(!bStatus){var strCode=app.xmlNodeTextByTag(this.xmlDOM.childNodes[intChildPos].childNodes[0],"code");var strMsg=app.xmlNodeTextByTag(this.xmlDOM.childNodes[intChildPos].childNodes[0],"error");this._lasterror=strMsg;}else{if(!this.CheckCallActionStatus()){return false;}}return bStatus;}};XmlMethodCall.prototype.CheckCallActionStatus=function(){var intChildPos=(this.xmlDOM.childNodes.length==1)?0:1;var casNode=app.xmlNodeByTag(this.xmlDOM.childNodes[intChildPos].childNodes[0],"callActionStatus");if(casNode){var strResult=app.xmlNodeTextByTag(casNode,"success");if(strResult=="false"){this._lasterror=app.xmlNodeTextByTag(casNode,"message");return false;}}return true;};XmlMethodCall.prototype.Reset=function(){this._params=new Array();this._wcparams=new Array();this._complexparams=new Array();this._lastresult="";this._lasterror="";this.xmlDOM=null;};XmlMethodCall.prototype.GetLastError=function(){return this._lasterror;};XmlMethodCall.prototype.GetReturnXml=function(){return this._lastresult;};XmlMethodCall.prototype.GetReturnValue=function(strName){var arrParams=this.xmlDOM.getElementsByTagName("params");if(arrParams.length){var aParam=arrParams[0].getElementsByTagName(strName);if(aParam.length==0){arrParams=this.xmlDOM.getElementsByTagName("data");if(arrParams.length){aParam=arrParams[0].getElementsByTagName(strName);}}return(aParam.length)?app.xmlText(aParam[0]):"";}else{return"";}};XmlMethodCall.prototype.GetParamValue=function(strName){if(this.xmlDOM){return this.GetReturnValue(strName);}return"";};XmlMethodCall.prototype.GetParam=function(strName){if(this.xmlDOM){return this.GetReturnValue(strName);}return"";};function ChooseProfileCodeDialog(strTargetBinding){this.code="";this.codeDescription="";this.description="";this.sla="";this.filter="";this.useoptions=true;this.execOperatorScript=false;this.operatorScriptId=0;this.useDescriptionText=true;this.targetbinding=strTargetBinding;if(this.targetbinding==undefined){this.targetbinding="updatedb.updatetxt";}this.callbackdevfunction=null;}ChooseProfileCodeDialog.prototype.Open=function(bShowFixCodes,bEnableOptions,strInitialSelCode,strCodeFilter,fCallback,targetEle,fWin){var me=this;me.useoptions=bEnableOptions;if(fWin==undefined){if(app._CURRENT_JS_WINDOW!=null){fWin=app._CURRENT_JS_WINDOW;app._CURRENT_JS_WINDOW=null;}else{fWin=window;}}var handleResultFunction=null;if(fCallback){handleResultFunction=function(oForm){me.code=oForm.code;me.codeDescription=oForm.codeDescription;me.description=oForm.description;me.sla=oForm.sla;me.operatorScriptId=oForm.operatorScriptId;fCallback(oForm);};}var oForm=null;if(fCallback==undefined){fCallback=null;}this.callbackdevfunction=fCallback;if(bShowFixCodes){app._profilecodeselector("fix",strCodeFilter,strInitialSelCode,handleResultFunction,targetEle,fWin);}else{if(bEnableOptions==false){app._profilecodeselector("cdf",strCodeFilter,strInitialSelCode,handleResultFunction,targetEle,fWin);}else{app._profilecodeselector("lcf",strCodeFilter,strInitialSelCode,handleResultFunction,targetEle,fWin);}}};function AssignCallPropertySheet(){return new PickAnalystDialog();}function PickAnalystDialog(){this.groupid="";this.analystid="";this.tpcontract="";this.repid="";this.analystname="";this.groupname="";this.callbackdevfunction=null;}PickAnalystDialog.prototype.Open=function(strTitle,bThirdParty,callback,openFromWindow){if(strTitle==undefined){strTitle="Assign";}if($.isFunction(bThirdParty)){callback=bThirdParty;bThirdParty=false;}else{if(bThirdParty==undefined){bThirdParty=true;}}if(openFromWindow==undefined){if(app._CURRENT_JS_WINDOW!=null){openFromWindow=app._CURRENT_JS_WINDOW;app._CURRENT_JS_WINDOW=null;}else{openFromWindow=window;}}var me=this;app._analystpicker(strTitle,bThirdParty,function(retObject){if(retObject==undefined){if(callback){callback(me);}}else{me.analystid=retObject.analystid;me.repid=retObject.analystid;me.tpcontract=retObject.thirdparty;me.groupid=retObject.groupid;me.analystname=retObject.analystname;me.groupname=retObject.groupname;if(callback){callback(retObject);}}},openFromWindow);};function DatabaseConnection(){this.sq=new SqlQuery();this.strDB="swdata";alert("DatabaseConnection : The webclient does not support this method");return false;}DatabaseConnection.prototype.Connect=function(dbtype,strDB,strUser,strPass,strServer){this.strDB=strDB;};DatabaseConnection.prototype.Query=function(strSQL){return this.sq.Query(strSQL,this.strDB);};DatabaseConnection.prototype.Fetch=function(){return this.sq.Fetch();};DatabaseConnection.prototype.GetValueAsString=function(nCol){return this.sq.GetValueAsString(nCol);};DatabaseConnection.prototype.GetValueAsNumber=function(nCol){return this.sq.GetValueAsNumber(nCol);};DatabaseConnection.prototype.GetValueAsInteger=function(nCol){return this.sq.GetValueAsNumber(nCol);};function _new_SqlQuery(){return new SqlQuery();}function SqlQuery(){this._lasterror="";this._currentrow=-1;this._recordset=null;this._currentrecord=null;this._rowcount=0;this._oI=null;}SqlQuery.prototype.injectXmlmcRsData=function(xmlmcObject){this._recordset=xmlmcObject.xmlDOM;if(typeof this._recordset=="object"){return true;}return false;};SqlQuery.prototype.HasRight=function(strSQL){strSQL=app.trim(strSQL.toLowerCase());var arrSQL=strSQL.split(" ");var strAction=arrSQL[0];var iCheckRight=0;switch(strAction){case"select":iCheckRight=_CAN_BROWSE_TABLEREC;break;case"update":iCheckRight=_CAN_UPDATE_TABLEREC;break;case"insert":iCheckRight=_CAN_ADDNEW_TABLEREC;break;case"delete":iCheckRight=_CAN_DELETE_TABLEREC;break;}var strTable="";var ifrompos=-1;var iwherepos=-1;var igrouppos=-1;var iorderpos=-1;var bPastInTo=false;for(var x=1;x<arrSQL.length;x++){if(strAction=="update"&&strTable==""){if(arrSQL[x]!=""){strTable=arrSQL[x];break;}}else{if(strAction=="insert"&&strTable==""){if(bPastInTo&&arrSQL[x]!=""){strTable=arrSQL[x];break;}if(arrSQL[x]=="into"){bPastInTo=true;}}else{if(arrSQL[x]=="from"&&ifrompos==-1){ifrompos=x;}if(arrSQL[x]=="where"&&iwherepos==-1){iwherepos=x;}if(arrSQL[x]=="order"&&iorderpos==-1){iorderpos=x;}if(arrSQL[x]=="group"&&igrouppos==-1){igrouppos=x;}}}}if(strAction=="delete"||strAction=="select"){var ilastPos=arrSQL.length;if(iwherepos!=-1){ilastPos=iwherepos;}else{if(igrouppos!=-1){ilastPos=igrouppos;}else{if(iorderpos!=-1){ilastPos=iorderpos;}}}var strAllTables="";for(var x=ifrompos+1;x<ilastPos;x++){strAllTables+=arrSQL[x];}strTable=strAllTables;}if(strTable==""){alert("SqlQuery.prototype.HasRight: Could not find table name in the sql :-\n\n"+strSQL);return false;}var arrTables=strTable.split(",");for(var x=0;x<arrTables.length;x++){var res=app.session.CheckTableRight(arrTables[x],iCheckRight,true);if(res!=""){alert(res);return false;}}return true;};SqlQuery.prototype._getsqlinfo=function(strSQL){var sqlInfo=new Object();strSQL=app.trim(strSQL.toLowerCase());var arrSQL=strSQL.split(" ");var strAction=arrSQL[0];var strTable="";var ifrompos=-1;var iwherepos=-1;var igrouppos=-1;var iorderpos=-1;var bPastInTo=false;for(var x=1;x<arrSQL.length;x++){if(strAction=="update"&&strTable==""){if(arrSQL[x]!=""){strTable=arrSQL[x];break;}}else{if(strAction=="insert"&&strTable==""){if(bPastInTo&&arrSQL[x]!=""){strTable=arrSQL[x];break;}if(arrSQL[x]=="into"){bPastInTo=true;}}else{if(arrSQL[x]=="from"&&ifrompos==-1){ifrompos=x;}if(arrSQL[x]=="where"&&iwherepos==-1){iwherepos=x;}if(arrSQL[x]=="order"&&iorderpos==-1){iorderpos=x;}if(arrSQL[x]=="group"&&igrouppos==-1){igrouppos=x;}}}}if(strAction=="delete"||strAction=="select"){var ilastPos=arrSQL.length;if(iwherepos!=-1){ilastPos=iwherepos;}else{if(igrouppos!=-1){ilastPos=igrouppos;}else{if(iorderpos!=-1){ilastPos=iorderpos;}}}var strAllTables="";for(var x=ifrompos+1;x<ilastPos;x++){strAllTables+=arrSQL[x];}strTable=strAllTables;}sqlInfo.action=app.trim(strAction);sqlInfo.tables=app.trim(strTable);var iF=strSQL.indexOf("from");sqlInfo.columns=app.trim(strSQL.substring(0,iF));sqlInfo.columns=app.trim(app.string_replace(sqlInfo.columns,strAction,"",true));return sqlInfo;};SqlQuery.prototype.invokeStoredQuery=function(strQueryName,strParams,optBoolNoMessage){return this.StoredQuery(strQueryName,strParams);};SqlQuery.prototype.InvokeStoredQuery=function(strQueryName,strParams,optBoolNoMessage){return this.StoredQuery(strQueryName,strParams);};SqlQuery.prototype.StoredQuery=function(strQueryName,strParams,optBoolNoMessage){if(optBoolNoMessage==undefined){optBoolNoMessage=false;}app.debugstart(strQueryName,"swjs.SqlQuery.CallStoredQuery");var res=false;if(strQueryName.indexOf("execute/")!=0){strQueryName="query/"+strQueryName;}var strJson=app.CallStoredQuery(strQueryName,strParams,true);try{this._recordset=eval("("+strJson+")");res=this._recordset["@status"];this._rowcount=0;if(this._recordset.data&&this._recordset.data.rowData&&this._recordset.data.rowData.row){var isArray=(this._recordset.data.rowData.row instanceof Array);if(!isArray){this._recordset.data.rowData.row=new Array(this._recordset.data.rowData.row);}this._rowcount=this._recordset.data.rowData.row.length;}if(res=="fail"){res=false;}if(!res&&this._recordset!=null){var strCode=this._recordset.state.code;var strMsg=this._recordset.state.error;this._lasterror="("+strCode+") "+strMsg;if(!optBoolNoMessage){alert(this._lasterror);}}}catch(e){this._recordset=null;this._lasterror="(000) Failed to parse SqlQuery resultset. Please contact your Administrator.";alert(this._lasterror);}app.debugend(strQueryName,"swjs.SqlQuery.CallStoredQuery");return res;};SqlQuery.prototype.WebclientStoredQuery=function(strQueryName,strParams){app.debugstart(strQueryName,"swjs.SqlQuery.WebclientStoredQuery");var res=false;var strJson=app.CallWebclientStoredQuery(strQueryName,strParams,true);var res=false;try{this._recordset=eval("("+strJson+")");res=this._recordset["@status"];this._rowcount=0;if(this._recordset.data&&this._recordset.data.rowData&&this._recordset.data.rowData.row){var isArray=(this._recordset.data.rowData.row instanceof Array);if(!isArray){this._recordset.data.rowData.row=new Array(this._recordset.data.rowData.row);}this._rowcount=this._recordset.data.rowData.row.length;}if(res=="fail"){res=false;}if(!res&&this._recordset!=null){var strCode=this._recordset.state.code;var strMsg=this._recordset.state.error;this._lasterror="("+strCode+") "+strMsg;alert(this._lasterror);}}catch(e){this._recordset=null;this._lasterror="(000) Failed to parse SqlQuery resultset. Please contact your Administrator.";alert(this._lasterror);}app.debugend(strQueryName,"swjs.SqlQuery.WebclientStoredQuery");return res;};SqlQuery.prototype.Query=function(strSQL,strDB){if(strDB==undefined){strDB="swdata";}if(strSQL==undefined||strSQL==""){alert("SqlQuery.Query expects a strSQL parameter");}this._oI=this._getsqlinfo(strSQL);var strDelete="";if(strSQL.toLowerCase().indexOf("delete")==0){strDelete="yes";}app.debugstart(strSQL,"swjs.SqlQuery.Query");var strParams="delete="+strDelete+"&execsql="+app.pfu(strSQL)+"&db="+strDB;var strURL=app.get_service_url("swclass/sqlquery","");var res=false;var strJson=app.get_http(strURL,strParams,true,false);try{this._recordset=eval("("+strJson+")");res=this._recordset["@status"];this._rowcount=0;if(this._recordset.data&&this._recordset.data.rowData&&this._recordset.data.rowData.row){var isArray=(this._recordset.data.rowData.row instanceof Array);if(!isArray){this._recordset.data.rowData.row=new Array(this._recordset.data.rowData.row);}this._rowcount=this._recordset.data.rowData.row.length;}if(!res&&this._recordset!=null){var strCode=this._recordset.state.code;var strMsg=this._recordset.state.error;this._lasterror="("+strCode+") "+strMsg;alert(this._lasterror);}}catch(e){this._recordset=null;this._lasterror="(000) Failed to parse SqlQuery resultset. Please contact your Administrator.";alert(this._lasterror);}app.debugend(strSQL,"swjs.SqlQuery.Query");return res;};SqlQuery.prototype.query=SqlQuery.prototype.Query;SqlQuery.prototype.fetch=function(){return this.Fetch();};SqlQuery.prototype.Fetch=function(){if(this._recordset==null){return false;}if(this._rowcount==0){return false;}if(this._recordset.params&&this._recordset.params.rowsEffected==0){return false;}if(this._recordset.data&&this._recordset.data.rowData&&this._recordset.data.rowData.row){this._currentrow++;this._currentrecord=this._recordset.data.rowData.row[this._currentrow];if(this._currentrecord==undefined){this._currentrecord=null;return false;}else{return true;}}else{this._currentrecord=null;return false;}};SqlQuery.prototype.GetValueAsNumber=function(intColIndex,boolDisplay){if(this._currentrecord==null){return false;}if(boolDisplay==undefined){boolDisplay=false;}var strColName="";var colObject=undefined;var testNum=new Number(intColIndex);if(isNaN(testNum)){strColName=intColIndex.toLowerCase();colObject=this._recordset.data.metaData[strColName];}else{var pos=0;for(var strColName in this._recordset.data.metaData){colObject=this._recordset.data.metaData[strColName];if(pos==intColIndex){break;}pos++;}}if(colObject==undefined){return false;}var dataColumn=this._currentrecord[strColName];if(dataColumn){var strValue=(dataColumn["@raw"]!=undefined)?dataColumn["@raw"]:dataColumn;var strDisplay=(dataColumn["#text"]!=undefined)?dataColumn["#text"]:dataColumn;var val=(boolDisplay)?strDisplay:strValue;if(val==""){return"";}var num=new Number(val);num++;num--;return num;}return"";};SqlQuery.prototype.GetValueAsString=function(intColIndex,boolDisplay){if(this._currentrecord==null){return false;}if(boolDisplay==undefined){boolDisplay=false;}var strColName="";var colObject=undefined;var testNum=new Number(intColIndex);if(isNaN(testNum)){strColName=intColIndex.toLowerCase();colObject=this._recordset.data.metaData[strColName];}else{var pos=0;for(var strColName in this._recordset.data.metaData){colObject=this._recordset.data.metaData[strColName];if(pos==intColIndex){break;}pos++;}}if(colObject==undefined){return false;}var dataColumn=this._currentrecord[strColName];if(dataColumn){var strValue=(dataColumn["@raw"]!=undefined)?dataColumn["@raw"]:dataColumn;var strDisplay=(dataColumn["#text"]!=undefined)?dataColumn["#text"]:dataColumn;return(boolDisplay)?strDisplay:strValue;}return"";};SqlQuery.prototype.GetColumnIndex=function(strColName){if(this._recordset.data==undefined||this._recordset.data.metaData==undefined){return -1;}var colObject=undefined;var pos=-1;for(var strCurrentColName in this._recordset.data.metaData){pos++;if(strCurrentColName.toLowerCase()==strColName.toLowerCase()){break;}}return pos;};SqlQuery.prototype.GetColumnName=function(intColIndex){if(this._recordset.data==undefined||this._recordset.data.metaData==undefined){return"";}var colObject=undefined;var pos=0;for(var strCurrentColName in this._recordset.data.metaData){if(pos==intColIndex){return strCurrentColName;}pos++;}return"";};SqlQuery.prototype.GetColumnCount=function(){if(this._recordset.data==undefined||this._recordset.data.metaData==undefined){return 0;}var pos=0;for(var strCurrentColName in this._recordset.data.metaData){pos++;}return pos;};SqlQuery.prototype.GetRowCount=function(){return this._rowcount;};SqlQuery.prototype.IsColNumeric=function(intColIndex){if(this._recordset.data==undefined||this._recordset.data.metaData==undefined){return false;}var strColName=this.GetColumnName(intColIndex);if(this._recordset.data.metaData[strColName]){var dataType=this._recordset.data.metaData[strColName].dataType;return(dataType!="string"&&dataType!="varchar"&&dataType!="text"&&dataType!="char"&&dataType!="longvarchar");}return false;};SqlQuery.prototype.Reset=function(){this._lasterror="";this._currentrow=-1;this._recordset=null;this._currentrecord=null;this._rowcount=0;this._oI=null;return true;};SqlQuery.prototype.GetLastError=function(){return this._lasterror;};function _new_SqlRecord(){return new SqlRecord();}function SqlRecord(){this._sqlquery=null;this._origvalues=new Array();this._modifiedfields=new Array();this._rowcount=0;}SqlRecord.prototype.GetCount=function(){return this._rowcount;};SqlRecord.prototype.invokeStoredQuery=function(strQueryName,strParams){return this.StoredQuery(strQueryName,strParams);};SqlRecord.prototype.StoredQuery=function(strQueryName,strParams){this._sqlquery=new SqlQuery();if(!this._sqlquery.StoredQuery("record/"+strQueryName,strParams)){return 0;}if(!this._sqlquery.Fetch()){return 0;}for(var strColName in this._sqlquery._currentrecord){var strColValue=this._sqlquery.GetValueAsString(strColName);var isNum=dd.tables[strTable.toLowerCase()].columns[strColName].IsNumeric();if(isNum){strColValue--;strColValue++;}this[strColName]=strColValue;this._origvalues[strColName]=strColValue;}this._rowcount=this._sqlquery.GetRowCount();return 1;};SqlRecord.prototype.GetRecord=function(strTable,strPrimaryKeyValue){this._rowcount=0;if(dd.tables[strTable.toLowerCase()]==undefined){alert("The specified table ["+strTable+"] was not found in the dd tables. Please contact your administrator");return -1;}var strPrimaryCol=dd.tables[strTable.toLowerCase()].PrimaryKey;if(strPrimaryCol==undefined){alert("The specified table does not have a primary key. Please contact your administrator");return -1;}var strParams="dsn=swdata&table="+strTable+"&keycol="+strPrimaryCol+"&keyvalue="+strPrimaryKeyValue;this._sqlquery=new SqlQuery();if(!this._sqlquery.WebclientStoredQuery("data/getRecord",strParams)){return 0;}if(!this._sqlquery.Fetch()){return 0;}for(var strColName in this._sqlquery._currentrecord){var strColValue=this._sqlquery.GetValueAsString(strColName);var isNum=dd.tables[strTable.toLowerCase()].columns[strColName].IsNumeric();if(isNum){strColValue--;strColValue++;}this[strColName]=strColValue;this._origvalues[strColName]=strColValue;}this._rowcount=1;return 1;};SqlRecord.prototype.GetRecordWhere=function(strTable,strWhere){this._rowcount=0;if(dd.tables[strTable.toLowerCase()]==undefined){alert("The specified table ["+strTable+"] was not found in the dd tables. Please contact your administrator");return -1;}var strParams="dan=swdata&table="+strTable+"&filter="+strWhere;this._sqlquery=new SqlQuery();if(!this._sqlquery.WebclientStoredQuery("data/getRecordWhere",strParams)){return 0;}if(!this._sqlquery.Fetch()){return 0;}for(var strColName in this._sqlquery._currentrecord){var strColValue=this._sqlquery.GetValueAsString(strColName);var isNum=dd.tables[strTable.toLowerCase()].columns[strColName].IsNumeric();if(isNum){strColValue--;strColValue++;}this[strColName]=strColValue;this._origvalues[strColName]=strColValue;}this._rowcount=this._sqlquery.GetRowCount();return 1;};SqlRecord.prototype.GetCacheRecord=function(strTable,strPrimaryKeyValue){var strPrimaryCol=dd.tables[strTable.toLowerCase()].PrimaryKey;if(strPrimaryCol==undefined){alert("The specified table does not have a primary key. Please contact your administrator");return -1;}var strParams="dsn=syscache&table="+strTable+"&keycol="+strPrimaryCol+"&keyvalue="+strPrimaryKeyValue;this._sqlquery=new SqlQuery();if(!this._sqlquery.WebclientStoredQuery("data/getRecord",strParams)){return 0;}if(!this._sqlquery.Fetch()){return 0;}for(var strColName in this._sqlquery._currentrecord){var strColValue=this._sqlquery.GetValueAsString(strColName);var isNum=dd.tables[strTable.toLowerCase()].columns[strColName].IsNumeric();if(isNum){strColValue--;strColValue++;}this[strColName]=strColValue;this._origvalues[strColName]=strColValue;}return 1;};SqlRecord.prototype.GetCacheRecordWhere=function(strTable,strWhere){var strParams="dan=syscache&table="+strTable+"&filter="+strWhere;this._sqlquery=new SqlQuery();if(!this._sqlquery.WebclientStoredQuery("data/getRecordWhere",strParams)){return 0;}if(!this._sqlquery.Fetch()){return 0;}for(var strColName in this._sqlquery._currentrecord){var strColValue=this._sqlquery.GetValueAsString(strColName);var isNum=dd.tables[strTable.toLowerCase()].columns[strColName].IsNumeric();if(isNum){strColValue--;strColValue++;}this[strColName]=strColValue;this._origvalues[strColName]=strColValue;}return 1;};SqlRecord.prototype.GetColumnCount=function(){return this._sqlquery.GetColumnCount();};SqlRecord.prototype.GetValue=function(nColIndex){return this._sqlquery.GetValueAsString(nColIndex);};SqlRecord.prototype.GetColumnName=function(nColIndex){return this._sqlquery.GetColumnName(nColIndex);};SqlRecord.prototype.IsModified=function(nColIndex){var strColName=this.GetColumnName(nColIndex);if(strColName.indexOf(".")!=-1){strColName=strColName.split(".")[1];}if(this[strColName]!=this._origvalues[strColName]){return true;}if(this._modifiedfields[strColName]!=undefined){return this._modifiedfields[strColName];}return false;};SqlRecord.prototype.SetFieldModifiedFlag=function(nColIndex,bModified){if(bModified==undefined){bModified=true;}var strColName=this.GetColumnName(nColIndex);if(strColName.indexOf(".")!=-1){strColName=strColName.split(".")[1];}this._modifiedfields[strColName]=bModified;};function PopupForm(){this.document=null;this._swdoc=null;}PopupForm.prototype.Open=function(strFormName,varRecordKey,strParams,fCallBack,fWin){var strMode=(varRecordKey!="")?"edit":"add";var me=this;var useWin=(app._CURRENT_JS_WINDOW!=null)?app._CURRENT_JS_WINDOW:window;app._open_application_form(strFormName,"stf",varRecordKey,strParams,true,strMode,function(res){var ret={document:null,_swdoc:null};if(res!=null){ret.document=res._swdoc;ret._swdoc=res._swdoc;}if(fCallBack){fCallBack(ret);}},null,useWin);};function HelpdeskSession(strUniqueID){if(strUniqueID==undefined){strUniqueID=top._uniqueformid;}this._uniqueformid=strUniqueID;this.strCallrefs="";this.strIssuerefs="";this.command="";this.resultstring="";this.lasterrorstring="";this.boolresult=true;this._bUseXmlmc=false;this._xmlmcMethod="";this._xmlmcMethodReturnType="callaction";this._xmlmc_values=new Array();this._xmlmc_param_mappings=new Array();this._actionverb="";this.array_boolvalues=new Array();this.array_strvalues=new Array();this.array_numvalues=new Array();this.array_txtvalues=new Array();this.array_values=new Array();this.array_datevalues=new Array();this.resultarray=new Array();this.array_ext_values=new Array();this.array_files=new Array();}HelpdeskSession.prototype.AcceptCall=function(nCallRef,nBackdatePeriod,bRespond){nCallRef+="";var xmlmc=new XmlMethodCall();var arrCallrefs=nCallRef.split(",");for(var x=0;x<arrCallrefs.length;x++){xmlmc.SetValue("callref",arrCallrefs[x]);}if(nBackdatePeriod>1){var intCurrentTime=app.global.GetCurrentEpocTime();var backDateEpoch=intCurrentTime-nBackdatePeriod;var strDateTime=_epoch_to_timestamp(backDateEpoch,true);xmlmc.SetValue("timeOfAction",strDateTime);}xmlmc.SetValue("markAsSLAResponse",bRespond);return xmlmc.Invoke("helpdesk","acceptCalls");};HelpdeskSession.prototype.AddCallToIssue=function(nIssueRef,nCallRef){nCallRef+="";nIssueRef+="";var xmlmc=new XmlMethodCall();xmlmc.SetValue("issueRef",nIssueRef);var arrCallrefs=nCallRef.split(",");for(var x=0;x<arrCallrefs.length;x++){xmlmc.SetValue("callref",arrCallrefs[x]);}return xmlmc.Invoke("helpdesk","addCallsToIssue");};HelpdeskSession.prototype.AssignCall=function(nCallRef,strGroup,strAnalyst,strTPContract){nCallRef+="";var xmlmc=new XmlMethodCall();var arrCallrefs=nCallRef.split(",");for(var x=0;x<arrCallrefs.length;x++){xmlmc.SetValue("callref",arrCallrefs[x]);}xmlmc.SetValue("groupId",strGroup);if(strAnalyst!=undefined){xmlmc.SetValue("analystId",strAnalyst);}if(strTPContract!=undefined){xmlmc.SetValue("tpmContract",strTPContract);}return xmlmc.Invoke("helpdesk","assignCalls");};HelpdeskSession.prototype.AssignToCall=function(nCallRef,strAssign){strAssign=app.string_replace(strAssign,"#","",false);var arrAssign=strAssign.split(":");return this.AssignCall(nCallRef,arrAssign[0],arrAssign[1],arrAssign[2]);};HelpdeskSession.prototype.BeginAttachMessageToCall=function(){alert("HelpdeskSession.BeginAttachMessageToCall is not supported");return false;this.command="ATTACH MESSAGE TO CALL";return true;};HelpdeskSession.prototype.BeginCallValueUpdates=function(nCallRef,strUpdateVerb){this._bUseXmlmc=true;this._xmlmcMethod="updateCallValues";this._xmlmc_param_mappings=new Array();this._xmlmc_param_mappings["callref"]=nCallRef;this._xmlmc_param_mappings["actionVerb"]=strUpdateVerb;this._xmlmc_param_mappings["updateMessage"]="updatedb.updatetxt";this._xmlmc_param_mappings["additionalCallValues"]=this._generate_xmlmc_additionalcallvalues;this.strCallrefs=nCallRef;this.command="UPDATE CALL VALUES "+nCallRef;return true;};HelpdeskSession.prototype.BeginCancelCall=function(nCallRef){this._bUseXmlmc=true;this._xmlmcMethod="cancelCalls";this._xmlmc_param_mappings=new Array();this._xmlmc_param_mappings["callRef"]=nCallRef;this._xmlmc_param_mappings["description"]="updatedb.updatetxt";this._xmlmc_param_mappings["publicUpdate"]="publicupdate";this.strCallrefs=nCallRef;this.command="CANCEL CALL "+nCallRef;return true;};HelpdeskSession.prototype.BeginCloseCall=function(nCallRef){this._bUseXmlmc=true;this._xmlmcMethod="closeCalls";this._xmlmc_param_mappings=new Array();this._xmlmc_param_mappings["callref"]=nCallRef;this._xmlmc_param_mappings["timeSpent"]="timespent";this._xmlmc_param_mappings["description"]="updatedb.updatetxt";this._xmlmc_param_mappings["fixCode"]="fixcode";this._xmlmc_param_mappings["isChargeable:checkclosecallstatus"]="status";this._xmlmc_param_mappings["timeOfAction:backdatetodatetime"]="backdateperiod";this._xmlmc_param_mappings["publicUpdate"]="publicupdate";this._xmlmc_param_mappings["updateSource"]="updatedb.udsource";this._xmlmc_param_mappings["updateCode"]="updatedb.udcode";this._xmlmc_param_mappings["delayCacheFlush"]="delaycacheflush";this._xmlmc_param_mappings["fileAttachment"]="_generate_xmlmc_fileattachment";this._xmlmc_param_mappings["extraUpdateDbValues"]="_generate_xmlmc_updatedbvalues";this.strCallrefs=nCallRef;this.command="CLOSE CALL "+nCallRef;return false;};HelpdeskSession.prototype.BeginCloseIssue=function(strIssueRef){alert("HelpdeskSession.BeginCloseIssue is not supported");return false;this.command="CLOSE ISSUE "+strIssueRef;return true;};HelpdeskSession.prototype.BeginCompleteTask=function(){alert("HelpdeskSession.BeginCompleteTask is not supported");return false;this.command="COMPLETE TASK";return true;};HelpdeskSession.prototype.UpdateTask=function(){alert("HelpdeskSession.UpdateTask is not supported");return false;this.command="UPDATE TASK";return true;};HelpdeskSession.prototype.DeleteTask=function(nCallRef,nTaskID){var xmlmc=new XmlMethodCall();xmlmc.SetValue("callref",nCallRef);xmlmc.SetValue("workItemId",nTaskID);return xmlmc.Invoke("helpdesk","deleteCallWorkItems");};HelpdeskSession.prototype.BeginCreateIssue=function(){alert("HelpdeskSession.BeginCreateIssue is not supported");return false;this.command="CREATE ISSUE";return true;};HelpdeskSession.prototype.BeginHoldCall=function(nCallRef){this._bUseXmlmc=true;this._xmlmcMethod="holdCalls";this._xmlmc_param_mappings=new Array();this._xmlmc_param_mappings["callref"]=nCallRef;this._xmlmc_param_mappings["timeSpent"]="timespent";this._xmlmc_param_mappings["description"]="updatedb.updatetxt";this._xmlmc_param_mappings["holdUntil:epochtodatetime"]="holduntil";this._xmlmc_param_mappings["publicUpdate"]="publicupdate";this._xmlmc_param_mappings["updateSource"]="updatedb.udsource";this._xmlmc_param_mappings["updateCode"]="updatedb.udcode";this._xmlmc_param_mappings["fileAttachment"]="_generate_xmlmc_fileattachment";this._xmlmc_param_mappings["extraUpdateDbValues"]="_generate_xmlmc_updatedbvalues";this.strCallrefs=nCallRef;this.command="HOLD CALL "+nCallRef;return true;};HelpdeskSession.prototype.BeginLogCall=function(){alert("HelpdeskSession.BeginLogCall is not supported");return false;this.command="LOG CALL";return true;};HelpdeskSession.prototype.BeginUpdateCall=function(nCallRef){this.ResetValues();this._bUseXmlmc=true;this._xmlmcMethod="updateCalls";this._xmlmc_param_mappings=new Array();this._xmlmc_param_mappings["callref"]=nCallRef;this._xmlmc_param_mappings["timeSpent"]="timespent";this._xmlmc_param_mappings["description"]="updatedb.updatetxt";this._xmlmc_param_mappings["publicUpdate"]="publicupdate";this._xmlmc_param_mappings["timeOfAction:backdatetodatetime"]="backdateperiod";this._xmlmc_param_mappings["updateSource"]="updatedb.udsource";this._xmlmc_param_mappings["updateCode"]="updatedb.udcode";this._xmlmc_param_mappings["markAsSLAResponse"]="markslaresponse";this._xmlmc_param_mappings["priority"]="priority";this._xmlmc_param_mappings["targetFixTime:epochtodatetime"]="_targetfixtime";this._xmlmc_param_mappings["fileAttachment"]="_generate_xmlmc_fileattachment";this._xmlmc_param_mappings["extraUpdateDbValues"]="_generate_xmlmc_updatedbvalues";this.strCallrefs=nCallRef;this.command="UPDATE CALL "+nCallRef;return true;};HelpdeskSession.prototype.BeginUpdateIssue=function(nIssueRef){this.ResetValues();alert("HelpdeskSession.BeginUpdateIssue is not supported");return false;this.command="UPDATE ISSUE "+nIssueRef;return true;};HelpdeskSession.prototype.SetProfileCode=function(nCallRef,strCode){nCallRef+="";var xmlmc=new XmlMethodCall();var arrCallrefs=nCallRef.split(",");for(var x=0;x<arrCallrefs.length;x++){xmlmc.SetValue("callref",arrCallrefs[x]);}xmlmc.SetValue("code",strCode);var res=xmlmc.Invoke("helpdesk","changeCallProblemProfile");if(res==false){alert(xmlmc.GetLastError());}return res;};HelpdeskSession.prototype.CancelCall=function(nCallRef,strReason,bPublicUpdate){nCallRef+="";var xmlmc=new XmlMethodCall();var arrCallrefs=nCallRef.split(",");for(var x=0;x<arrCallrefs.length;x++){xmlmc.SetValue("callref",arrCallrefs[x]);}xmlmc.SetValue("description",strReason);xmlmc.SetValue("publicUpdate",bPublicUpdate);return xmlmc.Invoke("helpdesk","cancelCalls");};HelpdeskSession.prototype.ReactivateCall=function(nCallRef,bRestoreWorkflow){nCallRef+="";if(bRestoreWorkflow==undefined){bRestoreWorkflow=true;}var xmlmc=new XmlMethodCall();var arrCallrefs=nCallRef.split(",");for(var x=0;x<arrCallrefs.length;x++){xmlmc.SetValue("callref",arrCallrefs[x]);}xmlmc.SetValue("restoreWorkflow",bRestoreWorkflow);return xmlmc.Invoke("helpdesk","reactivateCalls");};HelpdeskSession.prototype.ChangeCallClass=function(nCallRef,strClass){nCallRef+="";var xmlmc=new XmlMethodCall();var arrCallrefs=nCallRef.split(",");for(var x=0;x<arrCallrefs.length;x++){xmlmc.SetValue("callref",arrCallrefs[x]);}xmlmc.SetValue("class",strClass);var res=xmlmc.Invoke("helpdesk","changeCallClass");if(res==false){alert(xmlmc.GetLastError());}return res;};HelpdeskSession.prototype.ChangeCallCondition=function(nCallRef,intCallCondition){nCallRef+="";var xmlmc=new XmlMethodCall();var arrCallrefs=nCallRef.split(",");for(var x=0;x<arrCallrefs.length;x++){xmlmc.SetValue("callref",arrCallrefs[x]);}xmlmc.SetValue("condition",intCallCondition);return xmlmc.Invoke("helpdesk","changeCallCondition");};HelpdeskSession.prototype.AddCustomerToIssue=function(nIssueRef,strTable,strCustID){var xmlmc=new XmlMethodCall();xmlmc.SetValue("issueRef",nIssueRef);xmlmc.SetValue("keyValue",strCustID);return xmlmc.Invoke("helpdesk","addCustomerToIssue");};HelpdeskSession.prototype.RemoveCallFromIssue=function(nIssueRef,nCallRef){var xmlmc=new XmlMethodCall();xmlmc.SetValue("issueRef",nIssueRef);nCallRef+="";var arrCallrefs=nCallRef.split(",");for(var x=0;x<arrCallrefs.length;x++){xmlmc.SetValue("callref",arrCallrefs[x]);}return xmlmc.Invoke("helpdesk","removeCallsFromIssue");};HelpdeskSession.prototype.SendCustomerSurvey=function(nSurveyID,sCallRefs){var xmlmc=new XmlMethodCall();xmlmc.SetValue("surveyId",nSurveyID);sCallRefs+="";var arrCallrefs=sCallRefs.split(",");for(var x=0;x<arrCallrefs.length;x++){xmlmc.SetValue("callref",arrCallrefs[x]);}return xmlmc.Invoke("survey","sendCustomerCallSurvey");};HelpdeskSession.prototype.RemoveCallFromIssueStr=function(strIssueRef,sCallRefs){return this.RemoveCallFromIssue(sCallRefs,strIssueRef);};HelpdeskSession.prototype.TakeCallOffHold=function(nCallRef){var xmlmc=new XmlMethodCall();nCallRef+="";var arrCallrefs=nCallRef.split(",");for(var x=0;x<arrCallrefs.length;x++){xmlmc.SetParam("callref",arrCallrefs[x]);}if(!xmlmc.Invoke("helpdesk","takeCallsOffHold")){alert(xmlmc.GetLastError());return false;}return true;};HelpdeskSession.prototype.DeleteCallAttachment=function(nCallRef,nAttachID){var xmlmc=new XmlMethodCall();xmlmc.SetParam("callref",nCallRef);xmlmc.SetParam("attachId",nAttachID);if(!xmlmc.Invoke("helpdesk","deleteAttachmentFromCall")){alert(xmlmc.GetLastError());return false;}return true;};HelpdeskSession.prototype.UnwatchCall=function(strCallRefs,strAnalystId){strCallRefs+="";var xmlmc=new XmlMethodCall();var arrCallrefs=strCallRefs.split(",");for(var x=0;x<arrCallrefs.length;x++){xmlmc.SetParam("callref",arrCallrefs[x]);}if(!xmlmc.Invoke("helpdesk","unwatchCalls")){alert(xmlmc.GetLastError());return false;}return true;};HelpdeskSession.prototype.WatchCall=function(strCallRefs,strAnalystId){strCallRefs+="";var xmlmc=new XmlMethodCall();var arrCallrefs=strCallRefs.split(",");for(var x=0;x<arrCallrefs.length;x++){xmlmc.SetParam("callref",arrCallrefs[x]);}if(!xmlmc.Invoke("helpdesk","watchCalls")){alert(xmlmc.GetLastError());return false;}return true;};HelpdeskSession.prototype.markWatchedCallsUnread=function(strCallRefs,strAnalystId){strCallRefs+="";var xmlmc=new XmlMethodCall();var arrCallrefs=strCallRefs.split(",");for(var x=0;x<arrCallrefs.length;x++){xmlmc.SetParam("callref",arrCallrefs[x]);}if(!xmlmc.Invoke("helpdesk","markWatchedCallsUnread")){alert(xmlmc.GetLastError());return false;}return true;};HelpdeskSession.prototype.setWatchOptions=function(strCallRefs,intOptions,strAnalystId){strCallRefs+="";var xmlmc=new XmlMethodCall();var arrCallrefs=strCallRefs.split(",");for(var x=0;x<arrCallrefs.length;x++){xmlmc.SetParam("callref",arrCallrefs[x]);}xmlmc.SetParam("options",intOptions);if(!xmlmc.Invoke("helpdesk","setWatchOptions")){alert(xmlmc.GetLastError());return false;}return true;};HelpdeskSession.prototype.removeWatchOptions=function(strCallRefs,intOptions,strAnalystId){strCallRefs+="";var xmlmc=new XmlMethodCall();var arrCallrefs=strCallRefs.split(",");for(var x=0;x<arrCallrefs.length;x++){xmlmc.SetParam("callref",arrCallrefs[x]);}xmlmc.SetParam("options",intOptions);if(!xmlmc.Invoke("helpdesk","removeWatchOptions")){alert(xmlmc.GetLastError());return false;}return true;};HelpdeskSession.prototype.Close=function(){this.strCallrefs="";this.strIssuerefs="";this.command="";this.resultstring="";this.lasterrorstring="";this.boolresult=true;this._xmlmc_values=new Array();this._xmlmcMethod="";this._bUseXmlmc=false;this.resultarray=new Array();this.array_strvalues=new Array();this.array_numvalues=new Array();this.array_txtvalues=new Array();this.array_values=new Array();this.array_ext_values=new Array();this.array_datevalues=new Array();this.array_files=new Array();this.array_xmlmc_files=new Array();this._actionverb="";return true;};HelpdeskSession.prototype._generate_xmlmc_fileattachment=function(strParam,xmlmc){for(strFileName in this.array_xmlmc_files){var strFileAtts="<embeddedFileAttachment><fileName>"+app.pfx(strFileName)+"</fileName></embeddedFileAttachment>";xmlmc.SetParamAsComplexType("fileAttachment",strFileAtts);}};HelpdeskSession.prototype._generate_xmlmc_issueadditionalvalues=function(strParam,xmlmc){var strUpdateIssueValues="";for(strParam in this._xmlmc_values){if(strParam.indexOf("swissues.")==0){var arrParam=strParam.split(".");strUpdateIssueValues+="<"+arrParam[1]+">"+app.pfx(this._xmlmc_values[strParam])+"</"+arrParam[1]+">";}}if(strUpdateIssueValues!=""){xmlmc.SetParamAsComplexType("additionalValues",strUpdateIssueValues);}};HelpdeskSession.prototype._generate_xmlmc_updatedbvalues=function(strParam,xmlmc){var strUpdateDbValues="";for(strParam in this._xmlmc_values){if(strParam.indexOf("updatedb.")==0){var arrParam=strParam.split(".");strUpdateDbValues+="<"+arrParam[1]+">"+app.pfx(this._xmlmc_values[strParam])+"</"+arrParam[1]+">";}}if(strUpdateDbValues!=""){xmlmc.SetParamAsComplexType("extraUpdateDbValues",strUpdateDbValues);}};HelpdeskSession.prototype._generate_xmlmc_additionalcallvalues=function(strParam,xmlmc){var strOpencallValues="";for(strParam in this._xmlmc_values){if(strParam.indexOf("opencall.")==0){var arrParam=strParam.split(".");strOpencallValues+="<"+arrParam[1]+">"+app.pfx(this._xmlmc_values[strParam])+"</"+arrParam[1]+">";}}if(strOpencallValues!=""){xmlmc.SetParamAsComplexType("additionalCallValues",strOpencallValues);}};HelpdeskSession.prototype._CommitToXmlmc=function(strActionVerb){if(strActionVerb==undefined||strActionVerb==""){strActionVerb=this._actionverb;}if(!this._bUseXmlmc){return this.Commit(strActionVerb);}var xmlmc=new XmlMethodCall();for(strParam in this._xmlmc_param_mappings){var strHelpdeskSessionParamName=this._xmlmc_param_mappings[strParam];if(strParam.indexOf(":")>-1&&this._xmlmc_values[strHelpdeskSessionParamName]!=undefined){var formatterInfo=strParam.split(":");var formatter=formatterInfo[1];strParam=formatterInfo[0];switch(formatter){case"epochtodatetime":if(this._xmlmc_values[strHelpdeskSessionParamName]>0){var UTCDATE=app._date_from_epoch(this._xmlmc_values[strHelpdeskSessionParamName]);var strDateTime=app._formatDate(UTCDATE,"yyyy-MM-dd HH:mm:ss");this._xmlmc_values[strHelpdeskSessionParamName]=strDateTime;}break;case"backdatetodatetime":if(this._xmlmc_values[strHelpdeskSessionParamName]>60){var intCurrentTime=app.global.GetCurrentEpocTime();var backDateEpoch=intCurrentTime-this._xmlmc_values[strHelpdeskSessionParamName];var strDateTime=_epoch_to_timestamp(backDateEpoch,true);this._xmlmc_values[strHelpdeskSessionParamName]=strDateTime;}else{this._xmlmc_values[strHelpdeskSessionParamName]=undefined;}break;case"checkclosecallstatus":var val=this._xmlmc_values[strHelpdeskSessionParamName];if(val==6){this._xmlmcMethod="resolveCalls";this._xmlmc_values["status"]=undefined;this._xmlmc_values["delaycacheflush"]=undefined;}else{this._xmlmc_values["status"]=(this._xmlmc_values["status"]==18)?"true":"false";}break;}}if(strParam.toLowerCase()=="callref"){var strCallrefs=this._xmlmc_param_mappings[strParam]+"";var arrCallrefs=strCallrefs.split(",");for(var x=0;x<arrCallrefs.length;x++){xmlmc.SetParam(strParam,arrCallrefs[x]);}}else{if($.isFunction(this[strHelpdeskSessionParamName])){this[strHelpdeskSessionParamName](strParam,xmlmc);}else{if(this._xmlmc_values[strHelpdeskSessionParamName]!=undefined){xmlmc.SetParam(strParam,this._xmlmc_values[strHelpdeskSessionParamName]);}}}}if(xmlmc.Invoke("helpdesk",this._xmlmcMethod)){this.lasterrorstring="";this.boolresult=true;var strReturnString="";if(this._xmlmcMethodReturnType=="callaction"){var arrCallActions=xmlmc.xmlDOM.getElementsByTagName("callActionStatus");for(var x=0;x<arrCallActions.length;x++){var strCallref=app.xmlNodeTextByTag(arrCallActions[x],"callref");var strStatus=app.xmlNodeTextByTag(arrCallActions[x],"success");if(strStatus!="fail"){var strUDIndex=app.xmlNodeTextByTag(arrCallActions[x],"udIndex");if(strReturnString!=""){strReturnString+="\n";}strReturnString+="updateref="+strCallref+"."+strUDIndex;}else{var strMessage=app.xmlNodeTextByTag(arrCallActions[x],"message");this.boolresult=false;this.lasterrorstring=strMessage;}}}this.resultstring=strReturnString;this.SetReturnValues();}else{this.boolresult=false;this.lasterrorstring=xmlmc._lasterror;}this.ResetValues();return this.boolresult;};HelpdeskSession.prototype.Commit=function(strActionVerb){if(this._bUseXmlmc){return this._CommitToXmlmc(strActionVerb);}alert("HelpdeskSession.Commit is not supported");return false;if(strActionVerb==undefined){strActionVerb="";}var strParams="_wcactionverb="+strActionVerb+"&_uniqueformid="+this._uniqueformid+"&command="+this.command+"&_swcallrefs="+this.strCallrefs;var strStrParams=app._params_from_array(this.array_files,"swhdfile__");if(strStrParams!=""){strParams+="&"+strStrParams;}var strStrParams=app._params_from_array(this.array_strvalues,"swhdstr__");if(strStrParams!=""){strParams+="&"+strStrParams;}var strNumParams=app._params_from_array(this.array_numvalues,"swhdnum__");if(strNumParams!=""){strParams+="&"+strNumParams;}var strTxtParams=app._params_from_array(this.array_txtvalues,"swhdtxt__");if(strTxtParams!=""){strParams+="&"+strTxtParams;}var strDateParams=app._params_from_array(this.array_datevalues,"swhddate__");if(strDateParams!=""){strParams+="&"+strDateParams;}var strVarParams=app._params_from_array(this.array_values,"swhd__");if(strVarParams!=""){strParams+="&"+strVarParams;}var strVarParams=app._params_from_array(this.array_ext_values,"swext__");if(strVarParams!=""){strParams+="&"+strVarParams;}this.resultarray=new Array();var d=new Date();app.debugstart(d,"helpdesksession.Commit");var strURL=app.get_service_url("swclass/helpdesksession","");this.resultstring=app.get_http(strURL,strParams,true,false);app.debugend(d,"helpdesksession.Commit");var boolRes=(this.resultstring.indexOf("OK")>-1);this.resultstring=app.string_replace(this.resultstring,"+OK","",false);this.resultstring=app.string_replace(this.resultstring,"-OK","",false);if(!boolRes){this.lasterrorstring=this.resultstring;}else{this.SetReturnValues();}this.boolresult=boolRes;this.ResetValues();return boolRes;};HelpdeskSession.prototype.ResetValues=function(){this._xmlmc_values=new Array();this._xmlmcMethod="";this._bUseXmlmc=false;this.array_strvalues=new Array();this.array_numvalues=new Array();this.array_txtvalues=new Array();this.array_values=new Array();this.array_ext_values=new Array();this.array_datevalues=new Array();this.array_files=new Array();this.array_xmlmc_files=new Array();this._actionverb="";};HelpdeskSession.prototype.Connect=function(){return true;};HelpdeskSession.prototype.GetCallTotalTimeSpent=function(nCallRef){var xmlmc=new XmlMethodCall();xmlmc.SetValue("callref",nCallRef);if(xmlmc.Invoke("helpdesk","getCallTotalTimeSpent")){return xmlmc.GetParam("timeSpent");}return 0;};HelpdeskSession.prototype.GetCallUpdateResultData=function(){var retArray=new Array();var arrInfo=this.resultstring.split("updateref=");for(var x=0;x<arrInfo.length;x++){var tmp=arrInfo[x].split(".");if(tmp[0]!=undefined&&tmp[0]!=""){retArray[tmp[0]]=tmp[1];}}return retArray;};HelpdeskSession.prototype.GetLastErrorStr=function(){return this.lasterrorstring;};HelpdeskSession.prototype.GetResult=function(){return this.boolresult;};HelpdeskSession.prototype.GetResultInfo=function(){var tArr=new Array();var tO=new Object();for(strItem in this.resultarray){tO[strItem]=this.resultarray[strItem];}tArr[0]=tO;return tArr;return this.resultstring;};HelpdeskSession.prototype.SetReturnValues=function(){var strResult=this.resultstring.substring(4);this.resultarray=new Array();var arrValues=strResult.split(";");for(var x=0;x<arrValues.length;x++){var item=arrValues[x];var pair=item.split("=");var field=app.trim(pair[0]);var value=app.string_replace(pair[1],'"'," ",true);this.resultarray[field]=value;if(field=="callref"){this.resultarray["strcallref"]=value;if(isNaN(value)){value=value.substring(1);value++;value--;}}this.resultarray[field]=value;}};HelpdeskSession.prototype.GetReturnValue=function(strName){return this.resultarray[strName];};HelpdeskSession.prototype.GetReturnValueArray=function(){return this.resultarray;};HelpdeskSession.prototype.GetReturnDataStr=function(){return this.resultstring;};HelpdeskSession.prototype.GetSessionFileInfo=function(){var arrInfo=this.resultstring.split("updateref=");if(arrInfo[1]!=undefined){return arrInfo[1];}return null;};HelpdeskSession.prototype.SendBoolean=function(strParamName,bValue){if(!isNaN(bValue)){bValue=bValue-0;}this._xmlmc_values[strParamName]=(bValue)?"true":"false";this.array_numvalues[strParamName]=(bValue)?"1":"0";return true;};HelpdeskSession.prototype.SendDate=function(strParamName,strValue){this._xmlmc_values[strParamName]=strValue;this.array_datevalues[strParamName]=strValue;return true;};HelpdeskSession.prototype.SendFile=function(strParamName,strFileName){if(strFileName===undefined){this.array_xmlmc_files[strParamName]=true;}else{this.array_files[strParamName]=strFileName;}return true;};HelpdeskSession.prototype.SendString=function(strParamName,strValue){this._xmlmc_values[strParamName]=strValue;this.array_strvalues[strParamName]=strValue;return true;};HelpdeskSession.prototype.SendText=function(strParamName,strValue){this._xmlmc_values[strParamName]=strValue;this.array_txtvalues[strParamName]=strValue;return true;};HelpdeskSession.prototype.SendNumber=function(strParamName,strValue){if(strParamName.indexOf(".")>-1){var arrParam=strParamName.split(".");if(dd.tables[arrParam[0]]!=undefined&&dd.tables[arrParam[0]].columns[arrParam[1]]!=undefined){if(dd.tables[arrParam[0]].columns[arrParam[1]].IsNumeric()&&strValue==""){strValue="0";}}}this._xmlmc_values[strParamName]=strValue;this.array_numvalues[strParamName]=strValue;return true;};HelpdeskSession.prototype.SendValue=function(strParamName,strValue){if(strParamName.indexOf(".")>-1){var arrParam=strParamName.split(".");if(dd.tables[arrParam[0]]!=undefined&&dd.tables[arrParam[0]].columns[arrParam[1]]!=undefined){if(dd.tables[arrParam[0]].columns[arrParam[1]].IsNumeric()){if(strValue==""){strValue="0";}this._xmlmc_values[strParamName]=strValue;this.array_numvalues[strParamName]=strValue;return true;}}}this._xmlmc_values[strParamName]=strValue;this.array_values[strParamName]=strValue;return true;};HelpdeskSession.prototype.SendExtendedValue=function(strParamName,strValue){this._xmlmc_values[strParamName]=strValue;this.array_ext_values[strParamName]=strValue;return true;};function GetCallStatusInfo(strCallref){var ret=new Object();ret.nStatus=0;ret.strCallClass="";ret.strPriority="";var xmlmc=new XmlMethodCall();xmlmc.SetParam("callref",strCallref);if(xmlmc.Invoke("helpdesk","getCallStatusInfo")){ret.nStatus=xmlmc.GetParam("status");ret.strCallClass=xmlmc.GetParam("callClass");ret.strPriority=xmlmc.GetParam("priority");}return ret;}document.GetCallStatusInfo=GetCallStatusInfo;function MessageBox(strMessage,nOptions,callback,aWin){var undefined;if(nOptions==undefined){nOptions=0;}if(aWin==undefined){try{if(_swdoc){app._CURRENT_JS_WINDOW=window;aWin=window;}}catch(e){if(app._CURRENT_JS_WINDOW!=null){aWin=app._CURRENT_JS_WINDOW;}else{aWin=window;}}}if(nOptions==0){alert(strMessage);if(callback){callback(0);}return 0;}var info={};info.__app=app;info.__modal=true;info.__parentwindow=aWin;info.message=strMessage;info.noptions=nOptions;info.__callback=function(msgResult){if(callback){callback(msgResult);}};return app._open_window(app._root+"client/forms/_system/messagebox/messagebox.php","messagboxpopper",true,400,120,info,aWin,"messagebox.php");}var bAlert=false;function _override_alert(strMessage){var win=(app._CURRENT_JS_WINDOW!=null)?app._CURRENT_JS_WINDOW:window;win.alert(strMessage);}function PickFileDialog(){this.path="";this.filename="";this.filepath="";this.size=0;this.lastmodified="";alert("PickFileDialog : Is not supported in the Webclient");return false;}PickFileDialog.prototype.Open=function(){alert("PickFileDialog.Open : Is not supported in the Webclient");return false;};PickFileDialog.prototype.NextFile=function(){alert("PickFileDialog.NextFile : Is not supported in the Webclient");return false;};function WordDocument(){this.variables=new Array();return true;}WordDocument.prototype.SetVariable=function(strVar,varValue){this.variables[strVar]=varValue;return true;};WordDocument.prototype.CreateDocument=function(strTemplatePath,strSavePath){alert("WordDocument.CreateDocument : Is not supported in the Webclient");return false;};WordDocument.prototype.ResetVariables=function(){this.variables=new Array();return true;};function Issue(){this.what="what is this calls about?";this.issueref="";this.type=1;this.flags=0;this.status=1;this.mastercallref=0;this.timestart=app.global.GetCurrentEpocTime();this.timeresolveby=this.timestart+3600;this.timeresolved=0;this.affecteduserscount=0;this.description="";this.bcreated=true;this.bcallslocked=false;this._arrcallrefs=new Array();this._arrcustomers=new Array();this.Unapp=app;}Issue.prototype.SetDefaults=function(nCallref){this.type=1;this.status=1;this.timestart=app.global.GetCurrentEpocTime();this.timeresolveby=this.timestart+3600;return true;};Issue.prototype.UnLockCalls=function(strCallrefs){return true;};Issue.prototype.SetIssueRef=function(strIssueRef,strPointer){this.issueref=strIssueRef;return true;};Issue.prototype.Close=function(nCallref){this.status=16;return true;};Issue.prototype.Update=function(strPointer,strTable){return true;};Issue.prototype.PopulateFromCall=function(nCallref){return true;};Issue.prototype.AddCalls=function(strCallrefs){strCallrefs+="";var arrCalls=strCallrefs.split(",");for(var x=0;x<arrCalls.length;x++){this._arrcallrefs[arrCalls[x]]=true;}return true;};Issue.prototype.RemoveCalls=function(strCallrefs){strCallrefs+="";var arrCalls=strCallrefs.split(",");for(var x=0;x<arrCalls.length;x++){this._arrcallrefs[arrCalls[x]]=false;}return true;};Issue.prototype.IsCustomerConnected=function(strCustID){if(this._arrcustomers[strCustID]!=undefined){return this._arrcustomers[strCustID];}return false;};Issue.prototype.AddCustomer=function(strCustID){this._arrcustomers[strCustID]=true;return true;};Issue.prototype.GetCommaSepCallRefList=function(strCustID){var strCallref="";for(iCallref in this._arrcallrefs){if(this._arrcallrefs[iCallref]){if(strCallref!=""){strCallref+=",";}strCallref+=iCallref;}}return strCallref;};Issue.prototype.GetStatus=function(){return this.status;};Issue.prototype.GetTypeString=function(){var strType=(this.type==1)?"Hot":"Known";return strType;};Issue.prototype.GetDirty=function(){return 8;};Issue.prototype.IsDirty=function(){return false;};Issue.prototype.IsCreated=function(){return false;};function AddCallsToIssueDialog(){this.selCount=0;this.arrSelectedCallrefs=new Array();return false;}AddCallsToIssueDialog.prototype.Open=function(callback){var me=this;var oForm=app._open_system_form("_wc_addcallstoissue","swissues","","",true,function(formReturnInfo){if(formReturnInfo&&formReturnInfo._swdoc._selectedcallrefs!=""){var refs=oForm._swdoc._selectedcallrefs+"";me.arrSelectedCallrefs=refs.split(",");me.selCount=this.arrSelectedCallrefs.length;var retObject={};retObject.selCount=me.selCount;retObject.arrSelectedCallrefs=me.arrSelectedCallrefs;callback(retObject);}else{callback(0);}});};function OpenSqlTreeBrowserForm(strSearchFormName,boolArg1,boolArg2){var oForm=app._open_application_form("treebrowserform."+strSearchFormName,"stf","","resolvemode=1",true,"add",null,null,window);if(oForm&&oForm._swdoc._selected_treeformkey!=""){return oForm._swdoc._selected_treeformkey;}return"";}function RegGetString(strReg){var strParams="_regstring="+app.pfu(strReg);var strURL=app.get_service_url("swclass/reggetstring","");return app.get_http(strURL,strParams,true,false);}function RunProgram(){alert("RunProgram : Webclient does not support this method.");}function PCA_ShowDetails(strCompuerName){alert("PCA_ShowDetails : Webclient does not support this method.");return false;}function TAPIDial(strNumber){alert("TAPIDial : Webclient does not support this method.");return false;}function ShellExecute(strCommand){if((strCommand.indexOf("http:")==0)||(strCommand.indexOf("www.")==0)){if(strCommand.indexOf("http:")==-1){strCommand="http://"+strCommand;}window.open(strCommand,"");}else{if(strCommand.indexOf("hslib.exe")){var arrInfo=strCommand.split(",");var strUrlAssetInfo=app.trim(strCommand[1]);var arrMoreInfo=strUrlAssetInfo.split("-var");var strURL=arrMoreInfo[0];var strCompID="";var arrVars=new Array();for(var x=1;x<arrMoreInfo.length;x++){if(arrMoreInfo[x].indexOf("compname=")>-1){var arrTemp=arrMoreInfo[x].split("compname=");strCompID=app.trim(arrTemp[1]);}}if(strCompID!=""){app.global.RunHIB(strURL,"compname",strCompID);}else{alert("Expected [compname] was not specified for HIB. Please contact your Administrator.");}}else{alert(" ShellExecute : Webclient does not support this method.");}}}var arrSwapEnumBindingValues=new Array();arrSwapEnumBindingValues["appointments.show_time_as"]=new Array();arrSwapEnumBindingValues["appointments.show_time_as"]["free"]=1;arrSwapEnumBindingValues["appointments.show_time_as"]["busy"]=2;arrSwapEnumBindingValues["appointments.show_time_as"]["tentative"]=3;arrSwapEnumBindingValues["appointments.show_time_as"]["out_of_office"]=4;function XmlSqlQuery(){this._lasterror="";this._currentrow=-1;this._recordset=null;this._currentrecord=null;this._oI=null;}XmlSqlQuery.prototype.injectXmlmcRsData=function(xmlmcObject){this._recordset=xmlmcObject.xmlDOM;if(typeof this._recordset=="object"){return true;}return false;};XmlSqlQuery.prototype.HasRight=function(strSQL){strSQL=app.trim(strSQL.toLowerCase());var arrSQL=strSQL.split(" ");var strAction=arrSQL[0];var iCheckRight=0;switch(strAction){case"select":iCheckRight=_CAN_BROWSE_TABLEREC;break;case"update":iCheckRight=_CAN_UPDATE_TABLEREC;break;case"insert":iCheckRight=_CAN_ADDNEW_TABLEREC;break;case"delete":iCheckRight=_CAN_DELETE_TABLEREC;break;}var strTable="";var ifrompos=-1;var iwherepos=-1;var igrouppos=-1;var iorderpos=-1;var bPastInTo=false;for(var x=1;x<arrSQL.length;x++){if(strAction=="update"&&strTable==""){if(arrSQL[x]!=""){strTable=arrSQL[x];break;}}else{if(strAction=="insert"&&strTable==""){if(bPastInTo&&arrSQL[x]!=""){strTable=arrSQL[x];break;}if(arrSQL[x]=="into"){bPastInTo=true;}}else{if(arrSQL[x]=="from"&&ifrompos==-1){ifrompos=x;}if(arrSQL[x]=="where"&&iwherepos==-1){iwherepos=x;}if(arrSQL[x]=="order"&&iorderpos==-1){iorderpos=x;}if(arrSQL[x]=="group"&&igrouppos==-1){igrouppos=x;}}}}if(strAction=="delete"||strAction=="select"){var ilastPos=arrSQL.length;if(iwherepos!=-1){ilastPos=iwherepos;}else{if(igrouppos!=-1){ilastPos=igrouppos;}else{if(iorderpos!=-1){ilastPos=iorderpos;}}}var strAllTables="";for(var x=ifrompos+1;x<ilastPos;x++){strAllTables+=arrSQL[x];}strTable=strAllTables;}if(strTable==""){alert("XmlSqlQuery.prototype.HasRight: Could not find table name in the sql :-\n\n"+strSQL);return false;}var arrTables=strTable.split(",");for(var x=0;x<arrTables.length;x++){var res=app.session.CheckTableRight(arrTables[x],iCheckRight,true);if(res!=""){alert(res);return false;}}return true;};XmlSqlQuery.prototype._getsqlinfo=function(strSQL){var sqlInfo=new Object();strSQL=app.trim(strSQL.toLowerCase());var arrSQL=strSQL.split(" ");var strAction=arrSQL[0];var strTable="";var ifrompos=-1;var iwherepos=-1;var igrouppos=-1;var iorderpos=-1;var bPastInTo=false;for(var x=1;x<arrSQL.length;x++){if(strAction=="update"&&strTable==""){if(arrSQL[x]!=""){strTable=arrSQL[x];break;}}else{if(strAction=="insert"&&strTable==""){if(bPastInTo&&arrSQL[x]!=""){strTable=arrSQL[x];break;}if(arrSQL[x]=="into"){bPastInTo=true;}}else{if(arrSQL[x]=="from"&&ifrompos==-1){ifrompos=x;}if(arrSQL[x]=="where"&&iwherepos==-1){iwherepos=x;}if(arrSQL[x]=="order"&&iorderpos==-1){iorderpos=x;}if(arrSQL[x]=="group"&&igrouppos==-1){igrouppos=x;}}}}if(strAction=="delete"||strAction=="select"){var ilastPos=arrSQL.length;if(iwherepos!=-1){ilastPos=iwherepos;}else{if(igrouppos!=-1){ilastPos=igrouppos;}else{if(iorderpos!=-1){ilastPos=iorderpos;}}}var strAllTables="";for(var x=ifrompos+1;x<ilastPos;x++){strAllTables+=arrSQL[x];}strTable=strAllTables;}sqlInfo.action=app.trim(strAction);sqlInfo.tables=app.trim(strTable);var iF=strSQL.indexOf("from");sqlInfo.columns=app.trim(strSQL.substring(0,iF));sqlInfo.columns=app.trim(app.string_replace(sqlInfo.columns,strAction,"",true));return sqlInfo;};XmlSqlQuery.prototype.Query=function(strSQL,strDB){if(strDB==undefined){strDB="swdata";}if(strSQL==undefined||strSQL==""){alert("XmlSqlQuery.Query expects a strSQL parameter");}this._oI=this._getsqlinfo(strSQL);var strDelete="";if(strSQL.toLowerCase().indexOf("delete")==0){strDelete="yes";}var strParams="delete="+strDelete+"&execsql="+app.pfu(strSQL)+"&db="+strDB;var strURL=app.get_service_url("swclass/sqlquery","");app.debugstart(strSQL,"swjs.XmlSqlQuery");this._recordset=app.get_http(strURL,strParams,true,true);app.debugend(strSQL,"swjs.XmlSqlQuery");if(typeof this._recordset=="object"){return true;}return false;};XmlSqlQuery.prototype.query=XmlSqlQuery.prototype.Query;XmlSqlQuery.prototype.fetch=function(){return this.Fetch();};XmlSqlQuery.prototype.Fetch=function(){if(this._recordset.childNodes.length==0){return false;}this._currentrow++;var arrNodes=this._recordset.childNodes[0].getElementsByTagName("row");if(arrNodes[this._currentrow]==undefined){this._currentrecord=null;return false;}this._currentrecord=arrNodes[this._currentrow];return true;};XmlSqlQuery.prototype.GetValueAsNumber=function(intColIndex,boolDisplay){if(this._recordset.childNodes.length==0){return false;}if(this._currentrecord==null){return false;}if(boolDisplay==undefined){boolDisplay=false;}var testNum=new Number(intColIndex);if(isNaN(testNum)){intColIndex=this.GetColumnIndex(intColIndex);}if(this._currentrecord.childNodes[intColIndex]!=undefined){if(boolDisplay){var cNode=(this._currentrecord.childNodes[intColIndex].childNodes.length==2)?this._currentrecord.childNodes[intColIndex].childNodes[1]:this._currentrecord.childNodes[intColIndex].childNodes[0];}else{var cNode=(this._currentrecord.childNodes[intColIndex].childNodes.length==2)?this._currentrecord.childNodes[intColIndex].childNodes[0]:this._currentrecord.childNodes[intColIndex].childNodes[0];}var num=new Number(app.xmlText(cNode));num++;num--;return num;}};XmlSqlQuery.prototype.GetValueAsString=function(intColIndex,boolDisplay){try{if(this._recordset.childNodes.length==0){return"";}if(this._currentrecord==null){return"";}if(boolDisplay==undefined){boolDisplay=false;}var testNum=new Number(intColIndex);if(isNaN(testNum)){intColIndex=this.GetColumnIndex(intColIndex);}if(this._currentrecord.childNodes[intColIndex]!=undefined){if(boolDisplay){var cNode=(this._currentrecord.childNodes[intColIndex].childNodes.length==2)?this._currentrecord.childNodes[intColIndex].childNodes[1]:this._currentrecord.childNodes[intColIndex].childNodes[0];}else{var cNode=(this._currentrecord.childNodes[intColIndex].childNodes.length==2)?this._currentrecord.childNodes[intColIndex].childNodes[0]:this._currentrecord.childNodes[intColIndex].childNodes[0];}return app.xmlText(cNode);}return"";}catch(e){return"";}};XmlSqlQuery.prototype.GetColumnIndex=function(strColName){if(this._recordset.childNodes.length==0){return -1;}this.GetColumnCount();if(this._currentrecord==null){return -1;}var nodes=this._currentrecord.childNodes;var yLen=nodes.length;for(var x=0;x<yLen;x++){if(nodes[x].tagName.toLowerCase()==app.trim(strColName.toLowerCase())){return x;}}return -1;};XmlSqlQuery.prototype.GetColumnName=function(intColIndex){if(this._recordset.childNodes.length==0){return"";}this.GetColumnCount();if(this._currentrecord==null){return"";}if(this._currentrecord.childNodes[intColIndex]!=undefined){var strTableAppend="";if(this._oI!=null){if(this._currentrecord.childNodes[intColIndex].tagName.indexOf(".")==-1&&this._oI.action=="select"&&this._oI.tables.indexOf(",")==-1&&this._oI.columns=="*"){strTableAppend=this._oI.tables+".";}}return strTableAppend+this._currentrecord.childNodes[intColIndex].tagName;}return"";};XmlSqlQuery.prototype.GetColumnCount=function(){if(this.currentrow==-1){this.Fetch();this._currentrow=-1;}if(this._currentrecord==null){return 0;}return this._currentrecord.childNodes.length;};XmlSqlQuery.prototype.GetRowCount=function(){if(this._recordset.childNodes==undefined){return 0;}if(this._recordset.childNodes[0]==undefined){return 0;}var arrNodes=this._recordset.childNodes[0].getElementsByTagName("row");return arrNodes.length;};XmlSqlQuery.prototype.IsColNumeric=function(intColIndex){if(this._recordset.childNodes.length==0){return false;}var value=this.GetValueAsNumber(intColIndex);if(isNaN(value)){return false;}return true;};XmlSqlQuery.prototype.Reset=function(){this._currentrow=-1;this._recordset=null;this._currentrecord=null;this._lasterror="";return true;};XmlSqlQuery.prototype.GetLastError=function(){return this._lasterror;};function _cBoolean(varToTest){if(varToTest==="true"||varToTest==="TRUE"||varToTest==="True"||varToTest===true||varToTest===1){return true;}return false;}function GetAsISO8601TimeString(intEpochDateTime){return app.global.GetAsISO8601TimeString(intEpochDateTime);};;;;var undefined;var isIE=(window.ActiveXObject);function _toolbar_action(strID){app._CURRENT_JS_WINDOW=window;_swdoc_pointer._process_form_toolbar_action(strID);}function _qlc_saveas(strID){switch(strID){case"saveqlc":app.OpenWebClientForm("_sys_qlc_saveas","","",true,"qlc",window,function(oForm){if(oForm.document._saveas!=""){if(oForm.document._overwrite){var xmlmc=new XmlMethodCall();xmlmc.SetParam("name",oForm.document._saveas);xmlmc.SetParam("mailbox",oForm.document._saveasgroup);if(!xmlmc.Invoke("helpdesk","quicklogCallDelete")){alert("Failed to replace the existing quick-log record. Please conact your Administrator.\n\n"+xmlmc.GetLastError());return false;}}document._save_qlc(oForm.document._saveas,oForm.document._saveasgroup,oForm.document._savewf);}});break;}}function _workflow_action(strID){switch(strID){case"wfmanage":var ipgs=document.getElementById("if_workflow").contentWindow._get_nextnew_pgs();var strParams="_pgs="+ipgs+"&_callref="+document.opencall.callref+"&_tempworkflowtable="+document._tempworkflowtable;app.OpenWebClientForm("_sys_cdf_manage_newworkflow","",strParams,true,"workflow",window,function(res){document.getElementById("if_workflow").contentWindow._filter_workflow_list();});break;case"wfm_complete":document.getElementById("if_workflow").contentWindow._complete_item();break;case"wfaddtemplate":document.getElementById("if_workflow").contentWindow._add_existing_template();break;case"wfaddlist":document.getElementById("if_workflow").contentWindow._add_existing_worklist();break;case"wfnewitem":document.getElementById("if_workflow").contentWindow._create_new_workitem();break;case"wfnewlist":document.getElementById("if_workflow").contentWindow._create_new_worklist();break;case"wfrename":document.getElementById("if_workflow").contentWindow._rename_worklist();break;case"wfdelete":document.getElementById("if_workflow").contentWindow._delete_worklist_or_item();break;case"wfdelete":document.getElementById("if_workflow").contentWindow._delete_worklist_or_item();break;case"wfup":document.getElementById("if_workflow").contentWindow._move_worklist_or_item("up");break;case"wfdown":document.getElementById("if_workflow").contentWindow._move_worklist_or_item("down");break;case"wftoggle":document.getElementById("if_workflow").contentWindow._toggle_worklist_sequence();break;}}function _json_to_js(oJson,targetObject,castFunction){var undefined;if(oJson==null||oJson==undefined||targetObject==undefined){return;}for(strKey in oJson){if(typeof(oJson[strKey])=="string"){targetObject[strKey]=(castFunction)?castFunction(oJson[strKey]):oJson[strKey];}}}function _xml_to_js(oXML,targetObject,castFunction){var undefined;if(oXML==null||oXML==undefined||targetObject==undefined){return;}var _array=new Array();var xmlChildren=oXML.childNodes;var xmlChildChildren=new Array();var iLen=xmlChildren.length;for(var i=0;i<iLen;i++){if(xmlChildren[i].tagName==null){continue;}xmlChildChildren=xmlChildren[i].childNodes;if(xmlChildChildren.length==1){var varValue=(castFunction!=undefined)?castFunction(xmlChildChildren[0].nodeValue):xmlChildChildren[0].nodeValue;targetObject[xmlChildren[i].tagName]=varValue;}}}function GetWinWidth(){if(app.isIE&&!app.isIE10Above){return +$(".sizeHoriz").outerWidth();}return jqWin.innerWidth();}function GetWinHeight(){if(app.isIE&&!app.isIE10Above){return +$(".sizeVert").outerHeight();}return jqWin.innerHeight();}function _cBoolean(varValue){var bVal=(varValue=="1"||varValue==1||varValue=="true"||varValue=="TRUE"||varValue==true)?true:false;return bVal;}function _cNum(varValue){varValue--;varValue++;return varValue;}function insertBeforeEnd(node,html){if(node.insertAdjacentHTML){node.insertAdjacentHTML("beforeEnd",html);return node.children[node.children.length-1];}else{var r=node.ownerDocument.createRange();r.setStartBefore(node);var parsedHTML=r.createContextualFragment(html);return node.appendChild(parsedHTML);}}function _mousebtn(e){var rightclick;if(!e){var e=window.event;}if(e.which){rightclick=(e.which==3);}else{if(e.button){rightclick=(e.button==2);}}if(rightclick){return 2;}else{return 1;}}function create_xml_dom(strXML){if(window.ActiveXObject){var MSXML2_DOM_PROGIDS=new Array("MSXML2.DOMDocument.5.0","MSXML2.DOMDocument.4.0","MSXML2.DOMDocument.3.0","MSXML2.DOMDocument","Microsoft.XmlDom");for(var x=0;x<MSXML2_DOM_PROGIDS.length;x++){var oXML=null;try{oXML=new ActiveXObject(MSXML2_DOM_PROGIDS[x]);}catch(e){}if(oXML!=null){if(!oXML.loadXML(strXML)){debug("create_xml_dom ("+MSXML2_DOM_PROGIDS[x]+") : Error loading XML into DOM");}else{break;}}}}else{oXML=(new DOMParser).parseFromString(strXML,"text/xml");cleanWhitespace(oXML.documentElement);}if(!oXML.documentElement){alert("The returned xml does not have a valid document root.\n\n"+strXML);debug(strXML);}return oXML;}var notWhitespace=/\S/;function cleanWhitespace(node){for(var x=0;x<node.childNodes.length;x++){var childNode=node.childNodes[x];if((childNode.nodeType==3)&&(!notWhitespace.test(childNode.nodeValue))){node.removeChild(node.childNodes[x]);x--;}if(childNode.nodeType==1){cleanWhitespace(childNode);}}}function _open_control_form(strFormName,strMode,strKey,strParams,callback){var strType="Form";if(strFormName.indexOf(".")>0){strType=strFormName.split(".")[0];strFormName=strFormName.split(".")[1];}if(strType=="Form"){strType="stf";app._open_application_form(strFormName,strType,strKey,strParams,true,strMode,callback,null,window);}else{if(strType=="SystemForms"){if(strFormName=="CallDetails"){app.global.OpenCallDetailsView(strKey);}else{if(strFormName=="NewCall"){}}}}}var __arr_fileupload_callbacks=new Array();function fileuploadcomplete(iResult,strFileName,strFileSize,strFileDate,strCallBackID,strWebRootPath,strOrigFileName){if(__arr_fileupload_callbacks[strCallBackID]){__arr_fileupload_callbacks[strCallBackID].filelist._onfileuploaded(iResult,strFileName,strFileSize,strFileDate,strWebRootPath,strOrigFileName);}else{if(iResult!="1"){alert(iResult);}}}function _get_sw_application_image(swFC){var strImagePath="";if(swFC.eventButtonIcon!=""){if(swFC.eventButtonIcon.indexOf("ImageList=")>-1){var arrImg=swFC.eventButtonIcon.split(";");var strImageList=arrImg[0].split("=")[1];var intIconIndex=arrImg[1].split("=")[1];strImagePath=app._root+"client/images/imagelists/"+strImageList+"/"+intIconIndex+".png";}else{if(!isNaN(swFC.eventButtonIcon)){strImagePath=app._root+"client/images/imagelists/"+swFC.eventButtonIcon+".png";}else{strImagePath=_parse_context_vars(swFC.eventButtonIcon);}}}return strImagePath;}function _get_sw_dbcurrency_from_value(strValue,bFormatted,bFromData,bFromUserEvent){if(lsession.currencySymbol==undefined){lsession.currencySymbol=lsession.rightsjson.params.currencySymbol.substring(1);}strValue=strValue+"";strValue=strValue.replace(/[^0-9.]/g,"");if(isNaN(strValue)){if(!bFromData){alert("The format of the currency field is ####.## or ####");}return(bFormatted)?lsession.currencySymbol+" 0.00":0;}if(bFromData){var strFirstPart=strValue.substring(0,strValue.length-2);var strEndPart=strValue.substring(strValue.length-2);if(bFormatted){if(strFirstPart==""){strFirstPart="0";}if(strEndPart==""){strEndPart="00";}return lsession.currencySymbol+" "+strFirstPart+"."+strEndPart;}else{return strValue;}}else{if(bFromUserEvent){if(strValue.indexOf(".")==-1){strValue+=".00";}}else{if(strValue.indexOf(".")==-1){var strFirstPart=strValue.substring(0,strValue.length-2);var strEndPart=strValue.substring(strValue.length-2);if(strFirstPart==""){strFirstPart="0";}strValue=strFirstPart+"."+strEndPart;}}var arrParts=strValue.split(".");if(arrParts.length>2){if(!bFromData&&bFormatted){alert("The format of the currency field is ####.## or ####");}return(bFormatted)?lsession.currencySymbol+" 0.00":0;}var pounds=arrParts[0];var cents=arrParts[1];if(pounds==""){pounds="0";}if(cents==""){cents="0";}if(isNaN(pounds)){if(!bFromData&&bFormatted){alert("The format of the currency field is ####.## or ####");}return(bFormatted)?lsession.currencySymbol+" 0.00":0;}if(isNaN(cents)||cents>99){if(!bFromData&&bFormatted){alert("The format of the currency field is ####.## or ####");}return(bFormatted)?lsession.currencySymbol+" 0.00":0;}cents--;cents++;if(cents<10){cents=cents+"0";}return(bFormatted)?lsession.currencySymbol+" "+pounds+"."+cents:(pounds+""+cents-0);}}function _getminutes_from_uservalue(strValue){if(strValue==""||strValue==0){return 0;}if(strValue<1){return 0;}strValue+="";if(strValue.indexOf(":")>-1){var arrTime=strValue.split(":");var minHours=(arrTime[0]*60)-0;var minMinutes=arrTime[1]-0;strValue=minHours+minMinutes;}if(isNaN(strValue)){return 0;}return strValue;}function _getseconds_from_uservalue(strValue,bFromData){if(strValue==""||strValue==0){return 0;}if(strValue<1){return 0;}if(bFromData==undefined){bFromData=true;}strValue+="";if(strValue.indexOf(":")>-1){var arrTime=strValue.split(":");var secHours=(arrTime[0]*3600)-0;var secMinutes=(arrTime[1]*60)-0;var secSeconds=0;if(arrTime[2]!=undefined){secSeconds=arrTime[2]-0;}strValue=secHours+secMinutes+secSeconds;}else{if(!bFromData){strValue=strValue*60;}}if(isNaN(strValue)){return 0;}return strValue;}function _format_minutetime_field(strValue){if(strValue==""||strValue==0){return"0:00";}if(strValue<1){return"0:00";}strValue+="";if(strValue.indexOf(":")>-1){var arrTime=strValue.split(":");var minHours=(arrTime[0]*3600)-0;var minMinutes=(arrTime[1]*60)-0;strValue=minHours+minMinutes;}else{if(isNaN(strValue)){return"0:00";}}var Hours=Math.floor(strValue/60);var Minutes=strValue-(Hours*60);if(Minutes<10){Minutes="0"+Minutes;}return Hours+":"+Minutes;}function _format_secondtime_field(strValue){if(strValue==""||strValue==0){return"0:00";}if(strValue<1){return"0:00";}strValue+="";if(strValue.indexOf(":")>-1){var arrTime=strValue.split(":");var secHours=(arrTime[0]*3600)-0;var secMinutes=(arrTime[1]*60)-0;var secSeconds=0;if(arrTime[2]!=undefined){secSeconds=arrTime[2]-0;}strValue=secHours+secMinutes+secSeconds;}var Hours=Math.floor(strValue/3600);var Minutes=Math.floor(strValue/60)-(Hours*60);var Seconds=strValue-(Hours*3600)-(Minutes*60);if(Minutes<10){Minutes="0"+Minutes;}if(Hours<10){Hours="0"+Hours;}if(Seconds<10){Seconds="0"+Seconds;}return Hours+":"+Minutes+":"+Seconds;}function _smi_recordproperties(jsonNode,callback){var strFormName=jsonNode.attrib1;var strKeyValue=jsonNode.attrib2;strKeyValue=_parse_context_vars(strKeyValue,false,false);if(strKeyValue==""){alert("No record is selected.");}else{_open_control_form(strFormName,"edit",strKeyValue,"",callback);}}function _smi_openinventory(jsonNode){var strCompID=_parse_context_vars(jsonNode.attrib2);var strURL=_parse_context_vars("http://&[app.server]:&[app.httpport]/aw/html/viewer4");app.global.RunHIB(strURL,"compname",strCompID);}function _smi_openhib(jsonNode){var strURL=jsonNode.attrib1;var strVars=jsonNode.attrib2;var arrMoreInfo=strVars.split("-var");var strCompID="";var arrVars=new Array();for(var x=1;x<arrMoreInfo.length;x++){if(arrMoreInfo[x].indexOf("compname=")>-1){var arrTemp=arrMoreInfo[x].split("compname=");strCompID=_parse_context_vars(app.trim(arrTemp[1]));}}if(strCompID!=""){app.global.RunHIB(_parse_context_vars(strURL),"compname",strCompID);}}function _smi_openurl(jsonNode){var strURL=jsonNode.attrib1;window.open(strURL,"","");}function _smi_swjs(jsonNode){app._CURRENT_JS_WINDOW=window;var strJS=jsonNode.attrib1;strJS=_prepare_swjscode_forwebclient(strJS);eval(strJS);}function _prepare_swjscode_forwebclient(strSwJS){return strSwJS;}function _smi_treebrowserform(jsonNode,formType){var strSearchFormName=jsonNode.attrib1;app._open_application_form("treebrowserform."+strSearchFormName,"stf","","resolvemode=1",true,"add",function(oForm){if(formType==_LCF||formType==_CDF){if(oForm._swdoc._selected_treeformkey!=""){var strColumn=dd.tables[oForm._swdoc._selected_treeformtable].PrimaryKey;if(strColumn!=""){if(formType==_LCF){document.ResolveRecord(oForm._swdoc._selected_treeformtable,strColumn,oForm._swdoc._selected_treeformkey,false);}else{if(formType==_CDF){document.ChangeRecord(oForm._swdoc._selected_treeformtable,oForm._swdoc._selected_treeformkey);}else{document.LoadRecordData("swdata",oForm._swdoc._selected_treeformtable,oForm._swdoc._selected_treeformkey);}}}}}},null,window);}function _smi_recordpicklistform(jsonNode,formType){var strPicklistFormName=jsonNode.attrib1;var strFilter=jsonNode.attrib2;var strParams="_filter="+_parse_context_vars(strFilter,false,false);app._open_system_form("_wc_picklist","picklist",strPicklistFormName,strParams,true,function(oForm){if(oForm==null){return;}if(oForm._swdoc._selected_picklistkey!=""){if(formType==_LCF){document.ResolveRecord(oForm._swdoc._selected_table,document._tables[oForm._swdoc._selected_table.toLowerCase()]._keycolumn,oForm._swdoc._selected_picklistkey,false,true);}else{if(formType==_CDF){document.ChangeRecord(oForm._swdoc._selected_table,oForm._swdoc._selected_picklistkey);}else{document.LoadRecordData("swdata",oForm._swdoc._selected_table,oForm._swdoc._selected_picklistkey);}}}},null,window);};;;;var _LCF="lcf";var _CDF="cdf";var _STF="stf";function _swdocument(){var oDoc=document;var lapp=app;app._CURRENT_JS_WINDOW=window;this.name="";this.type=_formtype;this._doc=oDoc;this.document=oDoc;this._form=new Array();this._listbox_extraoptions_bindings=new Array();this._profilefilter="";this._callclass="";this.mainform=null;this.extform=null;this._load_extform=false;this._isloading=true;this._activeform=this.mainform;this._tempworkflowtable="";this._bXmlForm=false;this._wcmc=new Array();this._XmlFormService="";this._XmlFormUpdateMethod="";this._XmlFormAddMethod="";this._XmlFormGetMethod="";this._XmlFormKeyParam="";this.showmeitems=new Array();this.infobar=new _sw_infobar();this._title="";this._printtemplate="";this._overide_master_save_table="";this._overide_dsn="";this._mastertable=null;this._exttable=null;this._tables=new Array();this._bSaveEnabled=false;this._useEmailDateToLogCall=false;this._params=new Array();if(info.__params==undefined){info.__params="";}info.__params=info.__params+"";var arrParams=info.__params.split("&");var plen=arrParams.length;for(var x=0;x<plen;x++){var iPos=arrParams[x].indexOf("=");var paramName=app.trim(arrParams[x].substring(0,iPos));var paramValue=arrParams[x].substring(iPos+1);try{this._params[paramName.toLowerCase()]=decodeURIComponent(paramValue);}catch(e){this._params[paramName.toLowerCase()]=paramValue;}}switch(this.type){case _LCF:_uniqueformid="LCF"+_uniqueformid;app.debugstart("_swdocument:_swdoc_lcf","xmlform.php");_swdoc_lcf(this);app.debugend("_swdocument:_swdoc_lcf","xmlform.php");break;case _CDF:_uniqueformid="CDF"+_uniqueformid;app.debugstart("_swdocument:_swdoc_cdf","xmlform.php");_swdoc_cdf(this);app.debugend("_swdocument:_swdoc_cdf","xmlform.php");break;default:_uniqueformid="STF"+_uniqueformid;app.debugstart("_swdocument:_swdoc_stf","xmlform.php");_swdoc_stf(this);app.debugend("_swdocument:_swdoc_stf","xmlform.php");break;}this._initok=true;app.debugstart("_swdocument:_initialise_tables","xmlform.php");if(!this._initialise_tables()){this._initok=false;return false;}app.debugend("_swdocument:_initialise_tables","xmlform.php");app.debugstart("_swdocument:_initialise_settings","xmlform.php");this._initialise_settings();app.debugend("_swdocument:_initialise_settings","xmlform.php");app.debugstart("_swdocument:_initialise_layout","xmlform.php");this._initialise_layout();app.debugend("_swdocument:_initialise_layout","xmlform.php");app.debugstart("_swdocument:copy pointer","xmlform.php");for(varThing in this){this._doc[varThing]=this[varThing];}app.debugend("_swdocument:copy pointer","xmlform.php");return true;}var SW_SHOWME_ACTION_SEPARATOR=0;var SW_SHOWME_ACTION_SQLQUER=1;var SW_SHOWME_ACTION_PROPERTIES=2;var SW_SHOWME_ACTION_SCRIPT=3;var SW_SHOWME_ACTION_BROWSER=4;var SW_SHOWME_ACTION_EXECPROGRAM=5;var SW_SHOWME_ACTION_SENDEMAIL=6;var SW_SHOWME_ACTION_SENDDOCUMENT=7;var SW_SHOWME_ACTION_INVENTORYDETAILS=8;var SW_SHOWME_ACTION_TREEBROWSERFORM=9;var SW_SHOWME_ACTION_OPENURL=10;var SW_SHOWME_ACTION_RECORDRESET=11;var SW_SHOWME_ACTION_RUNHIB=12;_swdocument.prototype.IsLoading=function(){return this._isloading;};_swdocument.prototype._initialise_showmeitems=function(oShowMeJson){if(oShowMeJson==null||oShowMeJson==undefined){return;}this.showmeitems=oShowMeJson.action;if(this.showmeitems==undefined){this.showmeitems=new Array();}};_swdocument.prototype._showmeitem_exists=function(strName,boolExec){var aLen=this.showmeitems.length;for(var x=0;x<aLen;x++){var aNode=this.showmeitems[x];var strActionName=aNode.name;if(strActionName==strName){if(boolExec){this._execute_showmeaction(aNode);}return true;}}return false;};_swdocument.prototype._save_qlc=function(strName,strGroup,intSaveWorkflow){var xmlmc=new XmlMethodCall();xmlmc.SetParam("name",strName);xmlmc.SetParam("formName",document._callclass);xmlmc.SetParam("callClass",document._callclass);xmlmc.SetParam("mailbox",strGroup);for(strColID in this._mastertable._columns){var strFieldValue=document.opencall[strColID];if(strFieldValue!=undefined&&strFieldValue!=this._mastertable._columns[strColID].originalvalue){strFieldValue+="";if(strFieldValue.indexOf("&[")==0&&strFieldValue.charAt(strFieldValue.length-1)=="]"){var testValue=_parse_context_vars(strFieldValue);if(testValue==""||testValue!=strFieldValue){continue;}}var strFieldName=this._mastertable._name+"."+strColID;var strFieldXml="<keyName>"+app.pfx(strFieldName)+"</keyName><keyValue>"+app.pfx(strFieldValue)+"</keyValue>";xmlmc.SetParamAsComplexType("quickLogKeyValues",strFieldXml);}}if(this._exttable!=undefined&&this._exttable!=null){for(strColID in this._exttable._columns){var strFieldValue=document[this._exttable._name][strColID];if(strFieldValue!=undefined&&strFieldValue!=this._exttable._columns[strColID].originalvalue){var strFieldName=this._exttable._name+"."+strColID;var strFieldXml="<keyName>"+app.pfx(strFieldName)+"</keyName><keyValue>"+app.pfx(strFieldValue)+"</keyValue>";xmlmc.SetParamAsComplexType("quickLogKeyValues",strFieldXml);}}}if(document.updatedb!=undefined&&document.updatedb!=null){for(strColID in document.updatedb._columns){var strFieldValue=document.updatedb[strColID];if(strFieldValue!=undefined&&strFieldValue!=document.updatedb._columns[strColID].originalvalue){var strFieldName="updatedb."+strColID;var strFieldXml="<keyName>"+app.pfx(strFieldName)+"</keyName><keyValue>"+app.pfx(strFieldValue)+"</keyValue>";xmlmc.SetParamAsComplexType("quickLogKeyValues",strFieldXml);}}}if(intSaveWorkflow==1){var xmlmcTemp=new XmlMethodCall();xmlmcTemp.SetParam("_tablename",this._tempworkflowtable);if(!xmlmcTemp.Invoke("webclient","getTemporaryWorkflowRecords")){alert("Failed to get temporary task records . Please contact your Administrator.");}else{var oRS=new XmlSqlQuery();oRS.injectXmlmcRsData(xmlmcTemp);var strCurrentParentGroup="";var strItemParentGroup="";var intParentGroupID=0;var strParentGroupType="open";var strWorkItemListInstance="";while(oRS.Fetch()){var intTaskID=app.pfx(oRS.GetValueAsNumber("taskid"));if(intTaskID==0){var useTaskID=0;var pFlag=app.pfx(oRS.GetValueAsNumber("flags"));strItemParentGroup=app.pfx(oRS.GetValueAsString("parentgroup"));intParentGroupID=app.pfx(oRS.GetValueAsNumber("parentgroupsequence"));strParentGroupType=(pFlag==4104)?"sequential":"open";if(strCurrentParentGroup!=strItemParentGroup){if(strCurrentParentGroup!=""){xmlmc.SetParamAsComplexType("workItemList",strWorkItemListInstance);}strCurrentParentGroup=strItemParentGroup;var strWorkItemListInstance="";strWorkItemListInstance+="<id>"+intParentGroupID+"</id>";strWorkItemListInstance+="<type>"+strParentGroupType+"</type>";strWorkItemListInstance+="<name>"+strItemParentGroup+"</name>";}continue;}useTaskID=(strParentGroupType=="open")?0:useTaskID+1;useTaskID=intTaskID;var strWorkflowTaskXml="<workItemInfo>";strWorkflowTaskXml+="<id>"+useTaskID+"</id>";strWorkflowTaskXml+="<parentGroup>"+strItemParentGroup+"</parentGroup>";strWorkflowTaskXml+="<description>"+app.pfx(oRS.GetValueAsString("details"))+"</description>";strWorkflowTaskXml+="<time>"+app.pfx(oRS.GetValueAsString("compltbyx"))+"</time>";strWorkflowTaskXml+="<assignToGroup>"+app.pfx(oRS.GetValueAsString("groupid"))+"</assignToGroup>";strWorkflowTaskXml+="<assignToAnalyst>"+app.pfx(oRS.GetValueAsString("analystid"))+"</assignToAnalyst>";var intActionBy=0;var intFlags=oRS.GetValueAsString("flags");if(intFlags&1){intActionBy=1;}else{if(intFlags&2){intActionBy=2;}}strWorkflowTaskXml+="<actionBy>"+intActionBy+"</actionBy>";strWorkflowTaskXml+="<priority>"+app.pfx(oRS.GetValueAsString("priority"))+"</priority>";strWorkflowTaskXml+="<type>"+app.pfx(oRS.GetValueAsString("type"))+"</type>";strWorkflowTaskXml+="<reminder>"+app.pfx(oRS.GetValueAsString("notifytime"))+"</reminder>";var bRemindAssignee=(intFlags&16)?1:0;var bRemindCallOwner=(intFlags&32)?1:0;var bNotifyGroup=(intFlags&64)?1:0;strWorkflowTaskXml+="<remindAssignee>"+bRemindAssignee+"</remindAssignee>";strWorkflowTaskXml+="<remindCallOwner>"+bRemindCallOwner+"</remindCallOwner>";strWorkflowTaskXml+="<notifyGroup>"+bNotifyGroup+"</notifyGroup>";strWorkflowTaskXml+="</workItemInfo>";strWorkItemListInstance+=strWorkflowTaskXml;}if(strCurrentParentGroup!=""){xmlmc.SetParamAsComplexType("workItemList",strWorkItemListInstance);}}}if(!xmlmc.Invoke("helpdesk","quicklogCallAdd")){alert("Failed to create quick-log record. Please conact your Administrator.\n\n"+xmlmc.GetLastError());return false;}else{alert("Quicklog ["+strName+"] saved.");}};_swdocument.prototype._process_qlc_data=function(oQLCXML){var arrFields=oQLCXML.getElementsByTagName("quickLogKeyValues");var aLen=arrFields.length;for(var x=0;x<aLen;x++){var strBinding=app.xmlNodeTextByTag(arrFields[x],"keyName");var strValue=app.xmlNodeTextByTag(arrFields[x],"keyValue");if(strValue=="undefined"){continue;}if(strBinding.indexOf(".")!=-1){document._set_data_value(strValue,strBinding,true,strValue,true);if(document.mainform.elementsbybinding[strBinding.toLowerCase()]!=undefined){for(strControlID in document.mainform.elementsbybinding[strBinding.toLowerCase()]){document.mainform.elementsbybinding[strBinding.toLowerCase()][strControlID]._value(strValue,"",false,false);}}if(document.extform.elementsbybinding[strBinding.toLowerCase()]!=undefined){for(strControlID in document.extform.elementsbybinding[strBinding.toLowerCase()]){document.extform.elementsbybinding[strBinding.toLowerCase()][strControlID]._value(strValue,"",false,false);}}}}if(this._tempworkflowtable!=""){var arrParentGroups=new Array();var arrTasks=oQLCXML.getElementsByTagName("workItemInfo");var intUsePGS=-1;var intAltTaskID=0;var lastParentGroup="";var atLen=arrTasks.length;for(var x=0;x<atLen;x++){var intUseTaskID=app.xmlNodeTextByTag(arrTasks[x],"id");var strParentGroup=app.xmlNodeTextByTag(arrTasks[x],"parentGroup");if(lastParentGroup!=strParentGroup){intAltTaskID=0;intUsePGS++;lastParentGroup=strParentGroup;}var intSequential=(app.xmlNodeTextByTag(arrTasks[x].parentNode,"type")=="open")?4096:4104;if(intUseTaskID==0){intAltTaskID++;intUseTaskID=intAltTaskID;}var bNotifyGroupOnComplete=app.xmlNodeTextByTag(arrTasks[x],"notifyGroup");var bRemindCallOwner=app.xmlNodeTextByTag(arrTasks[x],"remindCallOwner");var bRemindAssignee=app.xmlNodeTextByTag(arrTasks[x],"remindAssignee");var bSequential=false;var iFlags=0;if(bRemindAssignee=="true"){iFlags=iFlags+16;}if(bRemindCallOwner=="true"){iFlags=iFlags+32;}if(bNotifyGroupOnComplete=="true"){iFlags=iFlags+64;}var strAnalystid=app.xmlNodeTextByTag(arrTasks[x],"assignToAnalyst");var strGroupid=app.xmlNodeTextByTag(arrTasks[x],"assignToGroup");var strDetails=app.xmlNodeTextByTag(arrTasks[x],"description");var iNotifytime=app.xmlNodeTextByTag(arrTasks[x],"reminder");var iCompltbyx=app.xmlNodeTextByTag(arrTasks[x],"time");if(iCompltbyx==0){iCompltbyx=3600;}var strPriority=app.xmlNodeTextByTag(arrTasks[x],"priority");var strType=app.xmlNodeTextByTag(arrTasks[x],"type");if(arrParentGroups[strParentGroup]==undefined){var strParams="_type=list&_sequential="+intSequential+"&_table="+top.document._tempworkflowtable+"&_worklistname="+strParentGroup+"&_pgs="+intUsePGS;var strURL=app.webroot+"/webclient/service/workflow/create_temp_workitem.php";var res=app.get_http(strURL,"swsessionid="+app._swsessionid+"&"+strParams,true,false,null,null);if(res=="ok"){arrParentGroups[strParentGroup]=true;}}var xmlmc=new XmlMethodCall();xmlmc.SetParam("_tablename",this._tempworkflowtable);xmlmc.SetParam("taskid",intUseTaskID);xmlmc.SetParam("parentgroup",strParentGroup);xmlmc.SetParam("parentgroupsequence",intUsePGS);xmlmc.SetParam("flags",iFlags);xmlmc.SetParam("analystid",strAnalystid);xmlmc.SetParam("groupid",strGroupid);xmlmc.SetParam("details",strDetails);xmlmc.SetParam("notifytime",iNotifytime);xmlmc.SetParam("compltbyx",iCompltbyx);xmlmc.SetParam("priority",strPriority);xmlmc.SetParam("type",strType);if(!xmlmc.Invoke("webclient","insertTemporaryWorkflowItem")){alert("Failed to add quicklog call task. Please contact your Administrator.");}}}};_swdocument.prototype._reverse_resolve_relateddata=function(strMasterBinding,strMasterValue){for(strTable in this._tables){if(this._tables[strTable.toLowerCase()]._type==_RELATED){var strMainTableCol=this._mastertable._name+"."+this._tables[strTable.toLowerCase()]._maindetailscolumn;if(strMainTableCol.toLowerCase()==strMasterBinding.toLowerCase()){var relKeyColumn=this._tables[strTable.toLowerCase()]._keycolumn;var strRelBinding=this._tables[strTable.toLowerCase()]._name+"."+relKeyColumn;var currentRelValue=document[strTable.toLowerCase()][relKeyColumn];if(currentRelValue!=strMasterValue){if(this.LoadRecordData){this.LoadRecordData("swdata",strTable,strMasterValue);}else{document._set_data_value(strMasterValue,strRelBinding,false);}}}}}};_swdocument.prototype._execute_showmeitem=function(strIndex,strName){if(this.showmeitems.length==0){return;}if(strIndex>-1){strIndex--;strIndex++;if(this.showmeitems[strIndex]!=undefined){this._execute_showmeaction(this.showmeitems[strIndex]);}}else{var aSiLen=this.showmeitems.length;for(var x=0;x<aSiLen;x++){var aNode=this.showmeitems[x];var strActionName=aNode.name;if(strActionName==strName){this._execute_showmeaction(aNode);}}}};_swdocument.prototype._execute_showmeaction=function(jsonActionNode){var strActionName=jsonActionNode.name;var actionType=jsonActionNode.id;actionType--;actionType++;switch(actionType){case SW_SHOWME_ACTION_PROPERTIES:_smi_recordproperties(jsonActionNode,function(oForm){if(oForm&&oForm.recordsaved){var iStart=jsonActionNode.attrib2.indexOf("&[");if(iStart>-1){var binding=jsonActionNode.attrib2.replace("&[","").replace("]","").split(".");var keyValue=_parse_context_vars(jsonActionNode.attrib2,false,false);document.ResolveRecord(binding[0],binding[1],keyValue,true,true);}}});break;case SW_SHOWME_ACTION_SCRIPT:_smi_swjs(jsonActionNode,this.type);break;case SW_SHOWME_ACTION_TREEBROWSERFORM:_smi_treebrowserform(jsonActionNode,this.type);break;case SW_SHOWME_ACTION_OPENURL:_smi_openurl(jsonActionNode,this.type);break;case SW_SHOWME_ACTION_RUNHIB:_smi_openhib(jsonActionNode,this.type);break;case SW_SHOWME_ACTION_INVENTORYDETAILS:_smi_openinventory(jsonActionNode,this.type);break;case SW_SHOWME_ACTION_BROWSER:_smi_recordpicklistform(jsonActionNode,this.type);break;case SW_SHOWME_ACTION_RECORDRESET:case SW_SHOWME_ACTION_EXECPROGRAM:case SW_SHOWME_ACTION_SENDEMAIL:case SW_SHOWME_ACTION_SENDDOCUMENT:case SW_SHOWME_ACTION_SEPARATOR:case SW_SHOWME_ACTION_SQLQUER:default:alert("The show me action "+strActionName+" is not currently supported by the webclient.");break;}};_swdocument.prototype._load_fielddata_from_xmlmc=function(xmlRecord,strXmlBindingID){};_swdocument.prototype._initialise_xmlmc_form=function(strService,strGetMethod,strAddMethod,strUpdateMethod,strKeyParam){document._bXmlForm=true;document._XmlFormService=strService;document._XmlFormUpdateMethod=strUpdateMethod;document._XmlFormAddMethod=strAddMethod;document._XmlFormGetMethod=strGetMethod;document._XmlFormKeyParam=strKeyParam;if(document._wcmc[strService]==undefined){document._wcmc[strService]=new Array();var strURL=app._root+"client/wcxml/xmlmc.schema.xml";var oSchemaXML=app.get_http(strURL,"",true,true);var arrServiceXML=oSchemaXML.getElementsByTagName(strService);if(arrServiceXML.length==0){alert("_initialise_xmlmc_form : There is no xmlmc service definition for ["+strService+"]. Please contact your administrator.");return false;}var arrMethod=arrServiceXML[0].getElementsByTagName(strAddMethod);if(arrMethod.length==0){alert("_initialise_xmlmc_form : There is no xmlmc service definition for ["+strService+":"+strAddMethod+"]. Please contact your administrator.");return false;}var arrInputParams=arrMethod[0].getElementsByTagName("input");if(arrInputParams.length>0){var aIpLen=arrInputParams[0].childNodes.length;for(var x=0;x<aIpLen;x++){var xmlParam=arrInputParams[0].childNodes[x];var strParamName=xmlParam.tagName;if(strParamName!=undefined&&strParamName!=""){var bComplex=false;var pType=xmlParam.getAttribute("type");var defValue=xmlParam.getAttribute("default");var strConv=xmlParam.getAttribute("conversion");var initValue="";if(defValue!=null||defValue!=undefined){initValue=defValue;}else{switch(pType.toLowerCase()){case"int":initValue=0;break;case"bool":initValue=0;break;case"complex":var complexObject=new Object();complexObject._complicated=true;var xmlComplexParams=xmlParam.childNodes;for(var y=0;y<xmlComplexParams.length;y++){bComplex=true;var xmlComplexParam=xmlComplexParams[y];var strComplexParamName=xmlComplexParam.tagName;var strComplexConv=xmlComplexParam.getAttribute("conversion");if(strComplexParamName!=undefined&&strComplexParamName!=""){var pComplexType=xmlComplexParam.getAttribute("type");var defComplexValue=xmlComplexParam.getAttribute("default");var initComplexValue="";if(defComplexValue!=null||defComplexValue!=undefined){initComplexValue=defComplexValue;}else{switch(pComplexType.toLowerCase()){case"int":case"bool":initComplexValue=0;break;}}if(strComplexConv!=""&&strComplexConv!=null){initComplexValue=this._FormXmlmcValueConversion(strComplexConv,initComplexValue);}document._wcmc[strService][strComplexParamName.toLowerCase()]=initComplexValue;}}break;}}if(!bComplex){if(strConv!=""&&strConv!=null){initValue=this._FormXmlmcValueConversion(strConv,initValue);}document._wcmc[strService][strParamName.toLowerCase()]=initValue;}}}}}return true;};_swdocument.prototype._FormXmlmcValueConversion=function(strConversion,varValue){if(strConversion==null){return varValue;}var arrInfo=strConversion.split(":");var strType=arrInfo[0];if(strType=="replace"){return app.string_replace(varValue,arrInfo[1],arrInfo[2],true);}};_swdocument.prototype._FormXmlmcLoadData=function(strKey){var arrInputParams=new Array();if(document._XmlFormKeyParam.indexOf("::")!=-1){var arrP=document._XmlFormKeyParam.split("::");var arrK=strKey.split("::");for(var x=0;x<arrP.length;x++){if(arrK[x]==""){return;}arrInputParams[arrP[x]]=arrK[x];}}else{arrInputParams[document._XmlFormKeyParam]=strKey;}document._FormXmlmc(document._XmlFormService,document._XmlFormGetMethod,arrInputParams);};_swdocument.prototype._FormXmlmcSaveData=function(arrParams){var strMethod=(_formmode=="add")?document._XmlFormAddMethod:document._XmlFormUpdateMethod;if(document._FormXmlmc(document._XmlFormService,strMethod,arrParams)){_formmode="edit";if(document._XmlFormKeyParam.indexOf("::")!=-1){var keyvalue="";var arrKey=document._XmlFormKeyParam.split("::");for(var x=0;x<arrKey.length;x++){if(x>0){keyvalue+="::";}keyvalue+=document._wcmc[document._XmlFormService][arrKey[x].toLowerCase()];}}else{var keyvalue=document._wcmc[document._XmlFormService][document._XmlFormKeyParam.toLowerCase()];}this._FormXmlmcLoadData(keyvalue);this._RefreshXmlmcFormValues();this._EnableSave(false);this._OnDataSaved();}else{return false;}};_swdocument.prototype._FormXmlmc=function(strService,strMethod,arrParams){if(arrParams==undefined){arrParams=new Array();}var strURL=app._root+"client/wcxml/xmlmc.schema.xml";var oSchemaXML=app.get_http(strURL,"",true,true);var arrServiceXML=oSchemaXML.getElementsByTagName(strService);if(arrServiceXML.length==0){alert("_GetXmlmc : There is no xmlmc service definition for ["+strService+"]. Please contact your administrator.");return false;}var arrMethod=arrServiceXML[0].getElementsByTagName(strMethod);if(arrMethod.length==0){alert("_GetXmlmc : There is no xmlmc service definition for ["+strXmlmcCall+"]. Please contact your administrator.");return false;}var xmlmc=new XmlMethodCall();var intIncludeDataTags=arrMethod[0].getAttribute("includedatatags");if(intIncludeDataTags==null||intIncludeDataTags==""){intIncludeDataTags=0;}var arrInputParams=arrMethod[0].getElementsByTagName("input");if(arrInputParams.length>0){for(var x=0;x<arrInputParams[0].childNodes.length;x++){var xmlParam=arrInputParams[0].childNodes[x];var strParamName=xmlParam.tagName;var strConv=xmlParam.getAttribute("conversion");if(strParamName!=undefined&&strParamName!=""){var boolComplex=false;if(arrParams[strParamName]!=undefined){var strValue=arrParams[strParamName];document._wcmc[strService][strParamName.toLowerCase()]=strValue;}else{var intReq=xmlParam.getAttribute("required");var type=xmlParam.getAttribute("type");var strValue=document._wcmc[strService][strParamName.toLowerCase()];if((type=="bool"||type=="int")&&intReq=="1"){if(strValue==null||strValue==""){strValue=0;}}else{if(type=="complex"){boolComplex=true;var complexType=type=xmlParam.getAttribute("complextype");}else{if(strValue==null||strValue==""){if(intReq=="1"){alert("_GetXmlmc : The parameter ["+strParamName+"] is a mandatory parameter. Please contact your administrator.");return false;}continue;}}}}if(boolComplex){if(complexType=="embeddedFileAttachment"){xmlmc.SetComplexValue(strParamName,"fileData",strValue);}else{for(var y=0;y<xmlParam.childNodes.length;y++){var strChildParamName=xmlParam.childNodes[y].tagName;if(strChildParamName!=undefined&&strChildParamName!=""){var strConv=xmlParam.childNodes[y].getAttribute("conversion");var intReq=xmlParam.childNodes[y].getAttribute("required");var type=xmlParam.childNodes[y].getAttribute("type");var strComplexValue=document._wcmc[strService][strChildParamName.toLowerCase()];if((type=="bool"||type=="int")&&intReq=="1"){if(strComplexValue==null||strComplexValue==""){strComplexValue=0;}}else{if(strComplexValue==null||strComplexValue==""){if(intReq=="1"){alert("_GetXmlmc : The parameter ["+strParamName+":"+strChildParamName+"] is a mandatory parameter. Please contact your administrator.");return false;}continue;}}if(strConv!=""&&strConv!=null){strComplexValue=this._FormXmlmcValueConversion(strConv,strComplexValue);}xmlmc.SetComplexValue(strParamName,strChildParamName,strComplexValue);}}}}else{if(strConv!=""&&strConv!=null){strValue=this._FormXmlmcValueConversion(strConv,strValue);}xmlmc.SetParam(strParamName,strValue);}}}}if(xmlmc.Invoke(strService,strMethod,intIncludeDataTags)){var arrOutParams=arrMethod[0].getElementsByTagName("output");if(arrOutParams.length>0){for(var x=0;x<arrOutParams[0].childNodes.length;x++){if(document._wcmc[strService]==undefined){document._wcmc[strService]=new Array();}var xmlParam=arrOutParams[0].childNodes[x];var strParamName=xmlParam.tagName;var strConv=xmlParam.getAttribute("conversion");if(strParamName!=undefined&&strParamName!=""){var bComplex=false;if(xmlParam.getAttribute("type")=="complex"){var arrChildParams=xmlmc.xmlDOM.getElementsByTagName(strParamName);arrChildParams=arrChildParams[0].childNodes;for(var y=0;y<arrChildParams.length;y++){var strComplexParamName=arrChildParams[y].tagName;var strComplexConv=xmlParam.childNodes[y].getAttribute("conversion");if(strComplexParamName!=undefined&&strComplexParamName!=""){bComplex=true;var varComplexValue=app.xmlText(arrChildParams[y]);if(strComplexConv!=""&&strComplexConv!=null){varComplexValue=this._FormXmlmcValueConversion(strComplexConv,varComplexValue);}document._wcmc[strService][strComplexParamName.toLowerCase()]=varComplexValue;}}}if(!bComplex){var varValue=xmlmc.GetParam(strParamName);if(xmlParam.getAttribute("type")=="bool"){varValue=(varValue=="true")?1:0;}if(strConv!=""&&strConv!=null){varValue=this._FormXmlmcValueConversion(strConv,varValue);}document._wcmc[strService][strParamName.toLowerCase()]=varValue;}}}}return true;}else{alert(xmlmc.GetLastError());return false;}};_swdocument.prototype._RefreshXmlmcFormValues=function(bInternal){var strMatch="x."+document._XmlFormService;for(strControlID in document.mainform.boundelements){if(document.mainform.boundelements[strControlID].binding.indexOf(strMatch.toLowerCase())==0){var arrI=document.mainform.boundelements[strControlID].binding.toLowerCase().split(".");this.mainform.boundelements[strControlID]._value(document._wcmc[document._XmlFormService][arrI[2]]);if(_formmode=="edit"&&arrI[2].toLowerCase()==document._XmlFormKeyParam.toLowerCase()){this.mainform.boundelements[strControlID]._enable(false);}}}};_swdocument.prototype._SetXmlmcFormValue=function(strBinding,strValue){for(strControlID in document.mainform.boundelements){if(document.mainform.boundelements[strControlID].binding.indexOf(strBinding.toLowerCase())==0){document.mainform.boundelements[strControlID]._value(strValue);}}};_swdocument.prototype._GetXmlmcFormValue=function(strBinding){for(strControlID in document.mainform.boundelements){if(document.mainform.boundelements[strControlID].binding.indexOf(strBinding.toLowerCase())==0){return document.mainform.boundelements[strControlID].value;}}return null;};_swdocument.prototype._initialise_settings=function(){var jsonSettings=_swDocumentJson.espForm.configuration.settings;var jsonOptions=_swDocumentJson.espForm.configuration.settings.options;this._title=jsonSettings.title;this._printtemplate=(jsonSettings.printTemplates)?jsonSettings.printTemplates.printTemplate:"";this._initialise_showmeitems(_swDocumentJson.espForm.configuration.showMeItems);if(_formtype==_CDF||_formtype==_LCF){var bHideToolBar=(jsonOptions.hideToolbar=="true")?true:false;var bHideMenuBar=(jsonOptions.hideMenubar=="true")?true:false;this._useEmailDateToLogCall=(jsonOptions.useEmailDateToLogCall=="true")?true:false;this._callclass=jsonSettings.callClass;this._profilefilter=jsonSettings.profileFilter;if(this._profilefilter==undefined){this._profilefilter="";}}else{var bHideToolBar=(jsonOptions.showToolbar!="true")?true:false;var bHideMenuBar=(jsonOptions.showMenubar!="true")?true:false;}if(bHideMenuBar){}if(bHideToolBar){document.getElementById("_tr_toolbar").style.display="none";_form_toolbar_holder.style.display="none";}else{var strToolBarType=_formtype;if(_formtype.indexOf("_system")!=-1){strToolBarType="stf";}if(app.__arr_application_toolbar_html[strToolBarType]!=undefined){_form_toolbar_holder.innerHTML=app.__arr_application_toolbar_html[strToolBarType];}document.getElementById("_tr_toolbar").style.display="";_form_toolbar_holder.style.display="block";if(this._setup_toolbar_buttons){this._setup_toolbar_buttons(jsonOptions);}}if(jsonOptions.showMassageBar=="true"){}if(_formtype!=_CDF&&_formtype!=_LCF){document.getElementById("_tr_tabbar").style.display="none";document.getElementById("_form_tabcontrol").style.display="none";return;}else{document.getElementById("_tr_tabbar").style.display="block";document.getElementById("_form_tabcontrol").style.display="block";if(!app.isIE){document.getElementById("_tr_tabbar_td").style.width=document.getElementById("if_mainform").offsetWidth;}}this._load_extform=false;if(jsonOptions.showExtendedDetails=="true"){var extOpts=jsonOptions.extendedDetailsTable;var strTabName=_parse_context_vars(extOpts.title);document.getElementById("_tc_extform").innerHTML=strTabName;document.getElementById("_tc_extform").style.display="inline";this._load_extform=true;}if(jsonOptions.showWorkflow=="true"||jsonOptions.showTasks=="true"){document.getElementById("_tc_workflow").style.display="block";}if(jsonOptions.showFileAttachments=="true"||jsonOptions.showFileAttactments=="true"){document.getElementById("_tc_files").style.display="block";}if(jsonOptions.showActions=="true"){document.getElementById("_tc_diary").style.display="block";}if(jsonOptions.showCustomHtmlTab=="true"){var htmlOpts=jsonOptions.customHtmlTab;if(htmlOpts){document.customHtmlTab=htmlOpts;document.getElementById("_tc_www").innerHTML=_parse_context_vars(htmlOpts.name);document.getElementById("_tc_www").style.display="inline";}}if(jsonOptions.howCloseDetails=="true"){}};_swdocument.prototype._initialise_tables=function(){var strName="";if(_swDocumentJson.espForm.configuration.tables==undefined){return true;}var arrTables=_swDocumentJson.espForm.configuration.tables.table;if(arrTables==undefined){return true;}if(arrTables.length==undefined){arrTables=new Array(arrTables);}var jsonSchema=eval("("+app._jsonSchemaString+")");for(var x=0;x<arrTables.length;x++){strName=arrTables[x].name;if(strName==""||strName==undefined){continue;}app.debugstart("_swdocument:_initialise_tables."+x,"xmlform.php");aTable=new _swfTable(arrTables[x],this,jsonSchema.espDatabaseSchema.database.tables.table[app._arr_tablenames_by_pos[strName]].columns.column);app.debugend("_swdocument:_initialise_tables."+x,"xmlform.php");if(aTable._initresult==false){this.CloseForm();return false;}this._tables[strName]=aTable;this[strName]=this._tables[strName];}if(!this._check_data_permission()){this.CloseForm();return false;}return true;};_swdocument.prototype._get_data_value=function(strBinding,boolFormatted){var arrBinding=strBinding.split(".");var strTable=arrBinding[0];var strColumn=arrBinding[1];if(this._tables[strTable.toLowerCase()]&&this._tables[strTable.toLowerCase()][strColumn.toLowerCase()]){return this._tables[strTable.toLowerCase()].columns[strColumn.toLowerCase()];}else{alert("_get_data_value : ["+strBinding+"]\n\nThe data binding does not exist. Please contact your Administrator");}};_swdocument.prototype._load_alt_sysform=function(strXmlFormName,strType,strPointerName){var strAltFormXMLURL=app._root+"client/forms/_system/"+strType+"/"+strXmlFormName+".json";var strRes=app.get_http(strAltFormXMLURL,"",true,false,null,null);try{var jsonformdata=eval("("+strRes+");");}catch(e){return false;}var jsonAltF=jsonformdata.espForm.layouts.layout[0];if(jsonAltF==null||jsonAltF==undefined){return false;}this[strPointerName]=new _swform(strPointerName,jsonAltF,this,true,strRes);if(this[strPointerName]==null||this[strPointerName]==undefined){return false;}else{var altformBG=jsonAltF.appearance.backgroundColor;try{this[strPointerName]._targetdocument.body.style.backgroundColor=altformBG;}catch(e){}}this[strPointerName]._jsonaltformdom=jsonAltF;return this[strPointerName];};_swdocument.prototype._load_alt_form=function(strXmlFormName,strType,strPointerName){var strAltFormXMLURL=app._root+app._applicationpath+"/_xml/prepared/"+strType+"/"+strXmlFormName+".json";var strRes=app.get_http(strAltFormXMLURL,"",true,false,null,null);try{var jsonformdata=eval("("+strRes+");");}catch(e){return false;}var jsonAltF=jsonformdata.espForm.layouts.layout[0];if(jsonAltF==null||jsonAltF==undefined){return false;}this[strPointerName]=new _swform(strPointerName,jsonAltF,this,true,strRes);if(this[strPointerName]==null||this[strPointerName]==undefined){return false;}else{var altformBG=jsonAltF.appearance.backgroundColor;try{this[strPointerName]._targetdocument.body.style.backgroundColor=altformBG;}catch(e){}}this[strPointerName]._jsonaltformdom=jsonAltF;return this[strPointerName];};_swdocument.prototype._initialise_layout=function(){var lapp=app;var jsonMF=(_swDocumentJson.espForm.layout==undefined)?_swDocumentJson.espForm.layouts.layout[0]:_swDocumentJson.espForm.layout;if(jsonMF==null||jsonMF==undefined){window.close();return;}app.debugstart("_swdocument:_initialise_layout._resizewindow","xmlform.php");this._resizewindow(jsonMF);app.debugend("_swdocument:_initialise_layout._resizewindow","xmlform.php");app.debugstart("_swdocument:_initialise_layout.new _swform('mainform')","xmlform.php");this.mainform=new _swform("mainform",jsonMF,this);app.debugend("_swdocument:_initialise_layout.new _swform('mainform')","xmlform.php");if(this.mainform==null||this.mainform==undefined){window.close();return;}else{var mainformBG=jsonMF.appearance.backgroundColor;this.mainform._targetdocument.body.style.backgroundColor=mainformBG;this._activeform=this.mainform;}var jsonEF=_swDocumentJson.espForm.extendedLayout;if(jsonEF==undefined){this.extform=undefined;}else{app.debugstart("_swdocument:_initialise_layout.new _swform('extform')","xmlform.php");this.extform=new _swform("extform",jsonEF,this);app.debugend("_swdocument:_initialise_layout.new _swform('extform')","xmlform.php");var extformBG=jsonEF.appearance.backgroundColor;if(this.extform._targetdocument.body){this.extform._targetdocument.body.style.backgroundColor=extformBG;}else{setTimeout("_setExtFormBG('"+extformBG+"')",2000);}}};function _setExtFormBG(strColor){try{extform._targetdocument.body.style.backgroundColor=strColor;}catch(e){}}_swdocument.prototype._resizewindow=function(oJsonForm){app.__cached_forms[_cacheformname].width=GetWinWidth();app.__cached_forms[_cacheformname].height=GetWinHeight();return;};_swdocument.prototype._load_bespoke_record=function(rs,strTableAlias){if(!this._tableExists(strTableAlias)){alert("_load_bespoke_record : the bespoke record ["+strTableAlias+"] has not been defined agaisnt this form. Please contact your Administrator");return false;}strTableAlias=strTableAlias.toLowerCase();if(rs._currentrow==-1){rs.Fetch();}var y=rs.GetColumnCount();for(var x=0;x<y;x++){var strValue=rs.GetValueAsString(x);var strColName=rs.GetColumnName(x);if(strColName.indexOf(".")>-1){var arrColName=strColName.split(".");strColName=arrColName[1];}this._tables[strTableAlias]._columns[strColName]=new _swdcolumn(strColName,strValue,strValue,this._tables[strTableAlias]);}return true;};_swdocument.prototype._loaddata=function(varKeyValue){if(this._mastertable!=null){if(varKeyValue!=undefined){this._keyvalue=varKeyValue;}if(this._keyvalue==""){return;}var strUseTable=this._mastertable._name;var strUseDSN=this._mastertable._dsn;if(this._mastertable._name=="calltasks"){var strPFS="1";if(this.GetArg("callref")!=""){var varKeyColName="taskid:callref";this._keyvalue=varKeyValue+":"+this.GetArg("callref");}else{var varKeyColName="sessionid:taskid:parentgroup";this._keyvalue=this.GetArg("_table")+":"+varKeyValue+":"+this.GetArg("parentgroup");strUseDSN="sw_systemdb";strUseTable="wc_calltasks";}}else{var varKeyColName=this._tables[this._mastertable._name]._keycolumn;var strPFS=(app.dd.tables[this._mastertable._name].columns[varKeyColName].IsNumeric())?"0":"1";}var strParams="_mastertable="+app.pfu(strUseTable);strParams+="&_masterdsn="+app.pfu(strUseDSN);strParams+="&_mastervalue="+app.pfu(app.trim(this._keyvalue));strParams+="&_masterkeycol="+app.pfu(varKeyColName);strParams+="&_masterpfs="+strPFS;var counter=1;for(strTable in this._tables){if(this._tables[strTable.toLowerCase()]._type==_RELATED){var varKeyColName=this._tables[strTable.toLowerCase()]._keycolumn;strParams+="&_relatedtable_"+counter+"="+this._tables[strTable.toLowerCase()]._name;strParams+="&_relatedkeycol_"+counter+"="+varKeyColName;strParams+="&_relatedforeigncol_"+counter+"="+this._tables[strTable.toLowerCase()]._maindetailscolumn;var intPFS=(app.dd.tables[strTable.toLowerCase()].columns[varKeyColName].IsNumeric())?"0":"1";strParams+="&_relatedpfs_"+counter+"="+intPFS;counter++;}else{if(this._tables[strTable.toLowerCase()]._type==_EXTENDED){strParams+="&_extendedtable="+this._tables[strTable.toLowerCase()]._name;strParams+="&_extendedkeycol="+this._tables[strTable.toLowerCase()]._keycolumn;}}}var strURL=app.webroot+"/webclient/service/form/getdata/json_index.php";app.debugstart("load form data get_http","xmlform.php");var res=app.get_http(strURL,"swsessionid="+app._swsessionid+"&"+strParams,true,false);app.debugend("load form data get_http","xmlform.php");this._ondatafetched(res);}else{this._ondatafetched("");}};_swdocument.prototype._ondatafetched=function(strRes){if(strRes!=""){app.debugstart("load form data ondatafetched","xmlform.php");app.debugstart("load form data ondatafetched - create json","xmlform.php");strRes=_regexreplace(strRes,"\n","\\n");try{var formdata=eval("("+strRes+");");}catch(e){app.debugstart("load form data ondatafetched - formadata invalid");alert("The returned form data could not be processed. Please contact your Administrator");document.CloseForm();return;}app.debugend("load form data ondatafetched - create json","xmlform.php");for(var strTableName in formdata.tables){app.debugstart("load form data ondatafetched - init table data for "+strTableName,"xmlform.php");if(document._tables[strTableName.toLowerCase()]._initialise_jsondata(formdata.tables[strTableName])==false){document.CloseForm();}app.debugend("load form data ondatafetched - init table data for "+strTableName,"xmlform.php");}app.debugend("load form data ondatafetched","xmlform.php");}document._init_title();};_swdocument.prototype._init_title=function(){var strTitle=this._title;if(this._mastertable!=null){if((_formmode=="add")&&(this.type==_STF)){strTitle="Add New "+strTitle;}else{if(_formmode=="edit"&&(this.type==_STF)){strTitle="Update "+strTitle;}}}else{strTitle=""+strTitle;}document.SetTitle(_parse_context_vars(strTitle,false,true));};_swdocument.prototype._check_data_permission=function(){var s=app.session;if(this._mastertable==null){return true;}if(_systemform){return true;}if(this.type==_STF){var iCheckAction=-1;_CAN_ADDNEW_TABLEREC:_CAN_UPDATE_TABLEREC;if(_formmode=="add"){iCheckAction=_CAN_ADDNEW_TABLEREC;}else{if(_formmode=="edit"){iCheckAction=_CAN_UPDATE_TABLEREC;}}if(iCheckAction>-1){if(s.CheckTableRight(this._mastertable._name,iCheckAction,true)!=""){return false;}}}return true;};_swdocument.prototype._save_data=function(intCloseForm){if(this._OnSaveData()==false){return false;}if(!this._OnPreValidate()){return false;}if(this.type==_STF||this.type.indexOf("_system")==0){if(this._mastertable._savedata(true)){if(this._exttable!=null&&this._exttable!=undefined){this._exttable._columns[this._exttable._keycolumn].originalvalue="";this._exttable._columns[this._exttable._keycolumn].value=this._mastertable._columns[this._mastertable._keycolumn].value;_swdoc[this._exttable._name][this._exttable._keycolumn]=this._mastertable._columns[this._mastertable._keycolumn].value;this._exttable._savedata();}}else{return false;}try{document[this._mastertable._name][this._mastertable._keycolumn]=this._mastertable._columns[this._mastertable._keycolumn].value;}catch(e){}this._on_data_saved();}else{if(this.type==_CDF){this._OnSaveCall();}else{if(this.type==_LCF){}}}return true;};_swdocument.prototype._delete_master_record=function(){var strTableName=(this._overide_master_save_table!="")?this._overide_master_save_table:this._mastertable._name;var strParams="table="+strTableName+"&dsn="+this._mastertable._dsn+"&keycol="+this._mastertable._keycolumn+"&keyvalue="+this._mastertable._keyvalue;var oQ=new SqlQuery();if(!oQ.WebclientStoredQuery("data/deleteRecord",strParams)){alert("_delete_master_record : failed to delete database record. Please contact your administrator.");return false;}window.close();return true;};_swdocument.prototype._on_data_saved=function(){_formmode="edit";_recordsaved=true;if(this.type==_STF){_primary_key=document[this._mastertable._name][this._mastertable._keycolumn];this._loaddata(document[this._mastertable._name][this._mastertable._keycolumn]);this.UpdateFormFromData(undefined,true);this._OnDataSaved();}else{if(this.type==_CDF){this.ResetModiedFlag("opencall");this._OnDataSaved();}else{if(this.type==_LCF){this.OnCallLoggedOK(nCallRef,dateRespondBy,dateFixBy,strCustName,strSla);}}}};_swdocument.prototype._set_dualdata_value=function(strValue,strBinding,bFromData){if(bFromData==undefined){bFromData=false;}var arrBinding=strBinding.split(".");var strTable=arrBinding[0];var strColumn=arrBinding[1];var arrBind=strColumn.split("!");if(this._tables[strTable.toLowerCase()]!=undefined){var strColumnOne=arrBind[0];var strColumnTwo=arrBind[1];if(this._tables[strTable.toLowerCase()][strColumnOne]!=undefined&&this._tables[strTable.toLowerCase()][strColumnTwo]!=undefined){if(this.type==_LCF&&this._tables[strTable.toLowerCase()]._type==_RELATED&&!bFromData){strValue=this._OnResolveRecord(strTable,strColumn,strValue,true);if(strValue==""){return false;}this._resolve_record_from_dualdata_value(strTable,strColumnOne,strColumnTwo,strValue);}}}};_swdocument.prototype._resolve_record_from_dualdata_value=function(strTable,strColumnOne,strColumnTwo,strValue){if(_bClosingForm){return;}if(strValue==""){return;}if(!this._tableExists(strTable,true)){return;}var arrValues=strValue.split(" ",2);var strValueOne=arrValues[0];var strValueTwo=arrValues[1];if(strValueTwo==undefined){strValueTwo=strValueOne;}if(strValueOne==""){strValueOne=strValueTwo;}if(app.dd.tables[strTable.toLowerCase()].columns[strColumnOne].IsNumeric()){if(isNaN(strValueOne)){alert("The column you are resolving against is numeric. Please enter a numeric value");return;}var strFilterOne=strColumnOne+"="+strValueOne;}else{var strFilterOne=strColumnOne+" like '"+app.pfs(strValueOne)+"%'";}var strFilterTwo="";if(strValueTwo==strValueOne){if(app.dd.tables[strTable.toLowerCase()].columns[strColumnTwo].IsNumeric()){if(isNaN(strValueOne)){alert("The column you are resolving against is numeric. Please enter a numeric value");return;}strFilterTwo=strColumnTwo+"="+strValueOne;}else{strFilterTwo=strColumnTwo+" like '"+app.pfs(strValueOne)+"%'";}}else{if(app.dd.tables[strTable.toLowerCase()].columns[strColumnTwo].IsNumeric()){if(isNaN(strValueTwo)){alert("The column you are resolving against is numeric. Please enter a numeric value");return;}strFilterTwo+=strColumnTwo+"="+strValueTwo;}else{strFilterTwo+=strColumnTwo+" like '"+app.pfs(strValueTwo)+"%'";}}var strOP=(strValueTwo==strValueOne)?" OR ":" AND ";var strFilter="("+strFilterOne+")";if(strFilterTwo!=""){strFilter+=strOP+" ("+strFilterTwo+")";}var rs=new SqlQuery();rs.WebclientStoredQuery("form/resolveRelatedTableRecord","table="+strTable+"&columnone="+strColumnOne+"&valueone="+strValueOne+"&columntwo="+strColumnTwo+"&valuetwo="+strValueTwo,true);if(rs.GetRowCount()==1){document._load_bespoke_record(rs,strTable);document.UpdateFormFromData(strTable,false);document._assign_mastertable_values(strTable);if(this._OnRecordResolved){this._OnRecordResolved(strTable);}rs=null;return true;}else{if(rs.GetRowCount()==0){rs=null;MessageBox("There is no match found for the item you entered. Please click No to try again or Yes to create a new record",app.MB_YESNO,function(confirmed){if(confirmed){var strParams="fromlfcresolve=1&displaycolumn=_dual&interimvalue="+strValue;_open_control_form(this._tables[strTable.toLowerCase()]._addrecordform,"add",strValue,strParams,function(res){if(res.recordsaved){document.ResolveRecord(strTable,strColumn,res.newrecordkey,false,true);}else{document.UpdateFormFromData(strTable,false);return false;}});}else{document.UpdateFormFromData(strTable,false);return false;}});}else{rs=null;if(this._tables[strTable.toLowerCase()]._picklist!=""){var strParams="_filter="+strFilter+"&_resolvecolumn="+strColumnOne+"&_resolvevalue="+strValue;var oForm=app._open_system_form("_wc_picklist","picklist",this._tables[strTable.toLowerCase()]._picklist,strParams,true,function(oForm){if(oForm==null){return;}if(oForm._swdoc._selected_picklistkey!=""){document.ResolveRecord(strTable,this._tables[strTable.toLowerCase()]._keycolumn,oForm._swdoc._selected_picklistkey,true,true);}else{document[strTable.toLowerCase()][strColumnOne]="";document[strTable.toLowerCase()][strColumnTwo]="";document.UpdateFormFromData(strTable,true);return false;}},null,window);}else{alert("ResolveRecord : ["+strTable+"]\n\nThe data table does not have a valid picklist form. Please contact your Administrator");}}}};_swdocument.prototype._is_binding_onrelatedtable=function(strBinding){var arrBinding=strBinding.split(".");var strTable=arrBinding[0];return(this._tables[strTable.toLowerCase()]!=undefined&&this._tables[strTable.toLowerCase()]._type==_RELATED);};_swdocument.prototype._set_data_value=function(strValue,strBinding,bFromData,strFormattedValue,boolQLC){if(_bClosingForm){return;}if(bFromData==undefined){bFromData=false;}if(boolQLC==undefined){boolQLC=false;}if(top.bDrawing&&strValue!=""&&this._is_binding_onrelatedtable(strBinding)){top.arrResolveRelatedRecordDataAfterDraw[strBinding]=strValue;return false;}var arrBinding=strBinding.split(".");var strTable=arrBinding[0];var strColumn=arrBinding[1];if(strTable=="x"){var strService=strColumn;strColumn=arrBinding[2];if(document._wcmc[strService]==undefined){document._wcmc[strService]=new Array();}else{if(document._wcmc[strService][strColumn.toLowerCase()]!=undefined&&document._wcmc[strService][strColumn.toLowerCase()]==strValue){return;}}document._wcmc[strService][strColumn.toLowerCase()]=strValue;if(!bFromData){document._UpdateFormFiltersFromData(strBinding);}this._EnableSave(true);return;}if(strColumn.indexOf("!")!=-1){this._set_dualdata_value(strValue,strBinding,bFromData);return;}var boolValidBinding=true;try{eval("var tmp = "+strBinding+";");}catch(e){boolValidBinding=false;}if(boolValidBinding){var strOldValue=tmp;if(strOldValue==strValue){return;}if(this.type==_LCF&&this._tables[strTable.toLowerCase()]._type==_RELATED&&!bFromData){this._tables[strTable.toLowerCase()]._bRecordDataChanged=true;strValue=this._OnResolveRecord(strTable,strColumn,strValue,true);if(strValue==""){document.ResetRecord(strTable);}else{this.ResolveRecord(strTable,strColumn,strValue,true);}}else{if(this._tables[strTable.toLowerCase()]._columns[strColumn.toLowerCase()]==undefined){this._tables[strTable.toLowerCase()]._columns[strColumn.toLowerCase()]=new _swdcolumn(strColumn.toLowerCase(),strValue,strFormattedValue,this._tables[strTable.toLowerCase()]);}else{this._tables[strTable.toLowerCase()]._columns[strColumn.toLowerCase()]._set_value(strValue,strFormattedValue);}if(!bFromData){document._UpdateFormFiltersFromData(strBinding);this._OnRecordValueChanged(strTable,strColumn,strValue,strOldValue);}if(this.type!=_LCF||boolQLC){document._reverse_resolve_relateddata(strBinding,strValue);}}}else{}};_swdocument.prototype._tableExists=function(strTable,bMessage){if(this._tables[strTable.toLowerCase()]){return true;}else{if(bMessage){alert("_tableExists : ["+strTable+"]\n\nThe data table does not exist. Please contact your Administrator");}return false;}};_swdocument.prototype._ismastertable=function(strTable,bMessage){if(this._tables[strTable.toLowerCase()]){return(this._tables[strTable.toLowerCase()]._type==_MASTER);}else{if(bMessage){alert("_ismastertable : ["+strTable+"]\n\nThe data table does not exist. Please contact your Administrator");}return false;}};_swdocument.prototype._UpdateFormFiltersFromData=function(strBinding){if(strBinding==undefined){strBinding="";}this.mainform._initialise_filters(strBinding,true);if(this.extform!=null&&this.extform!=undefined){this.extform._initialise_filters(strBinding,true);}};_swdocument.prototype._OnFormLoading=function(){app._CURRENT_JS_WINDOW=window;var res=true;var strFunc="OnFormLoading";if(window[strFunc]){res=window[strFunc](info.__formname,info.__callclass);}if(res==false){this.CloseForm();}return true;};_swdocument.prototype._OnFormLoaded=function(){app._CURRENT_JS_WINDOW=window;var strFunc="OnFormLoaded";if(window[strFunc]){try{res=window[strFunc](info.__formname,info.__callclass);this._CheckFormCodeDataChange();}catch(e){}}};_swdocument.prototype._OnFormClosing=function(){if(this._mastertable&&this._mastertable._name=="swissues"){app._servicedesk_refresh_issues();}app._CURRENT_JS_WINDOW=window;var strFunc="OnFormClosing";if(window[strFunc]){res=window[strFunc]();this._CheckFormCodeDataChange();return res;}return true;};_swdocument.prototype._check_mandatory_lb_with_extraoptions=function(bAlertMessage){if(bAlertMessage==undefined){bAlertMessage=true;}for(var strBinding in document._listbox_extraoptions_bindings){var lbInfo=document._listbox_extraoptions_bindings[strBinding];if(lbInfo.element.mandatory){var arrInfo=lbInfo.info;if(lbInfo.element.value==arrInfo[0]){var realValue=_parse_context_vars(arrInfo[1]);if(realValue==""){var strControlID=lbInfo.element.name;var arrBind=strBinding.split(".");try{var strControlName=app.dd.tables[arrBind[0]].columns[arrBind[1]].DisplayName;if(strControlName!=arrBind[1]&&strControlName!=undefined){if(bAlertMessage){alert("The form field ["+strControlName+"] is a mandatory listbox and the option selected contains a blank value.\n\nPlease provide a value before continuing.");}return false;}}catch(e){}if(bAlertMessage){alert("A form field ["+strControlID+"] is a mandatory listbox and the option selected contains a blank value.\n\nPlease provide a value before continuing.");}return false;}}}}return true;};_swdocument.prototype._OnValidate=function(bAlertMessage){if(bAlertMessage==undefined){bAlertMessage=true;}if(!this._check_mandatory_lb_with_extraoptions(bAlertMessage)){return false;}if(!this.mainform._check_mandatory_fields(bAlertMessage)){return false;}if(this.extform!=null&&this.extform!=undefined&&!this.extform._check_mandatory_fields(bAlertMessage)){return false;}app._CURRENT_JS_WINDOW=window;var strFunc="OnValidate";if(window[strFunc]){res=window[strFunc]();this._CheckFormCodeDataChange();return res;}return true;};_swdocument.prototype._OnPreValidate=function(){app._CURRENT_JS_WINDOW=window;var res=2;var strFunc="OnPreValidate";if(window[strFunc]){res=window[strFunc]();}if(res==2){if(!this._OnValidate()){return false;}}else{if(res==0){return false;}}return true;};_swdocument.prototype._OnSaveData=function(){app._CURRENT_JS_WINDOW=window;var strFunc="OnSaveData";if(window[strFunc]){res=window[strFunc]();this._CheckFormCodeDataChange();return res;}return true;};_swdocument.prototype._OnDataSaved=function(){this.UpdateFormFromData(undefined,true);this._EnableSave(false);app._CURRENT_JS_WINDOW=window;var strFunc="OnDataSaved";if(window[strFunc]){res=window[strFunc]();this._CheckFormCodeDataChange();return res;}return true;};_swdocument.prototype._OnRecordValueChanged=function(strTable,strColumn,strValue,strOldValue){if(this._tables[strTable.toLowerCase()]==this._mastertable||this._tables[strTable.toLowerCase()]==this._exttable){this._EnableSave(true);}app._CURRENT_JS_WINDOW=window;var strFunc="OnRecordValueChanged";if(window[strFunc]){window[strFunc](strTable,strColumn,strValue,strOldValue);this._CheckFormCodeDataChange();}};_swdocument.prototype.GetArg=function(strArg){if(strArg==undefined){return"";}if(this._params[strArg.toLowerCase()]==undefined){return"";}return this._params[strArg.toLowerCase()];};_swdocument.prototype.SetArg=function(strArg,varValue){this._params[strArg]=varValue;};_swdocument.prototype.Save=function(intCloseForm){if(document._bXmlForm){if(!this._OnPreValidate()){return false;}return this._FormXmlmcSaveData();}if(this._type==_LCF){alert("document.Save() is not supported in the log call form");return false;}return this._save_data(intCloseForm);};_swdocument.prototype.CloseForm=function(){if(_bClosingForm){return;}_bClosingForm=true;setTimeout("window.close()",20);};_swdocument.prototype.ResolveRecord=function(strTable,strColumn,strValue,bInternal,bExactMatch){if(_bClosingForm){return;}if(bInternal==undefined){bInternal=true;}if(bExactMatch==undefined){bExactMatch=true;}if(strValue==""){return;}if(!this._tableExists(strTable,true)){return;}if(app.dd.tables[strTable.toLowerCase()].columns[strColumn.toLowerCase()].IsNumeric()){if(isNaN(strValue)){alert("The column you are resolving against is numeric. Please enter a numeric value");return;}}else{if(bExactMatch){if(app._dbcaseinsensitive){var strFilter="UPPER("+strColumn+")"+" = '"+app.pfs(strValue.toUpperCase())+"'";}else{var strFilter=strColumn+" = '"+app.pfs(strValue)+"'";}}else{if(app._dbcaseinsensitive){var strFilter="UPPER("+strColumn+")"+" like '"+app.pfs(strValue.toUpperCase())+"%'";}else{var strFilter=strColumn+" like '"+app.pfs(strValue)+"%'";}}}var rs=new SqlQuery();rs.WebclientStoredQuery("form/resolveRelatedTableRecord","table="+strTable+"&columnone="+strColumn+"&valueone="+strValue+"&exactmatch="+bExactMatch,true);if(rs.GetRowCount()==1){document._load_bespoke_record(rs,strTable.toLowerCase());document.UpdateFormFromData(strTable,false);document._assign_mastertable_values(strTable.toLowerCase());if(this._OnRecordResolved){this._OnRecordResolved(strTable.toLowerCase());}rs=null;return true;}else{if(rs.GetRowCount()==0){rs=null;if(bExactMatch){return document.ResolveRecord(strTable.toLowerCase(),strColumn.toLowerCase(),strValue,true,false);}MessageBox("There is no match found for the item you entered. Please click No to try again or Yes to create a new record",app.MB_YESNO,function(confirmed){if(confirmed){var strParams="fromlfcresolve=1&displaycolumn="+strColumn+"&interimvalue="+strValue;_open_control_form(this._tables[strTable.toLowerCase()]._addrecordform,"add",strValue,strParams,function(res){if(res.recordsaved){document.ResolveRecord(strTable.toLowerCase(),strColumn,res.newrecordkey,true,true);}else{document[strTable.toLowerCase()][strColumn.toLowerCase()]="";document.UpdateFormFromData(strTable.toLowerCase(),true);return false;}});}else{document[strTable.toLowerCase()][strColumn.toLowerCase()]="";document.UpdateFormFromData(strTable.toLowerCase(),true);return false;}});}else{rs=null;if(this._tables[strTable.toLowerCase()]._picklist!=""){var strParams="_resolvecolumn="+strColumn+"&_resolvevalue="+strValue;app._open_system_form("_wc_picklist","picklist",this._tables[strTable.toLowerCase()]._picklist,strParams,true,function(oForm){if(oForm==null){return;}if(oForm._swdoc._selected_picklistkey!=""){document.ResolveRecord(strTable.toLowerCase(),this._tables[strTable.toLowerCase()]._keycolumn,oForm._swdoc._selected_picklistkey,true,true);}else{document[strTable.toLowerCase()][strColumn.toLowerCase()]="";document.UpdateFormFromData(strTable.toLowerCase(),true);return false;}},null,window);}else{alert("ResolveRecord : ["+strTable+"]\n\nThe data table does not have a vlid picklist form. Please contact your Administrator");}}}};_swdocument.prototype.AddFileAttachments=function(){if(!app.session.HaveRight(ANALYST_RIGHT_A_GROUP,ANALYST_RIGHT_A_CANATTACHFILESTOCALLS,true)){return;}try{files.fl_files.AddFiles(_formtype);}catch(e){}};_swdocument.prototype.RunQuickAction=function(strActionID){this._execute_showmeitem(-1,strActionID);};_swdocument.prototype.IsRecordResolved=function(strTable){return this._tables[strTable.toLowerCase()]._isloaded;};_swdocument.prototype.GetVar=function(strID){return this.GetArg(strID);};_swdocument.prototype.GetVariable=function(strID){return this.GetVar(strID);};_swdocument.prototype.SetVariable=function(strID,varValue){this._params[strID]=varValue;document[strID]=varValue;};_swdocument.prototype.SetTitle=function(strTitle){document.title=strTitle;};_swdocument.prototype.ResetModiedFlag=function(strTable){if(this._tableExists(strTable.toLowerCase())){this._tables[strTable.toLowerCase()].ResetModified();if(this._ismastertable(strTable.toLowerCase())){if(this.type!=_LCF){for(var strFormTableName in this._tables){this._tables[strFormTableName].ResetModified();}this._EnableSave(false);}}}};_swdocument.prototype._CheckFormCodeDataChange=function(){if(_bClosingForm){return;}if(this.type==_LCF){return;}if(document._bSaveEnabled){this.UpdateFormFromData();return;}if(this._mastertable!=null&&this._mastertable._check_data_changed()){this._EnableSave(true);this.UpdateFormFromData();return;}for(strTable in this._tables){if(strTable!=this._mastertable._name&&this._tables[strTable.toLowerCase()]._check_data_changed()){this._EnableSave(true);this.UpdateFormFromData();return;}}};_swdocument.prototype._EnableSave=function(bEnable){if(_bClosingForm){return;}if(this.type==_LCF){return;}if(bEnable==undefined){bEnable=true;}var bSaveVisible=app.toolbar_item_isvisible(this.type,"save",document);if(bSaveVisible){document._bSaveEnabled=bEnable;app.toolbar_item_dore(this.type,"save",bEnable,document);}else{document._bSaveEnabled=false;app.toolbar_item_dore(this.type,"save",false,document);}};_swdocument.prototype.IsObjectDefined=function(strObjectName){try{eval("var tmp = "+strObjectName+";");if(tmp!=undefined){return true;}}catch(e){return false;}return false;};_swdocument.prototype.ResetRecord=function(strTable){if(this._tables[strTable.toLowerCase()]!=undefined){document._tables[strTable.toLowerCase()]._reset();document.UpdateFormFromData(strTable.toLowerCase(),true);}};_swdocument.prototype.GetRecord=function(strTable){return this._tables[strTable.toLowerCase()];};_swdocument.prototype.ResetData=function(){return true;};_swdocument.prototype.UpdateFormFromData=function(strUseTable,bInternal){if(bInternal==undefined){bInternal=false;}if(document._bXmlForm){this._RefreshXmlmcFormValues(bInternal);return true;}app.debugstart("UpdateFormFromData:mainform","xmlform.php");var eles=this.mainform.boundelements;var strID="";var strBinding="";var arrBinding=new Array();for(strID in eles){strBinding=eles[strID].binding;if(strBinding==""){continue;}if(strBinding.indexOf("&[")>-1){var oEle=eles[strID];var eleValue=_parse_context_vars(strBinding,false,true);if(oEle.value==eleValue&&!bInternal){continue;}oEle._value(eleValue,eleValue,true);continue;}if(strUseTable!=undefined&&strUseTable!=""){if(strBinding.indexOf(strUseTable+".")>-1){this._tables[strUseTable]._update_form_field(eles[strID],eles[strID].binding,bInternal);}}else{arrBinding=strBinding.split(".");if(this._tables[arrBinding[0]]!=undefined){this._tables[arrBinding[0]]._update_form_field(eles[strID],eles[strID].binding,bInternal);}}}app.debugend("UpdateFormFromData:mainform","xmlform.php");if(this.extform!=null&&this.extform!=undefined){app.debugstart("UpdateFormFromData:extform","xmlform.php");eles=this.extform.boundelements;strID="";strBinding="";arrBinding=new Array();for(strID in eles){strBinding=eles[strID].binding;if(strBinding==""){continue;}if(strBinding.indexOf("&[")>-1){var oEle=eles[strID];var eleValue=_parse_context_vars(strBinding,false,true);if(oEle.value==eleValue&&!bInternal){continue;}oEle._value(eleValue,eleValue,true);continue;}if(strUseTable!=undefined&&strUseTable!=""){if(strBinding.indexOf(strUseTable+".")>-1){this._tables[strUseTable]._update_form_field(eles[strID],eles[strID].binding,bInternal);}}else{arrBinding=strBinding.split(".");if(this._tables[arrBinding[0]]!=undefined){this._tables[arrBinding[0]]._update_form_field(eles[strID],eles[strID].binding,bInternal);}}}app.debugend("UpdateFormFromData:extform","xmlform.php");}app.debugstart("UpdateFormFromData._UpdateFormFiltersFromData","xmlform.php");this._UpdateFormFiltersFromData(strUseTable);app.debugend("UpdateFormFromData._UpdateFormFiltersFromData","xmlform.php");if(bInternal){for(var strTableName in this._tables){this._tables[strTableName]._bUserDataChanged=false;}}return true;};_swdocument.prototype.RunQuickAction=function(strAction){alert("webclient : RunQuickAction\n\nThis functionality is not supported in the webclient.");};_swdocument.prototype._assign_mastertable_values=function(strTable){for(strToBinding in this._tables[strTable.toLowerCase()]._maindetailassignments){var strFromExpression=this._tables[strTable.toLowerCase()]._maindetailassignments[strToBinding];var arrTo=strToBinding.split(".");var arrFrom=strFromExpression.split(" ");document[arrTo[0]][arrTo[1]]="";var aFLen=arrFrom.length;for(var x=0;x<aFLen;x++){if(document[strTable.toLowerCase()][arrFrom[x]]!=undefined){var strValue=document[strTable.toLowerCase()][arrFrom[x]];if(document[arrTo[0]][arrTo[1]]!=""){document[arrTo[0]][arrTo[1]]+=" ";}document[arrTo[0]][arrTo[1]]+=strValue;}}}};_swdocument.prototype._OnDataChanged=function(bRefreshFields){if(bRefreshFields==undefined){bRefreshFields=false;}this._loaddata(document.opencall.callref);if(bRefreshFields){document.UpdateFormFromData(undefined,true);}if(this._SetupToolbarState!=undefined){this._SetupToolbarState();}if(this.type==_CDF){if(app._CurrentServiceDeskRowKey==document.opencall.callref&&app._CurrentServiceDeskTable!=null){var aRow=app._CurrentServiceDeskTable.rows[app._CurrentServiceDeskRowIndex];if(aRow!=undefined){app._refresh_servicedesk_row(aRow);}}}var strFunc="OnDataChanged";if(window[strFunc]){window[strFunc]();this._CheckFormCodeDataChange();}};_swdocument.prototype._CreateTempWorkflowTable=function(){if(this.type!="lcf"&&this.type!="cdf"){return;}this._tempworkflowtable=_uniqueformid;};_swdocument.prototype._DropTempWorkflowTable=function(){if(this.type!="lcf"&&this.type!="cdf"){return;}var strParams="_uniqueid="+this._tempworkflowtable;var strURL=app.webroot+"/webclient/service/workflow/drop_temp_workflowtable.php";app.get_http(strURL,"swsessionid="+app._swsessionid+"&"+strParams,false,false,null,null);};_swdocument.prototype._AddTempWorkflowList=function(){if(this.type!="lcf"&&this.type!="cdf"){return;}};_swdocument.prototype._RemoveTempWorkflowList=function(){if(this.type!="lcf"&&this.type!="cdf"){return;}};_swdocument.prototype._AddTempWorkflowItem=function(){if(this.type!="lcf"&&this.type!="cdf"){return;}};_swdocument.prototype._EditTempWorkflowItem=function(){if(this.type!="lcf"&&this.type!="cdf"){return;}};_swdocument.prototype._RemoveTempWorkflowItem=function(){if(this.type!="lcf"&&this.type!="cdf"){return;}};_swdocument.prototype._enableprint=function(){app.toolbar_item_dore(this.type,"swprint",(this._printtemplate!=""),document);};_swdocument.prototype.Print=function(){this._print();};_swdocument.prototype._print=function(){if(this._printtemplate!=""){var strURL=_parse_context_vars(this._printtemplate);if(strURL.indexOf("?")>0){strURL+="&emailmode=1&sessid="+app._swsessionid;}else{strURL+="?emailmode=1&sessid="+app._swsessionid;}app._print_url(strURL);}};function _swdoc_stf(oDocument){oDocument._process_form_toolbar_action=_swdoc_stf_process_form_toolbar_action;oDocument._SetupToolbarState=_swdoc_stf_SetupToolbarState;oDocument._onLoadRecord=_swdoc_stf_OnLoadRecord;oDocument.LoadRecordData=_swdoc_stf_LoadRecordData;}_swdoc_stf_OnLoadRecord=function(strTable,strKeyValue){return true;var ret=true;var strFunc="OnLoadRecord";if(window[strFunc]){ret=window[strFunc](strTable,strKeyValue);this._CheckFormCodeDataChange();}if(ret==undefined){ret=true;}return ret;};_swdoc_stf_LoadRecordData=function(strDSN,strTable,strKeyValue){if(strKeyValue==undefined){return false;}if(strDSN==undefined){return false;}if(app.dd.tables[strTable.toLowerCase()]==undefined){return false;}var strKeyCol=app.dd.tables[strTable.toLowerCase()].PrimaryKey;if(strKeyCol==undefined||strKeyCol==""){return false;}var strPreparedKeyValue=(app.dd.tables[strTable.toLowerCase()].columns[strKeyCol].IsNumeric())?strKeyValue:"'"+app.pfs(strKeyValue)+"'";var rs=new SqlQuery();var strParams="dsn="+strDSN+"&table="+strTable+"&keycol="+strKeyCol+"&keyvalue="+strKeyValue;if(rs.WebclientStoredQuery("data/getRecord",strParams)&&rs.Fetch()){if(this._load_bespoke_record(rs,strTable)){document.UpdateFormFromData(strTable,true);return true;}}return false;};function _swdoc_stf_SetupToolbarState(bInternal){this._enableprint();if(bInternal==undefined){bInternal=false;}if(bInternal){app.toolbar_item_dore("stf","save",false,document);}}function _swdoc_stf_process_form_toolbar_action(strID){switch(strID){case"save":this.Save();break;case"swprint":this._print();break;default:alert("standard form toolbar action not supported : "+strID);}}function _swdoc_cdf(oDocument){oDocument._process_form_toolbar_action=_swdoc_cdf_process_form_toolbar_action;oDocument._disable_special_bindings=_swdoc_cdf_disable_special_bindings;oDocument._OnChangeCallProfile=_swdoc_cdf_OnChangeCallProfile;oDocument._SetupToolbarState=_swdoc_cdf_SetupToolbarState;oDocument._OnAcceptCall=_swdoc_cdf_OnAcceptCall;oDocument._OnHoldCall=_swdoc_cdf_OnHoldCall;oDocument._OnOffHoldCall=_swdoc_cdf_OnOffHoldCall;oDocument._OnAssignCall=_swdoc_cdf_OnAssignCall;oDocument._OnResolveCall=_swdoc_cdf_OnResolveCall;oDocument._OnUpdateCall=_swdoc_cdf_OnUpdateCall;oDocument._OnSaveCall=_swdoc_cdf_OnSaveCall;oDocument._OnCancelCall=_swdoc_cdf_OnCancelCall;oDocument._CheckLastUpdateDate=_swdoc_cdf_CheckLastUpdateDate;oDocument._CheckLastUpdateDateInspect=_swdoc_cdf_CheckLastUpdateDateInspect;oDocument.ChangeCallClass=_swdoc_cdf_ChangeCallClass;oDocument.ChangeCallCondition=_swdoc_cdf_ChangeCallCondition;oDocument.ChangeRecord=_swdoc_cdf_ChangeRecord;oDocument.AcceptCall=_swdoc_cdf_AcceptCall;oDocument.AddCallToIssue=_swdoc_cdf_AddCallToIssue;oDocument.CancelCall=_swdoc_cdf_CancelCall;oDocument.CreateIssue=_swdoc_cdf_CreateIssue;oDocument.CloseCall=_swdoc_cdf_CloseCall;oDocument.HoldCall=_swdoc_cdf_HoldCall;oDocument.ReactivateCall=_swdoc_cdf_ReactivateCall;oDocument.TransferCall=_swdoc_cdf_TransferCall;oDocument.UpdateCall=_swdoc_cdf_UpdateCall;oDocument.LoadRelatedRecord=_swdoc_stf_LoadRecordData;}function _swdoc_cdf_ChangeCallClass(){var strParams="_selectcallclass=yes";var oForm=app._open_system_form("_wc_lognewcallclass","lcfpicker","",strParams,true,function(oForm){if(oForm&&oForm.document._selected_callclass!=undefined){if(oForm.document._selected_callclass!=""){var swHD=new HelpdeskSession();return swHD.ChangeCallClass(document.opencall.callref,oForm.document._selected_callclass);}}},undefined,window);}function _swdoc_cdf_ChangeCallCondition(){}function _swdoc_cdf_ChangeRecord(strTable,strKey){if(this._tables[strTable.toLowerCase()]){if(this._tables[strTable.toLowerCase()]._type==_RELATED){var origTable=strTable;var currentRelatedKeyValue=this._tables[strTable.toLowerCase()]._keyvalue;var opencallFK=this._tables[strTable.toLowerCase()]._maindetailscolumn;if(strTable=="equipmnt"){strTable="Asset Details";}else{if(strTable=="userdb"){strTable="Customer Details";}else{if(strTable=="site"){strTable="Site Details";}else{if(strTable=="company"){strTable="Organisation Details";}}}}var strDesc="The related record ["+strTable+'] was changed for this call. Old value : "'+app.pfx(currentRelatedKeyValue)+'" , New Value : "'+app.pfx(strKey)+'"';var xmlmc=new XmlMethodCall();xmlmc.SetParam("callref",document.opencall.callref);xmlmc.SetParam("updateMessage",strDesc);xmlmc.SetParamAsComplexType("additionalCallValues","<opencall><"+opencallFK+">"+app.pfx(strKey)+"</"+opencallFK+"></opencall>");if(xmlmc.Invoke("helpdesk","updateCallValues")){this.LoadRelatedRecord("swdata",origTable,strKey);this._assign_mastertable_values(origTable);document.Save();document.UpdateFormFromData(undefined,true);app._CURRENT_JS_WINDOW=window;var strFunc="OnRecordChanged";if(window[strFunc]){window[strFunc](origTable);}}else{alert("Failed to change the related record. Please contact your Administrator.");}}else{this.LoadRelatedRecord("swdata",origTable,strKey);}}}function _swdoc_cdf_AddCallToIssue(){}function _swdoc_cdf_CreateIssue(){app._issueform("",document.opencall.callref,false,window);}function _swdoc_cdf_CancelCall(){app._cancelcallform(document.opencall.callref,window);}function _swdoc_cdf_AcceptCall(){this._OnAcceptCall();}function _swdoc_cdf_CloseCall(){this._OnResolveCall();}function _swdoc_cdf_HoldCall(){this._OnHoldCall();}function _swdoc_cdf_ReactivateCall(){var swHD=new HelpdeskSession();return swHD.ReactivateCall(document.opencall.callref);}function _swdoc_cdf_TransferCall(){this._OnAssignCall();}function _swdoc_cdf_UpdateCall(){this._OnUpdateCall();}function _swdoc_cdf_CheckLastUpdateDate(){if(_bClosingForm){return;}var strParams="_lastdatex="+document.opencall.lastactdatex+"&_callref="+document.opencall.callref+"&_uniqueformid="+_uniqueformid;var strURL=app.get_service_url("call/getlastupdatedate","");app.get_http(strURL,strParams,false,false,document._CheckLastUpdateDateInspect,null);}function _swdoc_cdf_CheckLastUpdateDateInspect(strResult){if(_bClosingForm){return;}if(strResult>document.opencall.lastactdatex){this._OnDataChanged(true);}setTimeout("document._CheckLastUpdateDate()",_cdf_refresh_polling);}function _swdoc_cdf_OnChangeCallProfile(){var res=true;var strFunc="OnChangeCallProfile";if(window[strFunc]){res=window[strFunc]();this._CheckFormCodeDataChange();}return res;}function _swdoc_cdf_disable_special_bindings(strID){var array_special_bindings=new Array();array_special_bindings["opencall.priority"]=1;array_special_bindings["opencall.status"]=1;array_special_bindings["opencall.suppgroup"]=1;array_special_bindings["opencall.loggedby"]=1;array_special_bindings["opencall.owner"]=1;array_special_bindings["opencall.logdatex"]=1;array_special_bindings["opencall.assigndatx"]=1;array_special_bindings["opencall.respondbyx"]=1;array_special_bindings["opencall.fixbyx"]=1;array_special_bindings["opencall.resp_time"]=1;array_special_bindings["opencall.fix_time"]=1;array_special_bindings["opencall.probtext"]=1;array_special_bindings["opencall.lasttext"]=1;for(strID in this.mainform.namedelements){var strBinding=this.mainform.namedelements[strID].binding;if(array_special_bindings[strBinding]==1&&this.mainform.namedelements[strID]._is_an_input_field()){this.mainform.namedelements[strID]._enable(false);}}if(this.extform!=null||this.extform!=undefined){for(strID in this.extform.namedelements){var strBinding=this.extform.namedelements[strID].binding;if(array_special_bindings[strBinding]==1&&this.extform.namedelements[strID]._is_an_input_field()){this.extform.namedelements[strID]._enable(false);}}}}function _swdoc_cdf_process_form_toolbar_action(strID){switch(strID){case"swtasks":break;case"attach":if(!app.session.HaveRight(ANALYST_RIGHT_A_GROUP,ANALYST_RIGHT_A_CANATTACHFILESTOCALLS,true)){return;}files.fl_files.AddFiles("cdf");break;case"unattach":files.fl_files._deletecallattachment();app.toolbar_item_dore("cdf","unattach",false,document);break;case"callaccept":this._OnAcceptCall();break;case"callhold":this._OnHoldCall();break;case"calloffhold":this._OnOffHoldCall();break;case"callassign":this._OnAssignCall();break;case"callresolve":this._OnResolveCall();break;case"callupdate":this._OnUpdateCall();break;case"save":this._OnSaveCall();break;case"swprint":this._print();break;case"callwatch":var oHD=new HelpdeskSession();if(oHD.WatchCall(document.opencall.callref,app.session.analystId)){app.toolbar_item_dore("cdf","callwatch",false,document);app.toolbar_item_dore("cdf","callunwatch",true,document);if(app._ServiceDeskDocumentElement!=null&&app._ServiceDeskDocumentElement.body.offsetWidth>0){app._servicedesk_refresh_watched_calls();}}break;case"callunwatch":var oHD=new HelpdeskSession();if(oHD.UnwatchCall(document.opencall.callref,app.session.analystId)){app.toolbar_item_dore("cdf","callwatch",true,document);app.toolbar_item_dore("cdf","callunwatch",false,document);if(app._ServiceDeskDocumentElement!=null&&app._ServiceDeskDocumentElement.body.offsetWidth>0){app._servicedesk_refresh_watched_calls();}}break;case"callcancel":this._OnCancelCall();break;default:alert("Call Detail toolbar action not supported : "+strID);}}function _swdoc_cdf_SetupToolbarState(bInternal){this._enableprint();if(bInternal==undefined){bInternal=false;}if(bInternal){app.toolbar_item_dore("cdf","save",false,document);}var bIsWatched=app._swchd_iscallwatched(document.opencall.callref,app.session.analystid);var _hd_bCanAccept=true;var _hd_bCanAssign=true;var _hd_bCanUpdate=true;var _hd_bCanHold=true;var _hd_bCanTakeOffHold=true;var _hd_bCanResolve=true;var _hd_bCanClose=true;var _hd_bCanCancel=true;var _hd_bCanReactivate=true;var _hd_bCanAttach=true;var nStatus=document.opencall.status;nStatus--;nStatus++;switch(nStatus){case _INCOMING:_hd_bCanClose=false;_hd_bCanResolve=false;_hd_bCanAccept=false;_hd_bCanAssign=false;_hd_bCanUpdate=false;_hd_bCanCancel=false;_hd_bCanHold=false;_hd_bCanTakeOffHold=false;case _RESOLVED:_hd_bCanClose=true;_hd_bCanResolve=false;_hd_bCanAccept=false;_hd_bCanHold=false;_hd_bCanTakeOffHold=false;break;case _CLOSED:case _CLOSEDCHARGE:_hd_bCanClose=false;_hd_bCanResolve=false;_hd_bCanAccept=false;_hd_bCanAssign=false;_hd_bCanUpdate=false;_hd_bCanCancel=false;_hd_bCanHold=false;_hd_bCanTakeOffHold=false;_hd_bCanAttach=false;break;case _UNACCEPTED:_hd_bCanReactivate=false;_hd_bCanHold=false;_hd_bCanTakeOffHold=false;_hd_bCanClose=false;_hd_bCanResolve=false;_hd_bCanReactivate=false;break;case _UNASSIGNED:_hd_bCanHold=false;_hd_bCanTakeOffHold=false;_hd_bCanClose=false;_hd_bCanResolve=false;_hd_bCanReactivate=false;break;case _PENDING:_hd_bCanTakeOffHold=false;_hd_bCanAccept=false;_hd_bCanReactivate=false;break;case _ONHOLD:_hd_bCanHold=false;_hd_bCanReactivate=false;_hd_bCanClose=false;_hd_bCanResolve=false;_hd_bCanAccept=false;_hd_bCanAssign=false;break;case _OFFHOLD:_hd_bCanTakeOffHold=false;_hd_bCanReactivate=false;_hd_bCanClose=false;_hd_bCanResolve=false;break;case _INCOMING:_hd_bCanReactivate=false;break;case _CANCELLED:_hd_bCanClose=false;_hd_bCanResolve=false;_hd_bCanAccept=false;_hd_bCanAssign=false;_hd_bCanUpdate=false;_hd_bCanCancel=false;_hd_bCanTakeOffHold=false;_hd_bCanHold=false;_hd_bCanAttach=false;break;case _ESCO:case _ESCG:case _ESCA:_hd_bCanTakeOffHold=false;_hd_bCanHold=false;_hd_bCanReactivate=false;_hd_bCanClose=false;_hd_bCanResolve=false;break;default:alert("Service Desk Status Not Recognised : "+nStatus);break;}app.toolbar_item_dore("cdf","callupdate",_hd_bCanUpdate,document);app.toolbar_item_dore("cdf","callassign",_hd_bCanAssign,document);app.toolbar_item_dore("cdf","callaccept",_hd_bCanAccept,document);app.toolbar_item_dore("cdf","callhold",_hd_bCanHold,document);app.toolbar_item_dore("cdf","calloffhold",_hd_bCanTakeOffHold,document);app.toolbar_item_dore("cdf","callresolve",(_hd_bCanResolve||_hd_bCanClose),document);app.toolbar_item_dore("cdf","callcancel",_hd_bCanCancel,document);app.toolbar_item_dore("cdf","callwatch",!bIsWatched,document);app.toolbar_item_dore("cdf","callunwatch",bIsWatched,document);app.toolbar_item_dore("cdf","attach",_hd_bCanAttach,document);app.toolbar_item_dore("cdf","unattach",false,document);}function _swdoc_cdf_OnAcceptCall(){if(app.dd.GetGlobalParamAsNumber("webclient settings/call details/disabledataqualitycheckoncallaction")!=1){if(!this._OnPreValidate()){return false;}}app._acceptcallform(document.opencall.callref,window,[],function(){this._OnDataChanged(true);});}function _swdoc_cdf_OnCancelCall(){if(app._cancelcallform(document.opencall.callref,window)){this._OnDataChanged(true);}}function _swdoc_cdf_OnHoldCall(){if(app.dd.GetGlobalParamAsNumber("webclient settings/call details/disabledataqualitycheckoncallaction")!=1){if(!this._OnPreValidate()){return false;}}if(app._holdcallform(document.opencall.callref,window)){this._OnDataChanged(true);}}function _swdoc_cdf_OnOffHoldCall(){if(app.dd.GetGlobalParamAsNumber("webclient settings/call details/disabledataqualitycheckoncallaction")!=1){if(!this._OnPreValidate()){return false;}}if(app._swchd_offhold_call(document.opencall.callref)){this._OnDataChanged(true);}}function _swdoc_cdf_OnAssignCall(){if(app.dd.GetGlobalParamAsNumber("webclient settings/call details/disabledataqualitycheckoncallaction")!=1){if(!this._OnPreValidate()){return false;}}if(app._swchd_assign_call(document.opencall.callref,"","","",window)){this._OnDataChanged(true);}}function _swdoc_cdf_OnResolveCall(){if(app.dd.GetGlobalParamAsNumber("webclient settings/call details/disabledataqualitycheckoncallaction")!=1){if(!this._OnPreValidate()){return false;}}if(app._resolveclosecallform(document.opencall.callref,window)){this._OnDataChanged(true);}}function _swdoc_cdf_OnUpdateCall(){if(app.dd.GetGlobalParamAsNumber("webclient settings/call details/disabledataqualitycheckoncallaction")!=1){if(!this._OnPreValidate()){return false;}}app._updatecallform(document.opencall.callref,window,[],function(){this._OnDataChanged(true);});}function _swdoc_cdf_OnSaveCall(){if(!this._OnSaveData()){return false;}if(!this._OnPreValidate()){return false;}var xmlmc=new XmlMethodCall();xmlmc.SetParam("callref",document.opencall.callref);var strAdditionalCallValues="";var strAdditionalOpencallValues="";var strCallDetailExtendedValues="";var lapp=app;var ldd=app.dd;if(this._exttable!=null){this._exttable._columns[this._exttable._keycolumn].originalvalue="";this._exttable._columns[this._exttable._keycolumn].value=this._mastertable._columns[this._mastertable._keycolumn].value;_swdoc[this._exttable._name][this._exttable._keycolumn]=this._mastertable._columns[this._mastertable._keycolumn].value;this._exttable._savedata();}var rec=document.GetRecord("opencall");if(rec){var nColCount=rec.GetCount();for(var x=0;x<nColCount;x++){if(!this._mastertable.IsModified(x)){continue;}var strFieldName=rec.GetColumnName(x);var varSendValue=rec.GetValue(x);if(varSendValue.indexOf("&[")==0){varSendValue=_parse_context_vars(varSendValue);rec[strFieldName]=varSendValue;}else{if(document._listbox_extraoptions_bindings["opencall."+strFieldName]!=undefined){var arrInfo=document._listbox_extraoptions_bindings["opencall."+strFieldName].info;if(varSendValue==arrInfo[0]){varSendValue=_parse_context_vars(arrInfo[1]);rec[strFieldName]=varSendValue;}}}if(ldd.tables["opencall"].columns[strFieldName].IsNumeric()){if(varSendValue==""||varSendValue==undefined||varSendValue=="undefined"){varSendValue=0;}}else{if(varSendValue==undefined||varSendValue=="undefined"){continue;}}if(strAdditionalOpencallValues==""){strAdditionalOpencallValues="<opencall>";}strAdditionalOpencallValues+="<"+strFieldName+">"+lapp.pfx(varSendValue)+"</"+strFieldName+">";}if(strAdditionalOpencallValues!=""){strAdditionalOpencallValues+="</opencall>";}}strAdditionalCallValues=strAdditionalOpencallValues;if(strAdditionalCallValues==""){strAdditionalCallValues="<opencall><callref>"+document.opencall.callref+"</callref></opencall>";}xmlmc.SetParamAsComplexType("additionalCallValues",strAdditionalCallValues+strCallDetailExtendedValues);if(xmlmc.Invoke("helpdesk","updateCallValues")){if(app._CurrentServiceDeskRowKey==document.opencall.callref&&app._CurrentServiceDeskTable!=null){var aRow=app._CurrentServiceDeskTable.rows[app._CurrentServiceDeskRowIndex];if(aRow!=undefined){app._refresh_servicedesk_row(aRow);}}this._OnDataSaved();return true;}else{alert("The system failed to save the changes. Please report the following error to your Administrator.\n\nError : "+xmlmc.GetLastError());return false;}}function _swdoc_lcf(oDocument){oDocument._OnAcceptCall=_swdoc_lcf_OnAcceptCall;oDocument._OnLogAndAssignCall=_swdoc_lcf_OnLogAndAssignCall;oDocument._OnLogAndResolveCall=_swdoc_lcf_OnLogAndResolveCall;oDocument._OnLogCall=_swdoc_lcf_OnLogCall;oDocument._OnTakeCall=_swdoc_lcf_OnTakeCall;oDocument._OnCallLoggedOK=_swdoc_lcf_OnCallLoggedOK;oDocument._OnSetProfileCodeFilter=_swdoc_lcf_OnSetProfileCodeFilter;oDocument._OnRecordReset=_swdoc_lcf_OnRecordReset;oDocument._OnRecordResolved=_swdoc_lcf_OnRecordResolved;oDocument._CheckSpecialFields=_swdoc_lcf_CheckSpecialFields;oDocument._OnResolveRecord=_swdoc_lcf_OnResolveRecord;oDocument._setup_toolbar_buttons=_swdoc_lcf_setup_toolbar_buttons;oDocument._process_form_toolbar_action=_swdoc_lcf_process_form_toolbar_action;oDocument._send_session_data=_swdoc_lcf_onSendSessionData;oDocument._complete_log_call=_swdoc_lcf_complete_log_call;oDocument._AttachMailMessageToCall=_swdoc_lcf_AttachMailMessageToCall;oDocument.AcceptCall=_swdoc_lcf_OnAcceptCall;oDocument.LogAndAssignCall=_swdoc_lcf_OnLogAndAssignCall;oDocument.LogAndResolveCall=_swdoc_lcf_OnLogAndResolveCall;oDocument.TakeCall=_swdoc_lcf_OnTakeCall;oDocument.LogCall=_swdoc_lcf_OnLogCall;}function _swdoc_lcf_process_form_toolbar_action(strID){switch(strID){case"qlc":break;case"swtasks":break;case"attach":if(!app.session.HaveRight(ANALYST_RIGHT_A_GROUP,ANALYST_RIGHT_A_CANATTACHFILESTOCALLS,true)){return;}files.fl_files.AddFiles("lcf");break;case"unattach":files.fl_files.RemoveFile(files.fl_files.curSel);app.toolbar_item_dore("lcf","unattach",false,document);break;case"callaccept":this._OnAcceptCall();break;case"calllog":this._OnLogCall();break;case"calltake":this._OnTakeCall();break;case"callassign":this._OnLogAndAssignCall();break;case"callresolve":this._OnLogAndResolveCall();break;default:alert("log call toolbar action not supported : "+strID);}}function _swdoc_lcf_onSendSessionData(){var con={};con.SendValue=function(strParamName,strValue){var strParamName=strParamName.toLowerCase();if(strParamName.indexOf(".")>-1){var arrParam=strParamName.split(".");if(dd.tables[arrParam[0]]!=undefined&&dd.tables[arrParam[0]].columns[arrParam[1]]!=undefined){document[arrParam[0]][arrParam[1]]=strValue;}}else{document.opencall[strParamName]=strValue;}};con.SendNumber=function(strField,varValue){this.SendValue(strField,varValue);};con.SendText=function(strField,varValue){this.SendValue(strField,varValue);};con.SendBoolean=function(strField,varValue){this.SendValue(strField,varValue);};con.SendString=function(strField,varValue){this.SendValue(strField,intValue);};con.SendDate=function(strField,varValue){this.SendValue(strField,varValue);};var strFunc="OnSendSessionData";if(window[strFunc]){window[strFunc](con);}}function _swdoc_lcf_OnResolveRecord(strTable,strColumn,strValue){app._CURRENT_JS_WINDOW=window;if(document._ResolvingIncomingRecords){return strValue;}var strFunc="OnResolveRecord";if(window[strFunc]){strValue=window[strFunc](strTable,strColumn,strValue);this._CheckFormCodeDataChange();}return strValue;}function _swdoc_lcf_CheckSpecialFields(strTable){if(this._tables[strTable.toLowerCase()]._type==_RELATED){for(strColID in document[strTable.toLowerCase()]){if(strColID.indexOf("_")==0){continue;}var strValue=document[strTable.toLowerCase()][strColID];if(strValue!=undefined){strValue+="";if(strValue.indexOf("!P")==0||strValue.indexOf("!T")==0){if(strValue.indexOf("!P")==0){var strMessage=strValue.substring(4);if(strMessage!=""){alert(strMessage);}}else{var strMessage=strValue.substring(5);if(strMessage!=""){document.infobar.AddItem(strMessage,"","","_lfc_specialfields");}}}}}}}function _swdoc_lcf_OnRecordResolved(strTable){app._CURRENT_JS_WINDOW=window;this._tables[strTable.toLowerCase()]._isloaded=true;if(this._tables[strTable.toLowerCase()]._type==_RELATED){this._CheckSpecialFields(strTable);}if(!document._ResolvingIncomingRecords){var strFunc="OnRecordResolved";if(window[strFunc]){window[strFunc](strTable);this._CheckFormCodeDataChange();}}}function _swdoc_lcf_OnRecordReset(strTable){this._tables[strTable.toLowerCase()]._isloaded=false;var strFunc="OnRecordReset";if(window[strFunc]){window[strFunc](strTable);this._CheckFormCodeDataChange();}}function _swdoc_lcf_OnSetProfileCodeFilter(strFilter){var strFunc="OnSetProfileCodeFilter";if(window[strFunc]){strFilter=window[strFunc](strFilter);this._CheckFormCodeDataChange();}return strFilter;}function _swdoc_lcf_AttachMailMessageToCall(intCallref){if(_swdoc_pointer._form["mailbox"]==undefined||_swdoc_pointer._form["mailbox"]==""||_swdoc_pointer._form["emailid"]<0){return;}if(!app.dd.GetGlobalParamAsNumber("Email Audit Trail/StoreEmailAuditTrail")){return;}var bIncludeAttachments=dd.GetGlobalParamAsNumber("Email Audit Trail/IncludeAttachmentsInMessage");var strMoveMessageToFolder=dd.GetGlobalParamAsString("Mail Move Folders/LogCallMailFolder");if(strMoveMessageToFolder==""){if(dd.GetGlobalParamAsNumber("Email Audit Trail/MoveToDeletedItems")==1){strMoveMessageToFolder="Deleted Items";}}var strEmailSubject="";if(_swdoc_pointer._form["emailsubject"]!=""){strEmailSubject=app._replaceIllegalFileCharacters(_swdoc_pointer._form["subject"]);}var res=app.global.AttachMessageToCall(_swdoc_pointer._form["mailbox"],_swdoc_pointer._form["emailid"],"Received-"+strEmailSubject+".swm",intCallref,0,"mail-received",bIncludeAttachments,strMoveMessageToFolder);if(!res){alert("There was an error attaching the originating e-mail to this request. Please contact your Administrator");}}function _swdoc_lcf_OnCallLoggedOK(nCallRef,dateRespondBy,dateFixBy,strCustName,strSla,intCallref){this._AttachMailMessageToCall(intCallref);var strParams="_table="+top.document._tempworkflowtable+"&_callref="+intCallref;var strURL=app.webroot+"/webclient/service/workflow/attach_call_workflow.php";var res=app.get_http(strURL,"swsessionid="+app._swsessionid+"&"+strParams,true,false,null,null);if(res!="ok"){alert("The system failed to attach the associated workflow due to the foll0wing reason:-\n\n"+res+"\n\nPlease contact your Administrator.");}document.UpdateFormFromData(undefined,true);var strFunc="OnCallLoggedOK";if(window[strFunc]){window[strFunc](nCallRef,dateRespondBy,dateFixBy,strCustName,strSla);this._CheckFormCodeDataChange();}}function _swdoc_lcf_setup_toolbar_buttons(oJsonFormOptions){var bAllowLog=(oJsonFormOptions.allowLog!="true")?false:true;var bAllowLogAssign=(oJsonFormOptions.allowLogAssign!="true")?false:true;var bAllowLogAccept=(oJsonFormOptions.allowLogAccept!="true")?false:true;var bAllowLogClose=(oJsonFormOptions.allowLogClose!="true")?false:true;var bAllowLogAcceptTake=(oJsonFormOptions.allowLogAcceptTake!="true")?false:true;var bAllowAttachments=(oJsonFormOptions.showFileAttachments!="true")?false:true;app.toolbar_item_dore("lcf","calllog",bAllowLog,document);app.toolbar_item_dore("lcf","callassign",bAllowLogAssign,document);app.toolbar_item_dore("lcf","callaccept",bAllowLogAcceptTake,document);app.toolbar_item_dore("lcf","calltake",bAllowLogAccept,document);app.toolbar_item_dore("lcf","callresolve",bAllowLogClose,document);app.toolbar_item_sorh("lcf","attach",bAllowAttachments,document);app.toolbar_item_sorh("lcf","unattach",bAllowAttachments,document);}function _swdoc_lcf_OnAcceptCall(){if(!this._OnPreValidate()){return false;}document.opencall.fixbyx="";document.opencall.respondbyx="";if(app.session.currentAnalystId==""){document.opencall.owner=app.session.analystid;document.opencall.suppgroup=app.session.groupId;}else{document.opencall.owner=app.session.currentAnalystId;document.opencall.suppgroup=app.session.currentGroupId;}var res=true;var strFunc="OnAcceptCall";if(window[strFunc]){res=window[strFunc]();this._CheckFormCodeDataChange();}if(res!=false){this._complete_log_call("logaccept");}return true;}function _swdoc_lcf_OnLogAndAssignCall(strGroupID,strAnalystID){if(!this._OnPreValidate()){return false;}var picker=new PickAnalystDialog();picker.Open("Assign Request To:",false,function(){document.opencall.owner=picker.analystid;document.opencall.suppgroup=picker.groupid;if(document.opencall.owner==""&&document.opencall.suppgroup==""){return false;}document.opencall.fixbyx="";document.opencall.respondbyx="";var res=true;var strFunc="OnLogAndAssignCall";if(window[strFunc]){res=window[strFunc](document.opencall.suppgroup,document.opencall.owner);this._CheckFormCodeDataChange();}if(res!=false){this._complete_log_call("logassign");}return res;});}function _swdoc_lcf_OnLogAndResolveCall(){if(!this._OnPreValidate()){return false;}document.opencall.fixbyx="";document.opencall.respondbyx="";if(app.session.currentAnalystId==""){document.opencall.owner=app.session.analystid;document.opencall.suppgroup=app.session.groupId;}else{document.opencall.owner=app.session.currentAnalystId;document.opencall.suppgroup=app.session.currentGroupId;}var res=true;var strFunc="OnLogAndResolveCall";if(window[strFunc]){res=window[strFunc]();this._CheckFormCodeDataChange();}if(res!=false){this._complete_log_call("logresolve");}return res;}function _swdoc_lcf_OnLogCall(){if(!this._OnPreValidate()){return false;}document.opencall.fixbyx="";document.opencall.respondbyx="";document.opencall.owner="";document.opencall.suppgroup=app.session.currentGroupId;if(document.opencall.suppgroup==""){document.opencall.suppgroup=app.session.groupId;}var res=true;var strFunc="OnLogCall";if(window[strFunc]){res=window[strFunc]();this._CheckFormCodeDataChange();}if(res!=false){document.opencall.status=2;this._complete_log_call("logcall");}return res;}function _swdoc_lcf_OnTakeCall(){if(!this._OnPreValidate()){return false;}document.opencall.fixbyx="";document.opencall.respondbyx="";document.opencall.owner=app.session.analystid;document.opencall.suppgroup=app.session.groupId;var res=true;var strFunc="OnTakeCall";if(window[strFunc]){res=window[strFunc]();this._CheckFormCodeDataChange();}if(res!=false){document.opencall.status=3;this._complete_log_call("logtake");}return res;}function _swdoc_lcf_complete_log_call(strType){document.opencall.callclass=this._callclass;this._send_session_data();var xmlmcMethod="logNewCall";var xmlmc=new XmlMethodCall();if(_SWF_INCOMING_CALL){xmlmc.SetParam("incomingCallref",document.GetArg("incoming.callref"));}xmlmc.SetParam("callClass",document.opencall.callclass);if(document.opencall.priority!=""){if(document._listbox_extraoptions_bindings["opencall.priority"]!=undefined){var arrInfo=document._listbox_extraoptions_bindings["opencall.priority"].info;if(document.opencall.priority==arrInfo[0]){document.opencall.priority=_parse_context_vars(arrInfo[1]);}}if(document.opencall.priority!=""){xmlmc.SetParam("slaName",document.opencall.priority);}}if(document.opencall.probcode){xmlmc.SetParam("probCode",document.opencall.probcode);}xmlmc.SetParam("condition",document.opencall.h_condition);if(document.opencall.logdatex>0){var UTCDATE=app._date_from_epoch(document.opencall.logdatex);var strDateTime=app._formatDate(UTCDATE,"yyyy-MM-dd HH:mm:ss");xmlmc.SetParam("logDate",strDateTime);}var boolAssign=false;switch(strType){case"logassign":boolAssign=true;xmlmcMethod="logAndAssignNewCall";xmlmc.SetParam("groupId",document.opencall.suppgroup);if(document.opencall.owner!=""){xmlmc.SetParam("analystId",document.opencall.owner);}break;case"logtake":xmlmcMethod="logAndTakeNewCall";break;case"logaccept":case"logresolve":xmlmcMethod="logAndAcceptNewCall";break;}if(document.updatedb.timespent!=0){xmlmc.SetParam("timeSpent",document.updatedb.timespent);}if(document.updatedb.updatetxt!=""){xmlmc.SetParam("updateMessage",document.updatedb.updatetxt);}xmlmc.SetParam("updateCode","Logging");var strSource=(_swdoc_pointer._form["emailid"]>0)?"E-Mail":"Telephone";xmlmc.SetParam("updateSource",strSource);if(boolAssign){xmlmc.SetParam("forceAssignment",true);}var strAdditionalLogCallValues="";var strAdditionalLogOpencallValues="";var strAdditionalLogUpdatedbValues="";var strLogCallExtendedValues="";var rec=document.GetRecord("opencall");if(rec){var nColCount=rec.GetCount();for(var x=0;x<nColCount;x++){var strFieldName=rec.GetColumnName(x);var varSendValue=rec.GetValue(x);if(varSendValue.indexOf("&[")==0){varSendValue=_parse_context_vars(varSendValue);rec[strFieldName]=varSendValue;}else{if(document._listbox_extraoptions_bindings["opencall."+strFieldName]!=undefined){var arrInfo=document._listbox_extraoptions_bindings["opencall."+strFieldName].info;if(varSendValue==arrInfo[0]){varSendValue=_parse_context_vars(arrInfo[1]);rec[strFieldName]=varSendValue;}}}if(app.dd.tables["opencall"].columns[strFieldName]==undefined){continue;}if(app.dd.tables["opencall"].columns[strFieldName].IsNumeric()){if(varSendValue==0||varSendValue==""||varSendValue==undefined||varSendValue=="undefined"){continue;}}else{if(varSendValue==""||varSendValue==undefined||varSendValue=="undefined"){continue;}}if(strAdditionalLogOpencallValues==""){strAdditionalLogOpencallValues="<opencall>";}strAdditionalLogOpencallValues+="<"+strFieldName+">"+app.pfx(varSendValue)+"</"+strFieldName+">";}if(strAdditionalLogOpencallValues!=""){strAdditionalLogOpencallValues+="</opencall>";}}var rec=document.GetRecord("updatedb");if(rec){var nColCount=rec.GetCount();for(var x=0;x<nColCount;x++){if(!rec.IsModified(x)){continue;}var strFieldName=rec.GetColumnName(x);var varSendValue=rec.GetValue(x);if(varSendValue.indexOf("&[")==0){varSendValue=_parse_context_vars(varSendValue);rec[strFieldName]=varSendValue;}else{if(document._listbox_extraoptions_bindings["updatedb."+strFieldName]!=undefined){var arrInfo=document._listbox_extraoptions_bindings["updatedb."+strFieldName].info;if(varSendValue==arrInfo[0]){varSendValue=_parse_context_vars(arrInfo[1]);rec[strFieldName]=varSendValue;}}}if(strAdditionalLogUpdatedbValues==""){strAdditionalLogUpdatedbValues="<updatedb>";}strAdditionalLogUpdatedbValues+="<"+strFieldName+">"+app.pfx(varSendValue)+"</"+strFieldName+">";}if(strAdditionalLogUpdatedbValues!=""){strAdditionalLogUpdatedbValues+="</updatedb>";}}try{var affLen=files.fl_files.rowCount();for(var x=0;x<affLen;x++){var strFileName=files.fl_files.GetItemText(x,0);var strFileAtts="<embeddedFileAttachment><fileName>"+app.pfx(strFileName)+"</fileName></embeddedFileAttachment>";xmlmc.SetParamAsComplexType("fileAttachment",strFileAtts);}}catch(e){}strAdditionalLogCallValues=strAdditionalLogOpencallValues+strAdditionalLogUpdatedbValues+strLogCallExtendedValues;if(strAdditionalLogCallValues!=""){xmlmc.SetParamAsComplexType("additionalCallValues",strAdditionalLogCallValues);}if(xmlmc.Invoke("helpdesk",xmlmcMethod)){var intCallref=xmlmc.GetReturnValue("callref");if(this._exttable!=null){this._exttable._keyvalue="";this._exttable._columns[this._exttable._keycolumn].originalvalue="";this._exttable._columns[this._exttable._keycolumn].value=intCallref;_swdoc[this._exttable._name][this._exttable._keycolumn]=intCallref;this._exttable._savedata();}var respEpoch=0;var fixEpoch=0;var strRespondBy=app.string_replace(xmlmc.GetReturnValue("respondBy"),"Z","");var strFixBy=app.string_replace(xmlmc.GetReturnValue("fixBy"),"Z","");if(strRespondBy!=""){var respDate=app._parseDate(strRespondBy,"yyyy-MM-dd HH:mm:ss");var fixDate=app._parseDate(strFixBy,"yyyy-MM-dd HH:mm:ss");var respEpoch=app._date_to_epoch(respDate);var fixEpoch=app._date_to_epoch(fixDate);}var strCallref=xmlmc.GetReturnValue("formattedcallref");if(strCallref==""){strCallref=app.dd.tables["opencall"].columns["callref"].FormatValue(intCallref);}var supportGroup=xmlmc.GetReturnValue("supportGroup");var supportOwner=xmlmc.GetReturnValue("owner");var strCustomerName=xmlmc.GetReturnValue("customerName");var slaName=xmlmc.GetReturnValue("sla");var intSLAtz=xmlmc.GetReturnValue("slaTimeZoneOffset");var strSlaTzName=xmlmc.GetReturnValue("slaTimeZoneName");var msgArray=new Array();msgArray[0]=strCallref;msgArray[1]=strCustomerName;if(slaName!=""){msgArray[2]=strSlaTzName;msgArray[3]=app.format_analyst_datetime(app._date_from_epoch(respEpoch,intSLAtz));msgArray[4]=app.format_analyst_datetime(app._date_from_epoch(fixEpoch,intSLAtz));msgArray[5]=app._analyst_timezone;msgArray[6]=app.format_analyst_datetime(app._date_from_epoch(respEpoch,app._analyst_timezoneoffset));msgArray[7]=app.format_analyst_datetime(app._date_from_epoch(fixEpoch,app._analyst_timezoneoffset));}document.opencall.callref=intCallref;document.opencall.fixbyx=fixEpoch;document.opencall.respondbyx=respEpoch;document.opencall.owner=supportOwner;document.opencall.suppgroup=supportGroup;this._OnCallLoggedOK(strCallref,respEpoch,fixEpoch,strCustomerName,slaName,intCallref);var bAlert=true;if(app.OnNewCallLogged!=undefined){bAlert=app.OnNewCallLogged(intCallref,document.opencall.callclass);}if(bAlert){var lcfConfirmationCallback=function(oForm){if(oForm!=null){if(oForm.opendetail){app._open_call_form("",intCallref,false,window);}if(oForm.emailcustomer){var strUpdateText="";if(document.updatedb.updatetxt!=""){strUpdateText=document.updatedb.updatetxt;}app.global.ComposeCallUpdateEmail(intCallref+"",0,strUpdateText,intCallref+".0",360,"LogCallMailTemplate",1,null,document.opencall.callclass);}}if(strType=="logresolve"){app._resolveclosecallform(intCallref);}if(app._CurrentOutlookType=="helpdesk"){app._get_servicedesk_newcall_data(document.opencall.callref);}document.CloseForm();};var strParams="_messagearray="+msgArray;app._open_system_form("lcfconfirmation.php","logcallconfirm","",strParams,true,lcfConfirmationCallback,null,window,350,270);}else{if(strType=="logresolve"){app._resolveclosecallform(intCallref);}if(app._CurrentOutlookType=="helpdesk"){app._get_servicedesk_newcall_data(document.opencall.callref);}document.CloseForm();}}else{alert(xmlmc._lasterror);}}function _swdoc_lcf_run_quicklog(intQuicklogID){}function _swdoc_lcf_save_quicklog(){}var _sw_arr_infobar_timers=new Array();function _sw_inforbar_timer(nBar){if(_sw_arr_infobar_timers[nBar]!=undefined){_sw_arr_infobar_timers[nBar].ShowNextItem();}}function _sw_infobar(){this._intervalid=-1;this._currgroupid="";this._currgrouppos=-1;this._groups=new Array();this.cycling=false;this._timerarrpos=_sw_arr_infobar_timers.length;_sw_arr_infobar_timers[_sw_arr_infobar_timers.length++]=this;}_sw_infobar.prototype.StartAutoCycle=function(intMillSeconds){if(intMillSeconds==undefined){intMillSeconds=1000;}this.cycling=true;this._intervalid=setInterval("_sw_inforbar_timer("+this._timerarrpos+")",intMillSeconds);return true;};_sw_infobar.prototype.RemoveItemsByGroup=function(strGroup){this._groups[strGroup]=new Array();return true;};_sw_infobar.prototype.RemoveAllItems=function(){clearInterval(this._intervalid);this._intervalid=-1;this.cycling=false;this._groups=new Array();window.status="";return true;};_sw_infobar.prototype.ShowPrevItem=function(){return true;};_sw_infobar.prototype.ShowNextItem=function(){var strFirstGroup="";var strPrevGroup="";var strNextGroup="";var strLastGroup="";for(strGroup in this._groups){if(this._groups[strGroup].length==0){continue;}if(strFirstGroup==""){strFirstGroup=strGroup;}if(this._currgroupid==strPrevGroup){strNextGroup=strGroup;}strPrevGroup=strGroup;}if(strNextGroup==""){strNextGroup=strFirstGroup;}strLastGroup=strGroup;if(this._currgroupid==""){this._currgroupid=strFirstGroup;this._currgrouppos=0;}var arr=this._groups[this._currgroupid];var strStatus=arr[this._currgrouppos++];if(strStatus==undefined){this._currgrouppos=0;if(this._currgroupid==strLastGroup){this._currgroupid=strFirstGroup;}else{this._currgroupid=strNextGroup;}var arr=this._groups[this._currgroupid];var strStatus=arr[this._currgrouppos++];}window.status=strStatus;return true;};_sw_infobar.prototype.GetItemCount=function(){var intc=0;for(strGroup in this._groups){intc=intc+this._groups[strGroup].length;}return intc;};_sw_infobar.prototype.GetGroupItemCount=function(strGroup){if(this._groups[strGroup]==undefined){return 0;}return this._groups[strGroup].length;};_sw_infobar.prototype.AddItem=function(strMessage,strColor,strIcon,strGroup){if(strGroup==undefined){strGroup="_";}if(this._groups[strGroup]==undefined){this._groups[strGroup]=new Array();}this._groups[strGroup][this._groups[strGroup].length++]=strMessage;if(this._intervalid==-1){this.ShowNextItem();}return true;};;;;;function new_swform(strFormName,oFormJson,swDocument,boolAltForm,strFormSpecificJson){var aForm=new _swform(strFormName,oFormJson,swDocument,boolAltForm,strFormSpecificJson);return aForm;}function _swform(strFormName,oFormJson,swDocument,boolAltForm,strFormSpecificJson){if(boolAltForm==undefined){boolAltForm=false;}if(strFormSpecificJson==undefined){strFormSpecificJson=strFormJson;}if(boolAltForm||strFormName=="mainform"){var strForm=strFormSpecificJson.split('"layout":')[1];if(strForm.charAt(0)=="{"){strForm=strForm.split(',"extendedLayout":')[0];this.jform=eval("("+strForm+")");}else{this.jform=eval("("+strForm.substring(0,strForm.length-3)+")");this.jform=this.jform[0];}}else{if(strFormName=="extform"){var strForm=strFormSpecificJson.split('"extendedLayout":')[1];this.jform=eval("("+strForm.substring(0,strForm.length-2)+")");}}this._name=strFormName;this.elements=new Array();this.namedelements=new Array();this.boundelements=new Array();this.elementsbybinding=new Array();this._controlgroups=new Array();this._tabname="Details";this._tabcontrols=new Array();this._flagcontrols=new Array();this._width=0;this._height=0;this.width=0;this.height=0;this._origwidth=0;this._origheight=0;this._readonly=false;this.readonly=false;this._binitialised=false;this._bDrawn=false;this._isaltforn=boolAltForm;this._xmlaltformdom=null;this._jsonaltformdom=null;this._swdoc=swDocument;this.document=swDocument;this._targetiframe=this._swdoc.document.getElementById("if_"+strFormName);this._targetdocument=this._targetiframe.contentWindow.document;this._targetframe=this._targetiframe.contentWindow;this._targetframe._form=this;this._activating_menubutton=false;this._arr_open_menubuttons=new Array();this._arr_open_lists=new Array();this._arrtimers=new Array();this._initialise(oFormJson);}_swform.prototype._close_open_menubuttons=function(){for(strID in this._arr_open_menubuttons){if(this._arr_open_menubuttons[strID]){this.namedelements[strID].deactivate();}}};_swform.prototype._close_open_lists=function(strExlcudeName){for(strID in this._arr_open_lists){if(strID==strExlcudeName){continue;}if(this._arr_open_lists[strID]&&this.namedelements[strID]._dropped){this.namedelements[strID].deactivate();}}};_swform.prototype._resize_controls=function(bForce){if(!this._bDrawn){return;}if(bForce==undefined){bForce=false;}if(!bForce){if((this._origwidth==this._width)&&(this._origheight==this._height)){return;}}for(var strControlID in this.namedelements){this.namedelements[strControlID]._resize();}app.__cached_forms[_cacheformname].width=GetWinWidth();app.__cached_forms[_cacheformname].height=GetWinHeight();};_swform.prototype._initialise=function(){var oFormJson=this.jform;var lapp=app;if(!this._isaltforn){var strTable="";var arrTables=this._swdoc._tables;for(strTable in arrTables){this._targetframe[strTable]=arrTables[strTable];}}this._origwidth=oFormJson.appearance.width;this._origheight=oFormJson.appearance.height;var strControlName="";var oSwControl=null;var me=this;var arrJsonControls=oFormJson.controls;if(arrJsonControls){arrJsonControls=oFormJson.controls.control;if(oFormJson.controls.control.objectPlacement!=undefined){arrJsonControls=new Array();arrJsonControls[arrJsonControls.length++]=oFormJson.controls.control;}var cLen=arrJsonControls.length;for(var x=0;x<cLen;x++){oSwControl=new _swfc(arrJsonControls[x],me);strControlName=oSwControl.name;if(me.namedelements[strControlName]!=undefined){strControlName=strControlName+"_"+x;oSwControl.name=strControlName;}if(oSwControl._etype==FC_TABCONTROL){me._tabcontrols[strControlName]=oSwControl;}else{if(oSwControl._etype==FC_FLAGS){me._flagcontrols[strControlName]=oSwControl;}}if(oSwControl.binding!=""){me.boundelements[strControlName]=oSwControl;if(me.elementsbybinding[oSwControl.binding]==undefined){me.elementsbybinding[oSwControl.binding]=new Array();}me.elementsbybinding[oSwControl.binding][strControlName]=oSwControl;}me.namedelements[strControlName]=oSwControl;me.elements[strControlName]=oSwControl;me.elements[me.namedelements.length++]=oSwControl;me[strControlName]=oSwControl;me._targetframe[strControlName]=oSwControl;}}for(var strID in this._controlgroups){this[strID]=this._controlgroups[strID];}this._binitialised=true;};_swform.prototype._elements=function(strID){};_swform.prototype._initialise_tabcontrols=function(){var tC=null;for(strTabControlID in this._tabcontrols){tC=this._tabcontrols[strTabControlID];tC._initialise_elements();if(tC._items[tC.tab].controlInfo){var jFlags=tC._items[tC.tab].controlInfo.flags;if(jFlags!=undefined){if(jFlags.invisible=="true"){tC.ShowTabItem(tC.tab,false,true);}else{tC.ShowTabItem(tC.tab,true,true);}}else{tC.ShowTabItem(tC.tab,true,true);}}}};_swform.prototype._initialise_flagcontrols=function(){var fc=null;for(var strFlagControlID in this._flagcontrols){fc=this._flagcontrols[strFlagControlID];if(!fc.datainitialised&&fc.defaultValue!=""){fc._value(fc.defaultValue);}}};_swform.prototype._isaFilteredControl=function(oFormControl){return(oFormControl._etype==FC_SQLLIST||oFormControl._etype==FC_DBPICKLIST||oFormControl._etype==FC_FILELIST);};_swform.prototype._initialise_filters=function(strBinding,bFromUpdateFormFromData){if(bFromUpdateFormFromData==undefined){bFromUpdateFormFromData=false;}if(strBinding==undefined){strBinding="";}for(var strControlID in this.namedelements){var oFormControl=this.namedelements[strControlID];if(this._isaFilteredControl(oFormControl)){if(strBinding!=""){if(strBinding.indexOf(".")==-1){strBinding+=".";}if(oFormControl._unparsedFilter==undefined){oFormControl._unparsedFilter=oFormControl.listFilter;}if(oFormControl._unparsedFilter.indexOf(strBinding)>-1){oFormControl.Reload(bFromUpdateFormFromData);}}else{oFormControl.Reload(true);}}else{if(oFormControl._etype==FC_IMAGE){if(strBinding!=""){if(strBinding.indexOf(".")==-1){strBinding+=".";}if(oFormControl.appearance.caption.indexOf(strBinding)>-1){oFormControl._image(_parse_context_vars(oFormControl.appearance.caption));}}}}}};_swform.prototype._check_mandatory_fields=function(bAlertMessage){if(bAlertMessage==undefined){bAlertMessage=true;}for(var strControlID in this.namedelements){var strValue=app.trim(this.namedelements[strControlID].value);if(this.namedelements[strControlID].mandatory&&strValue==""&&this.namedelements[strControlID].hintText.toLowerCase()!="<auto generate>"&&this.namedelements[strControlID].visible==true){var strControlName=strControlID;if(this.namedelements[strControlID].dataRef!=""){var arrBind=this.namedelements[strControlID].dataRef.split(".");try{if(this.namedelements[strControlID].isXmlField()){strControlName=undefined;}else{strControlName=app.dd.tables[arrBind[0]].columns[arrBind[1]].DisplayName;}if(strControlName!=arrBind[1]&&strControlName!=undefined){if(bAlertMessage){alert("The form field ["+strControlName+"] is mandatory.\n\nPlease provide a value before continuing.");}return false;}else{if(strControlName==undefined){if(this.namedelements["lbl_"+strControlID]!=undefined){if(bAlertMessage){alert("The form field ["+this.namedelements["lbl_"+strControlID].text+"] is mandatory.\n\nPlease provide a value before continuing.");}return false;}}}}catch(e){}}if(bAlertMessage){alert("A form field ["+strControlID+"] that is mandatory has not been completed.\n\nPlease provide a value before continuing.");}return false;}}return true;};_swform.prototype._draw=function(){var strCacheHTML="";if(this._name=="mainform"&&app.__cached_forms[_cacheformname]["mainformhtml"]!=undefined){strCacheHTML=app.__cached_forms[_cacheformname]["mainformhtml"];}else{if(this._name=="extform"&&app.__cached_forms[_cacheformname]["extformhtml"]!=undefined){strCacheHTML=app.__cached_forms[_cacheformname]["extformhtml"];}}var bDrawnAlready=false;if(strCacheHTML!=""){bDrawnAlready=true;this._targetdocument.body.innerHTML=strCacheHTML;}for(strID in this.namedelements){this.namedelements[strID]._draw(bDrawnAlready);}this._initialise_tabcontrols();this._bDrawn=true;};_swform.prototype._OnFormLoaded=function(bDataReloaded){var strFunc="OnFormLoaded";if(this._targetframe[strFunc]){if(!_bClosingForm){res=this._targetframe[strFunc](bDataReloaded);}}};_swform.prototype._OnFieldValueChanged=function(strName,strValue){var strFunc="OnFieldValueChanged";if(this._targetframe[strFunc]){res=this._targetframe[strFunc](bDataReloaded);}};_swform.prototype._OnSize=function(nWidth,nHeight){};_swform.prototype._OnShowWindow=function(bShow){};_swform.prototype._OnSetFocus=function(){};_swform.prototype._OnKeyDown=function(nVirtualKey){};_swform.prototype._KillFocus=function(){};_swform.prototype._OnLeftClick=function(){};_swform.prototype._OnLeftDoubleClick=function(){};_swform.prototype._OnMouseOver=function(strName,bMouseOver){};_swform.prototype._OnRightClick=function(){};_swform.prototype._OnRightDoubleClick=function(){};_swform.prototype.IsObjectDefined=function(strObjectName){try{eval("var tmp = "+strObjectName+";");if(tmp!=undefined){return true;}}catch(e){return false;}return false;};_swform.prototype.GetReadOnly=function(){return this._readonly;};_swform.prototype.KillTimer=function(nTimer){if(this._targetframe._KillTimer){this._targetframe._KillTimer(nTimer);}};_swform.prototype.ResetFieldValues=function(){};_swform.prototype.SetReadOnly=function(bReadOnly){this._readonly=bReadOnly;this.readonly=bReadOnly;};_swform.prototype.SetTimer=function(nTimerID,nMilliseconds){if(this._targetframe._SetTimer){this._targetframe._SetTimer(nTimerID,nMilliseconds);}};_swform.prototype.UpdateFormFromData=function(){this._swdoc.UpdateFormFromData();};;;;;var _MASTER="Main Details Table";var _RELATED="Related Table";var _EXTENDED="Extended Details Table";var _DIARY="Diary Updates Table";function _swfTable(oJsonDefinition,oSwDoc,jsonCols){this._swdoc=oSwDoc;this._dsn="";this._name="";this._keycolumn="";this._keyvalue="";this._maindetailscolumn="";this._type="";this._addrecordform="";this._editrecordform="";this._updateverb="";this._maindetailassignments=new Array();this._isloaded=false;this._columns=new Array();this._numcols=new Array();this._numericCols=new Array();this._colcount=0;this._picklist="";this._bRecordDataChanged=true;this._bUserDataChanged=false;this._initresult=this._initialise(oJsonDefinition,jsonCols);}_swfTable.prototype.GetCount=function(){return this._colcount;};_swfTable.prototype.ResetModified=function(){this._bUserDataChanged=false;var nColCount=this.GetCount();for(var x=0;x<nColCount;x++){var strName=this._numcols[x];if(strName==undefined){continue;}this._columns[strName].value=this[strName];}};_swfTable.prototype.IsModified=function(nCol){var strName=this._numcols[nCol];if(strName==undefined){return false;}return(this._columns[strName].originalvalue!=this[strName]);};_swfTable.prototype.GetColumnName=function(nCol){var strName=this._numcols[nCol];if(strName==undefined){return"";}return strName;};_swfTable.prototype.GetValue=function(nCol){var strName=this._numcols[nCol];if(strName==undefined){return"";}return this[strName]+"";};_swfTable.prototype._initialise=function(oJsonDefinition,jsonCols){var lapp=app;this._dsn=oJsonDefinition.dsn;if(this._dsn==""||this._dsn==undefined){this._dsn="swdata";}this._name=oJsonDefinition.name;var lddt=lapp.dd.tables[this._name];if(lddt==undefined){alert("The table ["+this._name+"] used by this form does not exist. Please contact your Administrator.");return false;}this._type=oJsonDefinition.type;this._keycolumn=lddt.PrimaryKey.toLowerCase();this._description=oJsonDefinition.description;this._picklist=oJsonDefinition.recordPicklist;this._maindetailscolumn=oJsonDefinition.mainDetailsColumn;this._addrecordform=oJsonDefinition.addRecordForm;this._editrecordform=oJsonDefinition.editRecordForm;this._updateverb=oJsonDefinition.updateVerb;var strFromColumn="";var strToColumn="";var arrAssignments=oJsonDefinition.assignments;this._maindetailassignments=new Array();if(arrAssignments){if(arrAssignments.assignment.length==undefined){arrAssignments=new Array(arrAssignments.assignment);}else{arrAssignments=arrAssignments.assignment;}var yLen=arrAssignments.length;for(var x=0;x<yLen;x++){strFromColumn=arrAssignments[x].expression;strToColumn=arrAssignments[x].masterRecordColumn;this._maindetailassignments[strToColumn]=strFromColumn;}}if(this._type==_MASTER){this._swdoc._mastertable=this;}else{if(this._type==_EXTENDED){this._swdoc._exttable=this;}}var undefined;var aCol=null;var strColID="";var varValue="";var bNumeric=false;app.debugstart("_swfTable:_initialise:"+this._name+".columns?","xmlform.php");var colLen=jsonCols.length;for(var x=0;x<colLen;x++){aCol=jsonCols[x];if(aCol["@sqlType"].indexOf("VARCHAR")>-1){varValue="";}else{this._numericCols[aCol["@name"]]=true;varValue=0;}this._columns[aCol["@name"]]=_swjsonCol(aCol["@name"],varValue,"",this);}app.debugend("_swfTable:_initialise:"+this._name+".columns?","xmlform.php");return true;};_swfTable.prototype._initialise_jsondata=function(jsonData){var me=this;var lapp=app;if(!_systemform){if(lapp.session.CheckTableRight(me._name,_CAN_VIEW_TABLEREC,true)!=""){return false;}}me._columns=new Array();me._numcols=new Array();var strColName="";for(strColName in jsonData.rawValues){me._columns[strColName]=_swjsonCol(strColName,jsonData.rawValues[strColName],jsonData.displayValues[strColName],me);if(strColName==me._keycolumn){me._keyvalue=jsonData.rawValues[strColName];}else{if(strColName=="taskid"&&me._name=="calltasks"){me._keyvalue=jsonData.rawValues[strColName];}}}console.log(me._columns);me._isloaded=true;me._bRecordDataChanged=true;};_swfTable.prototype._initialise_data=function(xmlData){var me=this;var lapp=app;if(!_systemform){if(lapp.session.CheckTableRight(me._name,_CAN_VIEW_TABLEREC,true)!=""){return false;}}me._columns=new Array();me._numcols=new Array();var arrChildNodes=xmlData.childNodes;var yLen=arrChildNodes.length;var node=null;var xntbt=lapp.xmlNodeTextByTag;var strColName="";var strColValue="";for(var x=0;x<yLen;x++){node=arrChildNodes[x];if(node.tagName!=""){strColName=node.tagName;strColValue=xntbt(node,"value");me._columns[strColName]=_swjsonCol(strColName,strColValue,xntbt(node,"display"),me);if(strColName==me._keycolumn){me._keyvalue=strColValue;}else{if(strColName=="taskid"&&me._name=="calltasks"){me._keyvalue=strColValue;}}}}me._isloaded=true;me._bRecordDataChanged=true;};_swfTable.prototype._reset=function(){for(strColID in this._columns){var varValue=(app.dd.tables[this._name].columns[strColID].IsNumeric())?0:"";this._columns[strColID]=_swjsonCol(strColID,varValue,varValue,this);this[strColID]=varValue;}this._bRecordDataChanged=true;};_swfTable.prototype._savedata=function(boolMasterTable){var boolSave=false;var strFormType=_swdoc.type;if(_systemform){strFormType="system";}if(boolMasterTable==undefined){boolMasterTable=false;}var strTableName=(this._type==_MASTER&&_swdoc._overide_master_save_table!="")?_swdoc._overide_master_save_table:this._name;var strDSN=(this._type==_MASTER&&_swdoc._overide_dsn!="")?_swdoc._overide_dsn:this._dsn;var strAction=(this._keyvalue=="")?"add":"edit";var strKeyColumn=this._keycolumn;if(!_systemform){var iCheckAction=(this._keyvalue=="")?_CAN_ADDNEW_TABLEREC:_CAN_UPDATE_TABLEREC;if(app.session.CheckTableRight(this._name,iCheckAction,true)!=""){return false;}}if(this._name=="calltasks"&&_swdoc._overide_master_save_table!=""){strKeyColumn="taskid:parentgroup";this._columns["taskid"].originalvalue="";this._columns["parentgroup"].originalvalue="";this._columns["parentgroupsequence"].originalvalue="";}else{if(this._name=="calltasks"){strKeyColumn="taskid:callref";this._columns["taskid"].originalvalue="";this._columns["callref"].originalvalue="";this._columns["parentgroupsequence"].originalvalue="";}}var bPrimaryKeyOnly=true;var strXML="<dbaction action='"+strAction+"' type='"+strFormType+"' dsn='"+strDSN+"' table='"+strTableName+"' primarycolumn='"+strKeyColumn+"'>";strXML+="<"+strTableName+">";for(strColID in this._columns){if((this._columns[strColID].originalvalue!=document[this._name][strColID])||(strColID.toLowerCase()==this._keycolumn.toLowerCase())){if(app.dd.tables[this._name].columns[strColID].autoinc.toLowerCase()=="yes"&&strAction=="add"&&(strColID.toLowerCase()==this._keycolumn.toLowerCase())){continue;}var varSendValue=document[this._name][strColID];varSendValue+="";if(varSendValue.indexOf("&[")==0){varSendValue=_parse_context_vars(varSendValue);}if(varSendValue==""&&app.dd.tables[this._name].columns[strColID].IsNumeric()){continue;}if(bPrimaryKeyOnly&&strColID.toLowerCase()!=this._keycolumn.toLowerCase()){bPrimaryKeyOnly=false;}boolSave=true;var strPFS=(app.dd.tables[this._name].columns[strColID].IsNumeric())?"0":"1";strXML+="<"+strColID+" pfs='"+strPFS+"'>";strXML+=""+app.pfx(varSendValue)+"";strXML+="</"+strColID+">";}}if(strAction=="edit"&&bPrimaryKeyOnly){return true;}strXML+="</"+strTableName+"></dbaction>";var bStatus=false;if(boolSave){var strURL=app.webroot+"/webclient/service/form/savedata/index.php";var strRes=app.get_http(strURL,"submitxml="+app.pfu(strXML),true,false,null,null);var xmlDOM=app.create_xml_dom(strRes);var childPos=(xmlDOM.childNodes[1]!=null&&xmlDOM.childNodes[1].getAttribute("status")!=null&&xmlDOM.childNodes[1].getAttribute("status")!="")?1:0;var strFail=xmlDOM.childNodes[childPos].getAttribute("status");bStatus=(strFail=="fail")?false:true;if(!bStatus){var strCode=app.xmlNodeTextByTag(xmlDOM.childNodes[childPos],"code");var strMsg=app.xmlNodeTextByTag(xmlDOM.childNodes[childPos],"error");alert(strMsg);}else{if(strAction=="add"&&boolMasterTable){var newPrimaryKey=app.xmlNodeTextByTag(xmlDOM.childNodes[childPos],"lastInsertId");if(newPrimaryKey==""){newPrimaryKey=app.xmlNodeTextByTag(xmlDOM.childNodes[childPos],strKeyColumn);}if(newPrimaryKey!=""){document._mastertable._columns[this._keycolumn].value=newPrimaryKey;this._keyvalue=newPrimaryKey;}}this._bRecordDataChanged=true;this._bUserDataChanged=false;this._swdoc._EnableSave(false);}}return bStatus;};_swfTable.prototype._check_data_changed=function(){if(this._bUserDataChanged){this._bUserDataChanged=false;return true;}var nColCount=this.GetCount();for(var x=0;x<nColCount;x++){var strName=this._numcols[x];if(strName==undefined){continue;}if(this._columns[strName].value!=this._swdoc[this._name][strName]){return true;}}return false;};_swfTable.prototype._update_form_field=function(oEle,strBinding,bInternal){var arrBind=strBinding.split(".");if(arrBind[1]==undefined){return;}var strTableName=arrBind[0];var strColName=arrBind[1];if(strColName.indexOf("!")!=-1){var arrBind=strColName.split("!");if(this._columns[arrBind[0]]!=undefined&&this._columns[arrBind[1]]!=undefined){var varValueOne=_swdoc[this._name][arrBind[0]];var varValueTwo=_swdoc[this._name][arrBind[1]];this._columns[arrBind[0]]._set_value(varValueOne);this._columns[arrBind[1]]._set_value(varValueTwo);if(varValueOne!=""&&varValueTwo!=""){var strEleValue=varValueOne+" "+varValueTwo;}else{var strEleValue=varValueOne+""+varValueTwo;}if(oEle.value==strEleValue&&!bInternal){return;}if(oEle._value(strEleValue,strEleValue,true)!=false){if(!bInternal){this._bRecordDataChanged=true;this._bUserDataChanged=true;}}}}else{if(strBinding.indexOf("&[")!=-1){var eleValue=_parse_context_vars(strBinding,false,true);if(oEle.value==eleValue&&!bInternal){return;}if(oEle._value(eleValue,eleValue,true)!=false){if(!bInternal){this._bRecordDataChanged=true;this._bUserDataChanged=true;}}}else{if(this._columns[strColName]!=undefined){if(this._type==_MASTER&&_formmode=="edit"){if(strColName==this._keycolumn){if(oEle._etype!=FC_LABEL&&oEle._etype!=FC_FIELDLABEL){oEle._enable(false);}}}var varValue=this._columns[strColName].value;var varDisplayValue=this._columns[strColName].displayvalue;if(varValue!=_swdoc[this._name][strColName]){varValue=_swdoc[this._name][strColName];varDisplayValue=varValue;this._columns[strColName]._set_value(varValue);}if(oEle.value==varValue&&!bInternal){return;}if(oEle._value(varValue,varDisplayValue,true)!=false){if(!bInternal){this._bRecordDataChanged=true;this._bUserDataChanged=true;}}}}}};function _swjsonCol(strName,strValue,strDisplayValue,oTable){if(strDisplayValue==undefined||strDisplayValue==""){strDisplayValue=strValue;}oTable[strName]=strValue;oTable._colcount++;oTable._numcols[oTable._numcols.length++]=strName;if(typeof(strValue)!="number"&&oTable._numericCols[strName.toLowerCase()]){strValue--;strValue++;oTable[strName]=strValue;}return{"_table":oTable,"name":strName,"originalvalue":strValue,"value":strValue,"displayvalue":strDisplayValue,_set_value:function(strValue,strFormattedValue){this._table[this.name]=strValue;this.value=strValue;if(strFormattedValue=undefined){strFormattedValue=strValue;}this.displayvalue=strValue;this._table[this.name]=strValue;},_format:function(){return app.dd.tables[this._table._name].columns[this.name.toLowerCase()].FormatValue(this.value);}};}function _swdcolumn(strName,strValue,strDisplayValue,oTable){return _swjsonCol(strName,strValue,strDisplayValue,oTable);};;;;var _img_picklists=new Array();_img_picklists["Generic Types"]=14;_img_picklists["Helpdesk Icons"]=74;var isIE=(window.ActiveXObject);var FC_IMGPICKLIST="Pick List (Image Mode)";var FC_DBPICKLIST="Distinct Pick List";var FC_PICKLIST="Pick List";var FC_NUMPICKLIST="Pick List (Numeric Mode)";var FC_XMLPICKLIST="Pick List (XML Source)";var FC_TABCONTROL="TabControl";var FC_CAPTIONBAR="CaptionBar";var FC_RECTANGLE="Rectange";var FC_LINE="Line";var FC_SINGLESETCHART="SingleSetChart";var FC_LINKLABEL="LinkLabel";var FC_SQLLIST="SqlTable";var FC_FILELIST="FileListTable";var FC_FLAGS="Form Flags";var FC_LABEL="Text";var FC_FIELDLABEL="FieldName";var FC_EMAIL="E-mail Address";var FC_TEXTEDIT="Text Edit";var FC_PASSWORD="Password";var FC_SEARCHFIELD="DualSearchField";var FC_BUTTON="EventButton";var FC_MENUBUTTON="MenuButton";var FC_IMAGE="Image";var FC_DATETIME="Date/Time Control";var FC_FORMULA="FormulaField";var FC_MINUTETIME="Minute Time Period";var FC_SECONDTIME="Second Time Period";var _swfc_unnamedcounter=1;function _swfc(oControlJson,oForm){this.name="";this.duplicatename="";this.binding="";this.dataRef="";this._form=oForm;this._value_initialised=false;this.element=null;this._mandatoryicon=null;this.htmldocument=oForm._targetdocument;this.frame=oForm._targetiframe.contentWindow;this._bHintText=false;this._tabcontrol=null;this._commandkeydown=false;this.appearance={};this.appearance.index=0;this.appearance.caption="";this.appearance.backgroundColor="";this.appearance.foregroundColor="";this.appearance.alignment="Left";this.appearance.borderstyle="Rectangle";this.appearance.fillStyle="Solid";this.font={};this.font.name="Trebuchet MS";this.font.size="8";this.font.bold=0;this.font.underline=0;this.font.strikeout=0;this.position={};this.position.top=0;this.position.left=0;this.position.bottom=0;this.position.right=0;this.position.origwidth=0;this.position.origleft=0;this.position.origtop=0;this.position.origheight=0;this.scaling={};this.scaling.top=0;this.scaling.left=0;this.scaling.bottom=0;this.scaling.right=0;this.controlinfo={};this.controlinfo.type="";this.controlinfo.mouseOverCursor="default";this.toolbarButtonStyle=false;this.tabInvisible=false;this.enable=true;this.invisible=false;this.visible=true;this.readOnly=false;this.mandatory=false;this.allowNullValue=false;this.allowResize=false;this.url=false;this.editUnlimitedText=false;this.colorDateIndicator=false;this.autoCompleteField=false;this.skipTabStop=false;this.disabled=false;this._protected=false;this.noMacroExpand=false;this.useDDPickList=false;this.readOnlyInit=false;this.showHeader=false;this.eventButtonIcon="";this.comboNewValues=false;this.picklistonly=false;this.comboQuickAdd=false;this.comboAutoUpdate=false;this.pickListOrderDesc=false;this.sortDescending=false;this.sortColumn=-1;this.hasCheckbox=false;this.dateFormat="";this.dateFormatMode=0;this.selectionMode=0;this.autoLoad=false;this.path="";this.storedQuery="";this.sqlSource="";this.table="";this.distinctTable="";this.distinctColumn="";this.displayColumn="";this.hintText="";this.editRecordForm="";this.addRecordForm="";this.newRecordForm="";this.listFilter="";this.unparsedFilter="";this.extraOptions="";this.listItems="";this.pickList="";this.defaultValue="";this.textInputFormat="Text";this.disabledBackgroundColor="#eeeeee";this.borderColor="#c0c0c0";this.controlGroup="";this.transparentColor="";this.transparent=false;this.flagItems="";this.commands="";this.highlightStyle="";this.value="";this.text="";this.display="";this._originaltextcolor="";this.imageHAlign=1;this.imageVAlign=1;this.noImageImage="";this.imageHSpace=0;this.slope=0;this.headerHeight=23;this.hasBorder=1;this.panelBorderColor="#d3c9b6";this.fillStyle=0;this.panelBackgroundColor="#f2eedd";this.panelBackgroundColor2="#000000";this.image="";this._etype="";this.binding="";this.group="";this.controlGroup="";this.xpStyle=false;this._initialise(oControlJson);}_swfc.prototype._element=function(){this.element=this.htmldocument.getElementById(this.name);return this.element;};_swfc.prototype._initialise=function(oControlJson){var jsontothis=_json_to_js;jsontothis(oControlJson,this);if(this.name.indexOf("")=="sla"){poo();}jsontothis(oControlJson.general,this);jsontothis(oControlJson.controlInfo.flags,this,_cBoolean);jsontothis(oControlJson.general.flags,this,_cBoolean);jsontothis(oControlJson.appearance,this.appearance);if(this.appearance.caption.indexOf("&&")>-1){this.appearance.caption=_regexreplace(this.appearance.caption,"&&","&");}jsontothis(oControlJson.data,this);var oFont=oControlJson.appearance.font;if(oFont!=undefined){if(oFont["#text"]!=undefined){this.font.name=oFont["#text"];}if(oFont["@size"]!=undefined){this.font.size=oFont["@size"];}if(oFont["@bold"]!=undefined){this.font.bold=oFont["@bold"];}if(oFont["@italic"]!=undefined){this.font.italic=oFont["@italic"];}if(oFont["@underline"]!=undefined){this.font.underline=oFont["@underline"];}if(oFont["@strikeout"]!=undefined){this.font.strikeout=oFont["@strikeout"];}}jsontothis(oControlJson.objectPlacement.position,this.position);if(this.position.top<0){this.position.top=0;}jsontothis(oControlJson.objectPlacement.scaling,this.scaling,_cNum);this._etype=this.type;this.type=_element_numeric_types[this.type];if(this._etype==FC_FILELIST||this._etype==FC_SQLLIST){this._jsoncols=oControlJson.columns;if(this._jsoncols==undefined){this._jsoncols=new Object();}if(this._jsoncols.controlInfo==undefined||this._jsoncols.controlInfo[0]==undefined){this._jsoncols.controlInfo=new Array(this._jsoncols.controlInfo);}jsontothis(oControlJson.controlInfo,this.controlinfo);}else{jsontothis(oControlJson.controlInfo,this.controlinfo);this.textInputFormat=oControlJson.controlInfo.textInputFormat;}jsontothis(oControlJson.controlInfo.properties,this);if(this._etype=="Field"){this._etype=this.controlinfo.type;}else{if(this._etype==FC_FIELDLABEL||this._etype==FC_LABEL){this.mandatory=false;}else{if(this._etype==FC_TABCONTROL){this._items=oControlJson.items.item;if(this._items[0]==undefined){this._items=new Array(this._items);}}}}this.duplicatename=this.name;if(this.name==""){this.name="swfc_"+_swfc_unnamedcounter++;this.duplicatename=this.name;}else{if(this._form[this.name]!=undefined){this.duplicatename=this.name;this.name=this.name+_swfc_unnamedcounter++;}}if(this.transparent&&this._etype!=FC_CAPTIONBAR){this.appearance.backgroundColor="";}this.binding=this.binding.toLowerCase();this.dataRef=this.binding;if(this.controlGroup!=""){if(this._form._controlgroups[this.controlGroup]==undefined){this._form._controlgroups[this.controlGroup]=new _swform_controlgroup(this.controlGroup);}this._form._controlgroups[this.controlGroup]._add_element(this);}if(this.group!=""){this.tabInvisible=true;}};_swfc.prototype._draw=function(bDrawnAlready){if(app.isSafari&&this.htmldocument.body==null){this.htmldocument=this.frame.document;}switch(this._type()){case FC_SINGLESETCHART:this._draw_singlesetchart(bDrawnAlready);break;case FC_LINKLABEL:this._draw_linklabel(bDrawnAlready);break;case FC_IMGPICKLIST:case FC_DBPICKLIST:case FC_PICKLIST:case FC_NUMPICKLIST:case FC_XMLPICKLIST:this._draw_picklist(bDrawnAlready);break;case FC_SQLLIST:this._draw_sqltable(bDrawnAlready);break;case FC_FILELIST:this._draw_filetable(bDrawnAlready);break;case FC_LINE:case FC_RECTANGLE:this._draw_rectangle(bDrawnAlready);break;case FC_TEXTEDIT:case FC_SEARCHFIELD:this._draw_textedit(bDrawnAlready);break;case FC_PASSWORD:this._draw_password(bDrawnAlready);break;case FC_EMAIL:this._draw_emailbox(bDrawnAlready);break;case FC_FLAGS:this._draw_formflags(bDrawnAlready);break;case FC_LABEL:case FC_FIELDLABEL:this._draw_label(bDrawnAlready);break;case FC_BUTTON:this._draw_button(bDrawnAlready);break;case FC_MENUBUTTON:this._draw_mnubutton(bDrawnAlready);break;case FC_CAPTIONBAR:this._draw_captionarea(bDrawnAlready);break;case FC_IMAGE:this._draw_image(bDrawnAlready);break;case FC_TABCONTROL:this._draw_tabcontrol(bDrawnAlready);break;case FC_SECONDTIME:this._draw_secondtime(bDrawnAlready);break;case FC_MINUTETIME:this._draw_minutetime(bDrawnAlready);break;case FC_DATETIME:this._draw_datecontrol(bDrawnAlready);break;case FC_FORMULA:this._draw_formula(bDrawnAlready);break;}this._bgcolor(this.appearance.backgroundColor);this._visible(!this.invisible);this.enable=(this.disabled)?false:true;if(_formtype==_CDF&&!this._form._isaltforn&&this.dataRef!=""){var arrRef=this.dataRef.split(".");if(arrRef[0]!=document._mastertable._name){var boolDisable=(document._exttable&&arrRef[0]==document._exttable._name)?false:true;if(boolDisable&&this._is_an_input_field()){this._enable(false);}}else{this._enable(this.enable);}}else{this._enable(this.enable);}if(_formtype!=_CDF&&_formtype!=_LCF&&this.dataRef!=""){if(this._etype!=FC_LABEL&&this._etype!=FC_FIELDLABEL){var arrRef=this.dataRef.split(".");if(this._form._swdoc._mastertable!=null&&this._form._swdoc._mastertable._name==arrRef[0]&&this._form._swdoc._mastertable._keycolumn==arrRef[1]){this._mandatory(true);if(_formmode=="edit"){this._enable(false);}}}}return;};_swfc.prototype._store_position=function(){var lnopx=app.noPx;var oe=this.element;var tp=this.position;tp.origwidth=oe.offsetWidth;tp.origleft=lnopx(oe.style.left);tp.origtop=lnopx(oe.style.top);tp.origheight=oe.offsetHeight;};_swfc.prototype._draw_rectangle=function(bDrawnAlready){if(!bDrawnAlready){var intWidth=this.position.right-this.position.left;var intHeight=this.position.bottom-this.position.top;var iZindex=0;if(this.name.indexOf("_iframe_")==0){var strStyleAtts=this._get_border_style()+";font-size:0px;overflow:auto;position:absolute;z-Index:"+iZindex+";width:"+intWidth+"px;height:"+intHeight+"px;top:"+this.position.top+"px;left:"+this.position.left+"px;";var strHTML="<iframe id='"+this.name+"' style='"+strStyleAtts+"' onload='app._swc_check_document_hrefs(this);' onreadstatechange='app._swc_check_document_hrefs(this);'></iframe>";}else{if(this._etype==FC_LINE){if(this.appearance.backgroundColor==""){this.appearance.backgroundColor="#8f8f8f";}if(intHeight>intWidth){var iAddTop=0;var iAddLeft=Math.round(intWidth/2);intWidth=1;}else{var iAddTop=Math.round(intHeight/2);var iAddLeft=0;intHeight=1;}var strStyleAtts=this._get_font_style()+this._get_border_style()+";font-size:0px;overflow:auto;position:absolute;background-color:"+this.appearance.backgroundColor+";z-Index:"+iZindex+";width:"+intWidth+"px;height:"+intHeight+"px;top:"+(this.position.top-1+iAddTop)+"px;left:"+(this.position.left-0+iAddLeft)+"px;";}else{var strStyleAtts=this._get_font_style()+this._get_border_style()+this._background_css()+";font-size:0px;overflow:auto;position:absolute;z-Index:"+iZindex+";width:"+intWidth+"px;height:"+intHeight+"px;top:"+this.position.top+"px;left:"+this.position.left+"px;";}var strHTML="<div id='"+this.name+"' onclick='this.swfc._onleftclick(this);' style='"+strStyleAtts+"'></div>";}insertBeforeEnd(this.htmldocument.body,strHTML);}this._element();this.element.swfc=this;};_swfc.prototype._draw_label=function(bDrawnAlready){var tString=this.appearance.caption;var iStart=tString.indexOf("&[");if(iStart>-1){tString=_parse_context_vars(tString,false,true);}else{if(this.binding!=""){tString=app._application_labels[this.dataRef];}}if(!bDrawnAlready){var intWidth=this.position.right-this.position.left;var intHeight=this.position.bottom-this.position.top;var iZindex=300+(this.appearance.index-1+1);var strStyleAtts=this._get_font_style()+this._get_border_style()+";overflow:hidden;position:absolute;padding-left:0px;background-color:"+this.appearance.backgroundColor+";z-Index:"+iZindex+";width:"+intWidth+"px;height:"+intHeight+"px;top:"+this.position.top+"px;left:"+this.position.left+"px;";var strDisabled=(this.disabled)?"DISABLED":"";var iSpanTop=(intHeight/2)-((this.font.size*1.338)/2)-1;var strHTML="<div id='"+this.name+"' "+strDisabled+" style='"+strStyleAtts+";' onmousedown='this.swfc._onmousedown(event);'>";if(this.appearance.alignment.toLowerCase()=="right"){var strLabel="<label id='"+this.name+"_labeltext' style='position:absolute;top:"+iSpanTop+"px;right:0;white-space:nowrap;'>"+tString+"</label>";strHTML+="<div style='height:100%;width:100%;float:left;text-align:right;display:block;overflow:hidden;position:relative;'>"+strLabel+"</div>";}else{var strMultiLine=(this.multiLine)?"":"white-space:nowrap;";if(this.multiLine){var strLabel="<label id='"+this.name+"_labeltext'>"+tString+"</label>";strHTML+="<div style='"+this._get_font_style()+";display:block;'>"+strLabel+"</div>";}else{var strLabel="<label id='"+this.name+"_labeltext' style='"+strMultiLine+"'>"+tString+"</label>";strHTML+="<div style='"+this._get_font_style()+";display:block;overflow:hidden;position:relative;top:"+iSpanTop+";'>"+strLabel+"</div>";}}strHTML+="</div>";insertBeforeEnd(this.htmldocument.body,strHTML);}this._element();this.element.swfc=this;if(bDrawnAlready&&this.appearance.caption.indexOf("&[")>-1){this._text(_parse_context_vars(this.appearance.caption,false,true));}else{this.text=tString;}};_swfc.prototype._draw_formula=function(bDrawnAlready){this._draw_textedit(bDrawnAlready);if(bDrawnAlready){this.element.style.backgroundColor="";var strColor=this.appearance.foregroundColor;if(strColor==""){strColor="#000000";}this.element.style.color=strColor;}this._readOnly(true);};_swfc.prototype._draw_minutetime=function(bDrawnAlready){this._draw_textedit(bDrawnAlready);};_swfc.prototype._draw_secondtime=function(bDrawnAlready){this._draw_textedit(bDrawnAlready);};_swfc.prototype._is_an_input_field=function(){switch(this._etype){case FC_TEXTEDIT:case FC_EMAIL:case FC_PASSWORD:case FC_SEARCHFIELD:case FC_IMGPICKLIST:case FC_DBPICKLIST:case FC_PICKLIST:case FC_NUMPICKLIST:case FC_XMLPICKLIST:case FC_DATETIME:case FC_MINUTETIME:case FC_SECONDTIME:return true;}return false;};_swfc.prototype._background_css=function(){var bgColorOne=this.appearance.backgroundColor;var bgColorTwo="";var bFillTop=true;if(this.appearance.fillStyle=="Vertical Gradient"){bgColorTwo=this.backgroundColor2;}else{if(this.appearance.fillStyle=="Horizontal Gradient"){bFillTop=false;bgColorTwo=this.backgroundColor2;}}if(bgColorTwo!=""){if(app.isIE10Above){if(bFillTop){var strStyle="background: -ms-linear-gradient(top, "+bgColorOne+", "+bgColorTwo+")";}else{var strStyle="background: -ms-linear-gradient(left, "+bgColorOne+", "+bgColorTwo+")";}}else{if(app.isIE){if(bFillTop){var strStyle="filter:progid:DXImageTransform.Microsoft.Gradient(Enabled=true,GradientType=0,StartColorStr="+bgColorOne+",EndColorStr="+bgColorTwo+")";}else{var strStyle="filter:progid:DXImageTransform.Microsoft.Gradient(Enabled=true,GradientType=1,StartColorStr="+bgColorOne+",EndColorStr="+bgColorTwo+")";}}else{if(app.isFirefox){if(bFillTop){var strStyle="background: -moz-linear-gradient(top, "+bgColorOne+", "+bgColorTwo+")";}else{var strStyle="background: -moz-linear-gradient(left, "+bgColorOne+", "+bgColorTwo+")";}}else{var strStyle="background-color:"+bgColorOne;}}}}else{var strStyle="background-color:"+bgColorOne;}return strStyle;};_swfc.prototype._draw_captionarea=function(bDrawnAlready){if(!bDrawnAlready){var intWidth=this.position.right-this.position.left;var intHeight=this.position.bottom-this.position.top;var iZindex=1;var strIMG="<div style='height:"+(this.headerHeight)+";'></div>";if(this.image!=""){strIMG="<img src='"+_parse_context_vars(this.image)+"'>";}if(intHeight==this.headerHeight){var strStyleAtts="position:absolute;z-Index:"+iZindex+";width:"+intWidth+"px;top:"+(this.position.top-1)+"px;left:"+this.position.left+"px;";strHTML="<div id='"+this.name+"' style='"+strStyleAtts+"'>";}else{var strStyleAtts=this._get_border_style()+";position:absolute;background-color:"+this.panelBackgroundColor+";z-Index:"+iZindex+";width:"+intWidth+"px;height:"+(intHeight-1+2)+"px;top:"+(this.position.top-1)+"px;left:"+this.position.left+"px;";var strHTML="<div id='"+this.name+"' style='"+strStyleAtts+"'>";}var strCaptionTitleBackground=this._background_css();if(intHeight==this.headerHeight){var strTitleStyleAtts="padding:0px 0px 0px 2px;"+strCaptionTitleBackground+";height:"+(this.headerHeight)+"px;border:"+this.hasBorder+"px solid "+this.borderColor+";";}else{var strTitleStyleAtts="padding:0px 0px 0px 2px;"+strCaptionTitleBackground+";height:"+(this.headerHeight)+"px;border-bottom:"+this.hasBorder+"px solid "+this.borderColor+";";}strHTML+="<div style='"+strTitleStyleAtts+"'><table cellspacing=0 cellpadding=0 border=0><tr><td>"+strIMG+"</td><td style='"+this._get_font_style()+";color:"+this.appearance.foregroundColor+";'><div id='"+this.name+"_captiontext' style='position:relative;top:0px;padding-left:5px;'>"+_parse_context_vars(this.appearance.caption,false,true)+"</div></td></tr></table></div>";strHTML+="</div>";insertBeforeEnd(this.htmldocument.body,strHTML);}this._element();this.element.swfc=this;if(bDrawnAlready&&this.appearance.caption.indexOf("&[")>-1){var oHeader=this.htmldocument.getElementById(this.name+"_captiontext");if(oHeader){app.setElementText(oHeader,_parse_context_vars(this.appearance.caption,false,true));}}};_swfc.prototype._draw_image=function(bDrawnAlready){this._imageerror=false;if(!bDrawnAlready){var intWidth=this.position.right-this.position.left;var intHeight=this.position.bottom-this.position.top;var iZindex=9999+(this.appearance.index-1+1);if(this.backMode=="1"){this.appearance.backgroundColor="";}var strStyleAtts=this._get_border_style()+";background:"+this.appearance.backgroundColor+";position:absolute;z-Index:"+iZindex+";width:"+intWidth+"px;height:"+intHeight+"px;top:"+(this.position.top-1)+"px;left:"+this.position.left+"px;";var strHTML="<div id='"+this.name+"' style='"+strStyleAtts+"'>";strHTML+="<img style='width:100%;height:100%;background:"+this.appearance.backgroundColor+";' onclick='this.parentNode.swfc._onleftclick(this);' imageborder='0'>";strHTML+="</div>";insertBeforeEnd(this.htmldocument.body,strHTML);}this._element();this.element.swfc=this;this.element.childNodes[0].onerror=this._imgerror;this.element.childNodes[0].onload=this._imgloaded;var strSrc=_parse_context_vars(this.appearance.caption);if(strSrc.indexOf("/.")!=-1){this._imageError=true;this.element.childNodes[0].src=_parse_context_vars(this.noImageImage);}else{this.element.childNodes[0].src=_parse_context_vars(this.appearance.caption);}};_swfc.prototype._imgloaded=function(){var swfc=this.parentNode.swfc;swfc._imageError=false;};_swfc.prototype._imgerror=function(){var swfc=this.parentNode.swfc;if(!swfc._imageError&&swfc.noImageImage!=""){swfc._imageError=true;swfc.element.childNodes[0].src=_parse_context_vars(swfc.noImageImage);}};_swfc.prototype._draw_button=function(bDrawnAlready){if(this.toolbarButtonStyle){return this._draw_mnubutton(bDrawnAlready);}if(!bDrawnAlready){var intWidth=this.position.right-this.position.left;var intHeight=this.position.bottom-this.position.top;var iZindex=750+(this.appearance.index-1+1);var strStyleAtts=this._get_font_style()+";position:absolute;z-Index:"+iZindex+";width:"+intWidth+"px;height:"+intHeight+"px;top:"+this.position.top+"px;left:"+this.position.left+"px;";var strDisabled=(this.disabled)?"DISABLED":"";var strTableStyle="";if(intHeight<20){strTableStyle="style='position:relative;top:-1;'";}var strHTML="<button id='"+this.name+"' "+strDisabled+"  style='"+strStyleAtts+"'  onclick='this.swfc._onpressed();'><table cellspacing='0' cellpadding='0' border='0' align='center' "+strTableStyle+"><tr><td id='"+this.name+"_menutext' style='"+this._get_font_style()+";text-align:center;overflow:hidden;text-overflow:ellipsis;white-space:noWrap;'>"+this.appearance.caption+"</td></tr></table></button>";insertBeforeEnd(this.htmldocument.body,strHTML);}this._element();this.text=this.appearance.caption;this.element.swfc=this;this.element.style.textAlign="center";};_swfc.prototype._draw_mnubutton=function(bDrawnAlready){if(!bDrawnAlready){var iZindex=1000+(this.appearance.index-1+1);var strDisabled=(this.disabled)?"DISABLED":"";if(this.toolbarButtonStyle){var intWidth=this.position.right-this.position.left;var intHeight=this.position.bottom-this.position.top-1;if(!isIE){intHeight=intHeight-3;this.position.top=this.position.top-1+2;}else{this.position.top=this.position.top-1+2;}var strImagePath=_get_sw_application_image(this);var strImageHTML=(strImagePath=="")?"":"<td width='16px;'><img src='"+strImagePath+"'></img></td>";var strStyleAtts=this._get_border_style()+";position:absolute;z-Index:"+iZindex+";width:"+intWidth+"px;height:"+intHeight+"px;top:"+(this.position.top)+"px;left:"+this.position.left+"px;";var strHTML="<div id='"+this.name+"' "+strDisabled+" style='"+strStyleAtts+"' onclick='this.swfc.click();' onmouseover='this.swfc.hilite();' onmouseout='this.swfc.lolite();'><table height='"+(intHeight-2)+"' width='100%' border='0' cellspacing='0' cellpadding='0'><tr>"+strImageHTML+"<td id='"+this.name+"_menutext' ' style='"+this._get_font_style()+";text-align:center;overflow:hidden;text-overflow:ellipsis;white-space:noWrap;' align='middle' valign='middle' noWrap>"+this.appearance.caption+"</td></tr></table></div>";}else{var intWidth=this.position.right-this.position.left;var intHeight=this.position.bottom-this.position.top;var iZindex=400+(this.appearance.index-1+1);var strStyleAtts=this._get_font_style()+";position:absolute;z-Index:"+iZindex+";width:"+intWidth+"px;height:"+intHeight+"px;top:"+this.position.top+"px;left:"+this.position.left+"px;text-align:center;padding:0;";var strTableStyle="";if(intHeight<20){strTableStyle="style='position:relative;top:-1;'";}var strHTML="<button id='"+this.name+"' "+strDisabled+"  style='"+strStyleAtts+"'  onclick='this.swfc.click(event);'><table cellspacing='0' cellpadding='0' border='0' align='center' "+strTableStyle+"><tr><td id='"+this.name+"_menutext' style='"+this._get_font_style()+";text-align:center;padding-left:2px;overflow:hidden;text-overflow:ellipsis;white-space:noWrap;'>"+this.appearance.caption+"</td><td class='mnu-button-btn'></td></tr></table></button>";}insertBeforeEnd(this.htmldocument.body,strHTML);}this._element();this.text=this.appearance.caption;this.element.swfc=this;_swfc_menubutton(this);};_swfc.prototype._draw_password=function(bDrawnAlready){if(!bDrawnAlready){var intWidth=this.position.right-this.position.left;var intHeight=this.position.bottom-this.position.top;var iZindex=500+(this.appearance.index-1+1);var strStyleAtts=this._get_font_style()+this._get_border_style()+";position:absolute;background-color:"+this.appearance.backgroundColor+";z-Index:"+iZindex+";width:"+intWidth+"px;height:"+intHeight+"px;top:"+this.position.top+"px;left:"+this.position.left+"px;";var strDisabled=(this.disabled)?"DISABLED":"";var strReadonly=(this.readOnly)?"readOnly":"";var strHTML="<input type='password' "+strDisabled+" "+strReadonly+" id='"+this.name+"' onblur='this.swfc._onblur(event);' onchange='this.swfc._onchange(event);' onmousedown='this.swfc._onmousedown(event);' style='"+strStyleAtts+"'>";insertBeforeEnd(this.htmldocument.body,strHTML);}this._element();this.element.swfc=this;_swfc_textedit(this);};_swfc.prototype._draw_textedit=function(bDrawnAlready,boolLB){if(boolLB==undefined){boolLB=false;}this._ddf_settings();if(!bDrawnAlready){var intWidth=this.position.right-this.position.left;var intHeight=this.position.bottom-this.position.top;var iZindex=500+(this.appearance.index-1+1);var strStyleAtts=this._get_font_style()+";"+this._get_border_style()+";position:absolute;resize:none;background-color:"+this.appearance.backgroundColor+";z-Index:"+iZindex+";width:"+intWidth+"px;height:"+intHeight+"px;top:"+this.position.top+"px;left:"+this.position.left+"px;color:"+this.appearance.foregroundColor;var strDisabled=(this.disabled)?"DISABLED":"";var strReadonly=(this.readOnly)?"readOnly":"";if(this.editUnlimitedText&&!boolLB){var strHTML="<textarea id='"+this.name+"' "+strDisabled+" "+strReadonly+" onkeydown='return this.swfc._onkeydown(event);' onkeyup='return this.swfc._onkeyup(event);' onblur='this.swfc._onblur(event);' onchange='this.swfc._onchange(event);' onmousedown='return this.swfc._onmousedown(event);' style='"+strStyleAtts+"'></textarea>";}else{var strHTML="<input type='text' id='"+this.name+"'  "+strReadonly+" "+strDisabled+" onfocus='return this.swfc._onfocus(event);' onkeydown='return this.swfc._onkeydown(event);' onkeyup='return this.swfc._onkeyup(event);' onblur='this.swfc._onblur(event);' onchange='this.swfc._onchange(event);' onmousedown='return this.swfc._onmousedown(event);' style='"+strStyleAtts+"'>";}insertBeforeEnd(this.htmldocument.body,strHTML);}this._element();this.element.swfc=this;if(this.textInputFormat=="Currency"&&this.binding==""){var val="0";if(this.defaultValue!=""){val=this.defaultValue;}this._value(val,val,false);}else{if(this.defaultValue!=""&&!boolLB&&_formmode=="add"){var boolSetDefault=true;if(this.binding!=""){var arrBind=this.binding.split(".");if(document[arrBind[0]]==undefined){boolSetDefault=false;}}if(boolSetDefault){this._value(this.defaultValue,this.defaultValue,false);}}}if(this.readOnly){this._readOnly(true);}_swfc_textedit(this);};_swfc.prototype._draw_emailbox=function(bDrawnAlready){this._draw_textedit(bDrawnAlready);if(!bDrawnAlready){}};_swfc.prototype._ddf_settings=function(){var arrBind=this.binding.split(".");var ddfSettings=null;if(pDDTABLES[arrBind[0]]!=undefined&&pDDTABLES[arrBind[0]].columns[arrBind[1]]!=undefined){ddfSettings=pDDTABLES[arrBind[0]].columns[arrBind[1]];}else{return;}if(this.useDDPickList){this.pickList=ddfSettings.pickOptions;}if(_formtype==_LCF&&this.defaultValue==""&&ddfSettings.defaultValue!=""&&document._mastertable&&arrBind[0]==document._mastertable._name){this.defaultValue=ddfSettings.defaultValue;}};_swfc.prototype._draw_singlesetchart=function(bDrawnAlready){if(!bDrawnAlready){var intWidth=this.position.right-this.position.left;var intHeight=this.position.bottom-this.position.top;var iZindex=600+(this.appearance.index-1+1);var strStyleAtts=this._get_font_style()+this._get_border_style()+";position:absolute;background-color:"+this.appearance.backgroundColor+";z-Index:"+iZindex+";width:"+intWidth+"px;height:"+intHeight+"px;top:"+this.position.top+"px;left:"+this.position.left+"px;";var strHTML="<div id='"+this.name+"' style='"+strStyleAtts+"'>charts are not supported</div>";insertBeforeEnd(this.htmldocument.body,strHTML);}this._element();this.element.swfc=this;_swfc_chart(this);};function _swfc_chart(oSWFC){oSWFC.AddItem=_swfc_chart_AddItem;oSWFC.PlotChart=_swfc_chart_PlotChart;oSWFC.Reset=_swfc_chart_Reset;oSWFC.DeleteItem=_swfc_chart_DeleteItem;}function _swfc_chart_Reset(){}function _swfc_chart_DeleteItem(){}function _swfc_chart_PlotChart(){}function _swfc_chart_AddItem(){}_swfc.prototype._draw_linklabel=function(bDrawnAlready){if(!bDrawnAlready){var intWidth=this.position.right-this.position.left;var intHeight=this.position.bottom-this.position.top;var iZindex=300+(this.appearance.index-1+1);var strStyleAtts=this._get_font_style()+this._get_border_style()+";position:absolute;background-color:"+this.appearance.backgroundColor+";z-Index:"+iZindex+";width:"+intWidth+"px;height:"+intHeight+"px;top:"+this.position.top+"px;left:"+this.position.left+"px;";var strURL=_parse_context_vars(this.url);var strHTML="<a id='"+this.name+"' href='"+strURL+"' style='"+strStyleAtts+"' target='new'>"+_parse_context_vars(this.appearance.caption)+"</a>";insertBeforeEnd(this.htmldocument.body,strHTML);}this._element();this.element.swfc=this;};_swfc.prototype._draw_picklist=function(bDrawnAlready){this.picklistonly=this.comboNewValues;this.pickList=this.listItems;this._ddf_settings();if(!bDrawnAlready){var intWidth=this.position.right-this.position.left;var intHeight=this.position.bottom-this.position.top;var iZindex=500+(this.appearance.index-1+1);var strStyleAtts=this._get_font_style()+this._get_border_style()+";position:absolute;background-color:"+this.appearance.backgroundColor+";z-Index:"+iZindex+";width:"+intWidth+"px;height:"+intHeight+"px;top:"+this.position.top+"px;left:"+this.position.left+"px;";var bLoaded=false;var strOptions="";if(!this.mandatory){strOptions="<tr><td  noWrap width='100%'>&nbsp;</td><td style='display:none;'></td></tr>";}if(this._etype!=FC_DBPICKLIST&&this._etype!=FC_XMLPICKLIST){if(this._etype==FC_IMGPICKLIST){if(_img_picklists[this.imageList]!=undefined){var strClass=_regexreplace(this.imageList," ","_");for(var x=0;x<_img_picklists[this.imageList];x++){var ileft=x*18;var strStylePos="style='background-position: -"+ileft+"px 0;'";strOptions+="<tr ><td noWrap width='100%'><div class='"+strClass+"' "+strStylePos+"></div></td><td style='display:none;'>"+x+"</td></tr>";}}else{alert("An image listbox is using an image list ["+this.imageList+"] which is not supported by the Webclient. Please contact your Administrator.");}}else{var iInfo=new Array();var arrTextItems=new Array();var arrItems=this.pickList.split("|");this._modifiedPickList="";var aPLlen=arrItems.length;for(var x=0;x<aPLlen;x++){if(arrItems[x]==""){continue;}bLoaded=true;if(this._etype==FC_NUMPICKLIST){iInfo=arrItems[x].split("^");if(this.binding=="calltasks.priority"||this.binding=="calltasks.type"){strOptions+="<tr><td  noWrap width='100%'>"+iInfo[0]+"</td><td style='display:none;'>"+iInfo[0]+"</td></tr>";if(this.mandatory&&this.defaultValue==""){this.defaultValue=iInfo[1];}}else{strOptions+="<tr><td  noWrap width='100%'>"+iInfo[0]+"</td><td style='display:none;'>"+iInfo[1]+"</td></tr>";if(this.mandatory&&this.defaultValue==""){this.defaultValue=iInfo[1];}}}else{var strVal=arrItems[x];if(arrItems[x].indexOf("^")>-1){strVal=arrItems[x].split("^")[0];if(this._modifiedPickList!=""){this._modifiedPickList+="|";}this._modifiedPickList=strVal;}if(arrTextItems[strVal]==undefined){if(this.mandatory&&this.defaultValue==""){this.defaultValue=strVal;}strOptions+="<tr><td noWrap width='100%'>"+strVal+"</td><td style='display:none;'>"+strVal+"</td></tr>";arrTextItems[strVal]=true;}}if(this._modifiedPickList!=""){this.pickList=this._modifiedPickList;}this._originalPicklist=this.pickList;}}}var strDisabled=(this.disabled)?"DISABLED":"";var strHTML="<div id='_listboxdiv_"+this.name+"' class='picklist_div'  onmouseover='this.swfc._hilite(event);' onmouseout='this.swfc._lolite(event);' onmousedown='this.swfc._cancelevent(event);' onclick='this.swfc._selectitem(event);'><table border='0' cellpadding='0' cellspacing='0' style='table-layout:fixed;' width='100%'>"+strOptions+"</table></div>";insertBeforeEnd(this.htmldocument.body,strHTML);}else{if(this._etype!=FC_DBPICKLIST&&this._etype!=FC_XMLPICKLIST){bLoaded=true;}}this._dropdiv=this.htmldocument.getElementById("_listboxdiv_"+this.name);this._htmltable=this._dropdiv.childNodes[0];this._draw_textedit(bDrawnAlready,true);if(!bDrawnAlready){this.element.className="picklist_control";if(this.dropdownButtonType=="1"){this.element.style.backgroundImage="url(images/controls/elip.png)";}}if(this.readOnly){this._readOnly(true);}if(this.picklistonly){this.element.setAttribute("readOnly",true);}_swfc_listbox(this);this._htmltable.swfc=this;this._dropdiv.swfc=this;this._dataloaded=bLoaded;this.element.swfc=this;if(this.binding==""){if(this._etype==FC_NUMPICKLIST){if(this.defaultValue!=""){this._value(this.defaultValue);}else{this._value(0);}}else{if(this.defaultValue!=""){this._value(this.defaultValue);}}}};_swfc.prototype._draw_datecontrol=function(bDrawnAlready){if(!bDrawnAlready){var intWidth=this.position.right-this.position.left;var intHeight=this.position.bottom-this.position.top;var iZindex=500+(this.appearance.index-1+1);var strStyleAtts=this._get_font_style()+this._get_border_style()+";position:absolute;background-color:"+this.appearance.backgroundColor+";z-Index:"+iZindex+";width:"+intWidth+"px;height:"+intHeight+"px;top:"+this.position.top+"px;left:"+this.position.left+"px;";var strDisabled=(this.disabled)?"DISABLED":"";var strReadonly=(this.readOnly)?"readOnly":"";var strHTML="<input type='text' id='"+this.name+"'  "+strReadonly+" "+strDisabled+" onclick='this.swfc._trigger_dropdown(event, document);'	onblur='this.swfc._onblur(event);' onchange='this.swfc._onchange(event);' onmousedown='this.swfc._onmousedown(event);' style='"+strStyleAtts+"'>";insertBeforeEnd(this.htmldocument.body,strHTML);}this._element();this.element.swfc=this;if(!bDrawnAlready){this.element.className="datetime_control";}_swfc_datebox(this);if(_formtype==_LCF){if(this.dataRef.indexOf("opencall.")==-1){this._enable(false);}}};_swfc.prototype._draw_formflags=function(bDrawnAlready){if(!bDrawnAlready){var intWidth=this.position.right-this.position.left;var intHeight=this.position.bottom-this.position.top;var iZindex=500+(this.appearance.index-1+1);if(app.isIE){this.position.top=this.position.top-1+3;}else{this.position.top=this.position.top-2;this.position.left=this.position.left-1+5;}var strStyleAtts=this._get_font_style()+this._get_border_style()+"position:absolute;z-Index:"+iZindex+";width:"+intWidth+"px;height:"+intHeight+"px;top:"+this.position.top+"px;left:"+this.position.left+"px;";var strDisabled=(this.disabled)?"DISABLED":"";var strReadonly=(this.readOnly)?"DISABLED":"";var arrHTML=new Array();arrHTML.push("<div id='"+this.name+"' "+strDisabled+" "+strReadonly+" onclick='this.swfc._setflagvalue(event,document)' style='"+strStyleAtts+";overflow:hidden;'><table border='0' cellspacing='0' cellpadding='1'>");var arrItems=this.flagItems.split("|");var aIlen=arrItems.length-1;for(var x=0;x<aIlen;x++){var arrItemInfo=arrItems[x].split("^");arrHTML.push("<tr><td style='padding-left:5px'><image src='images/controls/cb.png' "+strReadonly+"  id='"+this.name+"_"+x+"' name='"+this.name+"_"+x+"' bitvalue='"+arrItemInfo[1]+"' checked='false'></td><td noWrap valign='middle'><label id='lbl_"+this.name+"_"+x+"' "+strDisabled+"  style='font-family:Trebuchet MS;font-size:8pt;padding-left:4px;'>"+arrItemInfo[0]+"</label></td></tr>");}arrHTML.push("</table></div>");insertBeforeEnd(this.htmldocument.body,arrHTML.join(""));}this._element();this.element.swfc=this;if(this.readOnly){this._readOnly(this.readOnly);}if(this.disabled){this.enable=false;}_swfc_formflag(this);};_swfc.prototype._draw_sqltable=function(bDrawnAlready){app.debugstart(this.name+"._draw_sqltable:","FORM CONTROLS");var xntbt=app.xmlNodeTextByTag;if(!bDrawnAlready){app.debugstart(this.name+"._draw_sqltable:processcolumns","FORM CONTROLS");var intWidth=this.position.right-this.position.left;var intHeight=this.position.bottom-this.position.top;var iZindex=1000+(this.appearance.index-1+1);var strStyleAtts=this._get_font_style()+this._get_border_style()+";position:absolute;background-color:"+this.appearance.backgroundColor+";z-Index:"+iZindex+";width:"+intWidth+"px;height:"+intHeight+"px;top:"+this.position.top+"px;left:"+this.position.left+"px;";var strHeaderDisplay=(this.showHeader)?"":"style='height:0px;visibility:hidden;'";var strColumnHeadings="<table cellspacing='0' cellpadding='0' border='0' "+strHeaderDisplay+"><tr>";var arrColHeadings=new Array();arrColHeadings.push("<table cellspacing='0' cellpadding='0' border='0' "+strHeaderDisplay+"><tr>");if(this._jsoncols){var strText="";var strcol;var intWidth=0;var xmlDBCol=null;var strStyle="";var bAllowResize="";var bAllowSort="";var arrCol=this._jsoncols.controlInfo;var aClen=arrCol.length;for(var x=0;x<aClen;x++){if(arrCol[x]==undefined||arrCol[x].width==undefined){continue;}strText=(arrCol[x].name)?arrCol[x].name:"";intWidth=arrCol[x].width;strCol=(arrCol[x].properties)?arrCol[x].properties.column:"";if(strText==""&&strCol!=""){var strColText=app._application_labels[this.table+"."+strCol];if(this.table=="updatedb"&&strColText.toLowerCase()==strCol){switch(strCol){case"aaid":strColText="Analyst ID";break;case"udindex":strColText="#";break;case"updatetimex":strColText="Date / Time";break;}}strText=strColText;}var jsonFlags=arrCol[x].flags;if(jsonFlags==undefined){strStyle="";bAllowResize="true";bAllowSort="true";}else{strStyle=jsonFlags.hidden=="true"?"style='display:none;'":"";bAllowSort=jsonFlags.allowSort!="true"?false:true;bAllowResize=jsonFlags.allowResize!="true"?false:true;}arrColHeadings.push("<td class='headertd' "+strStyle+" allowsort='"+bAllowSort+"'  allowresize='"+bAllowResize+"' width='"+intWidth+"px' style='width:"+intWidth+"px;white-space:noWrap;' dbname='"+strCol+"' noWrap "+strHeaderDisplay+"><div class='tdvalue' headerpos='"+x+"'  style='width:"+intWidth+"px;white-space:noWrap;' "+strHeaderDisplay+">"+strText+"</div></td>");}arrColHeadings.push("<td style='display:none;'><div></div></td></tr>");}arrColHeadings.push("</table>");app.debugend(this.name+"._draw_sqltable:processcolumns","FORM CONTROLS");app.debugstart(this.name+"._draw_sqltable:drawcontents","FORM CONTROLS");var arrHTML=new Array();arrHTML.push("<div id='"+this.name+"' style='"+strStyleAtts+";overflow:hidden;display:none;'>");arrHTML.push("<div id='"+this.name+"_pager' class='sqltable-pager'><div class='sqltable-pager-ll' onclick='this.parentNode.parentNode.swfc._pagestart(this,event);'>&nbsp;</div><div class='sqltable-pager-l' onclick='this.parentNode.parentNode.swfc._pageleft(this,event);'>&nbsp;</div><div class='sqltable-pager-input'>Page <input id='"+this.name+"_pageinput' onchange='this.parentNode.parentNode.parentNode.swfc._setpageposition(this);' type='text' value='1'/> of <span id='"+this.name+"_pagespan' >#</span></div><div id='"+this.name+"_pagerR' onclick='this.parentNode.parentNode.swfc._pageright(this,event);' class='sqltable-pager-r'>&nbsp;</div><div onclick='this.parentNode.parentNode.swfc._pageend(this,event);' class='sqltable-pager-rr'>&nbsp;</div></div>");arrHTML.push("<div id='"+this.name+"_header' onmousedown='this.parentNode.swfc._start_headerresize(event,document);' onmouseup='this.parentNode.swfc._stop_headerresize(event,document);' onclick='this.parentNode.swfc._sortcolumn(event,document);' onmousemove='this.parentNode.swfc._track_headercursor(event,document);' class='sqltable-header' "+strHeaderDisplay+">"+arrColHeadings.join("")+"</div>");arrHTML.push("<div id='"+this.name+"_data'  class='sqltable-data' onselectstart='return false;' onscroll='this.parentNode.swfc._scroll();'></div></div>");insertBeforeEnd(this.htmldocument.body,arrHTML.join(""));app.debugend(this.name+"._draw_sqltable:drawcontents","FORM CONTROLS");}this._element();this.element.swfc=this;app.disableSelection(this.element);_swfc_sqltable(this);if(!bDrawnAlready){this._resize_data_area();}app.debugend(this.name+"._draw_sqltable:","FORM CONTROLS");};_swfc.prototype._draw_filetable=function(bDrawnAlready){this._draw_sqltable(bDrawnAlready);_swfc_filetable(this);if(!bDrawnAlready){this._resize_data_area();}if(!bDrawnAlready){var strIframeHTML="<iframe id='"+this.name+"_iframe_fileuploader' name='"+this.name+"_iframe_fileuploader' style='display:none;'></iframe>";app.insertBeforeEnd(this.htmldocument.body,strIframeHTML);}};_swfc.prototype._draw_tabcontrol=function(bDrawnAlready){_swfc_tabcontrol(this);this._draw(bDrawnAlready);};_swfc.prototype._get_border_style=function(){if(this._etype==FC_CAPTIONBAR){strStyle="border:"+this.hasBorder+"px solid "+this.borderColor;}else{if(this._etype==FC_SEARCHFIELD){strStyle="border:1px solid "+this.borderColor;}else{switch(this.appearance.borderStyle){case"None":strStyle="border:0px solid #ffffff;";break;case"3-D Sunken":strStyle="";break;case"Rectangle":strStyle="border:1px solid "+this.borderColor+";";break;default:strStyle="border-width:0px;";}}}if(this.controlinfo.mouseOverCursor=="Hand"){strStyle=strStyle+";cursor:hand;";}return strStyle;};_swfc.prototype._get_font_style=function(){var strStyle=";text-align:"+this.appearance.alignment.toLowerCase();if(this._etype==FC_CAPTIONBAR||this._etype==FC_LABEL||this._etype==FC_FIELDLABEL){strStyle+=";font-family:"+this.font.name.replace("(","").replace(")","");}else{strStyle+=";font-family:sans-serif";}strStyle+=";font-size:"+this.font.size+"pt;";strStyle+=";font-underline:"+this.font.underline;strStyle+=";color:"+this.appearance.foregroundColor;if(_cBoolean(this.font.bold)){strStyle+=";font-weight:bold;";}strStyle+=";";return strStyle;};_swfc.prototype._cancelevent=function(oE){app.stopEvent(oE);return false;};_swfc.prototype._resize=function(){if(this.tabInvisible||!this.visible){return;}if(this._form._width==0){return;}var iWidthAdjust=this._form._width-this._form._origwidth;var iHeightAdjust=this._form._height-this._form._origheight;var intWidth=this.element.offsetWidth;var intLeft=this.element.offsetLeft;var intTop=this.element.offsetTop;var intHeight=this.element.offsetHeight;if(this.position.origwidth==0){this._store_position();}if(this.scaling.left>0){var intAddLeft=Math.round((iWidthAdjust/100)*this.scaling.left);if(intAddLeft<1){intLeft=this.position.origleft;}else{intLeft=this.position.origleft+(intAddLeft-1);}}if(this.scaling.right>0){var intAddWidth=Math.round((iWidthAdjust/100)*(this.scaling.right-this.scaling.left));if(intAddWidth<1){intWidth=this.position.origwidth;}else{intWidth=this.position.origwidth+(intAddWidth-2);}}if(this.scaling.top>0){var intAddtop=Math.round((iHeightAdjust/100)*this.scaling.top);if(intAddtop<1){intTop=this.position.origtop;}else{intTop=this.position.origtop+intAddtop;}}if(this.scaling.bottom>0){var intAddHeight=Math.round((iHeightAdjust/100)*(this.scaling.bottom-this.scaling.top));if(intAddHeight<1){intHeight=this.position.origheight;}else{intHeight=this.position.origheight+intAddHeight;}}if(this._align_innerelements){this._align_innerelements(intWidth,intHeight);}var boolAdjustMand=false;if(!isNaN(intLeft)&&intLeft!=this.element.offsetLeft){boolAdjustMand=true;this.element.style.left=intLeft;}if(!isNaN(intWidth)&&intWidth!=this.element.offsetWidth){this.element.style.width=intWidth;}if(!isNaN(intHeight)&&intHeight!=this.element.offsetHeight){this.element.style.height=intHeight;}if(!isNaN(intTop)&&intTop!=this.element.offsetTop){boolAdjustMand=true;this.element.style.top=intTop;}if(this.mandatory){this._showhide_mandatory_icon(!this.tabInvisible);}if(this._etype==FC_SQLLIST){this._resize_data_area();}else{if(this._etype==FC_IMGPICKLIST){this._set_picklist_img();}}if(this._form._arr_open_lists[this.name]){this._form._arr_open_lists[this.name]=false;this._dropped=false;this._dropdiv.style.display="none";}if(this.element.tagName=="TEXTAREA"){var divWysiwyg=this.htmldocument.getElementById("wysiwyg_div_"+this.name);if(divWysiwyg!=null){divWysiwyg.style.top=intTop;divWysiwyg.style.left=intLeft;divWysiwyg.style.width=intWidth;divWysiwyg.style.height=intHeight;}}};_swfc.prototype._showhide_mandatory_icon=function(bOverride){if(this._etype!=FC_TEXTEDIT&&this._etype!=FC_DATETIME&&this._etype!=FC_PICKLIST&&this._etype!=FC_DBPICKLIST&&this._etype!=FC_XMLPICKLIST&&this._etype!=FC_NUMPICKLIST&&this._etype!=FC_MINUTETIME&&this._etype!=FC_SECONDTIME){return true;}var bShow=(bOverride==undefined)?this.mandatory:bOverride;if(bShow){this._mandatoryicon=this.htmldocument.getElementById(this.name+"_mand");if(this._mandatoryicon==null){var strHTML="<div id='"+this.name+"_mand' class='mandatory'></div>";insertBeforeEnd(this.htmldocument.body,strHTML);this._mandatoryicon=this.htmldocument.getElementById(this.name+"_mand");}this._mandatoryicon.style.top=this.element.offsetTop-1+2;this._mandatoryicon.style.left=this.element.offsetLeft-1+2;this._mandatoryicon.style.zIndex=this.element.style.zIndex+2;if(this._mandatoryicon.style.zIndex==this.element.style.zIndex){this.element.style.zIndex=this.element.style.zIndex-1;}this._mandatoryicon.style.display="block";}else{if(this._mandatoryicon!=null){this._mandatoryicon.style.display="none";}}};_swfc.prototype._set_hint_text=function(strUseHint){var varHintValue=this.hintText;if(strUseHint!=undefined&&varHintValue==""){varHintValue=strUseHint;}if(this.value==""&&varHintValue!=""){if(this._originaltextcolor==""){this._originaltextcolor=this.element.style.color;}this.element.style.color="#8f8f8f";this.element.value=varHintValue;this._bHintText=true;}else{this._bHintText=false;if(this._originaltextcolor!=""){this.element.style.color=this._originaltextcolor;}}};_swfc.prototype._binding=function(strBinding){if(strBinding==undefined){return this.binding;}this.binding=strBinding;};_swfc.prototype._type=function(strType){if(strType==undefined){return this._etype;}this._etype=strType;};_swfc.prototype._group=function(strGroup){if(strGroup==undefined){return this.group;}this.group=strGroup;};_swfc.prototype._mandatory=function(bMandatory){if(bMandatory==undefined){return this.mandatory;}this.mandatory=bMandatory;this._showhide_mandatory_icon();};_swfc.prototype._onkeydown=function(oEv){var iKeyCode=app.getKeyCode(oEv);if(app.isIE&&this.element.value!=""&&_formtype==_LCF&&this.binding!=""&&this.binding.indexOf("opencall.")==-1&&this.binding.indexOf("updatedb.")==-1){if(iKeyCode==13){this.element.blur(oEv);}else{if(app.isSafari&&(iKeyCode==13||iKeyCode==9)){return app.stopEvent(oEv);}}}if(this._onkeydrop&&(iKeyCode==40||iKeyCode==38)){this._onkeydrop(oEv,iKeyCode);}if((this.picklistonly||this._etype==FC_IMGPICKLIST)&&iKeyCode!=9){return app.stopEvent(oEv);}};_swfc.prototype._onkeyup=function(oEv){var iKeyCode=app.getKeyCode(oEv);this._executejsevent("OnKeyPressed",this,this.element.value);return true;};_swfc.prototype._onblur=function(oEv){document._current_focused_input=false;this._set_element_display(true);};_swfc.prototype._onfocus=function(oEv){var origContext=this;origContext._form._close_open_lists(origContext.name);if(origContext.readOnly||origContext.picklistonly||origContext._etype==FC_IMGPICKLIST){return app.stopEvent(oEv);}origContext._display("-wc-hide-hint-");if(origContext.dataRef!=""){if(origContext.dataRef.toLowerCase()=="opencall.probcode"){origContext.element.blur();if(app.isSafari){if(origContext._probcodelastcalledtime==undefined){origContext._probcodelastcalledtime=new Date();}else{var tDate=new Date();var elapsedTime=tDate-origContext._probcodelastcalledtime;if(elapsedTime<500){return false;}}}var strFilter=origContext._form._swdoc._profilefilter;if(origContext._form._swdoc._OnSetProfileCodeFilter){strFilter=origContext._form._swdoc._OnSetProfileCodeFilter(strFilter);}if(origContext._form._swdoc._OnChangeCallProfile){if(!lsession.HaveRight(ANALYST_RIGHT_A_GROUP,ANALYST_RIGHT_A_CANCHANGECALLPROFILECODE,true)){return;}if(origContext._form._swdoc._OnChangeCallProfile()!=true){return;}}var strType=_formtype;app._profilecodeselector(strType,strFilter,origContext._value(),function(oForm){if(oForm.selected){origContext._value(oForm.code,oForm.codeDescription);if(strType==_CDF){var con=new HelpdeskSession();var res=con.SetProfileCode(origContext._form._swdoc.opencall.callref,oForm.code);if(res==false){alert("Failed to update the profile code for this request. Please contact your Administrator.");}else{if(origContext._form._swdoc._OnDataChanged){origContext._form._swdoc._OnDataChanged();}}}else{if(strType==_LCF){var bchange=false;if(oForm.sla!=""){bchange=true;var strOldPriorityValue=top.opencall.priority;origContext._form._swdoc.opencall.priority=oForm.sla;if(strOldPriorityValue!=oForm.sla){origContext._form._swdoc._OnRecordValueChanged("opencall","priority",oForm.sla,strOldPriorityValue);}document._form.probcodesla=oForm.sla;}else{document._form.probcodesla=oForm.profilesla;}if(oForm.description!=""){var strOldUpdateText=origContext._form._swdoc.updatedb.updatetxt;if(origContext._form._swdoc.updatedb.updatetxt!=""){if(confirm("There is already some description text on this form. Do you want to append the selected profile text?\n\nOK=Append\nCancel=Overwrite")){origContext._form._swdoc.updatedb.updatetxt+="\n\n"+oForm.description;}else{origContext._form._swdoc.updatedb.updatetxt=oForm.description;}}else{origContext._form._swdoc.updatedb.updatetxt=oForm.description;}if(strOldUpdateText!=origContext._form._swdoc.updatedb.updatetxt){origContext._form._swdoc._OnRecordValueChanged("updatedb","updatetxt",origContext._form._swdoc.updatedb.updatetxt,strOldUpdateText);}bchange=true;}if(bchange){origContext._form._swdoc.UpdateFormFromData("opencall",false);origContext._form._swdoc.UpdateFormFromData("updatedb",false);}if(oForm.operatorScriptId>0){bchange=false;app._operatorscript(oForm.operatorScriptId,window,function(oOp){if(oOp){for(strBinding in oOp._answers){var arrBinding=strBinding.split(".");if(origContext._form._swdoc[arrBinding[0]][arrBinding[1]]!=""){origContext._form._swdoc[arrBinding[0]][arrBinding[1]]+="\n"+oOp._answers[strBinding];}else{origContext._form._swdoc[arrBinding[0]][arrBinding[1]]=oOp._answers[strBinding];}bchange=true;}if(bchange){origContext._form._swdoc.UpdateFormFromData(undefined,false);}}});}}}}},null,window);if(app.isSafari){origContext._probcodelastcalledtime=new Date();}return false;}else{if(origContext.dataRef.toLowerCase()=="opencall.fixcode"){var strType=_formtype;app._profilecodeselector("fix","",origContext._value(),function(oForm){if(oForm.selected){origContext._value(oForm.code,oForm.codeDescription);}origContext.element.blur();},null,window);return false;}}}return true;};_swfc.prototype._readOnly=function(bReadOnly){if(bReadOnly==undefined){return this.readOnly;}this.readOnly=bReadOnly;if(bReadOnly){this.element.setAttribute("readOnly",bReadOnly);if(this._swlb){this._swlb.setAttribute("disabled",bReadOnly);}}else{this.element.removeAttribute("readOnly");if(this._swlb){this._swlb.setAttribute("disabled",bReadOnly);}}};_swfc.prototype._enable=function(bEnable){if(bEnable==undefined){return !this.disabled;}this.disabled=(!bEnable);this.enable=bEnable;if(bEnable&&_formtype==_CDF&&!this._form._isaltforn&&this.dataRef!=""){var arrRef=this.dataRef.split(".");if(arrRef[0]!=document._mastertable._name){var boolDisable=(document._exttable&&arrRef[0]==document._exttable._name)?false:true;if(boolDisable){return true;}}}this.element.disabled=this.disabled;this.element.setAttribute("disabled",this.disabled);if(!this.disabled){this.element.removeAttribute("disabled");}if(this._is_an_input_field()){if(!bEnable){this.element.style.backgroundColor=this.disabledBackgroundColor;}else{this.element.style.backgroundColor=this.appearance.backgroundColor;}}};_swfc.prototype._tabvisible=function(bVisible){if(bVisible==undefined){return !this.tabInvisible;}this.tabInvisible=(!bVisible);if(this._tabcontrol!=null){var intParentIndex=parseInt(this._tabcontrol.element.style.zIndex);var intMyIndex=parseInt(this.element.style.zIndex);if(intMyIndex<intParentIndex){this.element.style.zIndex=intParentIndex+intMyIndex;}}if(!this.visible){return;}this.element.style.visibility=(bVisible)?"visible":"hidden";this.element.style.display=(bVisible)?"block":"none";if(this._etype==FC_IMGPICKLIST){if(this._selected_img!=null){this._selected_img.style.display=(bVisible)?"":"none";}}else{if(this._etype==FC_SQLLIST&&this._NotLoadedAsInvisible&&bVisible){this._fetchdata();}}this._resize(bVisible);if(this.mandatory){this._showhide_mandatory_icon(bVisible);}if(this._etype==FC_TABCONTROL){if(bVisible){this._show();}else{this._hide();}}if(bVisible&&this._align!=undefined){this._align();}};_swfc.prototype.isXmlField=function(){if(this.binding.indexOf("x.")==0){return true;}return false;};_swfc.prototype._visible=function(bVisible){if(bVisible==undefined){return this.visible;}if(this.tabInvisible){this.invisible=(!bVisible);}this.visible=bVisible;if(this._etype==FC_IMGPICKLIST){if(this._selected_img!=null){this._selected_img.style.display=(this.visible)?"":"none";}}if(this.tabInvisible){this.element.style.visibility="hidden";this.element.style.display="none";if(this.mandatory){this._showhide_mandatory_icon(false);}if(this._etype==FC_TABCONTROL){this._hide();}}else{this.element.style.visibility=(bVisible)?"visible":"hidden";this.element.style.display=(bVisible)?"block":"none";if(this.mandatory){this._showhide_mandatory_icon(bVisible);}if(bVisible){if(this._etype==FC_TABCONTROL){this._show();}this._resize();if(this._etype==FC_SQLLIST&&this._NotLoadedAsInvisible){this._fetchdata();}}else{if(this._etype==FC_TABCONTROL){this._hide();}}}};_swfc.prototype._image=function(strURI){if(strURI==undefined){return this.image;}if(strURI==this.image){return;}this.image=strURI;this.element.childNodes[0].src=_parse_context_vars(strURI);};_swfc.prototype._onchange=function(oEv){this._value(this.element.value,this.element.value,false);};_swfc.prototype._onmousedown=function(oEv){if(this.readOnly){this._cancelevent(oEv);return false;}if(_mousebtn(oEv)==1){var strFunc="OnLeftClick";}else{var strFunc="OnRightClick";}return this._executejsevent(strFunc);};_swfc.prototype._color=function(strColor){if(strColor==undefined){return this.color;}this.color=strColor;if(this._is_an_input_field()){this.element.style.color=strColor;}};_swfc.prototype._bgcolor=function(strBgColor){if(strBgColor==undefined){return this.bgcolor;}this.bgcolor=strBgColor;if(this._is_an_input_field()){this.element.style.backgroundColor=strBgColor;}};_swfc.prototype._value=function(strValue,strFormattedValue,bFromData,bFromUser){if(this._etype==FC_LABEL||this._etype==FC_FIELDLABEL){return this.text;}if(strValue==undefined){return this.value;}if(strValue==this.value&&this._value_initialised){return;}if(!this._value_initialised&&strValue==""){strValue=this.defaultValue;strFormattedValue=strValue;}this._value_initialised=true;if(bFromUser==undefined){bFromUser=false;}if(this._etype==FC_MINUTETIME){strFormattedValue="";strValue=_getminutes_from_uservalue(strValue);}else{if(this._etype==FC_SECONDTIME){strFormattedValue="";strValue=_getseconds_from_uservalue(strValue,bFromData);}else{if(this.textInputFormat=="Currency"){var strDBValue=_get_sw_dbcurrency_from_value(strValue,false,bFromData,bFromUser);strFormattedValue=_get_sw_dbcurrency_from_value(strValue,true,bFromData,bFromUser);strValue=strDBValue;}}}this.value=strValue;this.text=strValue;if(this.binding=="opencall.probcode"&&strFormattedValue==strValue){strFormattedValue="";}else{if(this.binding=="opencall.fixcode"&&strFormattedValue==strValue){strFormattedValue="";}}if(strFormattedValue==undefined||strFormattedValue==""){strFormattedValue=this._formatValue();}this._display(strFormattedValue);if(this.binding!=""){if(bFromData==undefined){bFromData=false;}this._form._swdoc._set_data_value(strValue,this.binding,bFromData,strFormattedValue);}};_swfc.prototype._formatValue=function(bFromData){if(this.binding=="opencall.probcode"){if(this.value==""){return"";}var strFormattedValue=app.global.GetProblemProfileDescription(this.value).strCodeDesc;}else{if(this.binding=="opencall.fixcode"){if(this.value==""){return"";}var strFormattedValue=app.global.GetResolutionProfileDescription(this.value).strCodeDesc;}else{if(this._etype==FC_MINUTETIME){var strFormattedValue=_format_minutetime_field(this.value);}else{if(this._etype==FC_SECONDTIME){var strFormattedValue=_format_secondtime_field(this.value);}else{var strFormattedValue=this.value;}}}}return strFormattedValue;};_swfc.prototype._dataRef=function(strBinding){if(strBinding==undefined){return this.binding;}this.binding=strBinding;this.dataRef=strBinding;};_swfc.prototype._text=function(strText){if(this._etype==FC_CAPTIONBAR){var divText=this.htmldocument.getElementById(this.name+"_captiontext");if(divText!=null){app.setElementText(divText,_parse_context_vars(strText));}}else{if(this._etype==FC_LABEL||this._etype==FC_FIELDLABEL){var lblText=this.htmldocument.getElementById(this.name+"_labeltext");if(lblText!=null){if(strText==undefined){return this.text;}else{app.setElementText(lblText,_parse_context_vars(strText));this.text=_parse_context_vars(strText);}}}else{if(this._etype==FC_MENUBUTTON){var tdText=this.htmldocument.getElementById(this.name+"_menutext");if(tdText!=null){if(strText==undefined){return app.getElementText(tdText);}app.setElementText(tdText,_parse_context_vars(strText));this.text=_parse_context_vars(strText);}}else{if(this._etype==FC_BUTTON){var tdText=this.htmldocument.getElementById(this.name+"_menutext");if(tdText!=null){if(strText==undefined){return app.getElementText(tdText);}app.setElementText(tdText,_parse_context_vars(strText));this.text=_parse_context_vars(strText);}else{if(strText==undefined){return app.getElementText(this.element);}app.setElementText(this.element,_parse_context_vars(strText));this.text=_parse_context_vars(strText);}}else{if(strText==undefined){return this.text;}this.text=strText;this._display(strText);}}}}};_swfc.prototype._display=function(strDisplay,boolHint){if(strDisplay==undefined){return this.display;}if(strDisplay!="-wc-hide-hint-"){this.display=strDisplay;}this._set_element_display(boolHint,strDisplay);};_swfc.prototype._set_element_display=function(boolHint,strAltDisplay){if(boolHint==undefined){boolHint=false;}var strDisplay=(strAltDisplay==undefined)?this.display:strAltDisplay;if(strDisplay==""&&this.hintText!=""){this._set_hint_text();}else{if(this._originaltextcolor!=""){this.element.style.color=this._originaltextcolor;}this._bHintText=false;if(strDisplay=="-wc-hide-hint-"){if(this.value!=""){return;}strDisplay="";}if(this._etype==FC_IMGPICKLIST){this._set_picklist_img();}else{this.element.value=strDisplay;}}};_swfc.prototype._executejsevent=function(strEvent,p1,p2,p3,p4,p5,p6,p7,p8,p9,p10){var res=true;var strFunc=this.name+"_"+strEvent;var altFunc=this.duplicatename+"_"+strEvent;if(this.frame[strFunc]){try{app._CURRENT_JS_WINDOW=window;res=this.frame[strFunc](p1,p2,p3,p4,p5,p6,p7,p8,p9,p10);}catch(e){}}else{if(this.duplicatename!=""&&this.frame[altFunc]){try{app._CURRENT_JS_WINDOW=window;res=this.frame[altFunc](p1,p2,p3,p4,p5,p6,p7,p8,p9,p10);}catch(e){}}else{if(top[strFunc]){try{app._CURRENT_JS_WINDOW=window;res=top[strFunc](p1,p2,p3,p4,p5,p6,p7,p8,p9,p10);}catch(e){}}else{if(this.duplicatename!=""&&top[altFunc]){try{app._CURRENT_JS_WINDOW=window;res=top[altFunc](p1,p2,p3,p4,p5,p6,p7,p8,p9,p10);}catch(e){}}}}}if(strEvent=="OnValueChanged"){if(this.frame["OnFieldValueChanged"]){app._CURRENT_JS_WINDOW=window;this.frame["OnFieldValueChanged"](this.name,this.value);}}if(strEvent!="OnKeyPressed"){this._form._swdoc._CheckFormCodeDataChange();}else{if(this.binding!=""&&this.element.value!=this.value&&document.type!=_LCF){document._bSaveEnabled=true;}}return res;};_swfc.prototype._onpressed=function(anEle){this._form._swdoc._showmeitem_exists(this.name,true);this._executejsevent("OnPressed");};_swfc.prototype._onleftclick=function(anEle){this._executejsevent("OnLeftClick");};function _swfc_textedit(oSWFC){oSWFC._onchange=_swfc_textedit_onchange;oSWFC._onmousedown=_swfc_textedit_onmousedown;oSWFC._onblur=_swfc_textedit_onblur;oSWFC._show_multiclip_menu=swfc_textedit_show_multiclip_menu;oSWFC._hide_multiclip_menu=swfc_textedit_hide_multiclip_menu;oSWFC._insert_text_at_cursor=swfc_textedit_insert_text_at_cursor;oSWFC._rtecontextinit;}function _swfc_textedit_onchange(oEv){this._value(this.element.value,this.element.value,false,true);this._executejsevent("OnValueChanged",this.value);}function swfc_textedit_insert_text_at_cursor(strText){var myField=this.element;if(this.htmldocument.selection){myField.focus();sel=this.htmldocument.selection.createRange();sel.text=strText;}else{if(myField.selectionStart||myField.selectionStart=="0"){var startPos=myField.selectionStart;var endPos=myField.selectionEnd;myField.value=myField.value.substring(0,startPos)+strText+myField.value.substring(endPos,myField.value.length);}else{myField.value+=strText;}}this._value(myField.value);}function swfc_textedit_hide_multiclip_menu(){var divWysiwyg=this.htmldocument.getElementById("wysiwyg_div_"+this.name);if(divWysiwyg!=null){if(this._rtecontextinit){this._form._targetframe.WYSIWYG_ContextMenu.close();}}}function swfc_textedit_show_multiclip_menu(oEv,btnID){var divWysiwyg=this.htmldocument.getElementById("wysiwyg_div_"+this.name);if(divWysiwyg!=null){if(!this._rtecontextinit){this._form._targetframe.WYSIWYG_ContextMenu.init(this.name,this.element);}this._rtecontextinit=true;if(app.isSafari){this._form._targetframe.WYSIWYG_ContextMenu.show(oEv,this.name);}}else{var bGroupMc=lsession.HaveRight(ANALYST_RIGHT_D_GROUP,ANALYST_RIGHT_D_CANUSEGROUPMULTIPASTE);var bPersonalMc=lsession.HaveRight(ANALYST_RIGHT_D_GROUP,ANALYST_RIGHT_D_CANUSEPERSONALMULTIPASTE);if(!bGroupMc&&!bPersonalMc){return false;}var origValue=this.element.value;app.insertAtCursor(this.element,"##_swmc_marker_##");var strCurrentValue=this.element.value;this.element.value=origValue;var swc=this;app._open_system_form("multiclippicker.php","multiclip","","",true,function(oForm){if(oForm.selected){var xmlmc=new XmlMethodCall();xmlmc.SetParam("itemId",oForm.multiclipid);if(xmlmc.Invoke("system","multiClipGetItemData")){var strInsertData=xmlmc.GetParam("itemData");strCurrentValue=_regexreplace(strCurrentValue,"##_swmc_marker_##",strInsertData);swc._value(strCurrentValue);}}},null,window,250,250);}}function _swfc_textedit_onmousedown(oEv){var btnClicked=_mousebtn(oEv);if(app.isSafari&&oEv.shiftKey){btnClicked=666;}if(btnClicked==1){var strFunc="OnLeftClick";}else{if(this.readOnly){this._cancelevent(oEv);return false;}if(this.element.tagName=="TEXTAREA"&&(oEv.ctrlKey||btnClicked==666)){this._show_multiclip_menu(oEv,btnClicked);this._cancelevent(oEv);return false;}else{if(this.element.tagName=="TEXTAREA"){this._hide_multiclip_menu();}}var strFunc="OnRightClick";}return this._executejsevent(strFunc);}function _swfc_textedit_onblur(oEv){if((app.isIE||app.isChrome||app.isSafari)){if(this.value!=this.element.value&&this.element.value!=this.hintText&&this.binding.toLowerCase()!="opencall.probcode"){this._onchange(oEv);return;}}this._set_element_display(true);}function _swfc_datebox(oSWFC){oSWFC._value=_swfc_datebox_value;oSWFC._text=_swfc_datebox_text;oSWFC._onchange=_swfc_datebox_onchange;oSWFC._oncalchange=_swfc_datebox_oncalchange;oSWFC._convertvalue=_swfc_datebox_convertvalue;oSWFC._trigger_dropdown=_swfc_trigger_dropdown;oSWFC._onmousedown=_swfc_textedit_onmousedown;oSWFC._onblur=_swfc_textedit_onblur;oSWFC._apply_timezone_offset=true;oSWFC._jsdate=null;if(oSWFC.binding.indexOf("calltasks")==0){oSWFC._apply_timezone_offset=false;}}function _swfc_trigger_dropdown(oEv,aDoc){if(this.readOnly){return;}app.trigger_datebox_dropdown(this.element,oEv,this._jsdate);}function _swfc_datebox_onchange(oEv){this._value(this.element.value,"",false,true);}function _swfc_datebox_oncalchange(intEpoch){}function _swfc_datebox_text(strText){if(strText==undefined){if(this.dataRef==""){return this.text;}else{return this.value;}}this._value(strText);}function _swfc_datebox_value(strValue,strFormattedValue,bFromData,bManualChange){if(strValue==undefined){return this.value;}if(bFromData==undefined){bFromData=false;}if(bManualChange==undefined){bManualChange=false;}if(strValue.replace){strValue=strValue.replace("Z","");}if(strValue==this.value&&this._value_initialised){return;}if(!this._value_initialised&&strValue==""){strValue=this.defaultValue;strFormattedValue=strValue;}this._value_initialised=true;if(strValue=="1"&&strFormattedValue=="1"){strValue="0";}if(strValue=="0"||strValue==""){this.value=strValue;this.text=strValue;this._display("");}else{if(!this._convertvalue(strValue,bFromData,bManualChange)){return;}}if(this.binding!=""){this._form._swdoc._set_data_value(this.value,this.binding,bFromData);}if(!bFromData&&bManualChange){this._executejsevent("OnValueChanged",this.value);}}function _swfc_datebox_convertvalue(varDateString,bFromData,bManualChange){if(bFromData==undefined){bFromData=false;}var bEpoch=false;var bTimeStamp=false;if(this.binding!=""){var arrBind=this.binding.split(".");if((pDDTABLES[arrBind[0]])&&(pDDTABLES[arrBind[0]].columns[arrBind[1]])){if(!pDDTABLES[arrBind[0]].columns[arrBind[1]].IsNumeric()){bEpoch=false;}if(pDDTABLES[arrBind[0]].columns[arrBind[1]].type=="timestamp"){bTimeStamp=true;}}else{if(arrBind[0]=="x"){bTimeStamp=true;}else{alert("swform.controls : the date control ["+this.name+"] does not have a valid data binding.");}}}var varWorkWithValue=varDateString;varWorkWithValue--;varWorkWithValue++;var strFormat=this.dateFormat;if(strFormat==""){var fTest=new Number(this.dateFormatMode);fTest--;fTest++;switch(fTest){case 0:strFormat=app._analyst_datetimeformat;break;case 1:strFormat=app._analyst_dateformat;break;case 2:strFormat=app._analyst_timeformat;break;case 3:strFormat=app._analyst_datetimeformat;break;}}var _ANALYST_DATE=null;var _DB_DATE=null;if(!isNaN(varWorkWithValue)){var _selected_date_epoch=varWorkWithValue;if(this._apply_timezone_offset){if(bManualChange){_ANALYST_DATE=app._date_from_epoch(varWorkWithValue);}else{_ANALYST_DATE=app._utcdate_from_epoch(varWorkWithValue,lsession.timezoneOffset);}}else{_ANALYST_DATE=app._osdate_from_epoch(varDateString,0);}}else{_ANALYST_DATE=app._parseDate(varDateString,strFormat);if(_ANALYST_DATE==null){_ANALYST_DATE=app._parseDate(varDateString);}}try{_DB_DATE=app._date_from_epoch(parseInt(Date.UTC(_ANALYST_DATE.getUTCFullYear(),_ANALYST_DATE.getUTCMonth(),_ANALYST_DATE.getUTCDate(),_ANALYST_DATE.getUTCHours(),_ANALYST_DATE.getUTCMinutes(),_ANALYST_DATE.getUTCSeconds())/1000)-lsession.timezoneOffset);}catch(e){alert("The entered date format is not valid. Please use the following format ["+strFormat+"].");this._value(this.value);return false;}var strFormattedDate=app._formatDate(_ANALYST_DATE,strFormat);var strTextDate=app._formatDate(_DB_DATE,strFormat);if(_ANALYST_DATE!=null){this._jsdate=_ANALYST_DATE;if(!bTimeStamp){strDateDBValue=parseInt(Date.UTC(_ANALYST_DATE.getFullYear(),_ANALYST_DATE.getMonth(),_ANALYST_DATE.getDate(),_ANALYST_DATE.getHours(),_ANALYST_DATE.getMinutes(),_ANALYST_DATE.getSeconds())/1000)-lsession.timezoneOffset;}else{if(bTimeStamp){strDateDBValue=app._parseDate(_ANALYST_DATE.toUTCString(),"yyyy-MM-dd HH:mm:ss");if(bManualChange){strDateDBValue=app._date_to_utc_timestamp(_ANALYST_DATE);}else{strDateDBValue=app._formatDate(_ANALYST_DATE,"yyyy-MM-dd HH:mm:ss");}}}this.value=strDateDBValue;this.text=(this.binding=="")?strTextDate:strDateDBValue;this._display(strFormattedDate);return true;}else{if(varDateString!=""){alert("The entered date format is not valid. Please use the following format ["+strFormat+"].");}this.value="";this.text="";this._jsdate=null;this._set_hint_text();return false;}}function _swfc_datebox_display(varFormattedDisplay){}function _swfc_listbox(oSWFC){oSWFC._unparsedFilter=oSWFC.listFilter;oSWFC.filter=oSWFC.listFilter;oSWFC.Reload=_swfc_listbox_reload;oSWFC._onkeydrop=_swfc_listbox_onkeydrop;oSWFC.fetchType=1;oSWFC.invokeStoredQuery=_swfc_listbox_storedquery;oSWFC.InvokeStoredQuery=_swfc_listbox_storedquery;if(oSWFC.storedQuery!=""){oSWFC.fetchType=2;oSWFC.storedQueryParams=oSWFC.filter;oSWFC.storedQueryName=oSWFC.storedQuery;}oSWFC.source=oSWFC.sqlSource;oSWFC.table=oSWFC.distinctTable;oSWFC._selected_img=null;oSWFC._value=_swfc_listbox_value;oSWFC._text=_swfc_listbox_text;oSWFC._extra_option_value=_swfc_listbox_extra_option_value;oSWFC._fetchdata=_swfc_listbox_fetchdata;oSWFC._filter=_swfc_listbox_filter;oSWFC._pickList=_swfc_listbox_pickList;oSWFC._extraOptions=_swfc_listbox_extraOptions;oSWFC._apply_extra_options=_swfc_listbox_apply_extra_options;oSWFC._has_databound_extraoptions=_swfc_listbox_has_databound_extraoptions;oSWFC._check_value=_swfc_listbox_check_value;oSWFC._onchange=_swfc_listbox_onchange;oSWFC._onblur=_swfc_listbox_onblur;oSWFC._addoption=_swfc_listbox_addoption;oSWFC._onmousedown=_swfc_listbox_ondropdown;oSWFC.deactivate=_swfc_listbox_deactivate;oSWFC._set_picklist_img=_swfc_listbox__set_picklist_img;oSWFC._dataloaded=false;oSWFC._dropped=false;oSWFC._systemlbmandatory=false;oSWFC._hilite=_swfc_listbox_hilite;oSWFC._lolite=_swfc_listbox_lolite;oSWFC._selectitem=_swfc_listbox_selectitem;}function _swfc_listbox_text(strText){this._value(strText);}function _swfc_listbox_deactivate(){this._form._arr_open_lists[this.name]=false;this._dropped=false;this._dropdiv.style.display="none";}function _swfc_listbox__set_picklist_img(){if(_img_picklists[this.imageList]!=undefined){if(this._selected_img==null){var strClass=_regexreplace(this.imageList," ","_");var strImgDiv="<div id='"+this.name+"__img' class='"+strClass+"' style='position:absolute;z-Index:999;'></div>";insertBeforeEnd(this.htmldocument.body,strImgDiv);this._selected_img=this.htmldocument.getElementById(this.name+"__img");}if(this._selected_img!=null&&this._selected_img.style.display!="none"){if(isNaN(this.value)){this.value=0;}var ileft=this.value*18;this._selected_img.style.backgroundPosition="-"+ileft+"px 0";this._selected_img.style.top=this.element.offsetTop-1+3;this._selected_img.style.left=this.element.offsetLeft-1+2;}}}function _swfc_listbox_onkeydrop(oEv,intForceAction){return this._onmousedown(oEv,intForceAction);}function _swfc_listbox_ondropdown(oEv,intForceAction){if(intForceAction==undefined){intForceAction=0;}var ret=true;ret=this._executejsevent("OnDropDown");if(ret==undefined||ret==false){return app.stopEvent(oEv);}var strFunc="";if(_mousebtn(oEv)==1){strFunc="OnLeftClick";}else{if(_mousebtn(oEv)==2){strFunc="OnRightClick";}}if(strFunc!=""){ret=this._executejsevent(strFunc);}if(ret==undefined||ret==false){return app.stopEvent(oEv);}if(this.readOnly){this._cancelevent(oEv);return app.stopEvent(oEv);}if(ret){var boolDrop=(this.picklistonly||this._etype==FC_IMGPICKLIST);if(intForceAction==40){this._dropped=false;boolDrop=true;}else{if(intForceAction==38){boolDrop=false;}}var cancelEvent=boolDrop;if(!boolDrop){var arrM=app.findMousePos(oEv);var mLeft=arrM[0];var btnLeft=this.element.offsetLeft+this.element.offsetWidth-16;var btnRight=this.element.offsetLeft+this.element.offsetWidth-1;if((mLeft>btnLeft)&&(mLeft<btnRight)){boolDrop=true;}}if(!this._dropped&&boolDrop){this._form._close_open_lists();this._dropped=true;this._form._arr_open_lists[this.name]=true;this._pickList();this._dropdiv.style.top=this.element.offsetTop+this.element.offsetHeight;this._dropdiv.style.left=this.element.offsetLeft;this._dropdiv.style.width=this.element.offsetWidth;this._dropdiv.style.zIndex=999999;var iFormLeftSpace=this.element.offsetLeft+this.element.offsetWidth;var iFormRightSpace=this.htmldocument.body.offsetWidth-this.element.offsetLeft;this._dropdiv.style.height="";this._dropdiv.style.display="block";var iListHeight=this._dropdiv.offsetHeight;var iListWidth=this._dropdiv.offsetWidth;var iListBottom=iListHeight+(this.element.offsetTop+this.element.offsetHeight);var iFormBottom=app.eleHeight(this.htmldocument.body)-(this.element.offsetTop+this.element.offsetHeight);var iFormTop=this.element.offsetTop;this._dropdiv.style.overflow="auto";if(iFormBottom<iListHeight){if(iFormTop>iFormBottom){if(iListHeight>this.element.offsetTop){iListHeight=this.element.offsetTop;}this._dropdiv.style.height=iListHeight;this._dropdiv.style.top=this.element.offsetTop-iListHeight;}else{this._dropdiv.style.height=iFormBottom-2;}}return app.stopEvent(oEv);}else{this._form._arr_open_lists[this.name]=false;this._dropped=false;this._dropdiv.style.display="none";}}return ret;}function _swfc_listbox_check_value(strValue,strMode){if(strValue==""){return true;}if(strMode==undefined){strMode="key";}if(this._etype==FC_PICKLIST||this._etype==FC_NUMPICKLIST||this._etype==FC_IMGPICKLIST){var bNumeric=(this._etype==FC_NUMPICKLIST)?true:false;if(this.binding!=""){if(this.isXmlField()){bNumeric=true;}else{var wasNumeric=bNumeric;var arrBind=this.binding.split(".");bNumeric=pDDTABLES[arrBind[0]].columns[arrBind[1]].IsNumeric();if(wasNumeric&&!bNumeric&&!isNaN(strValue)){bNumeric=true;}}}strMode=(this._etype==FC_NUMPICKLIST&&bNumeric)?"key":"text";strValue=strValue+"";if(this._originalPicklist!=this.pickList||this._htmltable.rows.length==0){this._pickList();}var aRow=null;var arrRet=new Array();var aHtlen=this._htmltable.rows.length;var testValue=strValue.toLowerCase();for(var x=0;x<aHtlen;x++){aRow=this._htmltable.rows[x];var strText=app.eleText(aRow.cells[0]);var strID=app.eleText(aRow.cells[1]);if(strMode!="key"){if(strText.toLowerCase()==testValue){arrRet[0]=strText;arrRet[1]=strText;return arrRet;}}else{if(aRow.cells[1].innerHTML.toLowerCase()==testValue){arrRet[0]=strID;arrRet[1]=strText;return arrRet;}}}return false;}else{var strParams="dsn="+this.source;strParams+="&table="+app.pfu(this.table);strParams+="&filter="+app.pfu(_parse_context_vars(this.filter,true));strParams+="&keycol="+app.pfu(this.distinctColumn);strParams+="&textcol="+app.pfu(this.displayColumn);strParams+="&checkvalue="+app.pfu(strValue);strParams+="&checkmode="+strMode;app.debugstart(this.name+"._check_value [listbox]","FORM CONTROLS");var strURL=app._root+"service/form/combo/checkvalue/index.php";var strRes=app.get_http(strURL,strParams,true,false,null,null,0,this.name);app.debugend(this.name+"._check_value [listbox]","FORM CONTROLS");if(strRes.indexOf("^swwc^")==-1){return false;}return strRes.split("^swwc^");}}function _swfc_listbox_extra_option_value(strExtraOption){var arrAdditionalItems=this.extraOptions.split("^");var y=arrAdditionalItems.length;for(var x=0;x<y;x++){if(arrAdditionalItems[x]==""){continue;}if(arrAdditionalItems[x].indexOf("=")>-1){iInfo=arrAdditionalItems[x].split("=");if(strExtraOption==iInfo[0]){if(this.binding!=""&&iInfo[1].indexOf("&[")==0){var o={};o.info=iInfo;o.element=this;document._listbox_extraoptions_bindings[this.binding]=o;}var strResolvedValue=_parse_context_vars(iInfo[1]);if(strResolvedValue==""){strResolvedValue=iInfo[0];}return strResolvedValue;}}else{if(strExtraOption==arrAdditionalItems[x]){return arrAdditionalItems[x];}}}return strExtraOption;}function _swfc_listbox_has_databound_extraoptions(){var arrAdditionalItems=this.extraOptions.split("^");var y=arrAdditionalItems.length;for(var x=0;x<y;x++){if(arrAdditionalItems[x]==""){continue;}if(arrAdditionalItems[x].indexOf("=")>-1){iInfo=arrAdditionalItems[x].split("=");if(iInfo[1]!=undefined){if(app.trim(iInfo[1]).indexOf("&[")==0){return true;}}}}return false;}function _swfc_listbox_value(strValue,strFormattedValue,bFromData,bfromChange){if(bfromChange==undefined){bfromChange=false;}if(bFromData==undefined){bFromData=false;}if(strValue==undefined){return this.value;}strValue+="";if(strValue==this.value&&this._value_initialised&&bfromChange==false&&bFromData!=false){return;}var bSkip=false;if(this._etype!=FC_NUMPICKLIST&&(strValue==""||strValue=="0")&&!this._value_initialised){if(this.defaultValue!=""){if(this._etype==FC_PICKLIST){var bProcess=true;if(this.binding!=""){var arrBind=this.binding.split(".");if(document[arrBind[0]]==undefined){if(arrBind[0]!="x"){bProcess=false;}}}if(bProcess){strValue=this._extra_option_value(this.defaultValue);strFormattedValue=this.defaultValue;}bSkip=true;}else{strValue=this._extra_option_value(this.defaultValue);strFormattedValue=this.defaultValue;bSkip=true;}}}else{if(this._etype==FC_NUMPICKLIST&&(strValue==""||strValue=="0")&&!this._value_initialised){if(this.defaultValue!=""){strValue=this.defaultValue;}}else{if(strValue.indexOf("&[")==0&&!bFromData){strValue=_parse_context_vars(strValue);if(strValue=="undefined"){strValue="**Value Not Found**";}strFormattedValue=strValue;}}}this._value_initialised=true;if(!bfromChange&&!bSkip){if(this._etype==FC_PICKLIST||this._etype==FC_NUMPICKLIST||this._etype==FC_IMGPICKLIST){if(this.binding!=""&&arrSwapEnumBindingValues[this.binding]!=undefined){var tmpValue=arrSwapEnumBindingValues[this.binding][strValue];if(tmpValue!=undefined){strValue=tmpValue;}}var arrValues=this._check_value(strValue,"key");if(arrValues==false){if(this._etype!=FC_PICKLIST){strFormattedValue="";}}else{strFormattedValue=arrValues[1];}}else{var strExtraOptionValue=this._extra_option_value(strValue);if(strExtraOptionValue!=strValue){strFormattedValue=strValue;strValue=strExtraOptionValue;}else{if(this.distinctColumn!=this.displayColumn&&this.displayColumn!=""){var arrValues=this._check_value(strValue,"key");if(arrValues==false){strFormattedValue="";}else{strFormattedValue=arrValues[1];}}else{strFormattedValue=strValue;}}}}else{var bNumeric=false;if(this.binding!=""){var arrBind=this.binding.split(".");if(!this.isXmlField()){if(pDDTABLES[arrBind[0]]&&pDDTABLES[arrBind[0]].columns[arrBind[1]]){bNumeric=pDDTABLES[arrBind[0]].columns[arrBind[1]].IsNumeric();}}else{bNumeric=(this._etype==FC_NUMPICKLIST);}if(!bNumeric&&this._etype==FC_NUMPICKLIST){strValue=strFormattedValue;}}}this.value=strValue;if(this.binding!=""){this._form._swdoc._set_data_value(strValue,this.binding,bFromData);}if(strFormattedValue==undefined){strFormattedValue=this.value;}this.text=this.value;this._display(strFormattedValue);if(bfromChange){this._executejsevent("OnValueChanged",this.value);}}function _swfc_listbox_onblur(){}function _swfc_listbox_onchange(oEv){var strNewValue=this.element.value;var arrCheck=this._check_value(strNewValue,"text");var bFound=(arrCheck!=false);if(bFound){this._value(arrCheck[0],arrCheck[1],false,true);}else{if((this.comboQuickAdd)&&(strNewValue!="")&&(this.newRecordForm!="")){if(MessageBox("There is no match found for the item you entered. Please click No to try again or Yes to create a new record",app.MB_YESNO)){var strDisCol=(this.displayColumn=="")?this.distinctColumn:this.displayColumn;var strParams="fromlistbox=1&displaycolumn="+strDisCol+"&interimvalue="+strNewValue;var swfc=this;_open_control_form(this.newRecordForm,"add",strNewValue,strParams,function(res){if(res.recordsaved){swfc.element.value=res.picklistdisplay;swfc._value(res.primarykey,res.picklistdisplay,false,true);}else{swfc.element.value="";swfc._value("","",false,true);}});}else{this.value="";this.text="";this.display="";this._value("","",false,true);return false;}}else{this._value(this.element.value,this.element.value,false,true);}}}function _swfc_listbox_filter(strFilter){if(strFilter==undefined){return this.listFilter;}this._unparsedFilter=strFilter;this.listFilter=_parse_context_vars(strFilter,true);this.filter=this.listFilter;}function _swfc_listbox_reload(){}function _swfc_listbox_addoption(strValue,strText){var aRow=this._htmltable.insertRow(this._htmltable.rows.length);var celltext=aRow.insertCell(0);var cellid=aRow.insertCell(1);celltext.setAttribute("nowrap","true");celltext.setAttribute("width","100%");celltext.innerHTML=strText;cellid.style.display="none";cellid.innerHTML=strValue;}function _swfc_listbox_lolite(oEv){var aRow=app.getEventSourceElement(oEv);if(aRow.tagName=="TR"){}else{if(aRow.tagName=="TD"){aRow=aRow.parentNode;}else{return;}}aRow.style.backgroundColor="#ffffff";aRow.style.color="#000000";}function _swfc_listbox_hilite(oEv){var aRow=app.getEventSourceElement(oEv);if(aRow.tagName=="TR"){}else{if(aRow.tagName=="TD"){aRow=aRow.parentNode;}else{return;}}aRow.style.backgroundColor="navy";aRow.style.color="#ffffff";}function _swfc_listbox_selectitem(oEv){app.stopEvent(oEv);var aRow=app.getEventSourceElement(oEv);if(aRow.tagName=="DIV"){aRow=aRow.parentNode.parentNode;}else{if(aRow.tagName=="TD"){aRow=aRow.parentNode;}}if(aRow.cells&&aRow.cells[0]!=undefined){this._value(app.eleText(aRow.cells[1]),app.eleText(aRow.cells[0]),false,true);}this._dropped=false;this._dropdiv.style.display="none";return false;}function _swfc_listbox_pickList(){if(this._etype==FC_DBPICKLIST||this._etype==FC_XMLPICKLIST){var testfilter=_parse_context_vars(this._unparsedFilter,true);if(testfilter!=this.listFilter){this.listFilter=testfilter;this._dataloaded=false;}this._dataloaded=true;if(!this.mandatory){this._addoption("","");}this._fetchdata();this._apply_extra_options();}else{if(this.listItems!=this.pickList){this._dataloaded=false;}if(this._dataloaded){return true;}this._dataloaded=true;this.listItems=this.pickList;var yLen=this._htmltable.rows.length-1;for(var i=yLen;i>-1;i--){this._htmltable.deleteRow(i);}if(!this.mandatory&&!this._systemlbmandatory){this._addoption("","");}var iInfo=new Array();var arrItems=this.pickList.split("|");yLen=arrItems.length;for(var x=0;x<yLen;x++){if(arrItems[x]==""){continue;}if(this._etype==FC_NUMPICKLIST){iInfo=arrItems[x].split("^");this._addoption(iInfo[1],iInfo[0]);}else{var strVal=arrItems[x];if(arrItems[x].indexOf("^")>-1){strVal=arrItems[x].split("^")[0];}this._addoption(strVal,strVal);}}this._apply_extra_options();}return true;}function _swfc_listbox_apply_extra_options(){var iInfo=new Array();var arrAdditionalItems=this.extraOptions.split("^");var yLen=arrAdditionalItems.length;for(var x=0;x<yLen;x++){if(arrAdditionalItems[x]==""){continue;}if(arrAdditionalItems[x].indexOf("=")>-1){iInfo=arrAdditionalItems[x].split("=");this._addoption(iInfo[1],iInfo[0]);}else{this._addoption(arrAdditionalItems[x],arrAdditionalItems[x]);}}}function _swfc_listbox_extraOptions(strItems){if(strFilter==undefined){return this.extraOptions;}this.extraOptions=strItems;}function _swfc_listbox_storedquery(strQueryName,strParams){this._beforeloadingvalue=this.element.value;this.element.value="Loading...";this.fetchType=2;this.storedQueryName=strQueryName;this.storedQueryParams=strParams;var strDesc=(this.pickListOrderDesc)?"DESC":"ASC";var strMand=(this.mandatory)?"1":"0";var displayColumn=(this.displayColumn=="")?this.distinctColumn:this.displayColumn;var selectColumns=(this.displayColumn=="")?this.distinctColumn:this.distinctColumn+","+this.displayColumn;strParams=_parse_context_vars(strParams,true);if(strParams!=""){strParams+="&";}strParams+="dsn="+this.source;strParams+="&mandatory="+strMand;strParams+="&table="+this.table;strParams+="&columns="+selectColumns;strParams+="&orderdir="+strDesc;strParams+="&orderby="+displayColumn;strParams+="&sessid="+app.session.sessionId;strParams+="&espQueryName="+strQueryName;app.debugstart(this.name+".storedquery [listbox]","FORM CONTROLS");var strURL=app._root+"service/form/combo/getdata/storedquery.php";var strRes=app.trim(app.get_http(strURL,strParams,true,false,null,null));app.debugend(this.name+".storedquery [listbox]","FORM CONTROLS");if(strRes!=""){this._dropdiv.innerHTML=strRes;this._htmltable=this._dropdiv.childNodes[0];}this._dataloaded=true;this.comboAutoUpdate=false;this.element.value=this._beforeloadingvalue;}function _swfc_listbox_fetchdata(){this._beforeloadingvalue=this.element.value;var strMand=(this.mandatory)?"1":"0";if(this._etype==FC_DBPICKLIST){if(this.fetchType==2){this.invokeStoredQuery(this.storedQueryName,this._unparsedFilter);return;}if(this.source.toLowerCase()=="swdata"&&lsession.CheckTableRight(this.table,_CAN_BROWSE_TABLEREC,true)!=""){this._dropdiv.innerHTML="";this._htmltable=null;return false;}this.element.value="Loading...";if(this.displayColumn==""){this.displayColumn=this.distinctColumn;}var strParams="dsn="+this.source;strParams+="&mandatory="+strMand;strParams+="&table="+app.pfu(this.table);strParams+="&filter="+app.pfu(_parse_context_vars(this.filter,true));strParams+="&keycol="+app.pfu(this.distinctColumn);strParams+="&textcol="+app.pfu(this.displayColumn);strParams+="&orderdesc="+app.pfu(this.pickListOrderDesc);app.debugstart(this.name+"._fetchdata [listbox]","FORM CONTROLS");var strURL=app._root+"service/form/combo/getdata/index.php";var strRes=app.trim(app.get_http(strURL,strParams,true,false,null,null));app.debugend(this.name+"._fetchdata [listbox]","FORM CONTROLS");if(strRes!=""){this._dropdiv.innerHTML=strRes;this._htmltable=this._dropdiv.childNodes[0];}}else{app.debugstart(this.name+"._fetchdata [listbox]","FORM CONTROLS");this.element.value="Loading...";var strURL=_parse_context_vars(this.url);var strRes=app.trim(app.get_http(strURL,strParams,true,false,null,null));app.debugend(this.name+"._fetchdata [listbox]","FORM CONTROLS");if(strRes!=""){var oXML=create_xml_dom(strRes);if(oXML){var arrItems=oXML.getElementsByTagName("item");var yLen=arrItems.length;for(var x=0;x<yLen;x++){var strValue=app.xmlText(arrItems[x]);this._addoption(strValue,strValue);}}}this._dataloaded=true;this.comboAutoUpdate=false;}this.element.value=this._beforeloadingvalue;}function _swfc_formflag(oSWFC){oSWFC.value=0;oSWFC.datainitialised=false;oSWFC._setflagvalue=_swfc_formflag_setflagvalue;oSWFC._value=_swfc_formflag_value;oSWFC._text=_swfc_formflag_value;oSWFC._enable=_swfc_formflag_enable;oSWFC._readOnly=_swfc_formflag_readOnly;oSWFC._arrinputs=new Array();oSWFC._arrlabels=new Array();var x=0;while(1==1){var flag=oSWFC.htmldocument.getElementById(oSWFC.name+"_"+x);if(flag!=null){oSWFC._arrinputs[oSWFC._arrinputs.length++]=flag;var alabel=oSWFC.htmldocument.getElementById("lbl_"+oSWFC.name+"_"+x);oSWFC._arrlabels[oSWFC._arrlabels.length++]=alabel;}else{break;}x++;}if(oSWFC.defaultValue!=""&&_primary_key==""&&_formmode=="add"){oSWFC.defaultValue=oSWFC.defaultValue-0;oSWFC._value(oSWFC.defaultValue,oSWFC.defaultValue,false);}}function _swfc_formflag_enable(bEnable){if(bEnable==undefined){return !this.disabled;}this.disabled=(!bEnable);this.enable=bEnable;this.element.disabled=this.disabled;if(!this.disabled){this.element.removeAttribute("DISABLED");}else{this.element.setAttribute("DISABLED","1");}for(var x=0;x<this._arrinputs.length;x++){var aFlag=this._arrinputs[x];if(aFlag!=null){aFlag.disabled=this.disabled;this._arrlabels[x].disabled=this.disabled;if(this.disabled&&!app.isIE){this._arrlabels[x].style.color="#B4B4B4";}else{if(!app.isIE){this._arrlabels[x].style.color="#000000";}}}}}function _swfc_formflag_readOnly(bReadOnly){if(bReadOnly==undefined){return this.readOnly;}this.readOnly=bReadOnly;if(this.enable){for(var x=0;x<this._arrinputs.length;x++){var aFlag=this._arrinputs[x];if(aFlag!=null){aFlag.disabled=this.readOnly;}}}}function _swfc_formflag_value(strValue,strFormattedValue,bFromData){if(strValue==undefined){return this.value;}this._value_initialised=true;if(strValue==""){strValue=0;}if(bFromData){this.datainitialised=true;}if(strValue=="true"){strValue=1;}else{if(strValue=="false"){strValue=0;}}this.value=strValue;this.text=strValue;this.display=strValue;if(this.binding!=""&&!bFromData){if(bFromData==undefined){bFromData=false;}this._form._swdoc._set_data_value(this.value,this.binding,bFromData);}this.value--;this.value++;for(var x=0;x<this._arrinputs.length;x++){var aFlag=this._arrinputs[x];var testBit=aFlag.getAttribute("bitvalue");testBit--;testBit++;if(this.value&testBit){aFlag.setAttribute("checked","true");aFlag.src="images/controls/cb-checked.png";}else{aFlag.setAttribute("checked","false");aFlag.src="images/controls/cb.png";}}}function _swfc_formflag_setflagvalue(oEv,aDoc){if(this.enable==false||this.readOnly==true){return app.stopEvent(oEv);}if(this.value==""){this.value=0;}this.value--;this.value++;var aFlag=app.ev_source(oEv);if(aFlag.tagName=="LABEL"){var strFor=aFlag.id;if(strFor!=""){strFor=strFor.substring(4);var tmpEle=this.htmldocument.getElementById(strFor);if(tmpEle.tagName=="IMG"){aFlag=tmpEle;}}}if(aFlag.tagName=="IMG"){var intFlag=aFlag.getAttribute("bitvalue");intFlag++;intFlag--;var bchecked=aFlag.getAttribute("checked");if(bchecked=="false"){this.value=this.value+intFlag;}else{this.value=this.value-intFlag;}this._value(this.value);this._executejsevent("OnValueChanged",this.value);}}function _swfc_sqltable(oSWFC){oSWFC._datadiv=oSWFC.htmldocument.getElementById(oSWFC.name+"_data");oSWFC._headerdiv=oSWFC.htmldocument.getElementById(oSWFC.name+"_header");oSWFC._pagerdiv=oSWFC.htmldocument.getElementById(oSWFC.name+"_pager");oSWFC._pagerpagenumspan=oSWFC.htmldocument.getElementById(oSWFC.name+"_pagespan");oSWFC._pagerpagenuminput=oSWFC.htmldocument.getElementById(oSWFC.name+"_pageinput");oSWFC._datatable=null;oSWFC.filter=oSWFC.listFilter;oSWFC.rawSql="";oSWFC.curSel=-1;oSWFC.rowCount=_swfc_sqltable_rowcount;oSWFC._rowcount=_swfc_sqltable_rowcount;oSWFC.colCount=0;oSWFC.count=0;oSWFC.selectedCount=0;oSWFC._srcType="sql";oSWFC._phpSrc="";oSWFC._phpParams=new Array();if(oSWFC._jsoncols){oSWFC.colCount=oSWFC._jsoncols.controlInfo.length;}oSWFC.source=oSWFC.sqlSource;oSWFC._source=oSWFC.sqlSource;oSWFC._table=oSWFC.table;oSWFC.bJustAligned=false;oSWFC._currentScrollLeft=0;oSWFC._currentScrollTop=0;oSWFC._filter=_swfc_sqltable_filter;oSWFC._rawSql=_swfc_sqltable_rawsql;oSWFC.fetchType=1;oSWFC.invokeStoredQuery=_swfc_sqltable_storedquery;oSWFC.InvokeStoredQuery=_swfc_sqltable_storedquery;if(oSWFC.storedQuery!=""){oSWFC.fetchType=2;oSWFC.storedQueryParams=oSWFC.filter;oSWFC.storedQueryName=oSWFC.storedQuery;}oSWFC.Reload=_swfc_sqltable_reload;oSWFC.Refresh=_swfc_sqltable_reload;oSWFC.EditRecord=_swfc_sqltable_EditRecord;oSWFC.CreateRecord=_swfc_sqltable_CreateRecord;oSWFC.GetColumnDisplayName=_swfc_sqltable_GetColumnDisplayName;oSWFC.GetColumnName=_swfc_sqltable_GetColumnName;oSWFC.GetItemText=_swfc_sqltable_GetItemText;oSWFC.GetItemTextRaw=_swfc_sqltable_GetItemTextRaw;oSWFC.Initialize=_swfc_sqltable_Initialize;oSWFC.IsRowChecked=_swfc_sqltable_IsRowChecked;oSWFC.IsRowSelected=_swfc_sqltable_IsRowSelected;oSWFC.RemoveRow=_swfc_sqltable_RemoveRow;oSWFC.Reset=_swfc_sqltable_Reset;oSWFC.SetRowChecked=_swfc_sqltable_SetRowChecked;oSWFC.SetRowSelected=_swfc_sqltable_SetRowSelected;oSWFC._previewcolumn="";oSWFC._previewlines=4;oSWFC._expandercol="";oSWFC._expandercolseq="";oSWFC._selectedrows=new Array();oSWFC._checkedrowsbyid=new Array();oSWFC._unparsedFilter=oSWFC.listFilter;oSWFC._currrow=null;oSWFC._autoLoad=oSWFC.autoLoad;oSWFC._limit="";oSWFC._fclimit=200;oSWFC._page=1;oSWFC._totalpagecount=0;oSWFC._bDataFetched=false;oSWFC._NotLoadedAsInvisible=false;oSWFC._bFromColumnOrder=false;oSWFC._hasNoPermissionOnTable=false;oSWFC._fatalerror=false;oSWFC._fatalerror_counter=0;oSWFC._check_rows_aftercolumnorder=_swfc_sqltable_check_rows_aftercolumnorder;oSWFC._showhide_pager=_swfc_sqltable_showhide_pager;oSWFC._processing=_swfc_sqltable_processing;oSWFC._insertrow=_swfc_sqltable_insertrow;oSWFC._RemoveAllRows=_swfc_sqltable_RemoveAllRows;oSWFC._setpageposition=_swfc_sqltable_setpageposition;oSWFC._pageleft=_swfc_sqltable_pageleft;oSWFC._pageright=_swfc_sqltable_pageright;oSWFC._pagestart=_swfc_sqltable_pagestart;oSWFC._pageend=_swfc_sqltable_pageend;oSWFC._match_row_preview=_swfc_sqltable_match_row_preview;oSWFC._get_row_from_preview=_swfc_sqltable_get_row_from_preview;oSWFC._primarykey_value=_swfc_sqltable_primarykey_value;oSWFC._primarykey_name=_swfc_sqltable_primarykey_name;oSWFC._resize_data_area=_swfc_sqltable_resize_data_area;oSWFC._fetchdata=_swfc_sqltable_fetchdata;oSWFC._ondatafetched=_swfc_sqltable_ondatafetched;oSWFC._resizingcol=false;oSWFC._align=_swfc_sqltable_align;oSWFC._scroll=_swfc_sqltable_scroll;oSWFC._getcol=_swfc_sqltable_getcol;oSWFC._getselectcolumns=_swfc_sqltable_getselectcolumns;oSWFC._gethiddencolumns=_swfc_sqltable_gethiddencolumns;oSWFC._get_colwidths=_swfc_sqltable_get_colwidths;oSWFC._rowclick=_swfc_sqltable_rowclick;oSWFC._rowdblclick=_swfc_sqltable_rowdblclick;oSWFC._expanderdblclick=_swfc_sqltable_expanderdblclick;oSWFC._expanderclick=_swfc_sqltable_expanderclick;oSWFC._get_colnum_by_name=_swfc_sqltable_get_colnum_by_name;oSWFC._get_colname_by_num=_swfc_sqltable_get_colname_by_num;oSWFC._getcoltd=_swfc_sqltable_getcoltd;oSWFC._getrowtr=_swfc_sqltable_getrowtr;oSWFC._getheadertd=_swfc_sqltable_getheadertd;oSWFC._getheadercolumns=_swfc_sqltable_getheadercolumns;oSWFC._toggle_row_checked=_swfc_sqltable_toggle_row_checked;oSWFC._toggle_row_selected=_swfc_sqltable_toggle_row_selected;oSWFC._track_headercursor=_swfc_sqltable_track_headercusor;oSWFC._start_headerresize=_swfc_sqltable_start_headerresize;oSWFC._stop_headerresize=_swfc_sqltable_stop_headerresize;oSWFC._stop_tableresize_aftertimeout=_swfc_sqltable_stop_tableresize_aftertimeout;oSWFC._sortcolumn=_swfc_sqltable_sortcolumn;oSWFC.sortDescending=(oSWFC.sortDescending=="false")?false:true;oSWFC._create_bespoke_xmlcols=_swfc_sqltable_create_bespoke_xmlcols;oSWFC._redraw_columns=_swfc_sqltable_redraw_columns;}function _swfc_sqltable_check_rows_aftercolumnorder(){var boolValues=false;for(var strKeyValue in this._checkedrowsbyid){boolValues=true;break;}if(!boolValues){return;}var strPriCol=this._primarykey_name();if(strPriCol==""){return;}var strTestValue="";var rc=this.rowCount();for(var x=0;x<rc;x++){if(this._checkedrowsbyid[this.GetItemTextRaw(x,strPriCol)]){this.SetRowChecked(x,true);}}}function _swfc_sqltable_rowcount(){if(this._NotLoadedAsInvisible){this._fetchdata();}var oTable=app.get_parent_child_by_tag(this._datadiv,"TABLE");if(oTable==null){return 0;}return oTable.rows.length;}function _swfc_sqltable_setpageposition(oEle){if(!isNaN(oEle.value)&&(oEle.value>this._totalpagecount)){this._page=oEle.value;this.Refresh(false,this._page);}else{oEle.value=this._page;}}function _swfc_sqltable_pagestart(oEle,oEv){this._page=1;this.Refresh(false,this._page);}function _swfc_sqltable_pageend(oEle,oEv){this._page=this._totalpagecount;this.Refresh(false,this._page);}function _swfc_sqltable_pageleft(oEle,oEv){if((this._page-1)==0){return;}this._page--;this.Refresh(false,this._page);}function _swfc_sqltable_pageright(oEle,oEv){if((this._page+1)>this._totalpagecount){return;}this._page++;this.Refresh(false,this._page);}function _swfc_sqltable_create_bespoke_xmlcols(arrColumns,bUseLabels){if(bUseLabels==undefined){bUseLabels=true;}this._jsoncols={controlInfo:[]};var yLen=arrColumns.length;for(var x=0;x<yLen;x++){this._jsoncols.controlInfo[x]={};this._jsoncols.controlInfo[x].flags={};this._jsoncols.controlInfo[x].properties={};this._jsoncols.controlInfo[x].flags.allowResize="true";this._jsoncols.controlInfo[x].flags.allowSort="true";this._jsoncols.controlInfo[x].flags.hidden="false";this._jsoncols.controlInfo[x].properties.column=app.trim(arrColumns[x]);if(bUseLabels){this._jsoncols.controlInfo[x].name=app._application_labels[this.table+"."+app.trim(arrColumns[x])];}else{this._jsoncols.controlInfo[x].name=arrColumns[x];}this._jsoncols.controlInfo[x].width=120;this._jsoncols.controlInfo[x].dataColumn=x;}this._redraw_columns();this.colCount=arrColumns.length;}function _swfc_sqltable_redraw_columns(){var arrColumnHeadings=new Array();arrColumnHeadings.push("<table cellspacing='0' cellpadding='0' border='0'><tr>");if(this._jsoncols){var arrCol=this._jsoncols.controlInfo;var aCol=null;var yLen=arrCol.length;for(var x=0;x<yLen;x++){aCol=arrCol[x];var strText=aCol.name;var intWidth=aCol.width;var strCol=aCol.properties.column;if(strText==""){strText=app._application_labels[this.table+"."+strCol];}var jsonFlags=aCol.flags;var bHidden=jsonFlags.hidden;var strStyle=(bHidden=="true")?"style='display:none;'":"";var bAllowResize=jsonFlags.allowResize;var bAllowSort=jsonFlags.allowSort;arrColumnHeadings.push("<td class='headertd' "+strStyle+" allowsort='"+bAllowSort+"'  allowresize='"+bAllowResize+"' width='"+intWidth+"px' style='width:"+intWidth+"px;white-space:noWrap;' dbname='"+strCol+"' noWrap><div class='tdvalue' headerpos='"+x+"'  style='width:"+intWidth+"px;white-space:noWrap;'>"+strText+"</div></td>");}arrColumnHeadings.push("<td style='display:none;'><div></div></td></tr>");}arrColumnHeadings.push("</table>");this._headerdiv.innerHTML=arrColumnHeadings.join("");this._resize_data_area();}function _swfc_sqltable_GetItemText(nRow,nCol){if(this._NotLoadedAsInvisible){this._fetchdata();}if(isNaN(nCol-1)){nCol=this._get_colnum_by_name(nCol);}if(this.rowCount()<1){return"";}var strVal="";var aTD=this._getcoltd(nRow,nCol);if(aTD!=null){strVal=app.eleText(aTD.childNodes[0]);return app.trim(strVal);}return"";}function _swfc_sqltable_GetItemTextRaw(nRow,nCol){if(this._NotLoadedAsInvisible){this._fetchdata();}if(isNaN(nCol-1)){nCol=this._get_colnum_by_name(nCol);}if(this.rowCount()<1){return"";}var strVal="";var aTD=this._getcoltd(nRow,nCol);if(aTD!=null){strVal=app.eleText(aTD.childNodes[1]);if(strVal=="_s_"){strVal=app.eleText(aTD.childNodes[0]);}}return app.trim(strVal);}function _swfc_sqltable_EditRecord(nRow,callback){if(this._NotLoadedAsInvisible){this._fetchdata();}if(nRow==undefined){nRow=this.curSel;}if(nRow==-1){return;}var strKeyValue=this._primarykey_value();if(strKeyValue==""){return;}if(this.editRecordForm==""){this.editRecordForm=pDDTABLES[this.table].editform;}var strParams="fromsqllist=1";var swfc=this;_open_control_form(this.editRecordForm,"edit",strKeyValue,strParams,function(res){swfc.Reload(false);if(callback){callback(res);}});}function _swfc_sqltable_CreateRecord(callback){if(this.addRecordForm==""){this.addRecordForm=pDDTABLES[this.table].addform;}var strParams="fromsqllist=1";var swfc=this;_open_control_form(this.addRecordForm,"add","",strParams,function(res){swfc.Reload(false);if(callback){callback(res);}});}function _swfc_sqltable_GetColumnDisplayName(nCol){if(this._NotLoadedAsInvisible){this._fetchdata();}if(isNaN(nCol-1)){nCol=this._get_colnum_by_name(nCol);}var aCol=this._getcol(nCol);if(aCol==null){return"";}return aCol.text;}function _swfc_sqltable_GetColumnName(nCol){if(this._NotLoadedAsInvisible){this._fetchdata();}if(isNaN(nCol-1)){nCol=this._get_colnum_by_name(nCol);}nCol++;nCol--;return this._get_colname_by_num(nCol);}function _swfc_sqltable_Initialize(){}function _swfc_sqltable_IsRowChecked(nRow){var aRow=this._getrowtr(nRow);if(aRow!=null){return(aRow.getAttribute("checked")=="1");}return false;}function _swfc_sqltable_IsRowSelected(nRow){var aRow=this._getrowtr(nRow);if(aRow!=null){return(aRow.getAttribute("selected")=="1");}return false;}function _swfc_sqltable_RemoveRow(nRow){var aRow=this._getrowtr(nRow);if(aRow!=null){aRow.parentNode.removeChild(aRow);return true;}return false;}function _swfc_sqltable_RemoveAllRows(){var oTable=app.get_parent_child_by_tag(this._datadiv,"TABLE");if(oTable!=null){while(oTable.rows.length>0){var aRow=oTable.rows[oTable.rows.length-1];aRow.parentNode.removeChild(aRow);}this.rowCount(oTable.rows.length);return true;}return false;}function _swfc_sqltable_Reset(){this._RemoveAllRows();}function _swfc_sqltable_SetRowChecked(nRow,bChecked,bRunControlOnCheckedMethod){if(this._NotLoadedAsInvisible){this._fetchdata();}var aRow=this._getrowtr(nRow);if(aRow!=null){if(bRunControlOnCheckedMethod==undefined){bRunControlOnCheckedMethod=true;}this._toggle_row_checked(aRow,bChecked,bRunControlOnCheckedMethod);return true;}return false;}function _swfc_sqltable_SetRowSelected(nRow,bSelected,bKeepSelection){if(this._NotLoadedAsInvisible){this._fetchdata();}var aRow=this._getrowtr(nRow);if(aRow!=null){if(bSelected==undefined){bSelected=true;}if(bKeepSelection==undefined){bKeepSelection=false;}this._toggle_row_selected(aRow,bSelected,bKeepSelection);return true;}return false;}function _swfc_sqltable_rawsql(strRawSQL){if(strRawSQL==undefined){return this._rawSQL;}this.rawSQL=strRawSQL;this.rawSql=strRawSQL;this._fetchdata();}function _swfc_sqltable_resize_data_area(){if(this._datadiv==null){return;}if(this.tabInvisible||!this.visible){return;}var intHeight=this.element.offsetHeight;var intDataHeight=intHeight-this._headerdiv.offsetHeight-this._pagerdiv.offsetHeight;if(intDataHeight>2){this._datadiv.style.height=intDataHeight;}}function _swfc_sqltable_filter(strFilter,bFromFormLoad,intPage){if(bFromFormLoad==undefined){bFromFormLoad=false;}if(strFilter==undefined){return this.listFilter;}if(intPage==undefined){this._page=1;}var strTestFilter=_parse_context_vars(strFilter,true);if(this.filter==strTestFilter&&bFromFormLoad&&this._bDataFetched){return;}this._unparsedFilter=strFilter;this.listFilter=strTestFilter;this.filter=this.listFilter;if(bFromFormLoad&&!this._autoLoad){return false;}if(this.visible==false||this.tabInvisible){this._NotLoadedAsInvisible=true;return;}this._fetchdata();}function _swfc_sqltable_storedquery(strQueryName,strParams){this.fetchType=2;this.storedQueryName=strQueryName;this.storedQueryParams=strParams;var strCB=(this.hasCheckbox)?"1":"0";var strOrderByCol="";var strOrder="";if((this.sortColumn!=-1)&&((this.colCount>this.sortColumn))){strOrder=(this.sortDescending)?"DESC":"ASC";strOrderByCol=this._getcol(this.sortColumn).dbcolumn;}strParams=_parse_context_vars(strParams,true);if(strParams!=""){strParams+="&";}strParams+="columns="+this._getselectcolumns();strParams+="&hiddencolumns="+this._gethiddencolumns();strParams+="&columnwidths="+this._gethiddencolumns();strParams+="&orderby="+strOrderByCol;strParams+="&orderdir="+strOrder;strParams+="&table="+this.table;strParams+="&dsn="+this.source;strParams+="&sessid="+app.session.sessionId;strParams+="&espQueryName="+strQueryName;strParams+="&_limit="+this._limit;strParams+="&_fclimit="+this._fclimit;strParams+="&_page="+this._page;strParams+="&checkbox="+strCB;app.debugstart(this.name+".invokeStoredQuery [sqltable]","FORM CONTROLS");var strURL=app.webroot+"/webclient/service/form/sqllistdata/storedquery.php";this._ondatafetched(app.get_http(strURL,strParams,true,false,null,null));app.debugend(this.name+".invokeStoredQuery [sqltable]","FORM CONTROLS");return true;}function _swfc_sqltable_reload(bFromFormLoad,intPage){this._filter(this._unparsedFilter,bFromFormLoad,intPage);return true;}function _swfc_sqltable_fetchdata(){if(this.fetchType==2){this._NotLoadedAsInvisible=false;this.invokeStoredQuery(this.storedQueryName,this._unparsedFilter);return;}var strCols=this._getselectcolumns();var strHiddenCols=this._gethiddencolumns();var strColWidths=this._get_colwidths();if(strCols==""){return;}if(this.sqlSource==""){return;}if(this.table==""){return;}var strCB=(this.hasCheckbox)?"1":"0";var strParams="dsn="+app.pfu(this.source);if(this.rawSql!=""){strParams+="&rawsql="+app.pfu(this.rawSql);strParams+="&table="+app.pfu(this.table);strParams+="&_limit="+this._limit;strParams+="&_fclimit="+this._fclimit;strParams+="&_page="+this._page;}else{if(this._hasNoPermissionOnTable){this._NotLoadedAsInvisible=false;this._ondatafetched("");return false;}if(this.source.toLowerCase()=="swdata"&&lsession.CheckTableRight(this.table,_CAN_BROWSE_TABLEREC,true)!=""){this._hasNoPermissionOnTable=true;this._NotLoadedAsInvisible=false;this._ondatafetched("");return false;}strParams+="&table="+app.pfu(this.table);strParams+="&filter="+app.pfu(this.filter);strParams+="&columns="+strCols;strParams+="&hiddencolumns="+strHiddenCols;strParams+="&columnwidths="+strColWidths;strParams+="&colcount="+this.colCount;strParams+="&previewcol="+this._previewcolumn;strParams+="&previewlines="+this._previewlines;strParams+="&expandercol="+this._expandercol;strParams+="&expandercolseq="+this._expandercolseq;strParams+="&_limit="+this._limit;strParams+="&_fclimit="+this._fclimit;strParams+="&_page="+this._page;strParams+="&checkbox="+strCB;if((this.sortColumn!=-1)&&((this.colCount>this.sortColumn))){var strOrder=(this.sortDescending)?"DESC":"ASC";strParams+="&orderby="+this._getcol(this.sortColumn).dbcolumn;strParams+="&orderdir="+strOrder;}}this._NotLoadedAsInvisible=false;strParams+="&_sourcetype="+this._srcType;if(this._srcType=="php"){strParams+="&_sourceinclude="+this._phpSrc;for(strParamName in this._phpParams){if(strParams!=""){strParams+="&";}strParams+=strParamName+"="+app.pfu(this._phpParams[strParamName]);}}app.debugstart(this.name+"._fetchdata [sqltable]","FORM CONTROLS");var strURL=app.webroot+"/webclient/service/form/sqllistdata/index.php";this._ondatafetched(app.get_http(strURL,strParams,true,false,null,null));}function _swfc_sqltable_ondatafetched(strTableData){app.debugend(this.name+"._fetchdata [sqltable]","FORM CONTROLS");this._currentScrollLeft=-1;this._currentScrollTop=0;this._currrow=null;this._selectedrows=new Array();if(app.trim(strTableData).indexOf("<?")===0){strTableData="<table cellspacing='0' cellpadding='0' border='0' rc='0' pc='0' pn='0'></table>";}this._datadiv.innerHTML=strTableData;strTableData=null;this.rowCount(0);this.count=0;this.selectedCount=0;var oTable=app.get_parent_child_by_tag(this._datadiv,"TABLE");this._datatable=oTable;if(oTable!=null&&oTable.rows){this.rowCount(oTable.rows.length);this.count=this.rowCount();this._fullrowcount=this._datatable.getAttribute("rc");this._totalpagecount=this._datatable.getAttribute("pc");app.setElementText(this._pagerpagenumspan,this._totalpagecount);this._pagerpagenuminput.value=this._datatable.getAttribute("pn");this._showhide_pager((this._fullrowcount>this._fclimit));}this.curSel=-1;this._bDataFetched=true;this._align();if(!this._bFromColumnOrder){this._checkedrowsbyid=new Array();}}function _swfc_sqltable_showhide_pager(bShow){this._pagerdiv.style.display=(bShow)?"block":"none";this._resize_data_area();}function _swfc_sqltable_gethiddencolumns(){if(this._jsoncols==null){return"";}var strCols="";var arrCols=this._jsoncols.controlInfo;for(var x=0;x<arrCols.length;x++){if(arrCols[x].flags.hidden=="true"){if(arrCols[x].properties){if(strCols!=""){strCols+=",";}strCols+=arrCols[x].properties.column;}}}return strCols;}function _swfc_sqltable_getselectcolumns(){if(this._jsoncols==null){return"";}var strSelect="";var arrCols=this._jsoncols.controlInfo;for(var x=0;x<arrCols.length;x++){if(arrCols[x].properties){if(strSelect!=""){strSelect+=",";}strSelect+=arrCols[x].properties.column;}}return strSelect;}function _swfc_sqltable_getcol(nPos){if(this._jsoncols==null){return -1;}var aCol=this._jsoncols.controlInfo[nPos];if(aCol==undefined||aCol==null){return null;}var strText=aCol.name;var intWidth=aCol.width;var strCol=aCol.properties.column;if(strText==""){strText=app._application_labels[this.table+"."+strCol];}var colNode=new Object();colNode.text=strText;colNode.width=new Number(intWidth);colNode.dbcolumn=strCol;return colNode;}function _swfc_sqltable_sortcolumn(oEv,event){if(this._resizingcol){return;}if(this.rawSql!=""){return;}if(this.disabled){return false;}var orderTD=app.ev_source(oEv);if(orderTD.tagName=="DIV"){orderTD=orderTD.parentNode;}if(orderTD.tagName=="TD"){var bAllowSort=orderTD.getAttribute("allowsort");if(bAllowSort=="false"){return;}var arrCols=this._getheadercolumns();var yLen=arrCols.length;for(var x=0;x<yLen;x++){arrCols[x].className="headertd";}this.sortColumn=orderTD.cellIndex;this.sortDescending=(this.sortDescending==true)?false:true;var strOrder=(this.sortDescending==false)?"ASC":"DESC";orderTD.className="headertd-"+strOrder;this._bFromColumnOrder=true;this.Refresh();this._check_rows_aftercolumnorder();this._bFromColumnOrder=false;this._executejsevent("OnHeaderItemClicked",strOrder,orderTD.cellIndex);}}function _swfc_sqltable_toggle_row_checked(aRow,bChecked,bFromJSCode){if(bFromJSCode==undefined){bFromJSCode=false;}if(!bFromJSCode){if(this.disabled){return false;}}if(bChecked==undefined){var strVal=aRow.getAttribute("checked");if(strVal=="1"){bChecked=false;}else{bChecked=true;}}var strVal=(bChecked)?"1":"0";aRow.setAttribute("checked",strVal);if(bChecked){aRow.cells[0].childNodes[0].className="sl-checkbox-checked";}else{aRow.cells[0].childNodes[0].className="sl-checkbox";}var strKeyValue=this._primarykey_value(aRow.rowIndex);if(strKeyValue!=""){this._checkedrowsbyid[strKeyValue]=bChecked;}if(!bFromJSCode){if(!this._fatalerror){this._executejsevent("OnItemChecked",aRow.rowIndex,bChecked);}}}function _swfc_sqltable_get_row_from_preview(aRow){if(this._previewcolumn!=""){var iRowPos=aRow.rowIndex;if(aRow.getAttribute("type")=="prev"){iRowPos--;}aRow=aRow.parentNode.rows[iRowPos];}return aRow;}function _swfc_sqltable_match_row_preview(aRow){var prevRow=null;if(aRow.getAttribute("type")=="prev"){prevRow=aRow;aRow=aRow.parentNode.rows[prevRow.rowIndex-1];}else{if(this._previewcolumn!=""){prevRow=aRow.parentNode.rows[aRow.rowIndex+1];}}if(prevRow!=null){prevRow.style.color=aRow.style.color;prevRow.style.backgroundColor=aRow.style.backgroundColor;}}function _swfc_sqltable_toggle_row_selected(aRow,bSelected,bKeepSelected){if(bSelected==undefined){bSelected=false;}if(bKeepSelected==undefined||bSelected==false){bKeepSelected=false;}aRow=this._get_row_from_preview(aRow);if(bKeepSelected){if(bSelected!=-1){this._selectedrows[aRow.rowIndex]=bSelected;}if(this._selectedrows[aRow.rowIndex]){aRow.style.backgroundColor="";aRow.style.color="";this._selectedrows[aRow.rowIndex]=false;this._currrow=null;this.curSel=-1;aRow.setAttribute("selected","0");}else{if(this._previewcolumn){aRow.style.backgroundColor="#efefef";}else{aRow.style.backgroundColor="navy";aRow.style.color="#ffffff";}aRow.setAttribute("selected","1");this._currrow=aRow;this._selectedrows[aRow.rowIndex]=true;}}else{for(iRowIndex in this._selectedrows){if(aRow.parentNode.rows[iRowIndex]==undefined){continue;}aRow.parentNode.rows[iRowIndex].style.backgroundColor="";aRow.parentNode.rows[iRowIndex].style.color="";aRow.parentNode.rows[iRowIndex].setAttribute("selected","0");this._match_row_preview(aRow.parentNode.rows[iRowIndex]);}this._selectedrows=new Array();this._currrow=null;this.curSel=-1;if(bSelected==-1||bSelected==true){if(this._previewcolumn){aRow.style.backgroundColor="#efefef";}else{aRow.style.backgroundColor="navy";aRow.style.color="#ffffff";}aRow.setAttribute("selected","1");this._currrow=aRow;this._selectedrows[aRow.rowIndex]=true;this.curSel=aRow.rowIndex;}}this.selectedCount=0;for(strIndex in this._selectedrows){if(this._selectedrows[strIndex]){this.selectedCount++;}}this._match_row_preview(aRow);if(!this._fatalerror){this._executejsevent("OnItemSelected",this.curSel,aRow);}else{this._fatalerror_counter++;if(this._fatalerror_counter>100){this._fatalerror_counter=0;alert("This sql table appears to be stuck in a loop. This is most likely due to a missing column that is being referenced by swjs.\n\nPlease contact your Administrator.");}this._fatalerror=false;}}function _swfc_sqltable_insertrow(arrData,minusLen,strRowID){if(minusLen==undefined){minusLen=0;}if(strRowID==undefined){strRowID="";}var oTable=app.get_parent_child_by_tag(this._datadiv,"TABLE");if(oTable==null){var strColGroup="<colgroup>";for(var x=0;x<=(this.colCount-minusLen);x++){strColGroup+="<col/>";}strColGroup+="</colgroup>";var strTable="<table cellspacing='0' cellpadding='0' border='0'>"+strColGroup+"</table>";this._datadiv.innerHTML=strTable;oTable=app.get_parent_child_by_tag(this._datadiv,"TABLE");}var strAdjustStyle="";var strDataRow="";var aRow=oTable.insertRow(oTable.rows.length);aRow.setAttribute("rowid",strRowID);for(var x=0;x<=(this.colCount-minusLen);x++){strAdjustStyle="tdvalue";if(this._hascheckbox&&x==0){strAdjustStyle="class='sl-checkbox'";}else{strAdjustStyle="tdvalue";}var cell=aRow.insertCell(x);cell.setAttribute("nowrap","true");cell.className="datatd";cell.innerHTML="<div class='"+strAdjustStyle+"'></div><div style='display:none;'>_s_</div>";app.setElementText(cell.childNodes[0],arrData[x]);}this._align();app.addEvent(aRow,"click",_swfc_sqltable_rowclick);app.addEvent(aRow,"dblclick",_swfc_sqltable_rowdblclick);this.rowCount(oTable.rows.length);return aRow;}function _swfc_sqltable_rowclick(aRow,oEv){var swfc=this;if(this.tagName!=undefined){aRow=this;swfc=aRow.parentNode.parentNode.parentNode.parentNode.swfc;}if(swfc.disabled){return false;}if(swfc.hasCheckbox&&oEv!=undefined){var arrMouse=app.findMousePos(oEv);var eLeft=app.eleLeft(aRow);var iStart=(eLeft+5);var iEnd=(eLeft+15);if(arrMouse[0]>iStart&&arrMouse[0]<iEnd){swfc._toggle_row_checked(aRow);return;}}if(oEv==undefined){oEv=new Object();oEv.ctrlKey=false;}swfc._toggle_row_selected(aRow,-1,(swfc.selectionMode==1&&oEv.ctrlKey));}function _swfc_sqltable_expanderclick(aRow,oEv){var swfc=this;ret=swfc._executejsevent("OnExpanderClicked",aRow);}function _swfc_sqltable_expanderdblclick(aRow,oEv){var iExpanded=aRow.getAttribute("expanded");if(iExpanded==null){iExpanded=1;}var swfc=this;ret=swfc._executejsevent("OnExpanderDblClicked",aRow);if(ret==false){return false;}var yLen=aRow.parentNode.rows.length;var cellLen=0;var aTable=aRow.parentNode;if(iExpanded==1){var nextRow=null;var currI=aRow.rowIndex;for(var x=currI+1;x<yLen;x++){nextRow=aTable.rows[x];if(nextRow!=undefined){if(nextRow.getAttribute("type")=="expander"){break;}nextRow.style.display="none";}}aRow.setAttribute("expanded",0);}else{var nextRow=null;var currI=aRow.rowIndex;for(var x=currI+1;x<yLen;x++){nextRow=aTable.rows[x];if(nextRow!=undefined){if(nextRow.getAttribute("type")=="expander"){break;}nextRow.style.display="";}}aRow.setAttribute("expanded",1);}}function _swfc_sqltable_rowdblclick(aRow,oEv){var swfc=this;if(this.tagName!=undefined){aRow=this;swfc=aRow.parentNode.parentNode.parentNode.parentNode.swfc;}if(swfc.disabled){return false;}aRow=swfc._get_row_from_preview(aRow);var nCol=0;var ret=true;swfc.curSel=aRow.rowIndex;if(swfc.curSel>-1){ret=swfc._executejsevent("OnItemDoubleClicked",swfc.curSel,nCol);}if(ret==true){if(swfc._openfile!=undefined){swfc._openfile(swfc.curSel);}else{if(swfc.editRecordForm!=""){var origRowPos=swfc.curSel;swfc.EditRecord(swfc.curSel,function(res){if(this.rowCount()<(origRowPos-1)){origRowPos=0;}this.SetRowSelected(origRowPos);});}}}}function _swfc_sqltable_primarykey_value(intOverrideRowNum){if(this.curSel==-1&&intOverrideRowNum==undefined){return"";}var tempNum=this.curSel;if(intOverrideRowNum!=undefined){this.curSel=intOverrideRowNum;}var arrCols=this._jsoncols.controlInfo;var yLen=arrCols.length;for(var x=0;x<yLen;x++){var aCol=this._getcol(x);if(pDDTABLES[this.table]&&(pDDTABLES[this.table].PrimaryKey.toLowerCase()==aCol.dbcolumn.toLowerCase())){var strKeyValue=this.GetItemTextRaw(this.curSel,pDDTABLES[this.table].PrimaryKey);this.curSel=tempNum;return strKeyValue;}}this.curSel=tempNum;return"";}function _swfc_sqltable_primarykey_name(){var arrCols=this._jsoncols.controlInfo;var yLen=arrCols.length;for(var x=0;x<yLen;x++){var aCol=this._getcol(x);if(pDDTABLES[this.table]&&pDDTABLES[this.table].PrimaryKey.toLowerCase()==aCol.dbcolumn.toLowerCase()){return aCol.dbcolumn;}}return"";}function _swfc_sqltable_get_colwidths(){var strWidth="";var oHeadeTable=app.get_parent_child_by_tag(this._headerdiv,"TABLE");var yLen=oHeadeTable.rows[0].cells.length-1;var tableCells=oHeadeTable.rows[0].cells;for(var x=0;x<yLen;x++){if(strWidth!=""){strWidth+=",";}strWidth+=tableCells[x].offsetWidth;}return strWidth;}function _swfc_sqltable_align(bSkipAlign){if(this.tabInvisible){return;}var oTable=app.get_parent_child_by_tag(this._datadiv,"TABLE");var oHeadeTable=app.get_parent_child_by_tag(this._headerdiv,"TABLE");if(this.element.offsetHeight>0){this._resize_data_area();}var lastCellPos=oHeadeTable.rows[0].cells.length-1;if(lastCellPos==-1){return;}var lastCell=oHeadeTable.rows[0].cells[lastCellPos];lastCell.style.display="none";this._lastcell=lastCell;if(this._currentScrollLeft==-1){this._datadiv.scrollTop=0;this._datadiv.scrollLeft=0;this._currentScrollLeft=0;this._currentScrollTop=0;this.bJustAligned=false;}else{this.bJustAligned=true;this._currentScrollTop=this._datadiv.scrollTop;this._currentScrollLeft=this._datadiv.scrollLeft;}if(oTable!=undefined){oTable.style.width=oHeadeTable.offsetWidth;if(!app.isIE){bSkipAlign=false;}if(bSkipAlign==undefined){bSkipAlign=false;}var iTableWidth=0;var colGroup=app.get_parent_child_by_tag(oTable,"COLGROUP");if(colGroup==null){this._bcodescroll=false;return;}if(!bSkipAlign){var lnopx=app.noPx;var hTD;var dTD;var iTDW=0;var useRow=0;if(oHeadeTable.rows[0].getAttribute("type")=="expander"){useRow=1;}var iClen=oHeadeTable.rows[useRow].cells.length-1;for(var x=0;x<iClen;x++){hTD=oHeadeTable.rows[useRow].cells[x];dTD=colGroup.childNodes[x];if(dTD==undefined){break;}if(hTD.style.display=="none"){dTD.style.display="none";dTD.setAttribute("width",hTD.offsetWidth);dTD.style.width=hTD.offsetWidth;}else{iTDW=(lnopx(hTD.style.width)>hTD.offsetWidth)?lnopx(hTD.style.width):hTD.offsetWidth;iTableWidth+=iTDW;dTD.setAttribute("width",iTDW);dTD.style.width=iTDW;}}oTable.style.width=iTableWidth;}if(!app.isSafari&&!app.isChrome){if(this._datadiv.clientWidth<this._headerdiv.clientWidth){lastCell.style.display="block";try{lastCell.childNodes[0].style.width=this._headerdiv.clientWidth-this._datadiv.clientWidth;}catch(e){}lastCell.style.width=this._headerdiv.clientWidth-this._datadiv.clientWidth;lastCell.setAttribute("width",this._headerdiv.clientWidth-this._datadiv.clientWidth);}this._headerdiv.scrollLeft=this._datadiv.scrollLeft;}else{oTable.style.display="none";__arr_tables[this.name]=this;setTimeout('__showsafaritable("'+this.name+'","'+this._form._name+'")',10);}}}function __aligntablescrolling(eName,frmName){var oe=document[frmName][eName];if(oe){oe._datadiv.scrollTop=oe._currentScrollTop;oe._datadiv.scrollLeft=oe._currentScrollLeft;oe._headerdiv.scrollLeft=oe._datadiv.scrollLeft;}}var __arr_tables=new Array();function __showsafaritable(eName,frmName){var oe=__arr_tables[eName];if(oe==undefined){oe=document[frmName][eName];}if(oe){var oTable=app.get_parent_child_by_tag(oe._datadiv,"TABLE");oTable.style.display="block";var lastCell=oe._lastcell;if(oe._datadiv.clientWidth<oe._headerdiv.clientWidth){lastCell.style.display="block";try{lastCell.childNodes[0].style.width=oe._headerdiv.clientWidth-oe._datadiv.clientWidth;}catch(e){}lastCell.style.width=oe._headerdiv.clientWidth-oe._datadiv.clientWidth;lastCell.setAttribute("width",oe._headerdiv.clientWidth-oe._datadiv.clientWidth);}oe._datadiv.scrollTop=oe._currentScrollTop;oe._datadiv.scrollLeft=oe._currentScrollLeft;oe._headerdiv.scrollLeft=oe._datadiv.scrollLeft;}}function _swfc_sqltable_track_headercusor(oEv,aDoc){if(this._resizingcol&&this._resizetddiv!=null){}else{var iAdjust=this._datadiv.scrollLeft;try{var currTableResizeTD=app.ev_source(oEv);if(currTableResizeTD.tagName=="TD"){currTableResizeTD=currTableResizeTD.childNodes[0];}var iDiff=(app.eleLeft(currTableResizeTD)+currTableResizeTD.offsetWidth)-(app.findMousePos(oEv)[0]+iAdjust);var strInfo=(app.eleLeft(currTableResizeTD)+currTableResizeTD.offsetWidth)+":"+(app.findMousePos(oEv)[0]+iAdjust);var boolOk=false;if(app.isIE){boolOk=(iDiff>2&&iDiff<9);}else{boolOk=(iDiff>-6&&iDiff<-2);}if(boolOk){this._resizetddiv=currTableResizeTD;this._canresizecol=true;if(currTableResizeTD.style.cursor!="col-resize"){currTableResizeTD.style.cursor="col-resize";currTableResizeTD.parentNode.parentNode.style.cursor="col-resize";currTableResizeTD.parentNode.parentNode.parentNode.style.cursor="col-resize";}}else{this._canresizecol=false;if(currTableResizeTD.style.cursor!="default"){currTableResizeTD.style.cursor="default";currTableResizeTD.parentNode.parentNode.style.cursor="default";currTableResizeTD.parentNode.parentNode.parentNode.style.cursor="default";}}}catch(e){}}}function _swfc_sqltable_start_headerresize(oEv,aDoc){if(this._canresizecol){this._resizetddiv.style.cursor="col-resize";this._resizetddiv.parentNode.parentNode.style.cursor="col-resize";this._resizetddiv.parentNode.parentNode.parentNode.style.cursor="col-resize";this._resizingcol=true;_swfc_tablecontrol_resizing=this;}}var _curr_resize_control=null;function _swfc_sqltable_stop_tableresize_aftertimeout(){this._resizingcol=false;}function _swfc_sqltable_stop_headerresize(oEv,aDoc){if(this._resizingcol==false){return;}_curr_resize_control=this;setTimeout("_curr_resize_control._stop_tableresize_aftertimeout()",200);var iAdjust=this._datadiv.scrollLeft;var intNewTDWidth=app.findMousePos(oEv)[0]-app.eleLeft(this._resizetddiv)+iAdjust;if(intNewTDWidth<15){intNewTDWidth=15;}this._resizetddiv.style.cursor="default";this._resizetddiv.parentNode.parentNode.style.cursor="default";this._resizetddiv.parentNode.parentNode.parentNode.style.cursor="default";this._resizetddiv.style.width=intNewTDWidth;this._resizetddiv.parentNode.style.width=intNewTDWidth;this._align();this._resizetddiv=null;}function _swfc_sqltable_scroll(){if(this._datadiv.scrollLeft!=this._headerdiv.scrollLeft){if(this.bJustAligned){this.bJustAligned=false;this._datadiv.scrollLeft=this._currentScrollLeft;this._datadiv.scrollTop=this._currentScrollTop;this._headerdiv.scrollLeft=this._datadiv.scrollLeft;}else{this._headerdiv.scrollLeft=this._datadiv.scrollLeft;}}}function _swfc_sqltable_getheadercolumns(){var aRow=app.get_parent_child_by_tag(this._headerdiv,"TR");if(aRow!=undefined&&aRow!=null){return aRow.cells;}return new Array();}function _swfc_sqltable_getheadertd(nCol){var aRow=app.get_parent_child_by_tag(this._headerdiv,"TR");if(aRow!=undefined&&aRow!=null){if(isNaN(nCol-1)){nCol=this._get_colnum_by_name(nCol);}if(nCol>aRow.cells.length-1){return null;}try{var aTD=aRow.cells[nCol];}catch(e){return null;}if(aTD!=undefined&&aTD!=null){return aTD;}}return null;}function _swfc_sqltable_getcoltd(nRow,nCol){var oTable=app.get_parent_child_by_tag(this._datadiv,"TABLE");if(oTable==null){return null;}var aRow=oTable.rows[nRow];if(aRow!=undefined&&aRow!=null){if(isNaN(nCol-1)){nCol=this._get_colnum_by_name(nCol);}if(nCol==-1){return null;}if(nCol>aRow.cells.length-1){return null;}var aTD=aRow.cells[nCol];if(aTD!=undefined&&aTD!=null){return aTD;}}return null;}function _swfc_sqltable_getrowtr(nRow){var oTable=app.get_parent_child_by_tag(this._datadiv,"TABLE");if(oTable==null){return null;}if(nRow<0){return null;}var aRow=oTable.rows[nRow];if(aRow!=undefined&&aRow!=null){return aRow;}return null;}function _swfc_sqltable_get_colnum_by_name(sCol){var arrCols=this._jsoncols.controlInfo;var yLen=arrCols.length;for(var x=0;x<yLen;x++){var aCol=this._getcol(x);if(aCol.dbcolumn.toLowerCase()==sCol.toLowerCase()){return x;}}this._fatalerror=true;return -1;}function _swfc_sqltable_get_colname_by_num(nCol){var aCol=this._getcol(nCol);if(aCol!=undefined&&aCol!=null){return aCol.dbcolumn;}return"";}function _swfc_menubutton(mnuBtn){mnuBtn._dropped=false;mnuBtn._deactivated=false;mnuBtn._dropdiv=null;mnuBtn.hilite=_swfc_menubutton_hilite;mnuBtn.lolite=_swfc_menubutton_lolite;mnuBtn.click=_swfc_menubutton_click;mnuBtn.option_execute=_swfc_menubutton_option_execute;mnuBtn.option_hilite=_swfc_menubutton_option_hilite;mnuBtn.option_lolite=_swfc_menubutton_option_lolite;mnuBtn.deactivate=_swfc_menubutton_deactivate;mnuBtn._enable=_swfc_menubutton_enable;}function _swfc_menubutton_enable(bEnable){if(bEnable==undefined){return !this.disabled;}this.lolite();this.disabled=(!bEnable);this.element.disabled=this.disabled;if(!app.isIE&&this.element.tagName!="BUTTON"){var mnuTextEle=this.htmldocument.getElementById(this.name+"_menutext");if(mnuTextEle!=null){if(this.disabled){mnuTextEle.style.color="#8f8f8f";}else{mnuTextEle.style.color="#000000";}}}}function _swfc_menubutton_deactivate(){if(this.element.tagName!="BUTTON"){if(this.element.style.backgroundColor==this.backgroundColor){return;}this._dropped=false;}this._deactivated=true;this._dropdiv.style.display="none";this.lolite();}function _swfc_menubutton_hilite(){if(this.disabled){return;}if(this.element.tagName!="BUTTON"){this.element.style.border="1px solid #000000";this.element.style.backgroundColor=this.backgroundColor;}}function _swfc_menubutton_lolite(){if(this.element.tagName=="BUTTON"){return;}if(!this._dropped){this.element.style.border="0px solid #000000";this.element.style.backgroundColor="";}else{this.element.style.backgroundColor="";}}function _swfc_menubutton_option_execute(oRow){if(this.disabled){return;}var strCommandID=oRow.getAttribute("value");strCommandID++;strCommandID--;var strName=oRow.childNodes[1].innerHTML;this._dropdiv.style.display="none";this._dropped=false;this.lolite();this._executejsevent("OnMenuItem",strName,strCommandID);this._form._swdoc._execute_showmeitem(-1,strName);}function _swfc_menubutton_option_hilite(oRow){if(this.disabled){return;}oRow.childNodes[0].style.backgroundColor="#ffeec2";oRow.childNodes[1].style.backgroundColor="#ffeec2";}function _swfc_menubutton_option_lolite(oRow){oRow.childNodes[0].style.backgroundColor="#D8E7FC";oRow.childNodes[1].style.backgroundColor="#f6f6f6";}function _swfc_menubutton_click(eV){if(this.disabled){return;}if(this.commands==""||!isNaN(this.commands)){}else{if(this._deactivated){this._deactivated=false;this._dropped=true;if(this._dropdiv&&this._dropdiv.style.display=="none"){this._dropped=false;}}if(this._dropped){this._dropdiv.style.display="none";this._dropped=false;this._form._arr_open_menubuttons[this.name]=false;}else{if(this._dropdiv==null){var strOptions="";var arrCommands=this.commands.split("|");for(var x=0;x<arrCommands.length-1;x++){var arrMore=arrCommands[x].split("^");if(arrMore[0].indexOf("&&")>-1){arrMore[0]=_regexreplace(arrMore[0],"&&","&");}strOptions+="<tr value='"+arrMore[1]+"' onmouseover='this.parentNode.parentNode.parentNode.swfc.option_hilite(this);' onmouseout='this.parentNode.parentNode.parentNode.swfc.option_lolite(this);' onmousedown='this.parentNode.parentNode.parentNode.swfc.option_execute(this);'><td class='menubutton-option-leftspace' noWrap></td><td class='menubutton-option-text' noWrap>"+arrMore[0]+"</td></tr>";}var strHTML="<div id='"+this.name+"_dropdiv' class='menubutton-dropdiv'><table cellspacing=0 cellpadding=0 border=0>"+strOptions+"</table></div>";insertBeforeEnd(this.htmldocument.body,strHTML);this._dropdiv=this.htmldocument.getElementById(this.name+"_dropdiv");this._dropdiv.swfc=this;}var intWidth=this.position.right-this.position.left;var intHeight=this.position.bottom-this.position.top;this._dropdiv.style.top=this.element.offsetTop-1+intHeight;this._dropdiv.style.left=this.element.offsetLeft;this._dropdiv.style.zIndex=99999999;this._dropdiv.style.display="block";if(app.eleHeight(this.htmldocument.body)<(this._dropdiv.offsetHeight+this._dropdiv.offsetTop)){this._dropdiv.style.top=this.element.offsetTop-this._dropdiv.offsetHeight;}var divRight=this._dropdiv.offsetWidth+this._dropdiv.offsetLeft;if(divRight>this.htmldocument.body.offsetWidth){this._dropdiv.style.left=(this.element.offsetLeft+this.element.offsetWidth)-this._dropdiv.offsetWidth;}this._dropped=true;this._form._arr_open_menubuttons[this.name]=true;}}this._executejsevent("OnPressed");}function _swfc_tabcontrol(oSWFC){oSWFC.tab=0;oSWFC.ShowTabItem=_swfc_tabcontrol_showtabitem;oSWFC.EnableTabItem=_swfc_tabcontrol_enabletabitem;oSWFC.SetTabItemText=_swfc_tabcontrol_SetTabItemText;oSWFC._elements=new Array();oSWFC._associated=false;oSWFC._forceShow=false;oSWFC._activatetab=_swfc_tabcontrol_activatetab;oSWFC._tab=_swfc_tabcontrol_tab;oSWFC._draw=_swfc_tabcontrol_draw;oSWFC._initialise_elements=_swfc_tabcontrol_initialise;oSWFC._hide=_swfc_tabcontrol_hide;oSWFC._show=_swfc_tabcontrol_show;oSWFC._tiHide=_swfc_tabcontrol_item_hide;oSWFC._tiShow=_swfc_tabcontrol_item_show;oSWFC._align_innerelements=_swfc_tabcontrol_align_innerelements;oSWFC._scroll_tabitems=_swfc_tabcontrol_scroll_tabitems;}function _swfc_tabcontrol_SetTabItemText(nTab,strText){var eTabItems=this.htmldocument.getElementById(this.name+"_tabitems");if(eTabItems.childNodes[nTab-1+2]){app.setElementText(eTabItems.childNodes[nTab-1+2],strText);}}function _swfc_tabcontrol_draw(bDrawnAlready){if(!bDrawnAlready){var intWidth=this.position.right-this.position.left;var intHeight=this.position.bottom-this.position.top;var iZindex=10+(this.appearance.index-1+1);var strStyleAtts="overflow:hidden;position:absolute;z-Index:"+iZindex+";width:"+intWidth+"px;height:"+intHeight+"px;top:"+(this.position.top)+"px;left:"+this.position.left+"px;";var arrHTML=new Array();arrHTML.push("<div id='"+this.name+"' style="+strStyleAtts+">");var arrSpans=new Array();var strTabBgColor=this.appearance.foregroundColor;var strTabBgInactiveColor="#FEFEFE";var strColor=this.selectedTextColor;var strInactiveColor=this.deselectedTextColor;if(strColor==""||strColor=="#000000"){strColor="#696969";}if(strInactiveColor==""||strInactiveColor=="#000000"){strInactiveColor="#696969";}var firstVisibleTab=-1;var iSpanTop=(!app.isIE)?5:4;for(var x=0;x<this._items.length;x++){var strDisabled="";var strInvis="inline";var strDisplay=this._items[x].name;if(strDisplay.indexOf("&&")>-1){strDisplay=_regexreplace(strDisplay,"&&","&");}var jFlags=undefined;if(this._items[x].controlInfo){jFlags=this._items[x].controlInfo.flags;}if(jFlags!=undefined){strDisabled=jFlags.disabled=="true"?"enabled='false'":"";strInvis=jFlags.invisible=="true"?"none":"inline";if(strInvis=="inline"&&firstVisibleTab==-1){firstVisibleTab=x;}}else{if(firstVisibleTab==-1){firstVisibleTab=x;}}if(this.tabStyle=="2"){var strTabBgColor=this._items[x].controlInfo.properties.tabColor;var strColor=this._items[x].controlInfo.properties.activeTextColor;var strInactiveColor=this._items[x].controlInfo.properties.inactiveTextColor;strTabBgInactiveColor=strTabBgColor;if(strColor==undefined){strColor="#696969";}if(strInactiveColor==undefined){strInactiveColor="#696969";}var strUseColor=(x==0)?strColor:strInactiveColor;var strUseBgColor=strTabBgColor;}else{var strUseColor=(x==0)?strColor:strInactiveColor;var strUseBgColor=(x==0)?strTabBgColor:strTabBgInactiveColor;}if(strDisabled!=""){strUseColor="#A5A5A5";}arrSpans.push("<span ntab='"+x+"' activebg='"+strTabBgColor+"' inactivebg='"+strTabBgInactiveColor+"' inactivecolor='"+strInactiveColor+"' activecolor='"+strColor+"' onclick='this.parentNode.parentNode.swfc._activatetab(this);' style='"+this._get_font_style()+";color:"+strUseColor+";display:"+strInvis+";z-Index:6;margin-right:5px;margin-left:0px;background:"+strUseBgColor+";cursor:default;position:relative;top:"+iSpanTop+"px;z-Index:99999999;border:1px solid #D5D4DF;padding:2px 5px 2px 3px;' "+strDisabled+">"+strDisplay+"</span>");}arrHTML.push("<div  id='"+this.name+"_tabitems' class='tabcontrol-items-holder'><span style='width:3px;'></span>"+arrSpans.join("")+"</div>");arrHTML.push("<div  id='"+this.name+"_tabitems_scroll' class='tabcontrol-items-holder-scroll' style='visibility:hidden;' onmousedown='this.parentNode.swfc._scroll_tabitems(this,event,true);' onmouseup='this.parentNode.swfc._scroll_tabitems(this,event,false);'></div>");if(app.isIE){var strAreaStyleAtts="position:relative;top:0px;z-Index:0;border:1px solid #D5D4DF;width:"+intWidth+"px;height:"+(intHeight-22)+"px;";}else{var strAreaStyleAtts="position:relative;top:0px;z-Index:0;border:1px solid #D5D4DF;width:"+intWidth+"px;height:"+(intHeight-50)+"px;";}arrHTML.push("<div id='"+this.name+"_tabarea' style='"+strAreaStyleAtts+"'></div>");arrHTML.push("</div>");insertBeforeEnd(this.htmldocument.body,arrHTML.join(""));}this._element();this.element.swfc=this;if(!bDrawnAlready){this.tab=firstVisibleTab;if(this.tab==-1){this.tab=0;}this.tab--;this.tab++;var eTabItems=this.htmldocument.getElementById(this.name+"_tabitems");eTabItems.childNodes[this.tab+1].style.borderBottom="1px solid "+eTabItems.childNodes[this.tab+1].getAttribute("activebg");eTabItems.childNodes[this.tab+1].style.background=eTabItems.childNodes[this.tab+1].getAttribute("activebg");}else{for(var x=0;x<this._items.length;x++){var jFlags=undefined;if(this._items[x].controlInfo){jFlags=this._items[x].controlInfo.flags;}if(jFlags!=undefined){if(jFlags.invisible!="true"){this.tab=x;break;}}else{this.tab=x;break;}}}}function _swfc_tabcontrol_enabletabitem(nTab,bEnable){var eTabItems=this.htmldocument.getElementById(this.name+"_tabitems");if(eTabItems.childNodes[nTab-1+2]){var span=eTabItems.childNodes[nTab-1+2];span.setAttribute("enabled",bEnable);if(nTab==this.tab){span.style.color=(bEnable)?span.getAttribute("activecolor"):"#A5A5A5";}else{span.style.color=(bEnable)?span.getAttribute("inactivecolor"):"#A5A5A5";}}}function _swfc_tabcontrol_showtabitem(nTab,bShow,bShowOnFormDraw){if(bShowOnFormDraw==undefined){bShowOnFormDraw=false;}var htmlTabItemPos=nTab-1+2;var eTabItems=this.htmldocument.getElementById(this.name+"_tabitems");if(eTabItems.childNodes[htmlTabItemPos]==undefined){return;}eTabItems.childNodes[htmlTabItemPos].style.display=(bShow==false||bShow==0)?"none":"";var eScroll=this.htmldocument.getElementById(this.name+"_tabitems_scroll");if(eScroll!=null){try{eScroll.style.visibility=(app.isWidthOverflowing(eTabItems))?"visible":"hidden";}catch(e){}}if(!bShow){if(this.tab==htmlTabItemPos-1){for(var x=1;x<eTabItems.childNodes.length;x++){if(eTabItems.childNodes[x].style.display!="none"){this._tab(x-1);break;}}}}else{if(bShowOnFormDraw||(!this._visible()&&!bShowOnFormDraw)){if(this._tabcontrol&&this._tabcontrol.tab>0){this._forceShow=true;}this._tab(nTab);}else{if(this.tab!=nTab){var intVisibleItems=0;for(var x=1;x<eTabItems.childNodes.length;x++){if(eTabItems.childNodes[x].style.display!="none"){intVisibleItems++;}}if(intVisibleItems==1){this._tab(nTab);}}}}}function _swfc_tabcontrol_activatetab(aTab){if(aTab.getAttribute("enabled")=="false"||aTab.getAttribute("enabled")==false||aTab.getAttribute("enabled")=="0"){return;}var nTab=aTab.getAttribute("ntab");this._tab(nTab);nTab--;nTab++;this._executejsevent("OnTabSelected",nTab);}function _swfc_tabcontrol_tab(nTab){var eTabItems=this.htmldocument.getElementById(this.name+"_tabitems");if(this.tab!=nTab){var spanTab=eTabItems.childNodes[this.tab-1+2];spanTab.style.borderBottom="1px solid #D5D4DF";spanTab.style.color=spanTab.getAttribute("inactivecolor");spanTab.style.background=spanTab.getAttribute("inactivebg");}this.tab=nTab;this.tab--;this.tab++;this._show();}function _swfc_tabcontrol_hide(){for(var strID in this._elements){this._elements[strID]._tabvisible(false);}}function _swfc_tabcontrol_item_hide(nTab){var strID="";for(strID in this._elements){var arrGroup=this._elements[strID].group.split(":");var eTabName=arrGroup[0];var eTabPos=new Number(arrGroup[1]);if(eTabPos==nTab){this._elements[strID]._tabvisible(false);}}}function _swfc_tabcontrol_item_show(nTab){var strID="";for(strID in this._elements){var arrGroup=this._elements[strID].group.split(":");var eTabName=arrGroup[0];var eTabPos=new Number(arrGroup[1]);if(eTabPos==nTab){this._elements[strID]._tabvisible(true);}}}function _swfc_tabcontrol_show(){if(this._tabcontrol!=null&&!this._forceShow){var arrGroup=this.group.split(":");var eTabName=arrGroup[0];var eTabPos=new Number(arrGroup[1]);if(this._tabcontrol.tab!=eTabPos||!this._tabcontrol._visible()||!this._tabcontrol._tabvisible()){return;}}var iHtmlTabPos=this.tab-1+2;var eTabArea=this.htmldocument.getElementById(this.name+"_tabarea");var eTabItems=this.htmldocument.getElementById(this.name+"_tabitems");eTabArea.style.background=eTabItems.childNodes[iHtmlTabPos].getAttribute("activebg");eTabItems.childNodes[iHtmlTabPos].style.borderBottom="1px solid "+eTabItems.childNodes[iHtmlTabPos].getAttribute("activebg");eTabItems.childNodes[iHtmlTabPos].style.background=eTabItems.childNodes[iHtmlTabPos].getAttribute("activebg");eTabItems.childNodes[iHtmlTabPos].style.color=eTabItems.childNodes[iHtmlTabPos].getAttribute("activecolor");for(var strID in this._elements){var arrGroup=this._elements[strID].group.split(":");var eTabName=arrGroup[0];var eTabPos=new Number(arrGroup[1]);if(eTabPos!=this.tab){this._elements[strID]._tabvisible(false);}else{this._elements[strID]._tabvisible(true);}}}function _swfc_tabcontrol_initialise(){for(var strID in this._form.namedelements){if(this._form.namedelements[strID].group==""){continue;}var arrGroup=this._form.namedelements[strID].group.split(":");var eTabName=arrGroup[0];var eTabPos=new Number(arrGroup[1]);if(eTabName.toLowerCase()==this.name.toLowerCase()){this._form.namedelements[strID]._tabcontrol=this;this._elements[strID]=this._form.namedelements[strID];}}}function _swfc_tabcontrol_scroll_tabitems(oEle,oEv,bScroll){if(!bScroll){_current_scroll_div=null;return;}var eItems=this.htmldocument.getElementById(this.name+"_tabitems");if(eItems!=null){if(app.isWidthOverflowing(eItems)){var eScroll=this.htmldocument.getElementById(this.name+"_tabitems_scroll");if(eScroll!=null){var iMouseLeft=app.findMousePos(oEv)[0];var lpos=iMouseLeft-app.eleLeft(eScroll);_current_scroll_div=eItems;if(lpos>0&&lpos<4){_scroll_tab(true);}else{if(lpos>10&&lpos<15){_scroll_tab(false);}}}}}}var _current_scroll_div=null;function _scroll_tab(bLeft){if(_current_scroll_div==null){return;}if(bLeft){if(_current_scroll_div.scrollLeft==0){return;}_current_scroll_div.scrollLeft=_current_scroll_div.scrollLeft-5;setTimeout("_scroll_tab(true)",20);}else{_current_scroll_div.scrollLeft=_current_scroll_div.scrollLeft+5;setTimeout("_scroll_tab(false)",20);}}function _swfc_tabcontrol_align_innerelements(intParentWidth,intParentHeight){if(intParentHeight<1){return;}var eTabArea=this.htmldocument.getElementById(this.name+"_tabarea");if(!isNaN(intParentWidth)){if(app.isIE){eTabArea.style.width=intParentWidth-2;}else{eTabArea.style.width=intParentWidth-2;}}if(!isNaN(intParentHeight)){if(app.isIE){eTabArea.style.height=intParentHeight-22;}else{eTabArea.style.height=intParentHeight-22;}}var eItems=this.htmldocument.getElementById(this.name+"_tabitems");if(eItems!=null){eItems.style.width=intParentWidth-24;var eScroll=this.htmldocument.getElementById(this.name+"_tabitems_scroll");if(eScroll!=null){try{eScroll.style.left=intParentWidth-20;eScroll.style.visibility=(app.isWidthOverflowing(eItems))?"visible":"hidden";}catch(e){}}}}function _swfc_filetable(oSWFC){oSWFC.AddLocalFile=_swfc_filetable_addlocalfile;oSWFC.AddFiles=_swfc_filetable_addfile;oSWFC.RemoveFile=_swfc_filetable_removefile;oSWFC.DeleteFile=_swfc_filetable_deletefile;oSWFC.RemoveSelectedFiles=_swfc_filetable_removeselectedfiles;oSWFC.GetItemText=_swfc_sqltable_GetItemTextRaw;oSWFC.AddAttachment=_swfc_sqltable_AddAttachment;oSWFC.MailSelectedFiles=_swfc_sqltable_MailSelectedFiles;oSWFC.SaveAs=_swfc_sqltable_SaveAs;oSWFC.Refresh=_swfc_filetable_refresh;oSWFC.Reload=_swfc_filetable_refresh;oSWFC._fileuploadform=null;oSWFC._openfile=_swfc_filetable_openfile;oSWFC.OpenFile=_swfc_filetable_openfile;oSWFC._getuploadform=_swfc_filetable_getuploadform;oSWFC._useraddedfile=_swfc_filetable_useraddedfile;oSWFC._uploadfile=_swfc_filetable_uploadfile;oSWFC._onfileuploaded=_swfc_filetable_onfileuploaded;oSWFC._fileuploadservicepath="";oSWFC._getcallattachments=_swfc_filetable_getcallattachments;oSWFC._deletecallattachment=_swfc_filetable_deletecallattachment;oSWFC._uploadtype=_formtype;}function _swfc_filetable_removefile(nRow){if(this._autoLoad){this.DeleteFile(nRow);}else{this.RemoveRow(nRow);}}function _swfc_sqltable_SaveAs(){this.OpenFile();return rue;}function _swfc_sqltable_MailSelectedFiles(){var arrFileNames=new Array();for(var x=0;x<this.rowCount();x++){if(this.IsRowSelected(x)){arrFileNames.push(this.GetItemTextRaw(x,0));}}var arrSpecial=new Array();arrSpecial["attachments"]=arrFileNames.join(",");arrSpecial["attachmentsformid"]=_uniqueformid;app._newEmail(arrSpecial);}function _swfc_sqltable_AddAttachment(oFileAtt){if(this._uploadtype=="cdf"){alert("filelist.AddAttachment : Is not supported by the webclient");return;}var arrValues=new Array();var arrFileType=oFileAtt.filename.split(".");if(oFileAtt.timestamp==""){oFileAtt.timestamp=app._formatDate(new Date(),"y/MM/d HH:mm");}if(this._uploadtype=="lcf"){arrValues[0]=oFileAtt.filename;arrValues[1]=app.getByteSize(oFileAtt.filesize);arrValues[2]=app.getFileTypeInformation(arrFileType[arrFileType.length-1]);if(arrValues[0]==arrValues[2]){arrValues[2]="";}arrValues[3]=oFileAtt.timestamp;arrValues[4]=lsession.analystid;this._insertrow(arrValues,0);}else{arrValues[0]=oFileAtt.filename;arrValues[1]=app.getByteSize(oFileAtt.filesize);arrValues[2]=oFileAtt.timestamp;arrValues[3]="N/A";this._insertrow(arrValues,1);}}function _swfc_filetable_addlocalfile(){alert("AddLocalFile is not supported by the webclient.");}function _swfc_filetable_openfile(nRow,bSaveAs,optFileName,optFileSaveAs){if(bSaveAs==undefined){bSaveAs=false;}var strSave=(bSaveAs)?"save":"view";if((this._uploadtype=="lcf"||this._uploadtype=="cdf")&&!lsession.HaveRight(ANALYST_RIGHT_A_GROUP,ANALYST_RIGHT_A_CANREADFILESONCALLS,true)){return;}if(!confirm("You have chosen to "+strSave+" a file that resides on the server. Depending on the file size this may take a while to process. \n\nDo you want to continue? ")){return false;}var strFileName=(optFileName!=undefined)?optFileName:this.GetItemTextRaw(nRow,0);if(strFileName!=""){if(strFileName.indexOf("http:")==0||strFileName.indexOf("https:")==0){window.open(strFileName);return;}else{if(this._getrowtr(nRow)){var rowid=this._getrowtr(nRow).getAttribute("rowid");}var strParams="swsessionid="+app._swsessionid+"&_filename="+app.pfu(strFileName)+"&_uniqueformid="+_uniqueformid+"&_rowid="+app.pfu(rowid);if(this._uploadtype=="lcf"){var strURL=app._root+"service/fileopen/lcf.php?"+strParams;}else{if(this._uploadtype=="cdf"){if(strFileName.toLowerCase().indexOf(".swm")>0){if(!app.global.IsConnectedToMailServer()){alert("The Supportworks mail server is not running and as such the swm file cannot be opened. Please contact your Administrator");return;}var strParams="_callref="+this._form._swdoc.opencall.callref+"&_rowid="+app.pfu(rowid);app._open_system_form("_sys_swm_form","mail","",strParams,false,null,null,window,250,250);return;}else{strParams+="&_callref="+this._form._swdoc.opencall.callref;var strURL=app._root+"service/fileopen/cdf.php?"+strParams;}}else{var strUNCPath=_parse_context_vars(this.path);strParams+="&_uncpath="+app.pfu(strUNCPath);if(optFileSaveAs!=undefined){strParams+="&_filesaveas="+app.pfu(optFileSaveAs);}var strURL=app._root+"service/fileopen/stf.php?"+strParams;}}}var oIF=this.htmldocument.getElementById("iframe_fileopener");if(oIF==null){var strIframeHTML="<iframe src='javascript:false;' id='iframe_fileopener' name='iframe_fileopener' style='display:none;z-Index:999999;position:absolute;'></iframe>";app.insertBeforeEnd(this.htmldocument.body,strIframeHTML);oIF=this.htmldocument.getElementById("iframe_fileopener");if(oIF==null){alert("The filetable form control ["+this.name+"] was not able to open the file. Please contact your Administrator.");return;}}oIF.src=strURL;}}function _swfc_filetable_getopenfileform(){if(this._fileopenfileform!=null){return this._fileopenfileform;}var strFormName=this.name+"_fileopenerform";this._fileopenfileform=this.htmldocument.getElementById(strFormName);return this._fileopenfileform;}function _swfc_filetable_deletefile(nRow,bMessage,strOptFile){if(bMessage==undefined){bMessage=false;}if(bMessage){if(confirm("Are you sure you want to remove the selected file?")==false){return;}}var strFileName=(strOptFile!=undefined)?strOptFile:this.GetItemTextRaw(nRow,0);var strURL=app._root+"service/fileupload/remove.php";var strParams="_filename="+app.pfu(strFileName)+"&_uniqueformid="+_uniqueformid;var strRes=app.get_http(strURL,strParams,true,false,null,null);this.RemoveRow(nRow);}function _swfc_filetable_removeselectedfiles(nRow,bMessage){if(bMessage==undefined){bMessage=false;}if(bMessage){if(confirm("Are you sure you want to remove the selected files?")==false){return;}}for(var x=0;x<this.rowCount();x++){if(this.IsRowSelected(x)){if(this._autoLoad){this.DeleteFile(x);}else{this.RemoveFile(x);}}}}function _swfc_filetable_addfile(uploadType,strPrefixFileName){var oForm=this._getuploadform();if(uploadType==undefined){uploadType="STF";}this._prefixfilename=strPrefixFileName;var boolCheckAttachCallFilePermission=(uploadType=="cdf"||uploadType=="lfc");this._uploadtype=uploadType;if(boolCheckAttachCallFilePermission&&!app.session.HaveRight(ANALYST_RIGHT_A_GROUP,ANALYST_RIGHT_A_CANATTACHFILESTOCALLS,true)){return;}if(!app.isIE){var swc=this;var arrField=new Array();arrField["filecontrol"]=this;arrField["_uniqueformid"]=_uniqueformid;arrField["_prefixfilename"]=strPrefixFileName;arrField["_top"]=top;app._open_system_form("fileupload.php","fileupload","","",true,function(popupForm){if(popupForm._uploadfilenode==null){return;}oForm.appendChild(popupForm._uploadfilenode);swc._uploadfile();},null,window,400,20,arrField);return;}if(this._autoLoad==false&&(this._uploadtype!="lcf"&&this._uploadtype!="cdf")){var arrInputs=app.get_children_by_att_value(this._fileuploadform,"type","file",true);var strName="swfileupload_"+new Number(arrInputs.length+1);var eFile=this.htmldocument.createElement("input");if(eFile!=null){eFile.swfc=this;eFile.setAttribute("type","file");eFile.setAttribute("name",strName);app.addEvent(eFile,"change",this._useraddedfile);if(app.isIE6||app.isIE7){oForm.insertAdjacentElement("beforeEnd",eFile);}else{oForm.appendChild(eFile);}eFile.click();}}else{var eFile=app.getEleDoc(oForm).getElementById("swfileupload_1");if(eFile){oForm.removeChild(eFile);}eFile=this.htmldocument.createElement("input");eFile.swfc=this;eFile.setAttribute("type","file");eFile.setAttribute("name","swfileupload_1");eFile.setAttribute("id","swfileupload_1");app.addEvent(eFile,"change",this._useraddedfile);if(app.isIE6||app.isIE7){oForm.insertAdjacentElement("beforeEnd",eFile);}else{oForm.appendChild(eFile);}eFile.click();}return true;}function _swfc_filetable_uploadfile(){var swFC=this;swFC._processing(true);var eFileList=swFC.element;if(eFileList==null){return;}var strUNCPath=_parse_context_vars(swFC.path);if(strUNCPath=="undefined"){strUNCPath="";}var oForm=swFC._getuploadform();if(swFC._prefixfilename==undefined){swFC._prefixfilename="";}if(oForm.getAttribute("defined")!="1"){oForm.setAttribute("defined","1");var strPathEle="<input type='input' id='swuploadfile_copytopath' name='swuploadfile_copytopath' value='"+strUNCPath+"'>";var strSessEle="<input type='input' name='swsessionid' value='"+app._swsessionid+"'>";var strCallEle="<input type='input' name='swfileuploadcallbackfunctionid' value='"+swFC.name+"'>";var strUniqEle="<input type='input' name='_uniqueformid' value='"+_uniqueformid+"'>";var strPrefixFileName="<input type='input' name='_prefixfilename' value='"+swFC._prefixfilename+"'>";var strUploadTypeEle="<input type='input' name='_uploadtype' value='"+swFC._uploadtype+"'>";app.insertBeforeEnd(oForm,strPathEle);app.insertBeforeEnd(oForm,strSessEle);app.insertBeforeEnd(oForm,strCallEle);app.insertBeforeEnd(oForm,strUniqEle);app.insertBeforeEnd(oForm,strPrefixFileName);app.insertBeforeEnd(oForm,strUploadTypeEle);}else{for(var x=0;x<oForm.childNodes.length;x++){if(oForm.childNodes[x].name=="swuploadfile_copytopath"){oForm.childNodes[x].value=strUNCPath;}else{if(oForm.childNodes[x].name=="_prefixfilename"){oForm.childNodes[x].value=swFC._prefixfilename;}}}}var strAction="service/fileupload/index.php";if(swFC._fileuploadservicepath!=""){strAction=swFC._fileuploadservicepath;}oForm.setAttribute("action",app._root+strAction);var oIF=app.getEleDoc(oForm).getElementById("iframe_fileuploader");if(oIF==null){var strIframeHTML="<iframe src='javascript:false;' id='iframe_fileuploader' name='iframe_fileuploader' style='display:none;'></iframe>";app.insertBeforeEnd(app.getEleDoc(oForm).body,strIframeHTML);}top.__arr_fileupload_callbacks[swFC.name]=new Object();top.__arr_fileupload_callbacks[swFC.name].filelist=swFC;oForm.submit();}function _swfc_filetable_getuploadform(){if(this._fileuploadform!=null){return this._fileuploadform;}var oIF=this.htmldocument.getElementById(this.name+"_iframe_fileuploader");if(oIF==null){alert("filetable : _getuploadform\n\nThe iframe fileuploader does not exist. Please contact your Administrator.");}oIF=(oIF.contentWindow)?oIF.contentWindow:(oIF.contentDocument.document)?oIF.contentDocument.document:oIF.contentDocument;var strFormName=this.name+"_fileform";var strForm='<body><form id="'+strFormName+'" style="display:none;position:absolute;top:0px;left:0px;"  encType="multipart/form-data" method="POST" target="iframe_fileuploader"></form></body>';oIF.document.open();oIF.document.write(strForm);oIF.document.close();this._fileuploadform=oIF.document.getElementById(strFormName);return this._fileuploadform;}function _swfc_filetable_onfileuploaded(iResult,strFileName,strFileSize,strFileDate,strWebPath,strOrigFileName){this._processing(false);if(iResult!=1){if(iResult==0){iResult="There was a problem uplaoding the selected file";}if(iResult==-1){iResult="The uploaded file type has been restricted by the Supportworks security settings";}alert(iResult+". Please contact your administrator");return;}var strFilePath=_parse_context_vars(this.path)+"\\"+strFileName;var arrFileType=strFileName.split(".");var strFileType=arrFileType[arrFileType.length-1];var arrValues=new Array();if(this._uploadtype=="lcf"){arrValues[0]=strFileName;arrValues[1]=strFileSize;arrValues[2]=app.getFileTypeInformation(strFileType);if(arrValues[0]==arrValues[2]){arrValues[2]="";}arrValues[3]=strFileDate;arrValues[4]=lsession.analystid;this._insertrow(arrValues,0);}else{if(this._uploadtype=="cdf"){var hdcon=new HelpdeskSession(_swdoc._uniqueformid);hdcon.BeginUpdateCall(_swdoc.opencall.callref);hdcon.SendNumber("timespent",1);hdcon.SendBoolean("publicupdate",false);hdcon.SendValue("updatedb.udsource","File Attachment");hdcon.SendValue("updatedb.udcode","Attached File");hdcon.SendText("updatedb.updatetxt","The "+strFileName+" file has been added to the call by "+lsession.analystid);hdcon.SendFile(strFileName);hdcon.Commit();if(hdcon.GetResult()){this._getcallattachments();}else{alert("Failed to attach file to the call record. Please contact your administrator.");}hdcon.Close();}else{arrValues[0]=strFileName;arrValues[1]=strFileSize;arrValues[2]=strFileDate;arrValues[3]="N/A";this._insertrow(arrValues,1);}}strWebPath=app.webroot+"/webclient/"+strWebPath+"/"+strFileName;this._executejsevent("OnFileUploaded",strFileName,strFileType,strFileSize,strFileDate,strWebPath,strOrigFileName);}function _swfc_filetable_uploadallfiles(){swFC._uploadfile();}function _swfc_sqltable_processing(boolOn){if((boolOn)&&(this.element.style.display=="none"||this.element.style.visibility=="hidden")){return;}var imgID=this.name+"_procimg";var processingicon=this.htmldocument.getElementById(imgID);if(boolOn){if(processingicon==null){var strSRC="images/controls/processing.gif";var strIMG="<div style='position:absolute;z-Index:99999999;'><img id='"+imgID+"' src='"+strSRC+"' style='position:absolute;z-Index:9999;'></div>";insertBeforeEnd(this.htmldocument.body,strIMG);processingicon=this.htmldocument.getElementById(imgID);}processingicon.style.top=app.eleTop(this.element)+(this.element.offsetHeight/2)-4;processingicon.style.left=app.eleLeft(this.element)+(this.element.offsetWidth/2)-4;}else{if(processingicon!=null){processingicon.parentNode.removeChild(processingicon);}}}function _swfc_filetable_useraddedfile(){var aBtn=this;var swFC=this.swfc;var oForm=swFC._getuploadform();if(oForm!=null){var eFileList=swFC.element;if(eFileList==null){return;}if(swFC._uploadtype.toLowerCase()=="cid"){var _arr_images=new Array();_arr_images["png"]=1;_arr_images["gif"]=1;_arr_images["jpg"]=1;_arr_images["jpeg"]=1;_arr_images["bmp"]=1;_arr_images["ico"]=1;_arr_images["tif"]=1;_arr_images["tiff"]=1;var arrInfo=aBtn.value.split("\\");var strFilename=arrInfo[arrInfo.length-1];var arrFileInfo=strFilename.split(".");var strFileType=arrFileInfo[arrFileInfo.length-1];if(_arr_images[strFileType.toLowerCase()]==undefined){alert("Only images can be inserted as inline content.\nPlease select a supported image type:-\n\nbmp, gif, jpg, jpeg, ico, png");return false;}}var strUNCPath=_parse_context_vars(swFC.path);if(swFC._autoLoad||swFC._uploadtype=="lcf"||swFC._uploadtype=="cdf"){swFC._uploadfile();}else{var arrInfo=aBtn.value.split("\\");var strFilename=arrInfo[arrInfo.length-1];var arrFileInfo=strFilename.split(".");var strFileType=arrFileInfo[arrFileInfo.length-1];if(strUNCPath!=""){var strFilePath=strUNCPath+"\\"+strFilename;}else{var strFilePath="localmachine\\"+strFilename;}var arrValues=new Array();arrValues[0]=strFilename;arrValues[1]="n/a";arrValues[2]=app._formatDate(new Date(),"yyyy-MM-dd hh:mm:ss");arrValues[3]=strFilePath;arrValues[4]=app.getFileTypeInformation(strFileType);arrValues[5]=lsession._analystid;swFC._insertrow(arrValues);swFC._executejsevent("OnFileAdded");}}}function _swfc_filetable_refresh(){var strRes;var strUNCPath=_parse_context_vars(this.path);if(strUNCPath=="undefined"){strUNCPath="";this.path="";}if(strUNCPath!=""){app.debugstart(this.name+"._refresh [filetable]","FORM CONTROLS");app.debugstart(this.name+"._fetchdata [sqltable]","FORM CONTROLS");var strParams="uncpath="+app.pfu(strUNCPath);var strURL=app._root+"service/fileupload/display.php";var strRes=app.get_http(strURL,strParams,true,false,null,null);this._ondatafetched(strRes);app.debugend(this.name+"._refresh [filetable]","FORM CONTROLS");}return true;}function _swfc_filetable_deletecallattachment(){if(!lsession.HaveRight(ANALYST_RIGHT_A_GROUP,ANALYST_RIGHT_A_CANDELETEATTACHEDFILES,true)){return;}var aRow=this._currrow;if(aRow!=null){var strName=aRow.getAttribute("attachname");if(confirm("Removing this attachment ("+strName+") will permanently delete it from the system.\n\nDo you wish to continue?")){var attID=aRow.getAttribute("attachid");var hdcon=new HelpdeskSession(_swdoc._uniqueformid);if(hdcon.DeleteCallAttachment(_swdoc.opencall.callref,attID)){this._getcallattachments();var hdcon=new HelpdeskSession(_swdoc._uniqueformid);hdcon.BeginUpdateCall(_swdoc.opencall.callref);hdcon.SendBoolean("publicupdate",false);hdcon.SendValue("updatedb.udsource","File Attachment");hdcon.SendValue("updatedb.udcode","Removed File");hdcon.SendText("updatedb.updatetxt","The "+strName+" file has been removed from the call by "+lsession.analystid);hdcon.Commit();}}}}function _swfc_filetable_getcallattachments(){this._RemoveAllRows();var strParams="_callref="+_swdoc.opencall.callref;if(this.sortColumn!=-1){var strOrder=(this.sortDescending)?"DESC":"ASC";strParams+="&_orderby="+this.sortColumn;strParams+="&_orderdir="+strOrder;}app.debugstart(this.name+"._getcallattachments [filetable]","FORM CONTROLS");var strURL=app._root+"service/fileupload/callattachments.php";var xmlFileList=app.get_http(strURL,strParams,true,true,null,null);app.debugend(this.name+"._getcallattachments [filetable]","FORM CONTROLS");if(xmlFileList){var xntbt=app.xmlNodeTextByTag;var arrFiles=xmlFileList.getElementsByTagName("file");for(var x=0;x<arrFiles.length;x++){var strID=xntbt(arrFiles[x],"dataid");var strName=xntbt(arrFiles[x],"filename");var iSize=xntbt(arrFiles[x],"sizeu");var strAddedBy=xntbt(arrFiles[x],"addedby");var iTime=xntbt(arrFiles[x],"timeadded");var jsDate=app._utcdate_from_epoch(iTime,lsession.timezoneOffset);var strDate=app._formatDate(jsDate,"yyyy-MM-dd HH:mm:ss");var arrType=strName.split(".");var strType=app.getFileTypeInformation(arrType[arrType.length-1]);var arrValues=new Array();arrValues[0]=strName;arrValues[1]=iSize;arrValues[2]=strType;arrValues[3]=strDate;arrValues[4]=strAddedBy;var newRow=this._insertrow(arrValues,0,strID);if(newRow!=null){newRow.setAttribute("attachid",xntbt(arrFiles[x],"dataid"));newRow.setAttribute("attachname",strName);}}}}function _swform_controlgroup(strName){this.controls=new Array();this.name=strName;this.visible=true;this.enable=true;}_swform_controlgroup.prototype._add_element=function(oSwControl){this.controls[this.controls.length++]=oSwControl;this.controls[oSwControl.name]=oSwControl;};_swform_controlgroup.prototype._enable=function(bEnable){this.enable=bEnable;for(var x=0;x<this.controls.length;x++){this.controls[x]._enable(bEnable);}};_swform_controlgroup.prototype._visible=function(bVisible){this.visible=bVisible;for(var x=0;x<this.controls.length;x++){this.controls[x]._visible(bVisible);}};