{"espForm":{"configuration":{"settings":{"name":"_sys_swm_form","title":"Untitled","description":"used by webclient","options":{"allowResize":"true","showMenubar":"false","showToolbar":"false","showStatusBar":"false"}},"javascript":{}},"layouts":{"layout":[{"appearance":{"width":"651","height":"451","backgroundColor":"#f0f0f0","fillColour":"#ffffff","textColour":"#000000","font":{"@size":"8","#text":"Arial"}},"controls":{"control":[{"general":{"name":"tb_to","type":"Field"},"appearance":{"index":"0","backgroundColor":"#f0f0f0","foregroundColor":"#000000","font":{"@size":"8","#text":"Arial"},"borderStyle":"None"},"objectPlacement":{"position":{"top":"33","left":"86","right":"643","bottom":"51"},"scaling":{"top":"0","left":"0","right":"100","bottom":"0"}},"controlInfo":{"mouseOverCursor":"Window Default","type":"Text Edit","flags":{"invisible":"false","readOnly":"true","mandatory":"false","mandatoryLabelBackground":"false","mandatoryLabelText":"false","allowNullValue":"false","skipTabStop":"false","disabled":"false","protected":"false","noMacroExpand":"false","readOnlyInit":"false","autoCompleteField":"false","editUnlimitedText":"false","url":"false"},"textLineCount":"0","textInputFormat":"Text","properties":{"borderColor":"#333333","image":"#eeeeee","disabledBackgroundColor":"#eeeeee"}}},{"general":{"name":"tb_subject","type":"Field"},"appearance":{"index":"1","backgroundColor":"#f0f0f0","foregroundColor":"#000000","font":{"@size":"8","#text":"Arial"},"borderStyle":"None"},"objectPlacement":{"position":{"top":"80","left":"86","right":"643","bottom":"98"},"scaling":{"top":"0","left":"0","right":"100","bottom":"0"}},"controlInfo":{"mouseOverCursor":"Window Default","type":"Text Edit","flags":{"invisible":"false","readOnly":"true","mandatory":"false","mandatoryLabelBackground":"false","mandatoryLabelText":"false","allowNullValue":"false","skipTabStop":"false","disabled":"false","protected":"false","noMacroExpand":"false","readOnlyInit":"false","autoCompleteField":"false","editUnlimitedText":"false","url":"false"},"textLineCount":"0","textInputFormat":"Text","properties":{"borderColor":"#333333","image":"#eeeeee","disabledBackgroundColor":"#eeeeee"}}},{"general":{"name":"lb_attachments","type":"Field"},"appearance":{"index":"2","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Arial"},"borderStyle":"Rectangle"},"objectPlacement":{"position":{"top":"103","left":"86","right":"581","bottom":"121"},"scaling":{"top":"0","left":"0","right":"100","bottom":"0"}},"controlInfo":{"mouseOverCursor":"Window Default","type":"Pick List (Numeric Mode)","flags":{"invisible":"false","readOnly":"false","mandatory":"false","mandatoryLabelBackground":"false","mandatoryLabelText":"false","allowNullValue":"false","skipTabStop":"false","disabled":"false","protected":"false","noMacroExpand":"false","readOnlyInit":"false","comboAutoUpdate":"false","comboNewValues":"true","useDDPickList":"false"},"textLineCount":"0","textInputFormat":"Text","properties":{"borderColor":"#333333","image":"#eeeeee","disabledBackgroundColor":"#eeeeee"}}},{"general":{"name":"tb_body","type":"Field"},"appearance":{"index":"3","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Arial"},"borderStyle":"3-D Sunken"},"objectPlacement":{"position":{"top":"130","left":"12","right":"643","bottom":"445"},"scaling":{"top":"0","left":"0","right":"100","bottom":"100"}},"controlInfo":{"mouseOverCursor":"Window Default","type":"Text Edit","flags":{"invisible":"false","readOnly":"true","mandatory":"false","mandatoryLabelBackground":"false","mandatoryLabelText":"false","allowNullValue":"false","skipTabStop":"false","disabled":"false","protected":"false","noMacroExpand":"false","readOnlyInit":"false","autoCompleteField":"false","editUnlimitedText":"true","url":"false"},"textLineCount":"0","textInputFormat":"Text","properties":{"borderColor":"#000000","image":"#eeeeee","disabledBackgroundColor":"#eeeeee"}}},{"general":{"name":"Text1","type":"Text","flags":{"transparent":"true","xpStyle":"false","hasShadow":"false","toolbarButtonStyle":"false","cache":"false","hasBorder":"false","hasCheckbox":"false"}},"appearance":{"index":"4","caption":"Subject :","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Arial"},"alignment":"Right","borderStyle":"None","fillStyle":"Solid"},"objectPlacement":{"position":{"top":"80","left":"11","right":"79","bottom":"98"},"scaling":{"top":"0","left":"0","right":"0","bottom":"0"}},"controlInfo":{"mouseOverCursor":"Window Default"}},{"general":{"name":"Text2","type":"Text","flags":{"transparent":"true","xpStyle":"false","hasShadow":"false","toolbarButtonStyle":"false","cache":"false","hasBorder":"false","hasCheckbox":"false"}},"appearance":{"index":"5","caption":"From :","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Arial"},"alignment":"Right","borderStyle":"None","fillStyle":"Solid"},"objectPlacement":{"position":{"top":"10","left":"11","right":"79","bottom":"28"},"scaling":{"top":"0","left":"0","right":"0","bottom":"0"}},"controlInfo":{"mouseOverCursor":"Window Default"}},{"general":{"name":"fl_attachments","type":"FileListTable","flags":{"transparent":"false","xpStyle":"false","hasShadow":"false","toolbarButtonStyle":"false","cache":"false","hasBorder":"false","hasCheckbox":"false","showHeader":"true","verticalGridLines":"false","horizontalGridLines":"false","autoLoad":"true","allowMultiSelect":"false"}},"appearance":{"index":"6","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Arial"},"borderStyle":"Rectangle"},"objectPlacement":{"position":{"top":"260","left":"680","right":"878","bottom":"401"},"scaling":{"top":"0","left":"0","right":"0","bottom":"0"}},"columns":{"controlInfo":[{"mouseOverCursor":"Window Default","type":"Text Edit","flags":{"invisible":"false","readOnly":"false","mandatory":"false","mandatoryLabelBackground":"false","mandatoryLabelText":"false","allowNullValue":"false","skipTabStop":"false","disabled":"false","protected":"false","noMacroExpand":"false","readOnlyInit":"false","autoCompleteField":"false","editUnlimitedText":"false","url":"false","hidden":"false","allowResize":"true","allowSort":"true"},"textLineCount":"0","textInputFormat":"Text","name":"File Name","width":"160","image":"-1","dataColumn":"0"},{"mouseOverCursor":"Window Default","type":"Text Edit","flags":{"invisible":"false","readOnly":"false","mandatory":"false","mandatoryLabelBackground":"false","mandatoryLabelText":"false","allowNullValue":"false","skipTabStop":"false","disabled":"false","protected":"false","noMacroExpand":"false","readOnlyInit":"false","autoCompleteField":"false","editUnlimitedText":"false","url":"false","hidden":"false","allowResize":"true","allowSort":"true"},"textLineCount":"0","textInputFormat":"Text","name":"Size","width":"80","image":"-1","dataColumn":"1"},{"mouseOverCursor":"Window Default","type":"Text Edit","flags":{"invisible":"false","readOnly":"false","mandatory":"false","mandatoryLabelBackground":"false","mandatoryLabelText":"false","allowNullValue":"false","skipTabStop":"false","disabled":"false","protected":"false","noMacroExpand":"false","readOnlyInit":"false","autoCompleteField":"false","editUnlimitedText":"false","url":"false","hidden":"false","allowResize":"true","allowSort":"true"},"textLineCount":"0","textInputFormat":"Text","name":"Last Modified","width":"120","image":"-1","dataColumn":"2"},{"mouseOverCursor":"Window Default","type":"Text Edit","flags":{"invisible":"false","readOnly":"false","mandatory":"false","mandatoryLabelBackground":"false","mandatoryLabelText":"false","allowNullValue":"false","skipTabStop":"false","disabled":"false","protected":"false","noMacroExpand":"false","readOnlyInit":"false","autoCompleteField":"false","editUnlimitedText":"false","url":"false","hidden":"false","allowResize":"true","allowSort":"true"},"textLineCount":"0","textInputFormat":"Text","name":"Full Local Path","width":"100","image":"-1","dataColumn":"3"}]},"sortColumn":"-1","sortDescending":"false","headerHeight":"18","rowHeight":"16","selectedColor":"#cae1ee","selectedTextColor":"#ffffff","controlInfo":{"mouseOverCursor":"Window Default","flags":{"invisible":"true","skipTabStop":"false","disabled":"false","protected":"false","noMacroExpand":"false","multiLine":"false"},"properties":{"highlightStyle":"1","borderColor":"#d3c9b6"}}},{"general":{"name":"Text3","type":"Text","flags":{"transparent":"true","xpStyle":"false","hasShadow":"false","toolbarButtonStyle":"false","cache":"false","hasBorder":"false","hasCheckbox":"false"}},"appearance":{"index":"7","caption":"Attachments :","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Arial"},"alignment":"Right","borderStyle":"None","fillStyle":"Solid"},"objectPlacement":{"position":{"top":"104","left":"8","right":"79","bottom":"122"},"scaling":{"top":"0","left":"0","right":"0","bottom":"0"}},"controlInfo":{"mouseOverCursor":"Window Default"}},{"general":{"name":"btn_view","type":"EventButton"},"appearance":{"index":"8","caption":"View","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Arial"}},"objectPlacement":{"position":{"top":"99","left":"587","right":"644","bottom":"124"},"scaling":{"top":"0","left":"100","right":"100","bottom":"0"}},"controlInfo":{"mouseOverCursor":"Window Default","flags":{"invisible":"false","skipTabStop":"false","disabled":"true","protected":"false","noMacroExpand":"false","multiLine":"false"},"properties":{"backgroundColor":"#ff9900"}}},{"general":{"name":"Text4","type":"Text","flags":{"transparent":"true","xpStyle":"false","hasShadow":"false","toolbarButtonStyle":"false","cache":"false","hasBorder":"false","hasCheckbox":"false"}},"appearance":{"index":"9","caption":"To :","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Arial"},"alignment":"Right","borderStyle":"None","fillStyle":"Solid"},"objectPlacement":{"position":{"top":"33","left":"11","right":"79","bottom":"51"},"scaling":{"top":"0","left":"0","right":"0","bottom":"0"}},"controlInfo":{"mouseOverCursor":"Window Default"}},{"general":{"name":"tb_from","type":"Field"},"appearance":{"index":"10","backgroundColor":"#f0f0f0","foregroundColor":"#000000","font":{"@size":"8","#text":"Arial"},"borderStyle":"None"},"objectPlacement":{"position":{"top":"10","left":"86","right":"429","bottom":"28"},"scaling":{"top":"0","left":"0","right":"100","bottom":"0"}},"controlInfo":{"mouseOverCursor":"Window Default","type":"Text Edit","flags":{"invisible":"false","readOnly":"true","mandatory":"false","mandatoryLabelBackground":"false","mandatoryLabelText":"false","allowNullValue":"false","skipTabStop":"false","disabled":"false","protected":"false","noMacroExpand":"false","readOnlyInit":"false","autoCompleteField":"false","editUnlimitedText":"false","url":"false"},"textLineCount":"0","textInputFormat":"Text","properties":{"borderColor":"#333333","image":"#eeeeee","disabledBackgroundColor":"#eeeeee"}}},{"general":{"name":"Text5","type":"Text","flags":{"transparent":"true","xpStyle":"false","hasShadow":"false","toolbarButtonStyle":"false","cache":"false","hasBorder":"false","hasCheckbox":"false"}},"appearance":{"index":"11","caption":"Cc :","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Arial"},"alignment":"Right","borderStyle":"None","fillStyle":"Solid"},"objectPlacement":{"position":{"top":"53","left":"11","right":"79","bottom":"71"},"scaling":{"top":"0","left":"0","right":"0","bottom":"0"}},"controlInfo":{"mouseOverCursor":"Window Default"}},{"general":{"name":"tb_cc","type":"Field"},"appearance":{"index":"12","backgroundColor":"#f0f0f0","foregroundColor":"#000000","font":{"@size":"8","#text":"Arial"},"borderStyle":"None"},"objectPlacement":{"position":{"top":"53","left":"86","right":"643","bottom":"71"},"scaling":{"top":"0","left":"0","right":"100","bottom":"0"}},"controlInfo":{"mouseOverCursor":"Window Default","type":"Text Edit","flags":{"invisible":"false","readOnly":"true","mandatory":"false","mandatoryLabelBackground":"false","mandatoryLabelText":"false","allowNullValue":"false","skipTabStop":"false","disabled":"false","protected":"false","noMacroExpand":"false","readOnlyInit":"false","autoCompleteField":"false","editUnlimitedText":"false","url":"false"},"textLineCount":"0","textInputFormat":"Text","properties":{"borderColor":"#333333","image":"#eeeeee","disabledBackgroundColor":"#eeeeee"}}},{"general":{"name":"txt_sent","type":"Text","flags":{"transparent":"true","xpStyle":"false","hasShadow":"false","toolbarButtonStyle":"false","cache":"false","hasBorder":"false","hasCheckbox":"false"}},"appearance":{"index":"13","caption":"Sent : 2011-10-03 12:35","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Arial"},"alignment":"Right","borderStyle":"None","fillStyle":"Solid"},"objectPlacement":{"position":{"top":"10","left":"449","right":"642","bottom":"28"},"scaling":{"top":"0","left":"0","right":"0","bottom":"0"}},"controlInfo":{"mouseOverCursor":"Window Default"}}]},"javascript":{"methods":{"method":[{"name":"OnFormLoaded","code":"OnFormLoaded(bDataReloaded)\n{\n\tif(app.bWebClient==false) return false;\n\t\n\t\n\t_swdoc.oncontextmenu = function(){return false;};\n\t\n\t_swdoc.SetTitle(\"Loading SWM file...please wait\");\n\t\n\t\/\/--\n\t\/\/-- call php service to get swm content and then return email xml structure\n\tvar strParams = \"_callref=\"+_swdoc.GetArg(\"_callref\")+\"&_dataid=\" + _swdoc.GetArg(\"_rowid\") + \"&_uniqueformid=\" + top._uniqueformid;\n\tvar strURL = app.get_service_url(\"email\/getswmmessage\",\"\");\n\tvar xmlDOM = app.get_http(strURL, strParams, true, true, null, null);\n\tif(!xmlDOM) \n\t{\n\t\t_swdoc.CloseForm();\n\t\treturn;\n\t}\n\tvar xntbt = app.xmlNodeTextByTag;\n\t\n\t\/\/-- set subject\n\tvar strSubject = xntbt(xmlDOM,\"subject\");\t\n\tvar strPriority = \"Normal\";\n\tvar intPriority = xntbt(xmlDOM,\"priority\");\t\t\n\tswitch(intPriority)\n\t{\n\t\tcase \"1\":\n\t\t\tstrPriority = \"Highest\";\t\n\t\t\tbreak;\n\t\tcase \"2\":\n\t\t\tstrPriority = \"High\";\t\t\n\t\t\tbreak;\t\n\t\tcase \"4\":\n\t\t\tstrPriority = \"Low\";\t\t\t\n\t\t\tbreak;\t\n\t\tcase \"5\":\n\t\t\tstrPriority = \"Lowest\";\t\t\n\t\t\tbreak;\t\n\n\t}\n\n\t\/\/-- set title with time\n\t_swdoc.SetTitle(\"Priority (\" + strPriority + \") - \" + strSubject);\n\t_ete(txt_sent , \"Sent on : \" + xntbt(xmlDOM,\"timeSent\"));  \/\/--  no way to convert this value\n\t_eva(tb_subject , strSubject);\n\n\n\tvar strFrom = \"\";\n\tvar strTo = \"\";\n\tvar strCc = \"\";\n\tvar arrRecipients = xmlDOM.getElementsByTagName(\"recipient\");\n    for(var x=0;x<arrRecipients.length;x++)\n    {\n    \tvar strType =xntbt(arrRecipients[x],\"class\");\t\n    \tvar strName =  xntbt(arrRecipients[x],\"address\");\n    \tif(strType==\"to\")\n    \t{\n    \t\tif(strTo!=\"\")strTo +=\"; \";\n    \t\tstrTo += strName;\n    \t}\n    \telse if(strType==\"from\")\n    \t{\n    \t\tif(strFrom!=\"\")strFrom +=\"; \";\n    \t\t\n    \t\tstrFrom += strName;\n    \t}\n\t   \telse if(strType==\"cc\")\n    \t{\n    \t\tif(strCc!=\"\")strCc +=\"; \";\n    \t\tstrCc += strName;\n    \t}\n    }\n\n\t_eva(tb_from , strFrom);\n\t_eva(tb_to , strTo);\t\n\t_eva(tb_cc , strCc);\t\t\n\t\n\t\/\/-- set body vars\n\tvar strHtmlBody = xntbt(xmlDOM,\"htmlBody\");\n\tvar strBody = xntbt(xmlDOM,\"body\");\n\tif(strHtmlBody==\"\")\n\t{\n\t\t_swdoc._use_html_template\t= false;\n\t}\n\telse\n\t{\n\t\t_swdoc._use_html_template = true;\t\n\t}\n\t\t\t\n\t\/\/--\n\t\/\/-- add any inline content files to _swdoc level mime array and all others to drop down list\n\tvar arrFiles = xmlDOM.getElementsByTagName('fileAttachment'); \n    var defaultSelectedItem = -1;\n    var strPickList = \"\";\t\t\n    var y=0;\n    _swdoc._email_attachments = new Array();\n    _swdoc._email_inline_attachments = new Array();\n    \n\tfor(var x=0;x<arrFiles.length;x++)\n\t{\n\t\tvar strFileName = app.xmlNodeTextByTag(arrFiles[x],\"fileName\");\n\t\tvar strContentId = app.xmlNodeTextByTag(arrFiles[x],\"contentId\");\t\n\t\tif(strContentId!=\"\")\n\t\t{\n\t\t\t\/\/--\n\t\t\t\/\/-- add any inline content files to _swdoc level mime array\n\t\t\tvar mimeFile =  \"mime.\"+x+\".\"+strFileName;\n\t\t\t_swdoc._email_inline_attachments[strContentId] = new Object()\n\t\t\t_swdoc._email_inline_attachments[strContentId].attvalue = x;\t\n\t\t\t_swdoc._email_inline_attachments[strContentId].srcfilename = mimeFile;\t\t\n\t\t\t_swdoc._email_inline_attachments[strContentId].origfilename = strFileName;\t\n\t\t\t_swdoc._email_inline_attachments[strContentId].wwwpath = app.xmlNodeTextByTag(arrFiles[x],\"fileSource\");\t\t\n\t\t}\n\t\telse\n\t\t{\n\t\t\tvar attFile =  \"att.\"+x+\".\"+strFileName;\n\t\t\t_swdoc._email_attachments[attFile] = new Object();\n\t\t\t_swdoc._email_attachments[attFile].attvalue = x;\t\n\t\t\t_swdoc._email_attachments[attFile].srcfilename = attFile;\t\t\t\n\t\t\t_swdoc._email_attachments[attFile].origfilename = strFileName;\t\n\t\t\t_swdoc._email_attachments[attFile].wwwpath = app.xmlNodeTextByTag(arrFiles[x],\"fileSource\")\t\n\t\t\n\t\t\t\/\/-- construct picklist items\n\t\t\tif(strPickList!=\"\")strPickList+=\"|\";\n\t\t\tstrPickList += strFileName + \"^\" + x;\n\t\t\t\n\t\t\t\/\/-- default selected file name\n\t\t\tif(y==0)defaultSelectedItem = x;\n\t\t\ty++;\n\t\t}\n\t}\n\tif(defaultSelectedItem>-1)_een(btn_view , true);\n\tmainform.lb_attachments.pickList = strPickList;\n\t_eva(mainform.lb_attachments , defaultSelectedItem);\n\t\t\n\tif(_swdoc._use_html_template)\t\n\t{\n\t\tWYSIWYG.SwCreateNow('tb_body',SupportworksSettings);\t\t\t\n\t\tWYSIWYG.disable('tb_body');\n\t\tWYSIWYG._bDisableContentMenu = true;\n\t\tvar strEmailBody = strHtmlBody;\t\t\t\t\t\n\t}\n\telse\n\t{\n\t\tvar strEmailBody =strBody;\n\t}\n\t\t\n\tif(_swdoc._use_html_template)\n\t{\n\t\tWYSIWYG.SwSetHTMLValue(\"tb_body\",strEmailBody);\n\t\t_eva(tb_body , strBody);\n\t\t\t\n\t\t\/\/-- check inline images to make sure they have a swcid\n\t\tvar arrImageSrcs = new Array();\n\t\tvar arrImages = WYSIWYG.getEditorWindow(\"tb_body\").document.getElementsByTagName(\"img\");\n\t\tfor(var i=0;i<arrImages.length;i++) \n\t\t{\n\t\t\tvar swcid = arrImages[i].getAttribute(\"swcid\");\n\t\t\tif(swcid==null || swcid==\"\")\n\t\t\t{\n\t\t\t\tvar strSrc = arrImages[i].getAttribute(\"src\");\n\t\t\t\tfor(strCID in _swdoc._email_inline_attachments)\n\t\t\t\t{\t\n\t\t\t\t\tvar boolMatch = (app.pfu(unescape(strSrc.toLowerCase()))==app.pfu(_swdoc._email_inline_attachments[strCID].wwwpath.toLowerCase()));\n\t\t\t\t\tif(boolMatch)\n\t\t\t\t\t{\n\t\t\t\t\t\tarrImages[i].setAttribute(\"swcid\",strCID);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\telse\n\t{\t\t\n\t\t_eva(tb_body , strEmailBody);\n\t\ttb_body.element.focus();\n\t}\t\n}"},{"name":"lb_attachments_OnValueChanged","code":"lb_attachments_OnValueChanged(strValue)\n{\n\tif(strValue!=\"\")\n\t{\n\t\t\n\t\t_een(btn_view , true);\n\t}\n\telse\n\t{\n\t\t\n\t\t_een(btn_view , false);\n\t}\n\n}"},{"name":"btn_view_OnPressed","code":"btn_view_OnPressed()\n{\n\t\/\/-- find file and delete;\n\tvar intFilePos = lb_attachments.value;\n\tvar strFileName = lb_attachments.display;\n\tvar strViewFile = \"att.\"+ intFilePos +\".\"+ strFileName\n\tvar origFileName = _swdoc._email_attachments[strViewFile].origfilename;\n\t\n\tfl_attachments.OpenFile(-1,true,strViewFile,origFileName);\n}"}]}}},{"appearance":{"width":"360","height":"220","backgroundColor":"#ffffff","fillColour":"#ffffff","textColour":"#000000","font":{"@size":"8","#text":"Arial"}},"javascript":{}}]}}}