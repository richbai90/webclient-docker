{"espForm":{"configuration":{"settings":{"name":"_sys_email_selectsignature","title":"Select Signature","description":"wc form that allows analyst to select an email signature to put into text area","options":{"allowResize":"true","showMenubar":"false","showToolbar":"false","showStatusBar":"false"}},"javascript":{"methods":{"method":{"name":"(Globals)","code":"var _selected_signature = \"\";\nvar _selected_html_signature = \"\";\nvar _signature_inline_attachments = new Array();"}}}},"layouts":{"layout":[{"appearance":{"width":"416","height":"351","backgroundColor":"#eaeaea","fillColour":"#ffffff","textColour":"#000000","font":{"@size":"8","#text":"Arial"}},"controls":{"control":[{"general":{"name":"sl_signatures","type":"SqlTable","flags":{"transparent":"false","xpStyle":"true","hasShadow":"false","toolbarButtonStyle":"false","cache":"false","hasBorder":"false","hasCheckbox":"false","showHeader":"true","verticalGridLines":"false","horizontalGridLines":"false","autoLoad":"false","allowMultiSelect":"false"}},"appearance":{"index":"0","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Arial"},"borderStyle":"Rectangle"},"objectPlacement":{"position":{"top":"31","left":"9","right":"409","bottom":"153"},"scaling":{"top":"0","left":"0","right":"100","bottom":"0"}},"columns":{"controlInfo":{"mouseOverCursor":"Window Default","type":"Text Edit","flags":{"invisible":"false","readOnly":"false","mandatory":"false","mandatoryLabelBackground":"false","mandatoryLabelText":"false","allowNullValue":"false","skipTabStop":"false","disabled":"false","protected":"false","noMacroExpand":"false","readOnlyInit":"false","autoCompleteField":"false","editUnlimitedText":"false","url":"false","hidden":"false","allowResize":"true","allowSort":"true"},"textLineCount":"0","textInputFormat":"Text","name":"Name","width":"386","image":"-1","dataColumn":"0"}},"sortColumn":"-1","sortDescending":"false","headerHeight":"18","rowHeight":"16","selectedColor":"#cae1ee","selectedTextColor":"#ffffff","controlInfo":{"mouseOverCursor":"Window Default","properties":{"highlightStyle":"1","borderColor":"#d3c9b6"}}},{"general":{"name":"tb_preview","type":"Field"},"appearance":{"index":"1","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Arial"},"borderStyle":"Rectangle"},"objectPlacement":{"position":{"top":"181","left":"9","right":"409","bottom":"316"},"scaling":{"top":"0","left":"0","right":"100","bottom":"100"}},"controlInfo":{"mouseOverCursor":"Window Default","type":"Text Edit","flags":{"invisible":"false","readOnly":"true","mandatory":"false","mandatoryLabelBackground":"false","mandatoryLabelText":"false","allowNullValue":"false","skipTabStop":"false","disabled":"false","protected":"false","noMacroExpand":"false","readOnlyInit":"false","autoCompleteField":"false","editUnlimitedText":"false","url":"false"},"textLineCount":"0","textInputFormat":"Text","properties":{"borderColor":"#d3c9b6","image":"#eeeeee","disabledBackgroundColor":"#eeeeee"}}},{"general":{"name":"Text1","type":"Text","flags":{"transparent":"true","xpStyle":"false","hasShadow":"false","toolbarButtonStyle":"false","cache":"false","hasBorder":"false","hasCheckbox":"false"}},"appearance":{"index":"2","caption":"Signature :","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Arial"},"alignment":"Left","borderStyle":"None","fillStyle":"Solid"},"objectPlacement":{"position":{"top":"9","left":"5","right":"135","bottom":"30"},"scaling":{"top":"0","left":"0","right":"0","bottom":"0"}},"controlInfo":{"mouseOverCursor":"Window Default"}},{"general":{"name":"Text2","type":"Text","flags":{"transparent":"true","xpStyle":"false","hasShadow":"false","toolbarButtonStyle":"false","cache":"false","hasBorder":"false","hasCheckbox":"false"}},"appearance":{"index":"3","caption":"Preview :","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Arial"},"alignment":"Left","borderStyle":"None","fillStyle":"Solid"},"objectPlacement":{"position":{"top":"158","left":"5","right":"135","bottom":"179"},"scaling":{"top":"0","left":"0","right":"0","bottom":"0"}},"controlInfo":{"mouseOverCursor":"Window Default"}},{"general":{"name":"btn_close","type":"EventButton"},"appearance":{"index":"4","caption":"Close","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Arial"}},"objectPlacement":{"position":{"top":"323","left":"336","right":"408","bottom":"348"},"scaling":{"top":"100","left":"100","right":"100","bottom":"100"}},"controlInfo":{"mouseOverCursor":"Window Default","properties":{"backgroundColor":"#ff9900"}}},{"general":{"name":"btn_insert","type":"EventButton"},"appearance":{"index":"5","caption":"Insert","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Arial"}},"objectPlacement":{"position":{"top":"323","left":"252","right":"324","bottom":"348"},"scaling":{"top":"100","left":"100","right":"100","bottom":"100"}},"controlInfo":{"mouseOverCursor":"Window Default","properties":{"backgroundColor":"#ff9900"}}},{"general":{"name":"div_preview","type":"Rectange"},"appearance":{"index":"6","backgroundColor":"#ffffff","foregroundColor":"#d3c9b6","font":{"@size":"0"},"borderStyle":"Rectangle","fillStyle":"Solid"},"objectPlacement":{"position":{"top":"181","left":"9","right":"409","bottom":"316"},"scaling":{"top":"0","left":"0","right":"0","bottom":"0"}},"controlInfo":{"mouseOverCursor":"Window Default","flags":{"invisible":"true","skipTabStop":"false","disabled":"false","protected":"false","noMacroExpand":"false","multiLine":"false"}}}]},"javascript":{"methods":{"method":[{"name":"OnFormLoaded","code":"OnFormLoaded(bDataReloaded)\n{\n\t\/\/-- if not web client exit\n\tif(!app.bWebClient) return;\n\n\t\/\/-- get list of mail signatures for passed in mailbox\n\tvar bTemplates = false;\n\tvar strMailBox = _swdoc.GetArg(\"_mailbox\");\n\tvar xmlmc = new XmlMethodCall();\n\txmlmc.SetParam(\"mailbox\", strMailBox);\n\txmlmc.SetParam(\"templateType\", 4096);\t\n\txmlmc.SetParam(\"returnMime\", false);\t\t\n\tif(xmlmc.Invoke(\"mail\", \"getMailTemplateList\"))\n\t{\n\t\t\/\/-- loop templates and put into sqllist\n\t\tvar arrTemplates = xmlmc.xmlDOM.getElementsByTagName(\"mailTemplate\");\n\t\tfor(var x=0;x<arrTemplates.length;x++)\n\t\t{\n\t\t\tvar strTemplateName = app.xmlNodeTextByTag(arrTemplates[x],\"templateName\");\n\t\t\tvar arr = new Array(strTemplateName);\n\t\t\tsl_signatures._insertrow(arr,-1);\n\t\t\tbTemplates = true;\t\n\t\t}\n\t}\n\t\n\tif(!bTemplates)\n\t{\n\t\tMessageBox(\"There are no email signatures to select.\");\n\t\t_swdoc.CloseForm();\n\t}\n\telse\n\t{\n\t\tsl_signatures.SetRowSelected(0,true);\n\t}\n\n}"},{"name":"btn_close_OnPressed","code":"btn_close_OnPressed()\n{\n\t_swdoc._signature_inline_attachments = new Array();\n\t_swdoc.CloseForm();\n\n\n}"},{"name":"btn_insert_OnPressed","code":"btn_insert_OnPressed()\n{\n\t_swdoc._selected_html_signature = tb_preview.value;\n\t_swdoc._selected_signature = tb_preview.value;\n\n\tif(div_preview.visible)\n\t{\n\t\t_swdoc._selected_html_signature =\tdiv_preview.element.innerHTML;\n\t}\n\t_swdoc.CloseForm();\n\n}"},{"name":"sl_signatures_OnItemSelected","code":"sl_signatures_OnItemSelected(nRow)\n{\n\t\/\/-- load preview for email signature - save any inline attachment to parent forms temp loc\n\tvar strTemplate = sl_signatures.GetItemText(nRow, 0);\n\tif(strTemplate==\"\") return;\n\t\n\t\/\/-- clear atts array\n\t_swdoc._signature_inline_attachments = new Array();\n\t\n\tvar xmlmc = new XmlMethodCall();\n\txmlmc.SetParam(\"mailbox\", _swdoc.GetArg(\"_mailbox\"));\n\txmlmc.SetParam(\"templateName\",strTemplate);\t\t\n\txmlmc.SetParam(\"templateType\",4096);\t\n\txmlmc.SetParam(\"parseMime\",true);\t\t\n\txmlmc.SetWebclientParam(\"_altuniqueformid\",_swdoc.GetArg(\"_parentformid\"))\n\tif(xmlmc.Invoke(\"mail\", \"getMailTemplate\"))\n\t{\n\t\t\/\/-- get htmlbody and body\n\t\tvar strBody = xmlmc.GetReturnValue(\"body\");\n\t\tvar strHTMLBody = xmlmc.GetReturnValue(\"htmlBody\");\n\t\t_eva(tb_preview,strBody);\n\t\tif(strHTMLBody!=\"\")\n\t\t{\n\t\t\t_evi(tb_preview,false);\t\n\t\t\t_evi(div_preview,true);\n\t\t\tdiv_preview.element.style.overflow = \"auto\";\n\t\t\tdiv_preview.element.style.fontSize = \"12px\";\n\t\t\t_ecol(div_preview , \"#000000\");\n\t\t\tdiv_preview.element.innerHTML = strHTMLBody;\n\t\t\t\n\t\t\t\/\/-- store file attachment info\n\t\t\tvar arrFiles = xmlmc.xmlDOM.getElementsByTagName(\"fileAttachment\")\n\t\t\tfor(var x=0;x<arrFiles.length;x++)\n\t\t\t{\n\t\t\t\tvar strFileName = app.xmlNodeTextByTag(arrFiles[x],\"fileName\");\n\t\t\t\tvar strContentId = app.xmlNodeTextByTag(arrFiles[x],\"contentId\");\t\n\t\t\t\tif(strContentId!=\"\")\n\t\t\t\t{\n\t\t\t\t\t\/\/--\n\t\t\t\t\t\/\/-- add any inline content files to _swdoc level mime array\n\t\t\t\t\t_swdoc._signature_inline_attachments[strContentId] = new Object();\n\t\t\t\t\t_swdoc._signature_inline_attachments[strContentId].attvalue = x;\t\n\t\t\t\t\t_swdoc._signature_inline_attachments[strContentId].srcfilename = \"mime.\" + x + \".\"+strFileName;\t\t\n\t\t\t\t\t_swdoc._signature_inline_attachments[strContentId].origfilename = strFileName;\t\n\t\t\t\t\tvar wwwpath = app.xmlNodeTextByTag(arrFiles[x],\"fileData\");\n\t\t\t\t\tif(wwwpath==\"\")wwwpath= app.xmlNodeTextByTag(arrFiles[x],\"fileSource\");\n\t\t\t\t\t_swdoc._signature_inline_attachments[strContentId].wwwpath = wwwpath;\n \t\t\t\t}\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\t_evi(div_preview,false);\n\t\t\t_evi(tb_preview,true);\n\t\t}\n\t\t\n\t}\n}"}]}}},{"appearance":{"width":"360","height":"220","backgroundColor":"#ffffff","fillColour":"#ffffff","textColour":"#000000","font":{"@size":"8","#text":"Arial"}},"javascript":{}}]}}}