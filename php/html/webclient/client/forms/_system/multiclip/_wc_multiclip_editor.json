{"espForm":{"configuration":{"settings":{"name":"_wc_multiclip_editor","title":"MultiClip Item Editor","description":"wc form that allows user to manage their multiclip items","options":{"allowResize":"true","showMenubar":"false","showToolbar":"true","showStatusBar":"false"}},"javascript":{"methods":{"method":[{"name":"(Globals)","code":"var _boolModified = false;\nvar _current_mc_node = null;\nvar _strModifiedValue = \"\";\n\nfunction _multiclip_toolbar_action(strAction)\n{\n\tif(strAction==\"newblock\")\n\t{\n\t\tmainform._new_block();\n\t}\n\telse if(strAction==\"newgroup\")\n\t{\n\t\tmainform._new_group();\n\t}\n\telse if(strAction==\"rename\")\n\t{\n\t\tmainform._rename_current_mc()\n\t}\n\telse if(strAction==\"save\")\n\t{\n\t\tmainform._save_current_mc();\n\t}\n\telse if(strAction==\"delete\")\n\t{\n\t\tmainform._delete_current_mc();\n\t}\n\n}\n\n\/\/-- custom webclient handle for tb_text control\nfunction tb_text_OnKeyPressed(oEle, strValue)\n{\n\t_swdoc._boolModified = true;\n\t_swdoc._strModifiedValue = strValue;\n\t\n\tif(_swdoc._current_mc_node != null)\n\t{\n\t\t_swdoc._boolModified = true;\n\t\tapp.toolbar_item_dore(\"manage_multiclip\", \"save\" , true, top.document);\t\n\t}\t\n\t\n}"},{"name":"OnFormClosing","code":"OnFormClosing()\n{\n\tif(_swdoc._boolModified)\n\t{\n\t\tif(confirm(\"Would you like to save the modifications you have made?\"))\n\t\t{\n\t\t\tmainform._save_current_mc();\n\t\t}\n\t}\n\n\treturn true;\n}"}]}}},"layouts":{"layout":[{"appearance":{"width":"590","height":"362","backgroundColor":"#eaeaea","fillColour":"#ffffff","textColour":"#000000","font":{"@size":"8","#text":"Arial"}},"controls":{"control":[{"general":{"name":"div_mutlicliptree","type":"Rectange","flags":{"transparent":"true","xpStyle":"false","hasShadow":"false","toolbarButtonStyle":"false","cache":"false","hasBorder":"false","hasCheckbox":"false"}},"appearance":{"index":"0","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"0"},"borderStyle":"Rectangle","fillStyle":"Solid"},"objectPlacement":{"position":{"top":"4","left":"3","right":"208","bottom":"361"},"scaling":{"top":"0","left":"0","right":"50","bottom":"100"}},"controlInfo":{"mouseOverCursor":"Window Default"}},{"general":{"name":"tb_text","type":"Field"},"appearance":{"index":"1","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Arial"},"borderStyle":"Rectangle"},"objectPlacement":{"position":{"top":"3","left":"215","right":"590","bottom":"361"},"scaling":{"top":"0","left":"50","right":"100","bottom":"100"}},"controlInfo":{"mouseOverCursor":"Window Default","type":"Text Edit","flags":{"invisible":"false","readOnly":"false","mandatory":"false","mandatoryLabelBackground":"false","mandatoryLabelText":"false","allowNullValue":"false","skipTabStop":"false","disabled":"true","protected":"false","noMacroExpand":"false","readOnlyInit":"false","autoCompleteField":"false","editUnlimitedText":"true","url":"false"},"textLineCount":"0","textInputFormat":"Text","properties":{"borderColor":"#000000","image":"#eeeeee","disabledBackgroundColor":"#eeeeee"}}}]},"javascript":{"methods":{"method":[{"name":"OnFormLoaded","code":"OnFormLoaded(bDataReloaded)\n{\n\n\tif(!app.bWebClient)return;\n\n\/\/-- load special toolbar \nif(app.__arr_application_toolbar_html[\"manage_multiclip\"]!=undefined)\n{\n\ttop._form_toolbar_holder.innerHTML = app.__arr_application_toolbar_html[\"manage_multiclip\"];\n\ttop.document.getElementById(\"_tr_toolbar\").style.display=\"\";\n\ttop._form_toolbar_holder.style.display=\"block\";\n}\n\n\/\/-- load tree css\nvar fileref= mainform._targetdocument.createElement(\"link\");\nfileref.setAttribute(\"rel\", \"stylesheet\");\nfileref.setAttribute(\"type\", \"text\/css\");\nfileref.setAttribute(\"href\", \"_system\/multiclip\/tree.css\");\nif (typeof fileref!=\"undefined\") mainform._targetdocument.getElementsByTagName(\"head\")[0].appendChild(fileref)\n\n\n\/\/-- load tree\nprocess_multicliptree();\n}"},{"name":"(User Defined Functions)","code":"var multiclipTree;\n\nfunction rf()\n{\n}\n\nfunction select_tree_node()\n{\n\tif(_swdoc._boolModified)\n\t{\n\t\tif(confirm(\"Would you like to save the modifications you have made?\"))\n\t\t{\n\t\t\tmainform._save_current_mc();\n\t\t}\n\t\telse\n\t\t{\n\t\t\t_swdoc._boolModified = false;\n\t\t}\n\t}\n\n\tapp.toolbar_item_dore(\"manage_multiclip\", \"newblock\" , true, top.document);\n\tapp.toolbar_item_dore(\"manage_multiclip\", \"save\" , false, top.document);\n\n\n\tvar oNode = multiclipTree.getSelectedNode();\n\tif(oNode!=undefined)\n\t{\n\t\t_swdoc.SetTitle(\"MultiClip Item Editor - \" + oNode.name);\n\t\n\t\t_swdoc._current_mc_node = oNode;\n\t\tif(oNode.nodeonly)\n\t\t{\n\t\t\tapp.toolbar_item_dore(\"manage_multiclip\", \"newgroup\" , false, top.document);\n\t\t\tapp.toolbar_item_dore(\"manage_multiclip\", \"rename\" , true, top.document);\n\t\t\tapp.toolbar_item_dore(\"manage_multiclip\", \"delete\" , true, top.document);\n\t\t\t\n\t\t\t\/\/-- get data\n\t\t\tvar xmlmc = new XmlMethodCall();\n\t\t\txmlmc.SetParam(\"itemId\", oNode.id)\n\t\t\tif(xmlmc.Invoke(\"system\", \"multiClipGetItemData\"))\n\t\t\t{\n\t\t\t\t\/\/-- enable text\n\t\t\t\t_een(mainform.tb_text , true);\n\t\t\t\t_eva(mainform.tb_text , xmlmc.GetParam(\"itemData\"));\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\t_een(mainform.tb_text , false);\n\t\t\t\t_eva(mainform.tb_text , \"\");\n\t\t\t\tMessageBox(xmlmc.GetLastError());\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tvar id = _swdoc._current_mc_node.id;\n\t\t\tapp.toolbar_item_dore(\"manage_multiclip\", \"newgroup\" , (id==\"_MYP\" || id==\"_MYG\"), top.document);\n\t\t\tapp.toolbar_item_dore(\"manage_multiclip\", \"rename\" , false, top.document);\n\t\t\tapp.toolbar_item_dore(\"manage_multiclip\", \"delete\" , (id!=\"_MYP\" && id!=\"_MYG\"), top.document);\n\t\t\t\n\t\t\t_een(mainform.tb_text , false);\n\t\t\t_eva(mainform.tb_text , \"\");\n\t\t}\n\t}\n}\n\n\nfunction process_multicliptree()\n{\n\t_een(mainform.tb_text , false);\n\t_eva(mainform.tb_text , \"\");\n\n\tapp.toolbar_item_dore(\"manage_multiclip\", \"newblock\" , false, top.document);\n\tapp.toolbar_item_dore(\"manage_multiclip\", \"save\" , false, top.document);\n\tapp.toolbar_item_dore(\"manage_multiclip\", \"newgroup\" , false, top.document);\n\tapp.toolbar_item_dore(\"manage_multiclip\", \"rename\" , false, top.document);\n\tapp.toolbar_item_dore(\"manage_multiclip\", \"delete\" , false, top.document);\n\n\tvar bGroupMc = app.session.HaveRight(app.ANALYST_RIGHT_D_GROUP,app.ANALYST_RIGHT_D_CANEDITGROUPMULTIPASTE);\n\tvar bPersonalMc = app.session.HaveRight(app.ANALYST_RIGHT_D_GROUP,app.ANALYST_RIGHT_D_CANEDITPERSONALMULTIPASTE);\n\n\tif(!bGroupMc && !bPersonalMc)\n\t{\n\t\tMessageBox(\"You do not have permission to manage multiclip items. Please contact your Administrator\");\n\t\t_swdoc.CloseForm();\n\t\treturn false;\n\t}\n\n\t\/\/-- get multiclip tree info\n\tvar xmlmc = new XmlMethodCall();\n\tif(xmlmc.Invoke(\"system\", \"multiClipGetTree\"))\n\t{\n\t\tapp._xml_multiclip_tree = xmlmc.xmlDOM;\n\t}\n\n\tvar aDiv = mainform._targetdocument.getElementById(\"div_mutlicliptree\");\n\tmulticlipTree = app.newtree('multiclipTree',mainform._targetdocument);\n\tmulticlipTree.controlid = aDiv.id;\n\tmulticlipTree.dc = rf;\n\n\tif(bGroupMc)\n\t{\n\t\tvar node = multiclipTree.add(\"_MYG\",\"-1\",\"My Group\",select_tree_node,'','', 'treeimages\/folder.gif', 'treeimages\/folderopen.gif',true);\n\t\tnode._groupname = \"-1\";\n\t\tnode._mcgroupid = \"_MYG\";\n\t\n\t\tvar arrGroupNodes = app._xml_multiclip_tree.getElementsByTagName(\"myGroupMultiClip\");\n\t\tvar xmlGroupNode = arrGroupNodes[0];\n\t\tprocess_mc_grouping(xmlGroupNode,\"_MYG\",\"_MYG\");\n\t}\n\n\tif(bPersonalMc)\n\t{\n\t\tvar node = multiclipTree.add(\"_MYP\",\"-1\",\"My Personal\",select_tree_node,'','', 'treeimages\/folder.gif', 'treeimages\/folderopen.gif',true);\n\t\tnode._groupname = \"-1\";\n\t\tnode._mcgroupid = \"_MYP\";\n\t\n\t\tvar arrPersonalNodes = app._xml_multiclip_tree.getElementsByTagName(\"personalMultiClip\");\n\t\tvar xmlPersonalNode = arrPersonalNodes[0];\n\t\tprocess_mc_grouping(xmlPersonalNode,\"_MYP\",\"_MYP\");\n\t}\n\n\taDiv.innerHTML =  multiclipTree;\n}\n\nfunction process_mc_grouping(oGroupXML,strParentID,strGroupName)\n{\n\tif(oGroupXML==null)return;\n\tvar arrChildNodes = oGroupXML.childNodes;\n\tfor(var x=0;x<arrChildNodes.length;x++)\n\t{\n\t\tvar xmlChild = arrChildNodes[x];\n\t\t\n\t\tif(xmlChild.tagName=='multiClipItem')\n\t\t{\n\t\t\tvar strID = app.xmlNodeTextByTag(xmlChild,\"id\");\n\t\t\tvar strName = app.xmlNodeTextByTag(xmlChild,\"name\");\n\t\t\tvar node = multiclipTree.add(strID,strParentID,strName,select_tree_node,'','', 'treeimages\/document1.gif', 'treeimages\/document1.gif',false,true);\n\t\t\tnode._groupname = strGroupName;\n\t\t\tnode._mcgroupid = strGroupName;\n\t\t}\n\t\telse if(xmlChild.tagName=='multiClipGroup')\n\t\t{\n\t\t\tvar strThisName = app.xmlNodeTextByTag(xmlChild,\"name\");\n\t\t\tvar groupKey =strParentID + \"_\" + strThisName;\n\t\t\tvar node = multiclipTree.add(groupKey,strParentID,strThisName,select_tree_node,'','', 'treeimages\/folder.gif', 'treeimages\/folderopen.gif',false);\n\t\t\tnode._groupname = strGroupName;\n\t\t\tnode._mcgroupid = strThisName;\n\t\t\tprocess_mc_grouping(xmlChild,groupKey,strThisName);\n\t\t}\n\t}\n}\n\nfunction _new_block(strName, strNewParentGroup,strSetDefaultTextValue)\n{\n\tif(strName==undefined || strName==\"\")var strName = prompt(\"Please enter name for multiclip item\",\"\");\n\tif(strName==\"\" || strName==null)return;\n\n\t\/\/-- get top level parent\n\tvar pid = _swdoc._current_mc_node.id;\n\twhile(pid!=\"_MYP\" && pid!=\"_MYG\")\n\t{\n\t\tvar pNode = multiclipTree.getNodeByID(pid);\n\t\tpid = pNode.pid\n\t}\n\n\tvar boolPersonal = (pid==\"_MYP\")?\"true\":\"false\";\n\tvar parentNodeID = _swdoc._current_mc_node._mcgroupid;\n\tif(strNewParentGroup!=undefined && strNewParentGroup!=\"\")parentNodeID=strNewParentGroup;\n\tif(strSetDefaultTextValue==undefined)strSetDefaultTextValue=\"\";\n\t\t\t\n\tvar xmlmc = new XmlMethodCall();\n\txmlmc.SetParam(\"personalClipboard\", boolPersonal);\n\txmlmc.SetParam(\"name\", strName);\n\txmlmc.SetParam(\"itemData\", \"\");\n\tif(parentNodeID!=\"_MYP\" && parentNodeID!=\"_MYG\")xmlmc.SetParam(\"multiClipGroup\", parentNodeID);\n\tif(xmlmc.Invoke(\"system\", \"multiClipAddItem\"))\n\t{\n\t\tvar intID = xmlmc.GetParam(\"itemId\");\n\t\tprocess_multicliptree();\n\n\t\t\/\/-- 90414 - if coming from rename set default text\t\t\n\t\tif(strSetDefaultTextValue!=\"\")\n\t\t{\n\t\t\t\/\/-- set default value\n\t\t\t_swdoc._strModifiedValue=strSetDefaultTextValue;\n\t\t\t_save_current_mc(intID)\n\t\t}\n\t\n\t\t\/\/-- select intID\n\t\tmulticlipTree.openTo(intID,true,false,true);\n\t}\n\telse\n\t{\n\t\tMessageBox(xmlmc.GetLastError())\n\t}\n}\n\nfunction _new_group()\n{\n\tvar strName = prompt(\"Please enter name for multiclip group\",\"\");\n\tif(strName==\"\" || strName==null)return;\n\t\n\tif(_swdoc._current_mc_node!=null)\n\t{\n\t\t\/\/-- add a new temp item - this will allow us to create group\n\t\t_new_block(\"New Item\", strName);\n\t}\n}\n\n\nfunction _save_current_mc(intSaveToBlockId)\n{\n\tif(intSaveToBlockId==undefined)intSaveToBlockId=-1;\n\tif(_swdoc._current_mc_node!=null || intSaveToBlockId!=-1)\n\t{\n\t\tvar strSaveValue = (_swdoc._strModifiedValue!=\"\")?_swdoc._strModifiedValue: mainform.tb_text.value;\n\t\tvar strSaveToItemID = (intSaveToBlockId!=-1)?intSaveToBlockId:_swdoc._current_mc_node.id;\n\t\t_swdoc._strModifiedValue=\"\";\n\t\t\n\t\tvar xmlmc = new XmlMethodCall();\n\t\txmlmc.SetParam(\"itemId\", strSaveToItemID);\n\t\txmlmc.SetParam(\"itemData\", strSaveValue);\n\t\tif(xmlmc.Invoke(\"system\", \"multiClipSetItemData\"))\n\t\t{\n\t\t\t_swdoc._boolModified = false;\n\t\t\tapp.toolbar_item_dore(\"manage_multiclip\", \"save\" , false, top.document);\n\t\t \tmainform.tb_text._usermodifiedinput\t= false;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tMessageBox(xmlmc.GetLastError())\n\t\t}\n\t}\n}\n\nfunction _rename_current_mc()\n{\nif(_swdoc._current_mc_node!=null)\n{\n\tvar strName = prompt(\"Please enter a new name for the item\",\"\");\n\tif(strName==\"\" || strName==null)return;\n\t\n\tvar strOriginalTextValue = (_swdoc._strModifiedValue!=\"\")?_swdoc._strModifiedValue: mainform.tb_text.value;\t\n\t\n\t\/\/-- delete existing item and then create new one\n\tvar xmlmc = new XmlMethodCall();\n\txmlmc.SetParam(\"itemId\", _swdoc._current_mc_node.id);\n\tif(xmlmc.Invoke(\"system\", \"multiClipDeleteItem\"))\n\t{\n\t\t_new_block(strName,\"\",strOriginalTextValue);\n\t}\n\telse\n\t{\n\t\tMessageBox(xmlmc.GetLastError());\n\t}\n}\n}\n\nfunction _delete_current_mc()\n{\n\tif(_swdoc._current_mc_node!=null)\n\t{\n\t\tvar strMsg = (_swdoc._current_mc_node.nodeonly)?\"Are you sure you want to delete the selected item?\":\"This will delete the group and all of it's child items. Do you want to continue?\";\n\t\tif(!confirm(strMsg)) return;\n\t\n\t\t\/\/-- if a group then get all children items and delete one by one\n\t\tif(!_swdoc._current_mc_node.nodeonly)\n\t\t{\n\t\t\tvar arrChildren = multiclipTree._getChildrenArray(_swdoc._current_mc_node);\n\t\t\tfor(strChildID in arrChildren)\n\t\t\t{\n\t\t\t\t\/\/-- delete each item\n\t\t\t\tvar xmlmc = new XmlMethodCall();\n\t\t\t\txmlmc.SetParam(\"itemId\", strChildID);\n\t\t\t\txmlmc.Invoke(\"system\", \"multiClipDeleteItem\");\n\t\t\t}\n\t\n\t\t\tprocess_multicliptree();\n\t\t}\n\t\telse\n\t\t{\n\t\t\t\/\/-- delete existing item and then create new one\n\t\t\tvar xmlmc = new XmlMethodCall();\n\t\t\txmlmc.SetParam(\"itemId\", _swdoc._current_mc_node.id);\n\t\t\tif(xmlmc.Invoke(\"system\", \"multiClipDeleteItem\"))\n\t\t\t{\n\t\t\t\tprocess_multicliptree();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tMessageBox(xmlmc.GetLastError());\n\t\t\t}\n\t\t}\n\t}\n}"},{"name":"tb_text_OnValueChanged","code":"tb_text_OnValueChanged(strValue)\n{\n\t\/\/-- enable save button\n\tif(_swdoc._current_mc_node != null)\n\t{\n\t\t_swdoc._boolModified = true;\n\t\tapp.toolbar_item_dore(\"manage_multiclip\", \"save\" , true, top.document);\t\n\t}\n}"}]}}},{"appearance":{"width":"360","height":"220","backgroundColor":"#ffffff","fillColour":"#ffffff","textColour":"#000000","font":{"@size":"8","#text":"Arial"}},"javascript":{}}]}}}