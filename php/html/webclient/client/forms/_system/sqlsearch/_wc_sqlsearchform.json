{"espForm":{"configuration":{"settings":{"name":"_wc_sqlsearchform","title":"SQL Search","description":"webclient picklist form for lcf","options":{"allowResize":"true","showMenubar":"false","showToolbar":"false","showStatusBar":"false"}},"javascript":{"methods":{"method":{"name":"(Globals)","code":"var _selected_treeformkey = \"\";\nvar _selected_treeformtable = \"\";"}}}},"layouts":{"layout":[{"appearance":{"width":"567","height":"448","backgroundColor":"#f8f8f8","fillColour":"#ffffff","textColour":"#000000","font":{"@size":"8","#text":"Arial"}},"controls":{"control":[{"general":{"name":"sl_picklist","type":"SqlTable","flags":{"transparent":"false","xpStyle":"true","hasShadow":"false","toolbarButtonStyle":"false","cache":"false","hasBorder":"false","hasCheckbox":"false","showHeader":"true","verticalGridLines":"false","horizontalGridLines":"false","autoLoad":"false","allowMultiSelect":"false"}},"appearance":{"index":"0","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Arial"},"borderStyle":"Rectangle"},"objectPlacement":{"position":{"top":"2","left":"1","right":"564","bottom":"220"},"scaling":{"top":"0","left":"0","right":"100","bottom":"30"}},"sortColumn":"-1","sortDescending":"false","headerHeight":"18","rowHeight":"16","selectedColor":"#cae1ee","selectedTextColor":"#ffffff","controlInfo":{"mouseOverCursor":"Window Default","properties":{"highlightStyle":"0","borderColor":"#777777","sqlSource":"swdata"}}},{"general":{"name":"_iframe_preview","type":"Rectange"},"appearance":{"index":"1","backgroundColor":"#ffffff","foregroundColor":"#777777","font":{"@size":"0"},"borderStyle":"Rectangle","fillStyle":"Solid"},"objectPlacement":{"position":{"top":"226","left":"1","right":"564","bottom":"444"},"scaling":{"top":"30","left":"0","right":"100","bottom":"100"}},"controlInfo":{"mouseOverCursor":"Window Default"}}]},"javascript":{"methods":{"method":[{"name":"OnFormLoaded","code":"OnFormLoaded(bDataReloaded)\n{\n\tif(IsObjectDefined(\"app._xmlSearchForms\")==false)return;\n\t\n\tvar strQuery = _swdoc.GetArg('query');\n\tvar intLimit = _swdoc.GetArg('limit');\n\t\n\tvar oRS = app._new_SqlQuery();\n\tif(!oRS.HasRight(strQuery))\n\t{\n\t\t_swdoc.CloseForm();\n\t}\n\n\tvar _arr_sql = app._split_sqlquery(strQuery);\n\tvar strTable = _arr_sql['table'];\n\n\t\/\/-- only allow selects\n\tif(_arr_sql['action']!=\"select\")\n\t{\n\t\tMessageBox(\"Only SQL Select statements can be processed using the sqlsearch action. Please contact your Administrator\");\n\t\t_swdoc.CloseForm();\n\t\treturn false;\n\t}\n\n\tif(strTable.indexOf(\",\")==-1)\n\t{\n\t\tsl_picklist.table = strTable;\n\t\tsl_picklist.editRecordForm = app.dd.tables[strTable].editform;\n\t}\n\telse\n\t{\n\t\tsl_picklist.table = \"\";\n\t\tsl_picklist.editRecordForm =\"\";\n\t}\n\n\tvar arrColumns = new Array();\n\t\n\tif (app.trim(_arr_sql['columns'])==\"*\")\n\t{\n\t\t\/\/-- create columns from table\n\t\tif(dd.tables[sl_picklist.table]!=undefined)\n\t\t{\n\t\t\tfor(strColName in dd.tables[sl_picklist.table].namedcolumns)\n\t\t\t{\n\t\t\t\tarrColumns[arrColumns.length++] = strColName;\n\t\t\t}\n\t\t}\n\t}\n\telse\n\t{\n\t\tarrColumns = _arr_sql['columns'].split(\",\");\n\t}\n\n\n\tif(arrColumns.length>0)sl_picklist._create_bespoke_xmlcols(arrColumns);\n\n\tsl_picklist._limit = intLimit;\n\t_slraw(sl_picklist , strQuery);\n\n\t_swdoc.SetTitle(\"SQL Search (\" + sl_picklist.rowCount() +\")\");\n\tif(sl_picklist.rowCount()>0)sl_picklist.SetRowSelected(0);\n}"},{"name":"sl_picklist_OnItemDoubleClicked","code":"sl_picklist_OnItemDoubleClicked(nRow, nCol)\n{\n\tvar sCol = dd.tables[sl_picklist.table].PrimaryKey;\n\tvar keyValue = sl_picklist.GetItemTextRaw(nRow, sCol)\n\tif(keyValue!=\"\")\n\t{\n\t\tif(_swdoc.GetArg(\"resolvemode\")==\"1\")\n\t\t{\n\t\t\t_swdoc._selected_treeformkey = keyValue;\n\t\t\t_swdoc.CloseForm();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tvar strEditForm = dd.tables[sl_picklist.table].editform;\n\t\t\tif(strEditForm!=\"\")\n\t\t\t{\n\t\t\t\tapp.OpenFormForEdit(strEditForm, keyValue, \"\", true);\n\t\t\t}\n\t\t\telse if(sl_picklist.table==\"opencall\")\n\t\t\t{\n\t\t\t\tapp._open_call_detail(keyValue)\t;\n\t\t\t}\n\t\t}\n\t}\n\n\treturn false;\n}"},{"name":"sl_picklist_OnItemSelected","code":"sl_picklist_OnItemSelected(nRow)\n{\n\t\/\/-- check if we have an acivepage for this table.keycolumn\n\tvar strURL = app._webserver + \"webclient\/client\/forms\/noform.htm\";\n\tvar strTable = sl_picklist.table;\n\tvar sCol = dd.tables[sl_picklist.table].PrimaryKey;\n\tvar keyValue = sl_picklist.GetItemTextRaw(nRow, sCol)\n\tif(keyValue!=\"\")\n\t{\n\t\tvar strTableCol = strTable + \".\" + sCol;\n\t\tvar strActivePage = app.dd.GetGlobalParamAsString(\"active folder pages\/\" + strTableCol);\n\t\tif(strActivePage!=\"\") \n\t\t{\n\t\t\tvar strParams = \"sessid=\" + app.pfu(app._swsessionid) + \"&\" + sCol + \"=\" + app.pfu(keyValue) + \"&keyvalue=\" + app.pfu(keyValue);\n\t\t\tstrURL = app._swc_parse_variablestring(strActivePage,_swdoc,false,false);\n\t\t\tif(strURL.indexOf(\"?\")>-1)\n\t\t\t{\n\t\t\t\tstrURL += \"&\" + strParams;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tstrURL += \"?\" + strParams;\n\t\t\t}\n\t\t}\n\t}\n\t\/\/-- set iframe src\n\t_iframe_preview.element.src = strURL;\t\n\t\n\n\n}"}]}}},{"appearance":{"width":"360","height":"220","backgroundColor":"#ffffff","fillColour":"#ffffff","textColour":"#000000","font":{"@size":"8","#text":"Arial"}},"javascript":{}}]}}}