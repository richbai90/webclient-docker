{"espForm":{"configuration":{"settings":{"name":"_sys_cdf_manage_newworkflow","title":"Manage Workflow Additions","options":{"allowResize":"true","showMenubar":"false","showToolbar":"false","showStatusBar":"false"}},"javascript":{"methods":{"method":[{"name":"(Globals)","code":"var _iSequenceAdjust =0;\nvar _lastItemRow = null;\nvar _lastExpRow = null;\nvar _lastExpRowBG = \"\";\nvar _currentGroupFlags = -1;\nvar _currentGroup = \"\";\nvar _currentGroupTaskCount = 0;\nvar _currentGroupSeq = 0;\n\nfunction _onselected_existing_template(strTemplateName,strWorklist)\n{\n\n\t\/\/-- params\n\tvar strParams = \"_table=\" + _swdoc.GetArg(\"_tempworkflowtable\") + \"&_templatename=\" + strTemplateName+\"&_worklistname=\"+strWorklist;\n\t\/\/-- call service\n\tvar strURL = app.webroot + \"\/webclient\/service\/workflow\/add_workflow_template.php\";\n\tvar res = app.get_http(strURL, \"swsessionid=\" + app._swsessionid + \"&\"+ strParams, true, false,  null, null);\n\t\/\/MessageBox(res)\n\tif(res==\"ok\")\n\t{\n\t\t_swdoc._filter_workflow_list();\n\t}\n}\n\n\nfunction _filter_workflow_list()\n{\n\t_swdoc._lastExpRow = null;\n\t\n\tmainform.sl_browse.sortDescending = false;\n\tmainform.sl_browse._filter(\"\")\n\t_swdoc._setup_buttonitems();\n}\n\nfunction _setup_buttonitems()\n{\n\t\/\/-- enable add item menus\n\t_een(mainform.btn_newtask , false);\n\t_een(mainform.btn_newworklist , true);\n\t_een(mainform.btn_delete , false);\t\t\n\t_een(mainform.btn_rename , false);\t\t\t\n\t_een(mainform.btn_seq , false);\t\t\t\t\n\t_een(mainform.btn_up, false);\n\t_een(mainform.btn_down, false);\t\n\t\n\t_een(mainform.btn_apply , (mainform.sl_browse.rowCount()>0));\n\n}\n\n\n\/\/-- check if a worklist name already exists in list returns t\/f\nfunction _worklist_exists(strName)\n{\n\tvar ret = false;\n\tif(mainform.sl_browse._datatable!=null)\n\t{\n\t\tvar arrRows = mainform.sl_browse._datatable.rows;\n\t\tfor(var x=0;x<arrRows.length;x++)\n\t\t{\n\t\t\tif(arrRows[x].getAttribute!=null)\n\t\t\t{\n\t\t\t\tif(arrRows[x].getAttribute(\"type\")==\"expander\")\n\t\t\t\t{\n\t\t\t\t\tvar strCheckName = arrRows[x].getAttribute(\"parentgroup\").toLowerCase();\n\t\t\t\t\tif(strCheckName==strName.toLowerCase()) return true;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\treturn false;\n}\n\nfunction _get_nextnew_pgs()\n{\n\tvar pgs = -1;\n\tif(mainform.sl_browse._datatable!=null)\n\t{\n\t\tvar arrRows = mainform.sl_browse._datatable.rows;\n\t\tfor(var x=0;x<arrRows.length;x++)\n\t\t{\n\t\t\tif(arrRows[x].getAttribute!=null)\n\t\t\t{\n\t\t\t\tif(arrRows[x].getAttribute(\"type\")==\"expander\")\n\t\t\t\t{\n\t\t\t\t\tpgs = arrRows[x].getAttribute(\"parentgroupsequence\");\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tpgs++;\n\tpgs= pgs + _swdoc._iSequenceAdjust;\n\treturn pgs;\n\n}\n\nfunction _move_worklist_or_item(strDir)\n{\n\tvar strURL = app.webroot + \"\/webclient\/service\/workflow\/move_worklistposition.php\";\n\tvar strTaskID = \"\";\n\tif(_swdoc._lastItemRow != null)\n\t{\n\t\t\/\/-- moving task\n\t\tvar strURL = app.webroot + \"\/webclient\/service\/workflow\/move_workitemposition.php\";\n\t\tstrTaskID = sl_browse.GetItemTextRaw(sl_browse.curSel,\"taskid\");\n\t}\n\n\t\/\/-- insert new worklist in temp workflow table\n\tvar strParams = \"_dir=\"+strDir+\"&_table=\" + _swdoc.GetArg(\"_tempworkflowtable\") + \"&_worklistname=\" + _swdoc._currentGroup + \"&_pgs=\"+_swdoc._currentGroupSeq+\"&_taskid=\" + strTaskID;\t\n\tvar res = app.get_http(strURL, \"swsessionid=\" + app._swsessionid + \"&\"+ strParams, true, false,  null, null);\n\tif(res==\"ok\")\n\t{\n\t\t_swdoc._filter_workflow_list();\n\t}\n}\n\nfunction _onselected_existing_template(strTemplateName,strWorklist)\n{\n\t\/\/-- params\n\tvar strParams = \"_table=\" + _swdoc.GetArg(\"_tempworkflowtable\") + \"&_templatename=\" + strTemplateName+\"&_worklistname=\"+strWorklist+\"&_pgs=\" + _swdoc._get_nextnew_pgs();\n\t\/\/-- call service\n\tvar strURL = app.webroot + \"\/webclient\/service\/workflow\/add_workflow_template.php\";\n\tvar res = app.get_http(strURL, \"swsessionid=\" + app._swsessionid + \"&\"+ strParams, true, false,  null, null);\n\t\/\/MessageBox(res)\n\tif(res==\"ok\")\n\t{\n\t\t_swdoc._filter_workflow_list();\n\t}\n}"},{"name":"OnFormClosing","code":"OnFormClosing()\n{\n\t\/\/-- remove any temp records\n\tvar strParams = \"_table=\" + _swdoc.GetArg(\"_tempworkflowtable\") + \"&_callref=\" + _swdoc.GetArg(\"_callref\");\n\tvar strURL = app.webroot + \"\/webclient\/service\/workflow\/delete_temp_workflow.php\";\n\tapp.get_http(strURL, \"swsessionid=\" + app._swsessionid + \"&\"+ strParams, false, false,  null, null);\n\t\n}"}]}}},"layouts":{"layout":[{"appearance":{"width":"651","height":"428","backgroundColor":"#eaeaea","fillColour":"#ffffff","textColour":"#000000","font":{"@size":"8","#text":"Arial"}},"controls":{"control":[{"general":{"name":"sl_browse","type":"SqlTable","flags":{"transparent":"false","xpStyle":"false","hasShadow":"false","toolbarButtonStyle":"false","cache":"false","hasBorder":"false","hasCheckbox":"false","showHeader":"true","verticalGridLines":"true","horizontalGridLines":"true","autoLoad":"false","allowMultiSelect":"false"}},"appearance":{"index":"0","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Arial"},"borderStyle":"Rectangle"},"objectPlacement":{"position":{"top":"8","left":"5","right":"551","bottom":"418"},"scaling":{"top":"0","left":"0","right":"100","bottom":"100"}},"columns":{"controlInfo":[{"mouseOverCursor":"Window Default","type":"Text Edit","flags":{"invisible":"false","readOnly":"false","mandatory":"false","mandatoryLabelBackground":"false","mandatoryLabelText":"false","allowNullValue":"false","skipTabStop":"false","disabled":"false","protected":"false","noMacroExpand":"false","readOnlyInit":"false","autoCompleteField":"false","editUnlimitedText":"false","url":"false","hidden":"false","allowResize":"true","allowSort":"false"},"textLineCount":"0","textInputFormat":"Text","properties":{"column":"taskid"},"name":"ID","width":"45","image":"-1","dataColumn":"0"},{"mouseOverCursor":"Window Default","type":"Text Edit","flags":{"invisible":"false","readOnly":"false","mandatory":"false","mandatoryLabelBackground":"false","mandatoryLabelText":"false","allowNullValue":"false","skipTabStop":"false","disabled":"false","protected":"false","noMacroExpand":"false","readOnlyInit":"false","autoCompleteField":"false","editUnlimitedText":"false","url":"false","hidden":"false","allowResize":"true","allowSort":"false"},"textLineCount":"0","textInputFormat":"Text","properties":{"column":"compltbyx"},"name":"Time","width":"85","image":"-1","dataColumn":"2"},{"mouseOverCursor":"Window Default","type":"Text Edit","flags":{"invisible":"false","readOnly":"false","mandatory":"false","mandatoryLabelBackground":"false","mandatoryLabelText":"false","allowNullValue":"false","skipTabStop":"false","disabled":"false","protected":"false","noMacroExpand":"false","readOnlyInit":"false","autoCompleteField":"false","editUnlimitedText":"false","url":"false","hidden":"false","allowResize":"true","allowSort":"false"},"textLineCount":"0","textInputFormat":"Text","properties":{"column":"details"},"name":"Description","width":"209","image":"-1","dataColumn":"4"},{"mouseOverCursor":"Window Default","type":"Text Edit","flags":{"invisible":"false","readOnly":"false","mandatory":"false","mandatoryLabelBackground":"false","mandatoryLabelText":"false","allowNullValue":"false","skipTabStop":"false","disabled":"false","protected":"false","noMacroExpand":"false","readOnlyInit":"false","autoCompleteField":"false","editUnlimitedText":"false","url":"false","hidden":"false","allowResize":"true","allowSort":"false"},"textLineCount":"0","textInputFormat":"Text","properties":{"column":"groupid"},"name":"Assign Group","width":"120","image":"-1","dataColumn":"4"},{"mouseOverCursor":"Window Default","type":"Text Edit","flags":{"invisible":"false","readOnly":"false","mandatory":"false","mandatoryLabelBackground":"false","mandatoryLabelText":"false","allowNullValue":"false","skipTabStop":"false","disabled":"false","protected":"false","noMacroExpand":"false","readOnlyInit":"false","autoCompleteField":"false","editUnlimitedText":"false","url":"false","hidden":"false","allowResize":"true","allowSort":"false"},"textLineCount":"0","textInputFormat":"Text","properties":{"column":"analystid"},"name":"Assignee","width":"120","image":"-1","dataColumn":"5"},{"mouseOverCursor":"Window Default","type":"Text Edit","flags":{"invisible":"false","readOnly":"false","mandatory":"false","mandatoryLabelBackground":"false","mandatoryLabelText":"false","allowNullValue":"false","skipTabStop":"false","disabled":"false","protected":"false","noMacroExpand":"false","readOnlyInit":"false","autoCompleteField":"false","editUnlimitedText":"false","url":"false","hidden":"true","allowResize":"true","allowSort":"true"},"textLineCount":"0","textInputFormat":"Text","properties":{"column":"parentgroupsequence"},"name":"groupseq","width":"63","image":"-1","dataColumn":"6"},{"mouseOverCursor":"Window Default","type":"Text Edit","flags":{"invisible":"false","readOnly":"false","mandatory":"false","mandatoryLabelBackground":"false","mandatoryLabelText":"false","allowNullValue":"false","skipTabStop":"false","disabled":"false","protected":"false","noMacroExpand":"false","readOnlyInit":"false","autoCompleteField":"false","editUnlimitedText":"false","url":"false","hidden":"true","allowResize":"true","allowSort":"true"},"textLineCount":"0","textInputFormat":"Text","properties":{"column":"parentgroup"},"name":"grouptitle","width":"63","image":"-1","dataColumn":"7"},{"mouseOverCursor":"Window Default","type":"Text Edit","flags":{"invisible":"false","readOnly":"false","mandatory":"false","mandatoryLabelBackground":"false","mandatoryLabelText":"false","allowNullValue":"false","skipTabStop":"false","disabled":"false","protected":"false","noMacroExpand":"false","readOnlyInit":"false","autoCompleteField":"false","editUnlimitedText":"false","url":"false","hidden":"true","allowResize":"true","allowSort":"true"},"textLineCount":"0","textInputFormat":"Text","properties":{"column":"flags"},"name":"flags","width":"55","image":"-1","dataColumn":"7"}]},"sortColumn":"5","sortDescending":"false","headerHeight":"16","rowHeight":"16","selectedColor":"#00008b","selectedTextColor":"#ffffff","controlInfo":{"mouseOverCursor":"Window Default","properties":{"sqlSource":"syscache","table":"calltasks","newRecordForm":"Form._sys_calltask","editRecordForm":"Form._sys_calltask","selectionMode":"0"}}},{"general":{"name":"btn_apply","type":"EventButton"},"appearance":{"index":"1","caption":"Apply Workflow","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Arial"}},"objectPlacement":{"position":{"top":"363","left":"560","right":"648","bottom":"389"},"scaling":{"top":"100","left":"100","right":"100","bottom":"100"}},"controlInfo":{"mouseOverCursor":"Window Default","flags":{"invisible":"false","skipTabStop":"false","disabled":"true","protected":"false","noMacroExpand":"false","multiLine":"false"},"properties":{"backgroundColor":"#ff9900"}}},{"general":{"name":"btn_cancel","type":"EventButton"},"appearance":{"index":"2","caption":"Cancel","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Arial"}},"objectPlacement":{"position":{"top":"393","left":"560","right":"648","bottom":"419"},"scaling":{"top":"100","left":"100","right":"100","bottom":"100"}},"controlInfo":{"mouseOverCursor":"Window Default","properties":{"backgroundColor":"#ff9900"}}},{"general":{"name":"btn_template","type":"EventButton"},"appearance":{"index":"3","caption":"Add Template","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Arial"}},"objectPlacement":{"position":{"top":"6","left":"560","right":"648","bottom":"32"},"scaling":{"top":"0","left":"100","right":"100","bottom":"0"}},"controlInfo":{"mouseOverCursor":"Window Default","properties":{"backgroundColor":"#ff9900"}}},{"general":{"name":"btn_worklist","type":"EventButton"},"appearance":{"index":"4","caption":"Add Worklist","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Arial"}},"objectPlacement":{"position":{"top":"35","left":"560","right":"648","bottom":"61"},"scaling":{"top":"0","left":"100","right":"100","bottom":"0"}},"controlInfo":{"mouseOverCursor":"Window Default","properties":{"backgroundColor":"#ff9900"}}},{"general":{"name":"btn_newtask","type":"EventButton"},"appearance":{"index":"5","caption":"NewTask","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Arial"}},"objectPlacement":{"position":{"top":"112","left":"560","right":"648","bottom":"138"},"scaling":{"top":"0","left":"100","right":"100","bottom":"0"}},"controlInfo":{"mouseOverCursor":"Window Default","flags":{"invisible":"false","skipTabStop":"false","disabled":"true","protected":"false","noMacroExpand":"false","multiLine":"false"},"properties":{"backgroundColor":"#ff9900"}}},{"general":{"name":"btn_newworklist","type":"EventButton"},"appearance":{"index":"6","caption":"New Worklist","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Arial"}},"objectPlacement":{"position":{"top":"82","left":"560","right":"648","bottom":"108"},"scaling":{"top":"0","left":"100","right":"100","bottom":"0"}},"controlInfo":{"mouseOverCursor":"Window Default","properties":{"backgroundColor":"#ff9900"}}},{"general":{"name":"btn_delete","type":"EventButton"},"appearance":{"index":"7","caption":"Remove","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Arial"}},"objectPlacement":{"position":{"top":"193","left":"560","right":"648","bottom":"219"},"scaling":{"top":"0","left":"100","right":"100","bottom":"0"}},"controlInfo":{"mouseOverCursor":"Window Default","flags":{"invisible":"false","skipTabStop":"false","disabled":"true","protected":"false","noMacroExpand":"false","multiLine":"false"},"properties":{"backgroundColor":"#ff9900"}}},{"general":{"name":"btn_up","type":"EventButton"},"appearance":{"index":"8","caption":"Move Up","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Arial"}},"objectPlacement":{"position":{"top":"280","left":"560","right":"648","bottom":"306"},"scaling":{"top":"0","left":"100","right":"100","bottom":"0"}},"controlInfo":{"mouseOverCursor":"Window Default","flags":{"invisible":"false","skipTabStop":"false","disabled":"true","protected":"false","noMacroExpand":"false","multiLine":"false"},"properties":{"backgroundColor":"#ff9900"}}},{"general":{"name":"btn_down","type":"EventButton"},"appearance":{"index":"9","caption":"Move Down","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Arial"}},"objectPlacement":{"position":{"top":"310","left":"560","right":"648","bottom":"336"},"scaling":{"top":"0","left":"100","right":"100","bottom":"0"}},"controlInfo":{"mouseOverCursor":"Window Default","flags":{"invisible":"false","skipTabStop":"false","disabled":"true","protected":"false","noMacroExpand":"false","multiLine":"false"},"properties":{"backgroundColor":"#ff9900"}}},{"general":{"name":"btn_seq","type":"EventButton"},"appearance":{"index":"10","caption":"Toggle Seq.","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Arial"}},"objectPlacement":{"position":{"top":"251","left":"560","right":"648","bottom":"277"},"scaling":{"top":"0","left":"100","right":"100","bottom":"0"}},"controlInfo":{"mouseOverCursor":"Window Default","flags":{"invisible":"false","skipTabStop":"false","disabled":"true","protected":"false","noMacroExpand":"false","multiLine":"false"},"properties":{"backgroundColor":"#ff9900"}}},{"general":{"name":"btn_rename","type":"EventButton"},"appearance":{"index":"11","caption":"Rename","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Arial"}},"objectPlacement":{"position":{"top":"142","left":"560","right":"648","bottom":"168"},"scaling":{"top":"0","left":"100","right":"100","bottom":"0"}},"controlInfo":{"mouseOverCursor":"Window Default","flags":{"invisible":"false","skipTabStop":"false","disabled":"true","protected":"false","noMacroExpand":"false","multiLine":"false"},"properties":{"backgroundColor":"#ff9900"}}}]},"javascript":{"methods":{"method":[{"name":"btn_cancel_OnPressed","code":"btn_cancel_OnPressed()\n{\n\n\n\t_swdoc.CloseForm();\n\t\n\n}"},{"name":"btn_apply_OnPressed","code":"btn_apply_OnPressed()\n{\n\t\/\/-- check for duplicate names that may exist in the current workflow\n\tvar oCallWindow = top.info.__parentwindow;\n\tif(sl_browse._datatable==null) return;\n\tvar arrRows = sl_browse._datatable.rows;\n\tfor(var x=0;x<arrRows.length;x++)\n\t{\n\t\tif(arrRows[x].getAttribute!=null)\n\t\t{\n\t\t\tif(arrRows[x].getAttribute(\"type\")==\"expander\")\n\t\t\t{\n\t\t\t\tvar strCheckName = arrRows[x].getAttribute(\"parentgroup\")\n\t\t\t\tvar oMatchedRow = oCallWindow._doc.getElementById(\"if_workflow\").contentWindow._worklist_exists(strCheckName);\n\t\t\t\t\n\t\t\t\tif(oMatchedRow)\n\t\t\t\t{\n\t\t\t\t\t\/\/-- use matched pgs if user opts to merge\n\t\t\t\t\tvar iMatchedParentGroupSeq = oMatchedRow.getAttribute(\"parentgroupsequence\");\n\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\/\/-- get alt name\n\t\t\t\t\tvar strParams = \"_callref=\" + _swdoc.GetArg(\"_callref\") + \"&_worklistname=\" + strCheckName;\n\t\t\t\t\tvar strURL = app.webroot + \"\/webclient\/service\/workflow\/check_worklist_name_availability.php\";\n\t\t\t\t\tvar strAltName = app.get_http(strURL, \"swsessionid=\" + app._swsessionid + \"&\"+ strParams, true, false,  null, null);\n\t\t\t\t\n\t\t\t\t\tvar res = MessageBox(\"The workflow you have chosen to add contains a group called '\" +strCheckName+ \"' but there is already a group with this name defined in the current workflow.\\n\\n-To add a second group called '\"+strAltName+\"' choose Yes.\\n-To merge these items into the existing group choose No.\\n-To cancel the addition of this group choose Cancel.\",MB_YESNOCANCEL);\n\t\t\t\t\tif(res==2)\n\t\t\t\t\t{\n\t\t\t\t\t\t\/\/-- delete workflow - user cancelled adding this one\n\t\t\t\t\t\tvar strParams = \"_type=list&_table=\" + _swdoc.GetArg(\"_tempworkflowtable\") + \"&_worklistname=\" + strCheckName;\n\t\t\t\t\t\tvar strURL = app.webroot + \"\/webclient\/service\/workflow\/delete_temp_workitem.php\";\n\t\t\t\t\t\tvar res = app.get_http(strURL, \"swsessionid=\" + app._swsessionid + \"&\"+ strParams, true, false,  null, null);\n\t\t\t\t\t}\n\t\t\t\t\telse if(res==6)\n\t\t\t\t\t{\n\t\t\t\t\t\t\/\/-- add with alt name - so change name in temp db\n\t\t\t\t\t\tvar strParams = \"&dsn=sw_systemdb&_table=\" + _swdoc.GetArg(\"_tempworkflowtable\") + \"&_worklistname=\" + strCheckName + \"&_newname=\" + strAltName;\n\t\t\t\t\t\tvar strURL = app.webroot + \"\/webclient\/service\/workflow\/rename_worklist.php\";\n\t\t\t\t\t\tvar res = app.get_http(strURL, \"swsessionid=\" + app._swsessionid + \"&\"+ strParams, true, false,  null, null);\n\t\t\t\t\t}\n\t\t\t\t\telse if(res==0)\n\t\t\t\t\t{\n\t\t\t\t\t\t\/\/-- merge - leave it as it is currently named - though need to change the pgs so it matches up with one we are merging with\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\t\n\t\n\t\/\/-- add workflow to parent call\n\tvar strParams = \"_table=\" + _swdoc.GetArg(\"_tempworkflowtable\") + \"&_callref=\" + _swdoc.GetArg(\"_callref\");\n\tvar strURL = app.webroot + \"\/webclient\/service\/workflow\/attach_call_workflow.php\";\n\tvar res = app.get_http(strURL, \"swsessionid=\" + app._swsessionid + \"&\"+ strParams, true, false,  null, null);\n\tif(res!=\"ok\")\n\t{\n\t\tMessageBox(\"The system failed to attach the workflow additions due to the follwing reason:-\\n\\n\"+res+\"\\n\\nPlease contact your Administrator.\");\n\t}\n\n\t_swdoc.CloseForm();\n}"},{"name":"OnFormLoaded","code":"OnFormLoaded(bDataReloaded)\n{\n\tif(!app.bWebClient)return;\n\t\/\/-- get sequence adjuster\n\t_swdoc._iSequenceAdjust = _swdoc.GetArg(\"_pgs\");\n\tif(_swdoc._iSequenceAdjust==\"\")\n\t{\n\t\t_swdoc._iSequenceAdjust=0;\n\t}\n\telse\n\t{\n\t\t_swdoc._iSequenceAdjust--;\n\t\t_swdoc._iSequenceAdjust++;\n\t}\n\t\n\t\n\t\n\tsl_browse._expandercol = \"parentgroup\";\n\tsl_browse._expandercolseq = \"parentgroupse\";\n\tsl_browse.table = \"wc_calltasks\";\n\tsl_browse.source = \"sw_systemdb\";\n\tsl_browse._srcType = 'php';\n\tsl_browse._phpSrc = \"phpquery\/get_manageworkflow_sqllist.php\";\n\tsl_browse._phpParams = new Array();\n\tsl_browse._phpParams['_temptable'] = _swdoc.GetArg(\"_tempworkflowtable\");\n\n\n\n}"},{"name":"btn_template_OnPressed","code":"btn_template_OnPressed()\n{\n\t\/\/-- pick template to add to form\n\tvar oForm = app.OpenWebClientForm(\"_sys_pickworkflow\",\"\",\"\",true,\"workflow\",window,undefined);\n\tif(oForm.document._templatename==\"\")return;\n\t\n\t_swdoc._onselected_existing_template(oForm.document._templatename,oForm.document._worklistname);\t\n\n}"},{"name":"btn_worklist_OnPressed","code":"btn_worklist_OnPressed()\n{\n\tvar oForm = app.OpenWebClientForm(\"_sys_pickworkflow_list\",\"\",\"\",true,\"workflow\",window,undefined);\n\tif(oForm.document._worklistname==\"\")return;\n\n\t_swdoc._onselected_existing_template(oForm.document._templatename,oForm.document._worklistname);\n\n}"},{"name":"btn_newtask_OnPressed","code":"btn_newtask_OnPressed()\n{\n\n\tvar strParams = \"_nexttaskid=\"+ (++_swdoc._currentGroupTaskCount) +\"&_table=\" + _swdoc.GetArg(\"_tempworkflowtable\") + \"&_parentgroup=\" + _swdoc._currentGroup + \"&_pgs=\" + _swdoc._currentGroupSeq;\n\t\/\/MessageBox(_swdoc._currentGroupSeq)\n\tapp.OpenWebClientForm(\"_sys_new_calltask\",\"\",strParams,true,\"workflow\",window,undefined);\n\t_swdoc._filter_workflow_list();\n\n}"},{"name":"btn_newworklist_OnPressed","code":"btn_newworklist_OnPressed()\n{\n\tvar strName = prompt(\"Please enter the name of the new worklist:\",\"\");\n\tif(strName==\"\" || strName==null || strName==undefined) return;\n\n\t\/\/-- check does not already exist\n\tif(_swdoc._worklist_exists(strName))\n\t{\n\t\tMessageBox(\"A worklist of the same name already exists. Please enter a different name.\");\n\t\treturn;\n\t}\n\n\n\t\/\/-- get parent sequence id\n\tvar iPGS = _swdoc._get_nextnew_pgs();\n\n\t\/\/-- insert new worklist in temp workflow table\n\tvar tempTable = _swdoc.GetArg(\"_tempworkflowtable\");\n\tvar strParams = \"swsessionid=\" + app._swsessionid + \"&_type=list&_table=\" + tempTable + \"&_worklistname=\" + strName + \"&_pgs=\" + iPGS;\n\t\n\tvar strURL = app.webroot + \"\/webclient\/service\/workflow\/create_temp_workitem.php\";\n\tvar res = app.get_http(strURL, strParams, true, false,  null, null);\n\tif(res==\"ok\")\n\t{\n\t\t_swdoc._filter_workflow_list();\n\t}\n\telse\n\t{\n\t\tMessageBox(\"The system was not able to create the Worklist. Please contact your Administrator.\");\n\t}\n}"},{"name":"btn_delete_OnPressed","code":"btn_delete_OnPressed()\n{\n\t\n\tvar strTaskID = \"\";\n\tif(_swdoc._lastItemRow != null)\n\t{\n\t\tstrTaskID = sl_browse.GetItemTextRaw(sl_browse.curSel,\"taskid\");\n\t}\n\n\t\/\/-- insert new worklist in temp workflow table\n\tvar strParams = \"_type=list&_table=\" + _swdoc.GetArg(\"_tempworkflowtable\") + \"&_worklistname=\" + _swdoc._currentGroup + \"&_taskid=\" + strTaskID;\n\tvar strURL = app.webroot + \"\/webclient\/service\/workflow\/delete_temp_workitem.php\";\n\tvar res = app.get_http(strURL, \"swsessionid=\" + app._swsessionid + \"&\"+ strParams, true, false,  null, null);\n\tif(res==\"ok\")\n\t{\n\t\tvar iCurRow = sl_browse.curSel;\n\t\t_swdoc._filter_workflow_list();\n\t\tsl_browse.SetRowSelected(iCurRow);\n\t}\n\n}"},{"name":"btn_up_OnPressed","code":"btn_up_OnPressed()\n{\n\t_swdoc._move_worklist_or_item(\"up\");\n\t\n}"},{"name":"btn_down_OnPressed","code":"btn_down_OnPressed()\n{\n\t_swdoc._move_worklist_or_item(\"down\");\n\t\n\n}"},{"name":"btn_seq_OnPressed","code":"btn_seq_OnPressed()\n{\n\tif(_swdoc._currentGroup!=\"\")\n\t{\n\t\t\n\t\tvar strParams = \"_type=list&_table=\" + _swdoc.GetArg(\"_tempworkflowtable\") + \"&_worklistname=\" + _swdoc._currentGroup +\"&_flags=\" + _swdoc._currentGroupFlags;\n\t\tvar strURL = app.webroot + \"\/webclient\/service\/workflow\/set_worklist_sequence.php\";\n\t\tvar res = app.get_http(strURL, \"swsessionid=\" + app._swsessionid + \"&\"+ strParams, true, false,  null, null);\n\t\tif(res==\"ok\")\n\t\t{\n\t\t\tvar iCurRow = sl_browse.curSel;\n\t\t\t_swdoc._filter_workflow_list();\n\t\t\tsl_browse.SetRowSelected(iCurRow);\n\t\t}\n\t}\n\n}"},{"name":"sl_browse_OnItemDoubleClicked","code":"sl_browse_OnItemDoubleClicked(nRow, nCol)\n{\n\t\t\/\/-- call webclient method to open system form\n\t\tvar iKey = sl_browse.GetItemTextRaw(sl_browse.curSel,\"taskid\");\n\t\tif(iKey!=\"\")\n\t\t{ \n\t\t\tvar strParentGroup = sl_browse.GetItemTextRaw(sl_browse.curSel,\"parentgroup\");\n\t\t\tvar strParams = \"_table=\"+_swdoc.GetArg(\"_tempworkflowtable\") + \"&parentgroup=\" + strParentGroup;\n\t\t\tapp.OpenWebClientForm(\"_sys_new_calltask\",iKey,strParams,true,\"workflow\",window,undefined);\n\t\t\n\t\t\tvar iCurRow = sl_browse.curSel;\n\t\t\t_swdoc._filter_workflow_list();\n\t\t\tsl_browse.SetRowSelected(iCurRow);\n\t\t}\n\t\treturn false;\n\n\n}"},{"name":"btn_rename_OnPressed","code":"btn_rename_OnPressed()\n{\n\t\/\/-- get expander row if not already selected\n\tvar eleRow = _swdoc._lastExpRow;\n\tif(eleRow==null)\n\t{\n\t\teleRow = _swdoc._lastItemRow;\n\t\twhile(eleRow.getAttribute(\"type\")!=\"expander\")\n\t\t{\n\t\t\teleRow = eleRow.previousSibling;\n\t\t\tif(eleRow==null)\n\t\t\t{\n\t\t\t\tMessageBox(\"There is a technical problem with the workflow table [unable to find expander]. Please contact your Administrator.\");\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t}\n\n\t\/\/-- add new worklist name\n\tvar strCurrentName = eleRow.getAttribute(\"parentgroup\");\n\tvar strNewName = prompt(\"Please enter the new name of the worklist:\",strCurrentName);\n\tif(strNewName!=\"\" && strNewName!=null && strNewName!=undefined)\n\t{\n\t\t\/\/-- check does not already exist\n\t\tif(_swdoc._worklist_exists(strNewName))\n\t\t{\n\t\t\tMessageBox(\"A worklist of the same name already exists. Please enter a different name.\");\n\t\t\treturn;\n\t\t}\n\n\t\t\/\/-- call service to change it\n\t\tvar strParams = \"&dsn=sw_systemdb&_table=\" + _swdoc.GetArg(\"_tempworkflowtable\") + \"&_worklistname=\" + strCurrentName + \"&_newname=\" + strNewName;\n\t\tvar strURL = app.webroot + \"\/webclient\/service\/workflow\/rename_worklist.php\";\n\t\tvar res = app.get_http(strURL, \"swsessionid=\" + app._swsessionid + \"&\"+ strParams, true, false,  null, null);\n\t\tif(res==\"ok\")\n\t\t{\n\t\t\tvar iCurRow = sl_browse.curSel;\n\t\t\t_swdoc._filter_workflow_list();\n\t\t\tsl_browse.SetRowSelected(iCurRow);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tMessageBox(\"The system was not able to rename the Worklist. Please contact your Administrator.\");\n\t\t}\n\t}\n\n}"},{"name":"(User Defined Functions)","code":"\/\/-- webclient only event\nfunction sl_browse_OnExpanderClicked(eleRow)\n{\n\t\/\/- -unhilite last item row\n\tsl_browse.SetRowSelected(sl_browse.curSel,false);\n\n\tif(_swdoc._lastExpRow!=null)\n\t{\n\t\t_swdoc._lastExpRow.childNodes[0].style.backgroundColor = _swdoc._lastExpRowBG;\n\t}\n\telse\n\t{\n\t\t_swdoc._lastExpRowBG = eleRow.childNodes[0].style.backgroundColor;\n\t}\n\teleRow.childNodes[0].style.backgroundColor = \"#efefef\";\n\t_swdoc._lastExpRow = eleRow;\n\t_swdoc._lastItemRow = null;\n\n\t\/\/-- enable add item menus\n\t_een(btn_newtask , true);\n\t_een(btn_newworklist , true);\n\t_een(btn_delete , true);\t\t\n\t_een(btn_rename , true);\t\t\t\n\t_een(btn_seq , true);\t\t\t\t\n\t\n\t_swdoc._currentGroup = eleRow.getAttribute(\"parentgroup\");\n\t_swdoc._currentGroupSeq = eleRow.getAttribute(\"parentgroupsequence\");\n\t_swdoc._currentGroupTaskCount = eleRow.getAttribute(\"itemcount\");\n\t_swdoc._currentGroupFlags = eleRow.getAttribute(\"flags\");\n\n\tvar iLastRowGrpSeq = _swdoc._get_nextnew_pgs()-1;\n\t\/\/-- check if can move up or down\n\tvar bDisableUp = (_swdoc._currentGroupSeq>0)?false:true;\n\tvar bDisableDown = (_swdoc._currentGroupSeq<iLastRowGrpSeq)?false:true;\t\n\t_een(btn_up, (!bDisableUp));\n\t_een(btn_down, (!bDisableDown));\t\n\t\n}\n\n\n\/\/-- override built in event with my own\nfunction sl_browse_OnItemSelected(nRow,eleRow)\n{\n\t\t\/\/-- remove group highlight\n\t\tif(_swdoc._lastExpRow!=null)\n\t\t{\n\t\t\t_swdoc._lastExpRow.childNodes[0].style.backgroundColor = _swdoc._lastExpRowBG;\n\t\t\t_swdoc._lastExpRow = null;\n\t\t}\n\t\t\n\t\t\/\/-- store row pointer\n\t\t_swdoc._lastItemRow = eleRow;\n\t\t\/\/-- work out groups count\n\n\t\twhile(eleRow.getAttribute(\"type\")!=\"expander\")\n\t\t{\n\t\t\teleRow = eleRow.previousSibling;\n\t\t\tif(eleRow==null)\n\t\t\t{\n\t\t\t\tMessageBox(\"There is a technical problem with the workflow table [unable to find expander]. Please contact your Administrator.\");\n\t\t\t}\n\t\t}\n\t\t_swdoc._currentGroup = eleRow.getAttribute(\"parentgroup\");\n\t\t_swdoc._currentGroupSeq = eleRow.getAttribute(\"parentgroupsequence\");\n\t\t_swdoc._currentGroupTaskCount = eleRow.getAttribute(\"itemcount\");\n\t\t_swdoc._currentGroupFlags = eleRow.getAttribute(\"flags\");\n\n\t\t\/\/-- disable - enable buttons\n\t\t_een(mainform.btn_newtask , false);\n\t\t_een(mainform.btn_newworklist , true);\n\t\t_een(mainform.btn_delete , true);\t\t\n\t\t_een(mainform.btn_rename , true);\t\t\t\n\t\t_een(mainform.btn_seq , true);\t\t\t\t\n\t\t\n\t\t\/\/-- check if can move up or down\n\t\tvar iPos =mainform. sl_browse.GetItemTextRaw(mainform.sl_browse.curSel,\"taskid\");\n\t\tvar bDisableUp = (iPos==1)?true:false;\n\t\tvar bDisableDown = (iPos==_swdoc._currentGroupTaskCount)?true:false;\t\n\t\t_een(mainform.btn_up, (!bDisableUp));\n\t\t_een(mainform.btn_down, (!bDisableDown));\t\n\n}"}]}}},{"appearance":{"width":"360","height":"220","backgroundColor":"#ffffff","fillColour":"#ffffff","textColour":"#000000","font":{"@size":"8","#text":"Arial"}},"javascript":{}}]}}}