var _arr_tablenames_by_pos=new Array();var _arr_xml_mailbox_list=new Array();var _arr_xml_calendar_list=new Array();var _arr_cdf_forms=new Array();var _helpdesk_view_tree_reload=false;var _xml_helpdesk_view_tree=null;var _xml_helpdesk_view_3p_tree=null;var _xml_helpdesk_assign_tree=null;var _xml_helpdesk_3p_assign_tree=null;var _xml_multiclip_tree=null;var _xml_defaultslainfo=null;var _xml_logcallconfirmation=null;var session=new Object();session.AnalystId="";session.analystId="";session.analystID="";session.analystid="";session.analystname="";session.groupId="";session.currentAnalystId="";session.currentGroupId="";session.contextMode="";session.dataDictionary="";session.httpPort=80;session.isAdmin=false;session.maxBackdatePeriod=0;session.port=0;session.role=0;session.server="";session.serverBuild="";session.sessionId="";session.timezone="";session.timezoneOffset="";session.wsIpAddress="";session.rightsjson=null;session.dataset="";session.currentddDataset="";session.datasetFilterList="";session.currentddDatasetFilterList="";function _initialise_appdot_variables(){app.sessionid=session.sessionId;app.sessionId=session.sessionId;app.currentdd=session.dataDictionary;app.instance="SW";app.dataset=app.dd.GetGlobalParamAsString("Application Settings/Dataset");app.datasetfilterlist=app.dd.GetGlobalParamAsString("Application Settings/DatasetFilterList");session.dataset=app.dataset;session.currentddDataset=app.dataset;session.datasetFilterList=app.datasetfilterlist;session.currentddDatasetFilterList=app.datasetfilterlist;}function _initialise_analyst_session_variables(){var strIssuesVisible=app.dd.GetGlobalParamAsString("Views/helpdesk view/bottom/issues view/visible");var bShowNewIssue=(strIssuesVisible.toLowerCase()=="yes")?true:false;app.toolbarmenu_item_sorh("newissue",bShowNewIssue,document);session.AnalystId=_analyst_id;session.analystId=_analyst_id;session.analystid=_analyst_id;session.analystID=_analyst_id;session.analystname=_analyst_name;session.groupId=_analyst_supportgroup;session.groupid=_analyst_supportgroup;session.currentAnalystId=_analyst_id;session.currentGroupId=_analyst_supportgroup;session.userdefaults=_analyst_userdefaults;session.contextMode="";session.dataDictionary=_application;session.isAdmin=_analyst_admin;session.maxBackdatePeriod=_analyst_maxbackdateperiod;session.role=_analyst_privlevel;session.serverBuild="";session.sessionId=_swsessionid;session.timezone=_analyst_timezone;session.timeZone=_analyst_timezone;session.timezoneOffset=_analyst_timezoneoffset;session.timezoneOffset--;session.timezoneOffset++;session.timeZoneOffset=session.timezoneOffset;session.server=document.location.host;session.httpPort=httpport;session.wsComputerName="N/A";session.wsIpAddress="N/A";session.CloseSession=function(strSessionID){var strURL=app.get_service_url("session/disconnect/closesession.php","");return app.get_http(strURL,"closesessionid="+strSessionID,true,false,null);};_initialise_appdot_variables();_load_cdf_formnames();_load_session_rights();var boolMB=global.IsConnectedToMailServer();_email_getmailbox_permissions();_arr_xml_mailbox_list=new Array();for(strMailBoxName in _current_mailbox_permissions){var arr_addresses=new Array();var xmlmc=new XmlMethodCall();xmlmc.SetParam("mailbox",strMailBoxName);xmlmc.SetParam("getAddresses",true);if(xmlmc.Invoke("mail","getMailboxList")){arr_addresses=xmlmc.xmlDOM.getElementsByTagName("mailbox");var arr_mb=new Array();var xmlmc=new XmlMethodCall();xmlmc.SetParam("mailbox",strMailBoxName);if(xmlmc.Invoke("mail","getMailboxList")){arr_mb=xmlmc.xmlDOM.getElementsByTagName("mailbox");}for(var x=0;x<arr_mb.length;x++){_arr_xml_mailbox_list[_arr_xml_mailbox_list.length++]=arr_mb[x];}for(var x=0;x<arr_addresses.length;x++){var checkMailboxName=xmlNodeTextByTag(arr_addresses[x],"name");var checkMailboxAddress=xmlNodeTextByTag(arr_addresses[x],"address");var boolSkip=false;for(var y=0;y<arr_mb.length;y++){var masterMailboxName=xmlNodeTextByTag(arr_mb[y],"name");var masterMailboxAddress=xmlNodeTextByTag(arr_mb[y],"address");var masterMailboxType=xmlNodeTextByTag(arr_mb[y],"type");if(masterMailboxType==1||(checkMailboxName==masterMailboxName&&checkMailboxAddress==masterMailboxAddress)){boolSkip=true;break;}}if(!boolSkip){_arr_xml_mailbox_list[_arr_xml_mailbox_list.length++]=arr_addresses[x];}}}}if(_arr_xml_mailbox_list.length==0){global._mailserverrunning=false;boolMB=false;}var xmlmc=app._new_xmlmethodcall();if(xmlmc.Invoke("calendar","getCalendars")){_arr_xml_calendar_list=xmlmc.xmlDOM.getElementsByTagName("calendar");}if(!global.RefreshHelpdeskAnalystsTree()){app.logout("");return;}var lcfxmlurl=dd.GetGlobalParamAsString("global call settings/logcallconfirmmsg");if(lcfxmlurl!=""){app.get_http(_swc_parse_variablestring(lcfxmlurl),"",false,true,function(res){_xml_logcallconfirmation=res;});}setTimeout("app._on_updatedcalls_notification_received('')",5000);}function _get_webclient_cookie(strCookieID){strCookieID=app.pfu(_application+":"+strCookieID);var strURL=app.get_service_url("session/getcookie","");return app.get_http(strURL,"analystid="+session.analystId+"&settingid="+strCookieID,true,false,null);}function _set_webclient_cookie(strCookieID,varValue){strCookieID=app.pfu(_application+":"+strCookieID);var strURL=app.get_service_url("session/setcookie","");var res=app.get_http(strURL,"analystid="+session.analystId+"&cookievalue="+app.pfu(varValue)+"&settingid="+strCookieID,true,false,null);return(res=="OK");}function _load_cdf_formnames(){_arr_cdf_forms=new Array();var tmpQ=new SqlQuery();if(tmpQ.WebclientStoredQuery("system/getCallDetailFormNames","")){while(tmpQ.Fetch()){_arr_cdf_forms[tmpQ.GetValueAsString("formname")]=tmpQ.GetValueAsString("callclass");}}}function _load_session_rights(){if(session.rightsjson!=null){return;}var strURL=app.get_service_url("session/getrights","");try{session.rightsjson=eval("("+app.get_http(strURL,"",true,false,null)+")");}catch(e){alert("Analyst session rights could not be loaded. Please contact your Administrator");sys.logoff();}}function _on_updatedcalls_notification_received(strRes){var intPollSec=dd.GetGlobalParamAsNumber("views/helpdesk view/webclient settings/refreshpolling");if(isNaN(intPollSec)||intPollSec<1){return;}var iTimeoutPeriod=(intPollSec*1000);if(_CurrentOutlookType!="helpdesk"||_servicedesk_tree==null||_refresh_servicedesk_againstdata==undefined||_ServiceDeskDocumentElement==null){setTimeout("app._on_updatedcalls_notification_received('')",iTimeoutPeriod);return;}if(strRes!=""){if(_refresh_servicedesk_againstdata!=undefined&&_ServiceDeskDocumentElement.body.offsetWidth>0){_refresh_servicedesk_againstdata(strRes);}setTimeout("app._on_updatedcalls_notification_received('')",iTimeoutPeriod);return;}var strSelectColumns=_servicedesk_get_distinct_columns();var strURL=app.get_service_url("call/getupdatedcallslist","");var strArgs="_selectcols="+strSelectColumns+"&_last_lastactdatex="+_LAST_HELPDESKVIEW_LASTACTDATEX;app.get_http(strURL,strArgs,false,false,app._on_updatedcalls_notification_received);}session.SwitchContext=function(strRepID,strGroupID){if(!session.HaveRight(ANALYST_RIGHT_A_GROUP,ANALYST_RIGHT_A_CANSWITCHGROUP)){if(_analyst_in_supportgroups.indexOf(strGroupID)==-1||strGroupID==""){alert("You do not have rights to change your service desk context to another group.");return false;}}if(!session.HaveRight(ANALYST_RIGHT_A_GROUP,ANALYST_RIGHT_A_CANSWITCHREP)){if(strRepID!=""&&strRepID!=this.analystid){alert("You do not have rights to change your service desk context to that of another analyst.");return false;}}var xmlmc=new XmlMethodCall();xmlmc.SetParam("groupId",strGroupID);xmlmc.SetParam("analystId",strRepID);if(xmlmc.Invoke("session","switchAnalystContext")){session.currentAnalystId=strRepID;session.currentGroupId=strGroupID;}else{alert(xmlmc.GetLastError());return false;}return true;};session.CanBackdateCallActions=function(){return(this.maxBackdatePeriod>0);};session.GetAnalystStatus=function(strAnalystID){var strURL=app.get_service_url("session/getanalyststatus","");var strJS=app.get_http(strURL,"analystid="+strAnalystID+"&swsessionid="+app._swsessionid,true,false,null);if(strJS==""){return false;}eval(strJS);return tmpObject;};session.GetCloseProfileLevelRequired=function(){var div=Math.round(_analyst_rightsh/65536);if(div>0){var sub=div*65536;var resNum=_analyst_rightsh-sub;}else{var resNum=_analyst_rightsh;}return resNum;};session.GetProbProfileLevelRequired=function(){var div=Math.round(_analyst_rightsh/65536);return div;};session.IsMemberOfSupportGroup=function(strGroup){var arrGroup=_analyst_in_supportgroups.split(",");for(var x=0;x<arrGroup.length;x++){if(arrGroup[x].toLowerCase()==strGroup.toLowerCase()){return true;}}return false;};session.GetMaxBackdatePeriodAllowed=function(){return session.maxBackdatePeriod;};session.HaveAppRight=function(nGroupID,nRightID,strApplication){if(strApplication==undefined||strApplication==""){strApplication=app._application;}if(this.rightsjson==null){_load_session_rights();}if(this.rightsjson==null){return false;}if(this.rightsjson["@status"]==false){app.logout(this.rightsjson.state.error);return false;}var arrAppRights=jA(this.rightsjson.params.appRight);var xmlRights=arrAppRights[0];if(xmlRights==undefined){alert("The application rights data could not be loaded. Please contact your administrator.");return false;}else{var strMatchApp=strApplication.toLowerCase();var arrRightTypes=["A","B","C","D","E","F","G","H"];for(var x=0;x<arrAppRights.length;x++){if(arrAppRights[x].appName.toLowerCase()==strMatchApp){if(isNaN(nGroupID)){var jRight=arrAppRights[x]["right"+nGroupID.toUpperCase()];}else{var jRight=arrAppRights[x]["right"+arrRightTypes[nGroupID-1]];}if(jRight==undefined){alert("The requested application rights data could not be found. Please contact your administrator.");return false;}else{var intFlag=jRight-0;intFlag++;intFlag--;return(this.flags(nRightID)&intFlag);}}}}return false;};session.flags=function(flagPos){if(this.bitflags!=undefined){return this.bitflags[flagPos];}this.bitflags=new Array();var y=1;for(var x=1;x<65;x++){this.bitflags[x]=y;y=y*2;}return this.bitflags[flagPos];};session._checkedtablerights=new Array();session.CheckTableRight=function(strTable,iCheckRight,boolMessage){if(session._checkedtablerights[strTable]==undefined){session._checkedtablerights[strTable]=new Array();}if(session._checkedtablerights[strTable][iCheckRight]!=undefined){if(session._checkedtablerights[strTable][iCheckRight]!=""&&boolMessage){alert(session._checkedtablerights[strTable][iCheckRight]);}return session._checkedtablerights[strTable][iCheckRight];}var strMessage="";if(boolMessage==undefined){boolMessage=true;}if(this.rightsjson==null){_load_session_rights();}if(this.rightsjson==null){return false;}if(this.rightsjson["@status"]==false){app.logout(this.rightsjson.state.error);return false;}var arrTableRights=this.rightsjson.params.databaseRight;if(arrTableRights==undefined){strMessage="The table rights data could not be loaded. Please contact your administrator.";}else{var jRights=arrTableRights[0];if(iCheckRight!=undefined){var tableRights=jRights.tableRight;var matchTable=strTable.toLowerCase();for(var x=0;x<tableRights.length;x++){if(tableRights[x].tableName.toLowerCase()==matchTable){var intFlag=tableRights[x].right-0;var res=((iCheckRight&intFlag)>0)?true:false;if(res){session._checkedtablerights[strTable][iCheckRight]="";return"";}break;}}strMessage="You do not have permission to ["+_get_table_right_desc(iCheckRight)+"] on the database table:-\n\n"+strTable+".\n\nThe table permissions are granted by your Administrator.";}}session._checkedtablerights[strTable][iCheckRight]=strMessage;if(boolMessage&&strMessage!=""){alert(strMessage);}return strMessage;};session.HaveRight=function(nGroupID,nRightID,boolMessage){if(boolMessage==undefined){boolMessage=false;}var arrClientRights=this.rightsjson.params;if(arrClientRights==undefined){alert("The client rights data could not be loaded. Please contact your administrator.");return false;}else{var arrRightTypes=["a","b","c","d","e","f","g","h"];if(isNaN(nGroupID)){nGroupID=nGroupID.toLowerCase();for(var x=0;x<arrRightTypes.length;x++){if(nGroupID==arrRightTypes[x]){nGroupID=x+1;break;}}}var jRight=arrClientRights["sl"+arrRightTypes[nGroupID-1]];if(jRight==undefined){alert("The requested rights data could not be found. Please contact your administrator.");return false;}else{var intFlag=jRight-0;var res=((nRightID&intFlag)!=0)?true:false;if(!res&&boolMessage){try{var strMessage=_CALL_RIGHTS_MSG[nGroupID][nRightID];alert(strMessage);}catch(e){}}return res;}}};session.IsDefaultOption=function(nOption){return((nOption&this.userdefaults)>0)?true:false;};session.RefreshCallDetails=function(nCallRef){};var __arr_application_toolbar_html=new Array();function _toolbars_loaded(strRes){var arrTBS=strRes.split("_sw2split_");for(var x=0;x<arrTBS.length;x++){var arrTB=arrTBS[x].split("_swsplit_");__arr_application_toolbar_html[arrTB[0]]=arrTB[1];}_swcore.bToolbarsLoaded=true;}function _load_application_picklists(strPickListXmlString){app._xmlPickLists=create_xml_dom(strPickListXmlString);if(typeof app._xmlPickLists!="object"){alert("The application pick list definitions could not be loaded. Please contact your Administrator");app._xmlPickLists=null;sys.logoff();return false;}_swcore.bPicklistsLoaded=true;}function _load_application_dbentityviews(dbevXmlString){app._xmlManagedEntitySearches=create_xml_dom(dbevXmlString);if(typeof app._xmlManagedEntitySearches!="object"){app._xmlManagedEntitySearches=null;}}function _load_application_schema(strSchemaJson){app._jsonSchemaString=strSchemaJson;try{app._jsonSchema=eval("("+_jsonSchemaString+")");if(typeof app._jsonSchema!="object"){alert("The application schema definition could not be loaded. Please contact your Administrsator");sys.logoff();return false;}}catch(e){alert("The application schema definition could not be loaded. Please contact your Administrsator");sys.logoff();return false;}}function _load_system_schema(strSysSchemaXml){app._xmlSystemSchema=create_xml_dom(strSysSchemaXml);if(typeof app._xmlSystemSchema!="object"){alert("The system database schema definition could not be loaded. Please contact your Administrsator");sys.logoff();return false;}_swcore.bSchemasLoaded=true;}function _load_application_globalparams(globalParamsXmlString){app._xmlGlobalParameters=create_xml_dom(globalParamsXmlString);if(app._xmlGlobalParameters&&app._xmlGlobalParameters.childNodes&&app._xmlGlobalParameters.childNodes.length>0){_swcore.bGlobalParamsLoaded=true;}else{alert("The application global parameters could not be loaded. Please contact your Administrator");sys.logoff();return false;}}function _load_application_treebrowserforms(strTreeBrosersXmlString){app._xmlSearchForms=create_xml_dom(strTreeBrosersXmlString);if(typeof app._xmlSearchForms!="object"){alert("The application tree browser form definitions could not be loaded. Please contact your Administrator");app._xmlSearchForms=null;sys.logoff();return false;}_swcore.bTreeBrowsersLoaded=true;}function _initialise_schema_and_global_parameters(OnProcessedCallback){var strCustomURL="service/session/fetchstartupresources/index.php";app.get_http(strCustomURL,"",false,false,function(strHttpResult,targetEle,ohttp){var resources=JSON.parse(strHttpResult);_toolbars_loaded(resources.systemtoolbars);_load_application_picklists(resources.picklistforms);_load_application_treebrowserforms(resources.treebrowserforms);_load_application_globalparams(resources.globalparameters);_load_application_dbentityviews(resources.dbentityviews);_load_application_schema(resources.swdataschema);_load_system_schema(resources.systemschema);var intStartNode=(app.isIE&&!app.isIE11Above)?1:0;_store_global_params_as_array(app._xmlGlobalParameters.childNodes[intStartNode]);app.dd=new swdd();app.dd.tables["updatedb"].PrimaryKey="udid";app.dd.tables["updatedb"].primarykey="udid";for(var x=0;x<app.dd.tables.length;x++){for(var y=0;y<app.dd.tables[x].columns.length;y++){_application_labels[app.dd.tables[x].columns[y].binding]=app.dd.tables[x].columns[y].DisplayName;}}_initialise_analyst_session_variables();OnProcessedCallback();});return true;}function swdd(){if(app._jsonSchema){this.Name=session.dataDictionary;this.LastModifiedBy="N/A";this.LastModifiedDate="N/A";this.Version="N/A";this.Application=this.Name;this.tables=new Array();this._init_appxmlschema(app._jsonSchema);this._init_xmlschema(app._xmlSystemSchema);}}swdd.prototype.GetSqlTreeBrowsersFormParameters=function(strSearchFormName){var xmlForm=null;var arrSearchForms=app._xmlSearchForms.getElementsByTagName("sqlTbForm");for(var x=0;x<arrSearchForms.length;x++){var strName=app.xmlNodeTextByTag(arrSearchForms[x],"name");if(strName==strSearchFormName){xmlForm=arrSearchForms[x];break;}}if(xmlForm==null){alert("GetSqlTreeBrowsersFormParameters : The tree browser form ["+strSearchFormName+"] was not found. Please contact your Administrator.");return false;}var retArray=new Array();retArray[0]=new Object();retArray[0].table=app.xmlNodeTextByTag(xmlForm,"table");retArray[0].title=app.xmlNodeTextByTag(xmlForm,"title");retArray[0].resultColumn=app.xmlNodeTextByTag(xmlForm,"resultColumn");retArray[1]=app.xmlNodeTextByTag(xmlForm,"title");retArray[2]=app.xmlNodeTextByTag(xmlForm,"resultColumn");return retArray;};swdd.prototype._init_appxmlschema=function(jsonDbSchema){var arrTables=jA(jsonDbSchema.espDatabaseSchema.database.tables.table);for(var x=0;x<arrTables.length;x++){var tPos=this.tables.length;var aTable=arrTables[x];if(aTable){var strName=aTable["@name"].toLowerCase();app._arr_tablenames_by_pos[strName]=x;this.tables[tPos]=new Object();this.tables[tPos].namedcolumns=new Array();this.tables[tPos].columns=new Array();this.tables[tPos].Name=strName;this.tables[tPos].name=strName;this.tables[tPos].DisplayName=jVal(aTable["displayName"]);this.tables[tPos].PrimaryKey=jVal(aTable["@primaryKey"]).toLowerCase();this.tables[tPos].editform=jVal(aTable["editREcordForm"]);this.tables[tPos].addform=jVal(aTable["addRecordForm"]);this.tables[tPos].NewRecordForm=this.tables[tPos].addform;this.tables[tPos].RecordPropertiesForm=this.tables[tPos].editform;this.tables[tPos].Description="N/A";this.tables[tPos].Dsn="swdata";this.tables[tPos].canRead=session.CheckTableRight(strName,_CAN_BROWSE_TABLEREC,false);this.tables[tPos].canAdd=session.CheckTableRight(strName,_CAN_ADDNEW_TABLEREC,false);this.tables[tPos].canUpdate=session.CheckTableRight(strName,_CAN_UPDATE_TABLEREC,false);this.tables[tPos].canDelete=session.CheckTableRight(strName,_CAN_DELETE_TABLEREC,false);this.tables[tPos].IsColumnDefined=function(strColName){for(var x=0;x<this.columns.length;x++){if(this.columns[x].Name.toLowerCase()==strColName.toLowerCase()){return true;}}return false;};var arrColumns=jA(aTable.columns.column);var strTextInputType="";this.tables[tPos].ColumnCount=arrColumns.length;for(var y=0;y<arrColumns.length;y++){var aCol=arrColumns[y];var strColName=aCol["@name"].toLowerCase();var strBinding=strName+"."+strColName;this.tables[tPos].columns[y]=new Object();this.tables[tPos].columns[y].binding=strBinding;this.tables[tPos].columns[y].table=strName;this.tables[tPos].columns[y].name=strColName;this.tables[tPos].columns[y].Name=strColName;this.tables[tPos].columns[y].DisplayName=jVal(aCol["displayName"]);var aControl=aCol.control;if(aControl){this.tables[tPos].columns[y].controlType=jVal(aControl["@type"]).toLowerCase();this.tables[tPos].columns[y].inputMask=jVal(aControl["inputMask"]);this.tables[tPos].columns[y].textInputFormat=jVal(aControl["textInputFormat"]);this.tables[tPos].columns[y].pickOptions=jVal(aControl["pickOptions"]);this.tables[tPos].columns[y].defaultValue=jVal(aControl["defaultValue"]);}else{this.tables[tPos].columns[y].pickOptions=jVal(aCol.pickOptions);this.tables[tPos].columns[y].defaultValue=jVal(aCol.defaultValue);}this.tables[tPos].columns[y].type=jVal(aCol["@sqlType"]).toLowerCase();this.tables[tPos].columns[y].DataType=this.tables[tPos].columns[y].type;this.tables[tPos].columns[y].SqlDataType=jVal(aCol["@sqlType"]);this.tables[tPos].columns[y].unsigned="no";this.tables[tPos].columns[y].size=jVal(aCol["@size"]);this.tables[tPos].columns[y].MaxDataSize=jVal(aCol["@size"]);this.tables[tPos].columns[y].primarykey=jVal(aCol["@primaryKey"]);this.tables[tPos].columns[y].autoinc=jVal(aCol["@autoIncrement"]);if(this.tables[tPos].columns[y].autoinc==null){this.tables[tPos].columns[y].autoinc="no";}this.tables[tPos].columns[y]._bIsNumeric=_is_numeric_type(this.tables[tPos].columns[y].type);this.tables[tPos].columns[y]._startupvalue=(this.tables[tPos].columns[y]._bIsNumeric)?0:"";this.tables[tPos].columns[y].IsNumeric=function(){return this._bIsNumeric;};this.tables[tPos].columns[y].SqlTypeName=function(){return this.SqlDataType;};this.tables[tPos].columns[y].FormatValue=function(strValue){if(this.controlType){if(this.controlType=="date/time control"){if(this._bIsNumeric&&!isNaN(strValue)){if(strValue==0){return"";}if(this.inputMask!=""){return get_displayvalueforfield_fromepochvalue(strValue,this.inputMask,true);}else{if(this.textInputFormat=="text"){this.textInputFormat="datetime";}else{if(this.textInputFormat.indexOf("/")>-1){this.textInputFormat=this.textInputFormat.replace("/","");}}return get_displayvalueforfield_fromepochvalue(strValue,this.textInputFormat,true);}}}else{if(this.controlType=="text edit"){if(this.textInputFormat=="text"){return strValue;}}else{if(this.controlType.indexOf("pick list")==0){if(this.pickOptions.indexOf("^")>0){var arrItem=new Array();var arrOptions=this.pickOptions.split("|");for(var xy=0;xy<arrOptions.length;xy++){if(arrOptions[xy]==strValue){return strValue;}arrItem=arrOptions[xy].split("^");if(arrItem[1]==strValue){return arrItem[0];}}}else{return strValue;}}}}}if(this.inputMask!=""){if(this._bIsNumeric){var origValue=strValue+"";if(this.inputMask.indexOf("#")>-1){var intValueLen=origValue.length;var intMaskLen=this.inputMask.length;var iCut=intMaskLen-intValueLen;var newMask=this.inputMask.substring(0,iCut);newMask=app.string_replace(newMask,"#","0",true);return newMask+origValue;}else{return this.inputMask+origValue;}}}else{var strURL=app.get_service_url("ddf/formatvalue","");var strBinding=this.table+"."+this.name;var strParams="formatbinding="+strBinding+"&formatvalue="+strValue;return app.get_http(strURL,strParams,true,false,null);}};if(strColName=="length"){}else{this.tables[tPos].columns[strColName]=this.tables[tPos].columns[y];this.tables[tPos].namedcolumns[strColName]=this.tables[tPos].columns[y];}}this.tables[strName]=this.tables[tPos];}}};swdd.prototype._init_xmlschema=function(xmlSchema){var tPos=this.tables.length;var arrTables=xmlSchema.getElementsByTagName("Table");for(var x=0;x<arrTables.length;x++){var strName=arrTables[x].getAttribute("name").toLowerCase();this.tables[tPos]=new Object();this.tables[tPos].Name=strName;this.tables[tPos].name=strName;this.tables[tPos].DisplayName="";this.tables[tPos].PrimaryKey="";this.tables[tPos].editform="";this.tables[tPos].addform="";this.tables[tPos].namedcolumns=new Array();this.tables[tPos].columns=new Array();var arrColumns=arrTables[x].getElementsByTagName("Column");this.tables[tPos].ColumnCount=arrColumns.length;for(var y=0;y<arrColumns.length;y++){var aCol=arrColumns[y];var strBinding=this.tables[tPos].Name+"."+aCol.getAttribute("name").toLowerCase();this.tables[tPos].columns[y]=new Object();this.tables[tPos].columns[y].binding=strBinding;this.tables[tPos].columns[y].table=this.tables[tPos].Name;this.tables[tPos].columns[y].name=aCol.getAttribute("name").toLowerCase();this.tables[tPos].columns[y].Name=aCol.getAttribute("name").toLowerCase();this.tables[tPos].columns[y].DisplayName=_application_labels[strBinding];this.tables[tPos].columns[y].pickOptions="";this.tables[tPos].columns[y].defaultValue="";this.tables[tPos].columns[y].type=aCol.getAttribute("sqltype").toLowerCase();this.tables[tPos].columns[y].unsigned=aCol.getAttribute("unsigned");this.tables[tPos].columns[y].size=aCol.getAttribute("size");this.tables[tPos].columns[y].primarykey=aCol.getAttribute("primarykey");this.tables[tPos].columns[y].autoinc=aCol.getAttribute("auto_increment");if(this.tables[tPos].columns[y].autoinc==null){this.tables[tPos].columns[y].autoinc="no";}this.tables[tPos].columns[y]._bIsNumeric=_is_numeric_type(this.tables[tPos].columns[y].type);this.tables[tPos].columns[y]._startupvalue=(this.tables[tPos].columns[y]._bIsNumeric)?0:"";this.tables[tPos].columns[y].IsNumeric=function(){return this._bIsNumeric;};this.tables[tPos].columns[y].FormatValue=function(strValue){var strURL=app.get_service_url("ddf/formatvalue","");var strBinding=this.table+"."+this.name;var strParams="formatbinding="+strBinding+"&formatvalue="+strValue;return app.get_http(strURL,strParams,true,false,null);};if(aCol.getAttribute("primarykey")=="yes"){this.tables[tPos].PrimaryKey=aCol.getAttribute("name").toLowerCase();}this.tables[tPos].columns[aCol.getAttribute("name").toLowerCase()]=this.tables[tPos].columns[y];this.tables[tPos].namedcolumns[aCol.getAttribute("name").toLowerCase()]=this.tables[tPos].columns[y];}this.tables[tPos].IsColumnDefined=function(strColName){for(var x=0;x<this.columns.length;x++){if(this.columns[x].Name.toLowerCase()==strColName.toLowerCase()){return true;}}return false;};if(this.tables[tPos].PrimaryKey==""){var arrIndexes=arrTables[x].getElementsByTagName("Index");for(var y=0;y<arrIndexes.length;y++){var aIDX=arrIndexes[y];if(aIDX.getAttribute("unique")=="yes"){this.tables[tPos].PrimaryKey=aIDX.getAttribute("cols");break;}}}this.tables[strName]=this.tables[tPos];}};swdd.prototype.GetGlobalParamAsString=function(strPath){return __get_global_param(strPath,false);};swdd.prototype.GetGlobalParam=function(strPath){return __get_global_param(strPath,false);};swdd.prototype.GetGlobalParamAsNumber=function(strPath){return __get_global_param(strPath,true);};function _esptable_form(strTable,boolEdit,bMsg){if(bMsg==undefined){bMsg=true;}var oTable=app.dd.tables[strTable];if(oTable==undefined){if(bMsg){alert("_esptable_form : Table ["+strTable+"] information not defined.\n\nPlease contact your Administrator");}return"";}if(boolEdit){return oTable.addform;}else{return oTable.editform;}}var __arr_global_params=new Array();function _store_global_params_as_array(xmlStartNode,arrTarget){if(xmlStartNode!=null){if(arrTarget==undefined){arrTarget=__arr_global_params;}var arrXML=xmlStartNode.childNodes;for(var x=0;x<arrXML.length;x++){var currNode=arrXML[x];if(currNode.tagName!="name"&&currNode.tagName!="folder"&&currNode.tagName!="params"){continue;}if(currNode.tagName=="folder"){var strFolderName=app.xmlText(currNode.getElementsByTagName("name")[0]).toLowerCase();strFolderName=app.string_replace(strFolderName," ","_",true);arrTarget[strFolderName]=new Array();_store_global_params_as_array(currNode,arrTarget[strFolderName]);var xmlParams=currNode.getElementsByTagName("param");for(var y=0;y<xmlParams.length;y++){var currParam=xmlParams[y];var strParamName=app.xmlText(currParam.getElementsByTagName("name")[0]).toLowerCase();strParamName=app.string_replace(strParamName," ","_",true);var strParamValue=app.xmlText(currParam.getElementsByTagName("value")[0]);arrTarget[strFolderName][strParamName]=strParamValue;}}}}}function __get_global_param(strPath,boolNumeric){if(app._xmlGlobalParameters!=null){var arrParams=__arr_global_params;var rValue="";strPath=app.string_replace(strPath," ","_",true);strPath=strPath.toLowerCase();var arrPath=strPath.split("/");var lastPath=arrPath[arrPath.length-1];for(var x=0;x<arrPath.length;x++){var strCurrPathPart=arrPath[x];if(arrParams[strCurrPathPart]!=undefined){rValue=arrParams[strCurrPathPart];arrParams=arrParams[strCurrPathPart];}else{return(boolNumeric)?0:"";break;}}if(boolNumeric){rValue--;rValue++;if(isNaN(rValue)){return 0;}}return rValue;}return(boolNumeric)?0:"";}function _is_numeric_type(strType){switch(strType){case"integer":case"double":case"tinyint":case"bigint":case"smallint":case"decimal":case"float":return true;default:break;}return false;}