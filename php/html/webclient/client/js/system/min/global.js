var global=new Object();function _OnOpenEditSlaForm(strSlaNameOrCompanyID,b3rdParty){var res=true;if(OnOpenEditSlaForm){res=OnOpenEditSlaForm(strSlaNameOrCompanyID,b3rdParty);}if(res){}}function _OnOpenManageSlasForm(){var res=true;if(OnOpenManageSlasForm){res=OnOpenManageSlasForm();}if(res){}}function _OnOpenNewSlaForm(strSlaNameOrCompanyID,bThirdParty){var res=true;if(OnOpenNewSlaForm){res=OnOpenNewSlaForm(strSlaNameOrCompanyID,bThirdParty);}if(res){}}global.SwitchSupportworksView=function(strView){var boolFound=false;var arrViews=dd.GetGlobalParam("views");for(var strViewName in arrViews){if(strViewName==strView){boolFound=true;break;}else{var strIconTitle=arrViews[strViewName].icontitle;if(strIconTitle==strView){boolFound=true;break;}}}if(boolFound){var eTriggerItem=app.get_parent_child_by_id(app.application_navbar.shortcutholder,strViewName);if(eTriggerItem&&eTriggerItem.className!="sbar-item-hide"){eTriggerItem=app.get_parent_child_by_tag(eTriggerItem,"IMG");}else{eTriggerItem=app.get_parent_child_by_id(app.application_navbar.baritemholder,strViewName);if(eTriggerItem==null){return;}eTriggerItem=app.get_parent_child_by_tag(eTriggerItem,"TD");}if(eTriggerItem==null){return;}app.fireEvent(eTriggerItem,"click");}};global.SwitchSupportworksViewByType=function(strViewType){var boolFound=false;var arrViews=dd.GetGlobalParam("views");for(var strViewName in arrViews){var strType=arrViews[strViewName].type;if(strType==strViewType){boolFound=true;break;}}if(boolFound){var eTriggerItem=app.get_parent_child_by_id(app.application_navbar.shortcutholder,strViewName);if(eTriggerItem&&eTriggerItem.className!="sbar-item-hide"){eTriggerItem=app.get_parent_child_by_tag(eTriggerItem,"IMG");}else{eTriggerItem=app.get_parent_child_by_id(app.application_navbar.baritemholder,strViewName);if(eTriggerItem==null){return;}eTriggerItem=app.get_parent_child_by_tag(eTriggerItem,"TD");}if(eTriggerItem==null){return;}app.fireEvent(eTriggerItem,"click");}};global.isRFC822ValidEmail=function(sEmail){var sQtext="[^\\x0d\\x22\\x5c\\x80-\\xff]";var sDtext="[^\\x0d\\x5b-\\x5d\\x80-\\xff]";var sAtom="[^\\x00-\\x20\\x22\\x28\\x29\\x2c\\x2e\\x3a-\\x3c\\x3e\\x40\\x5b-\\x5d\\x7f-\\xff]+";var sQuotedPair="\\x5c[\\x00-\\x7f]";var sDomainLiteral="\\x5b("+sDtext+"|"+sQuotedPair+")*\\x5d";var sQuotedString="\\x22("+sQtext+"|"+sQuotedPair+")*\\x22";var sDomain_ref=sAtom;var sSubDomain="("+sDomain_ref+"|"+sDomainLiteral+")";var sWord="("+sAtom+"|"+sQuotedString+")";var sDomain=sSubDomain+"(\\x2e"+sSubDomain+")*";var sLocalPart=sWord+"(\\x2e"+sWord+")*";var sAddrSpec=sLocalPart+"\\x40"+sDomain;var sValidEmail="^"+sAddrSpec+"$";var reValidEmail=new RegExp(sValidEmail);if(reValidEmail.test(sEmail)){return true;}return false;};global.CreateSla=function(strSlaName,strTimeZone,intRespTime,intFixTime,callback){if(_xml_defaultslainfo==null){var strURL=app.get_service_url("session/getdefaultslasettings","");_xml_defaultslainfo=app.get_http(strURL,"",true,true);}if(_xml_defaultslainfo){var xmlDay=_xml_defaultslainfo.getElementsByTagName("Sunday");var intSunS=_convert_hhmm_to_epoch(xmlDay[0].getAttribute("start"));var intSunE=_convert_hhmm_to_epoch(xmlDay[0].getAttribute("end"));var xmlDay=_xml_defaultslainfo.getElementsByTagName("Monday");var intMonS=_convert_hhmm_to_epoch(xmlDay[0].getAttribute("start"));var intMonE=_convert_hhmm_to_epoch(xmlDay[0].getAttribute("end"));var xmlDay=_xml_defaultslainfo.getElementsByTagName("Tuesday");var intTueS=_convert_hhmm_to_epoch(xmlDay[0].getAttribute("start"));var intTueE=_convert_hhmm_to_epoch(xmlDay[0].getAttribute("end"));var xmlDay=_xml_defaultslainfo.getElementsByTagName("Wednesday");var intWedS=_convert_hhmm_to_epoch(xmlDay[0].getAttribute("start"));var intWedE=_convert_hhmm_to_epoch(xmlDay[0].getAttribute("end"));var xmlDay=_xml_defaultslainfo.getElementsByTagName("Thursday");var intThuS=_convert_hhmm_to_epoch(xmlDay[0].getAttribute("start"));var intThuE=_convert_hhmm_to_epoch(xmlDay[0].getAttribute("end"));var xmlDay=_xml_defaultslainfo.getElementsByTagName("Friday");var intFriS=_convert_hhmm_to_epoch(xmlDay[0].getAttribute("start"));var intFriE=_convert_hhmm_to_epoch(xmlDay[0].getAttribute("end"));var xmlDay=_xml_defaultslainfo.getElementsByTagName("Saturday");var intSatS=_convert_hhmm_to_epoch(xmlDay[0].getAttribute("start"));var intSatE=_convert_hhmm_to_epoch(xmlDay[0].getAttribute("end"));var xmlmc=new XmlMethodCall();xmlmc.SetParam("name",strSlaName);xmlmc.SetParam("type",1);xmlmc.SetParam("resptime",intRespTime);xmlmc.SetParam("fixtime",intFixTime);xmlmc.SetParam("mode",0);xmlmc.SetParam("dd","");xmlmc.SetParam("timeZone",strTimeZone);xmlmc.SetParam("sunStart",intSunS);xmlmc.SetParam("sunEnd",intSunE);xmlmc.SetParam("monStart",intMonS);xmlmc.SetParam("monEnd",intMonE);xmlmc.SetParam("tueStart",intTueS);xmlmc.SetParam("tueEnd",intTueE);xmlmc.SetParam("wedStart",intWedS);xmlmc.SetParam("wedEnd",intWedE);xmlmc.SetParam("thuStart",intThuS);xmlmc.SetParam("thuEnd",intThuE);xmlmc.SetParam("friStart",intFriS);xmlmc.SetParam("friEnd",intFriE);xmlmc.SetParam("satStart",intSatS);xmlmc.SetParam("satEnd",intSatE);if(xmlmc.Invoke("sla","addSystemSLA")){if(callback){(callback(xmlmc.GetParam("slaid")));}return xmlmc.GetParam("slaid");}else{alert("Error : sla.addSystemSLA failed.\n\n"+xmlmc.GetLastError());}}else{alert("The default working hours could not be loaded. Please contact your administrator.");}if(callback){(callback(0));}return 0;};global.DeleteSla=function(intSlaID){var xmlmc=new XmlMethodCall();xmlmc.SetParam("slaName",intSlaID);return xmlmc.Invoke("sla","deleteSLA");};global.Create3rdPartySupplier=function(strCompanyID,strSupplierName,strTel,strEmail,strNotes){var rs=new SqlQuery();var strParams="analystid="+strCompanyID+"&name="+strSupplierName+"&tel="+strTel+"&email="+strEmail;if(rs.WebclientStoredQuery("system/createThirdPartySupplier",strParams)){return true;}else{return false;}};global.Delete3rdPartySupplier=function(strCompanyID){var rs=new SqlQuery();var strParams="analystid="+strCompanyID;if(rs.WebclientStoredQuery("system/deleteThirdPartySupplier",strParams)){return true;}else{return false;}};global.SetSla3rdPartyInfo=function(nSlaID,strCompanyID,strContact,strEmail,strTel,strNotes,nValidFromEpoch,nExpiresEndEpoch,nContractOptions){var rs=new SqlQuery();var strParams="company="+strCompanyID;strParams+="&name="+strContact;strParams+="&tel="+strTel;strParams+="&email="+strEmail;strParams+="&notes="+strNotes;strParams+="&validfrom="+nValidFromEpoch;strParams+="&validto="+nExpiresEndEpoch;strParams+="&options="+nContractOptions;strParams+="&slaid="+nSlaID;return rs.WebclientStoredQuery("system/setSla3rdPartyInfo",strParams);};global.InvokeSlaEditDialog=function(nSlaID,b3rdParty,strAgreementTitle){alert("InvokeSlaEditDialog : This method is not supported in the webclient.");return false;};global.InvokeAddNewSlaDialog=function(nSlaID,b3rdParty,strAgreementTitle){alert("InvokeAddNewSlaDialog : This method is not supported in the webclient.");return false;};global.GetCallRefValue=function(strCallref){var val=parseInt(strCallref.match(/[0-9]+/)[0],10);return val;};global.RefreshHelpdeskAnalystsTree=function(){var xmlmc=new XmlMethodCall();xmlmc.SetParam("recursive","true");if(xmlmc.Invoke("helpdesk","getAnalystTeamTree")){_xml_helpdesk_view_tree=xmlmc.xmlDOM;}else{alert(xmlmc.GetLastError());return false;}if(dd.GetGlobalParamAsString("third party slas/enable").toLowerCase()=="true"){var xmlmc=new XmlMethodCall();if(xmlmc.Invoke("helpdesk","getThirdPartyTeamTree")){_xml_helpdesk_view_3p_tree=xmlmc.xmlDOM;}else{alert(xmlmc.GetLastError());return false;}}var xmlmc=new XmlMethodCall();xmlmc.SetParam("recursive",true);if(xmlmc.Invoke("helpdesk","getAnalystAssignmentTree")){_xml_helpdesk_assign_tree=xmlmc.xmlDOM;}else{alert(xmlmc.GetLastError());return false;}var xmlmc=new XmlMethodCall();if(xmlmc.Invoke("helpdesk","getThirdPartyAssignmentTree")){_xml_helpdesk_3p_assign_tree=xmlmc.xmlDOM;}else{alert(xmlmc.GetLastError());return false;}if(app.oCurrentOutlookControl!=null&&oCurrentOutlookControl.contentWindow._reload_helpdesk_tree){oCurrentOutlookControl.contentWindow._reload_helpdesk_tree();}else{_helpdesk_view_tree_reload=true;}return true;};global.TAPIDial=function(strNumber){alert("TAPIDial : This method is not supported in the webclient.");return false;};global.AddResolutionToKnowledgeBase=function(strProbText,strProbCode,strSolution,strFixCode,strCallRefList,modalCallbackFunction){strCallRefList=strCallRefList+"";var arrCalls=strCallRefList.split(",");if(arrCalls.length>1){var xmlmc=new XmlMethodCall();for(var x=0;x<arrCalls.length;x++){xmlmc.SetParam("callRef",arrCalls[x]);}return xmlmc.Invoke("knowledgebase","unpublishedCallAdd");}else{var strTitle="Call "+app.dd.tables["opencall"].columns["callref"].FormatValue(strCallRefList)+" resolved and added to the KnowledgeBase";var strKeywords="";var arrCode=strFixCode.split("-");for(var x=0;x<arrCode.length;x++){if(strKeywords!=""){strKeywords+=", ";}strKeywords+=arrCode[x];}var oRes=global.GetResolutionProfileDescription(strFixCode);if(oRes.strCodeDesc!=""){var arrCode=oRes.strCodeDesc.split("->");for(var x=0;x<arrCode.length;x++){if(strKeywords!=""){strKeywords+=", ";}strKeywords+=arrCode[x];}}var res=true;if(app.OnNewKBDocument!=undefined){_CURRENT_JS_WINDOW=window;res=app.OnNewKBDocument(app.session.analystId,strProbCode,strCallRefList,strProbText,strSolution,strKeywords,strTitle);}if(res==true){var strParams="in_callref="+strCallRefList;strParams+="&in_problem="+strProbText;strParams+="&in_solution="+strSolution;strParams+="&in_probcode="+strProbCode;strParams+="&in_fixcode="+strFixCode;strParams+="&in_title="+strTitle;strParams+="&in_keywords="+strKeywords;strParams+="&in_author="+app._analyst_name+" ["+session.analystId+"]";app.kbase.open_compose(strParams,modalCallbackFunction);}}};global.LoadFileInBase64=function(strFileName){return"";};global.LogInfo=function(strFormOrEntityName,strFunctionName,strMessage,nLogType){return"";};function OpenSqlTreeBrowserForm(strConfigName,bPage1PickMode,bPage2PickMode,strTreeFilter){var strParams="treefilter="+strTreeFilter;if(bPage1PickMode||bPage1PickMode==undefined){strParams+="&resolvemode=1";}if(bPage2PickMode){strParams+="&resolvetreemode=1";}var useWin=(app._CURRENT_JS_WINDOW&&app._CURRENT_JS_WINDOW.open&&!app._CURRENT_JS_WINDOW.closed)?app._CURRENT_JS_WINDOW:window;var oForm=app._open_application_form("treebrowserform."+strConfigName,"stf","",strParams,true,"add",null,null,useWin);if(oForm){try{return oForm._swdoc._selected_treeformkey;}catch(e){return"";}}return false;}global.OpenSqlTreeBrowserForm=OpenSqlTreeBrowserForm;function OpenHtmlWindow(strName,strType,strURL,strTitle,bResizable,iWidth,iHeight){strURL=_swc_parse_variablestring(strURL);var useWin=(app._CURRENT_JS_WINDOW&&app._CURRENT_JS_WINDOW.open&&!app._CURRENT_JS_WINDOW.closed)?app._CURRENT_JS_WINDOW:window;var strResize=(bResizable)?"yes":"no";var strProperties="height="+iHeight+",width="+iWidth+",toolbar=no,directories=no,status=no,menubar=no,scrollbars=no,resizable="+strResize;if(strType.toLowerCase=="frame"){useWin.open(strURL,strName,strProperties);}else{if(strType.toLowerCase=="modal"){useWin.showModalDialog(strURL,useWin,"resizable:"+strResize+";scroll:no;dialogWidth:"+iWidth+"px;dialogHeight:"+iHeight+"px");}else{if(app.isIE){useWin.showModelessDialog(strURL,useWin,"resizable:"+strResize+";scroll:no;dialogWidth:"+iWidth+"px;dialogHeight:"+iHeight+"px");}else{useWin.open(strURL,strName,strProperties+",modal=yes");}}}}global.OpenHtmlWindow=OpenHtmlWindow;global.alert=function(strMessage,nOptionButtons){alert(strMessage);};function GetAsISO8601TimeString(epValue){var d=new Date((epValue*1000));function pad(n){return n<10?"0"+n:n;}return d.getUTCFullYear()+"-"+pad(d.getUTCMonth()+1)+"-"+pad(d.getUTCDate())+" "+pad(d.getUTCHours())+":"+pad(d.getUTCMinutes())+":"+pad(d.getUTCSeconds());}global.GetAsISO8601TimeString=GetAsISO8601TimeString;global.AttachMessageToCall=function(strMailboxName,strMessageID,strFileName,strCallReference,strCallUdIndex,strMailActionType,bIncludeAttachments,strMoveMessageToFolder){var xmlmc=new XmlMethodCall();xmlmc.SetParam("mailbox",strMailboxName);xmlmc.SetParam("messageId",strMessageID);xmlmc.SetParam("fileName",strFileName);xmlmc.SetParam("callRef",strCallReference);xmlmc.SetParam("udIndex",strCallUdIndex);xmlmc.SetParam("attachType",strMailActionType);xmlmc.SetParam("includeAttachments",bIncludeAttachments);if(strMoveMessageToFolder!=undefined&&strMoveMessageToFolder!=""){var xmlmctwo=new XmlMethodCall();xmlmctwo.SetParam("mailbox",strMailboxName);xmlmctwo.SetParam("folderPath",strMoveMessageToFolder);if(xmlmctwo.Invoke("mail","getFolderFromPath")){xmlmc.SetParam("moveMessageToFolderId",xmlmctwo.GetParam("folderId"));}}xmlmc.Invoke("helpdesk","attachMessageToCall");return true;};global.CallStatusString=function(nStatus){return app.dd.tables["opencall"].columns["status"].FormatValue(nStatus);};global.CanSendMail=function(){_email_getmailbox_permissions();return _email_checkright(_EM_CANSEND,"%");};global.CloseMailMessageWindow=function(strMessageID){};global.ComposeCallUpdateEmail=function(arrCallInfo,intUdIndex,strMessageText,flFileAttachments,nTimeSpent,strTemplateName,nTemplateType,modalCallbackFunction,strWebclientCallclass){var boolCommaSepCallrefs=(typeof arrCallInfo=="string")?true:false;var boolFetchMessageTextFromUdIndex=false;if(strWebclientCallclass==undefined){strWebclientCallclass="";}intUdIndex+="";if(boolCommaSepCallrefs){if(nTemplateType==undefined){alert("global.ComposeCallUpdateEmail (old) : Expects 7 parameters to be passed in but only 6 are present.\n\n Please contact your administrator.");return false;}if(intUdIndex.indexOf("\n")){intUdIndex=intUdIndex.split("\n")[0];}}else{if($.isFunction(nTemplateType)){modalCallbackFunction=nTemplateType;}nTemplateType=strTemplateName;strTemplateName=nTimeSpent;nTimeSpent=flFileAttachments;flFileAttachments=strMessageText;strMessageText=intUdIndex;}if(strMessageText==""&&!isNaN(intUdIndex)){boolFetchMessageTextFromUdIndex=true;}var strCallClass="";var xmlTemplateNode=null;if(strTemplateName=="UpdateCallMailTemplate"){strTemplateName="Update Call";}else{if(strTemplateName=="CloseCallMailTemplate"){strTemplateName="Close Call";}else{if(strTemplateName=="HoldCallMailTemplate"){strTemplateName="Hold Call";}else{if(strTemplateName=="LogCallMailTemplate"){strTemplateName="Log Call";}}}}if(nTemplateType==undefined){nTemplateType=0;if(strTemplateName=="UpdateCallMailTemplate"){nTemplateType=TEMPLATE_UPDATECALL;}else{if(strTemplateName=="CloseCallMailTemplate"){nTemplateType=TEMPLATE_CLOSECALL;}else{if(strTemplateName=="HoldCallMailTemplate"){nTemplateType=TEMPLATE_HOLDCALL;}else{if(strTemplateName=="LogCallMailTemplate"){nTemplateType=TEMPLATE_LOGCALL;}}}}}var intFirstCallref=0;var intUpdateIndex=intUdIndex;if(boolCommaSepCallrefs){var arrCallrefs=arrCallInfo.split(",");for(var x=0;x<arrCallrefs.length;x++){if(intFirstCallref==0){intFirstCallref=arrCallrefs[x];}}}else{for(intCallref in arrCallInfo){if(intFirstCallref==0){intFirstCallref=intCallref;if(isNaN(intUdIndex)){intUpdateIndex=arrCallInfo[intCallref];}}}}if(strWebclientCallclass==""){var strParams="callref="+intFirstCallref+"&udindex="+intUpdateIndex;var rs=new SqlQuery();rs.WebclientStoredQuery("system/getCallClassAndLastUpdateText",strParams);if(rs.Fetch()){if(boolFetchMessageTextFromUdIndex){strMessageText=rs.GetValueAsString("updatetxt");}strCallClass=rs.GetValueAsString("callclass");}}else{strCallClass=strWebclientCallclass;}var _array_selectable_templates=new Array();for(strMailboxID in _current_mailbox_permissions){if(_email_checkright(_EM_TEMPLATEUSE,strMailboxID)){var strDisplayName=global.GetSharedMailboxDisplayName(strMailboxID);var xmlmc=new XmlMethodCall();xmlmc.SetParam("mailbox",strMailboxID);xmlmc.SetParam("templateType",nTemplateType);xmlmc.SetParam("returnMime",false);if(xmlmc.Invoke("mail","getMailTemplateList")){var arrTemplates=xmlmc.xmlDOM.getElementsByTagName("mailTemplate");for(var x=0;x<arrTemplates.length;x++){var oTemplate=new Object();oTemplate.name=app.xmlNodeTextByTag(arrTemplates[x],"templateName");oTemplate.mailbox=strMailboxID;oTemplate.mailboxname=strDisplayName;oTemplate.callclass=app.xmlNodeTextByTag(arrTemplates[x],"callClass");if(oTemplate.callclass==strCallClass||oTemplate.callclass==""||oTemplate.callclass=="All Classes"){_array_selectable_templates[_array_selectable_templates.length++]=oTemplate;}}}}}var intUseFirstAddress=0;var intUseTemplate=0;var intUseHTMLTemplate=1;if(_array_selectable_templates.length==0){alert("There are no templates defined that you can use for sending emails. Please contact your Administrator");app.debug("No email templates available for "+strTemplateName,"global.ComposeCallUpdateEmail","Get Templates");return false;}else{if(_array_selectable_templates.length>1){var _specialParams=new Array();_specialParams["_emailtemplates"]=_array_selectable_templates;_specialParams["_defaultclass"]=strCallClass;var aForm=_open_system_form("_sys_email_templatepicker","mail","","",true,null,undefined,undefined,undefined,undefined,_specialParams);if(aForm.document.selectedindex==-1){return false;}intUseTemplate=aForm.document.selectedindex;strCallClass=aForm.document.selectedcallclass;intUseFirstAddress=aForm.document.flg_userfirstaddress;intUseHTMLTemplate=aForm.document.flg_userhtmltemplate;}}var useTemplate=_array_selectable_templates[intUseTemplate];var xmlmc=new XmlMethodCall("abcdef");xmlmc.SetParam("mailbox",useTemplate.mailbox);xmlmc.SetParam("templateMailbox",useTemplate.mailbox);xmlmc.SetParam("templateName",useTemplate.name);xmlmc.SetParam("templateType",nTemplateType);xmlmc.SetParam("callClass",strCallClass);var arrProperCallrefs=new Array();if(boolCommaSepCallrefs){var arrCallInfo=arrCallInfo.split(",");for(var x=0;x<arrCallrefs.length;x++){xmlmc.SetParam("callRef",arrCallrefs[x]);arrProperCallrefs[arrProperCallrefs.length++]=arrCallrefs[x];}}else{for(intCallref in arrCallInfo){xmlmc.SetParam("callRef",intCallref);arrProperCallrefs[arrProperCallrefs.length++]=intCallref;}}flFileAttachments=intFirstCallref+"."+intUpdateIndex;xmlmc.SetParam("lastUpdate",strMessageText);xmlmc.SetParam("timeSpent",(nTimeSpent));xmlmc.SetParam("dataDictionary",session.dataDictionary);var _arrSpecial=new Array();_arrSpecial["_arrMailmergeCallrefs"]=arrProperCallrefs;_arrSpecial["_mailbox"]=useTemplate.mailbox;_arrSpecial["_templatename"]=useTemplate.name;_arrSpecial["_templatetype"]=nTemplateType;_arrSpecial["_firstadd"]=intUseFirstAddress;_arrSpecial["_usehtml"]=intUseHTMLTemplate;_arrSpecial["_timespent"]=nTimeSpent;_arrSpecial["_lastupdate"]=strMessageText;_arrSpecial["_lastupdateCallInfo"]=flFileAttachments;_arrSpecial["_mergeMessageXmlmc"]=xmlmc;var strParams="addnew=1&_emailaction=CALLMERGE:&_mailbox="+useTemplate.mailbox;var systemCallbackFunction=null;if(modalCallbackFunction){systemCallbackFunction=function(){modalCallbackFunction({});};}app._open_system_form("_sys_email_formcompose","mail","",strParams,false,systemCallbackFunction,null,window,undefined,undefined,_arrSpecial);};global.GetSharedMailboxDisplayName=function(strMailbox){for(var x=0;x<_arr_xml_mailbox_list.length;x++){if(app.xmlNodeTextByTag(_arr_xml_mailbox_list[x],"name").toLowerCase()==strMailbox.toLowerCase()){return app.xmlNodeTextByTag(_arr_xml_mailbox_list[x],"displayName");}}return"";};global.IsSharedMailbox=function(strMailbox){for(var x=0;x<_arr_xml_mailbox_list.length;x++){if(app.xmlNodeTextByTag(_arr_xml_mailbox_list[x],"name").toLowerCase()==strMailbox.toLowerCase()){return(app.xmlNodeTextByTag(_arr_xml_mailbox_list[x],"type")=="2");}}return"";};global.GetMailboxNameByPos=function(nPos){if(nPos>999){nPos=nPos-1000;}return app.xmlNodeTextByTag(_arr_xml_mailbox_list[nPos],"name");};global.GetMailboxDisplayByPos=function(nPos){if(nPos>999){nPos=nPos-1000;}return app.xmlNodeTextByTag(_arr_xml_mailbox_list[nPos],"displayName");};global.GetSharedMailboxXmlNode=function(strMailbox){for(var x=0;x<_arr_xml_mailbox_list.length;x++){if(app.xmlNodeTextByTag(_arr_xml_mailbox_list[x],"name").toLowerCase()==strMailbox.toLowerCase()){return _arr_xml_mailbox_list[x];}}return null;};global.GetMailboxEmailAddressByPos=function(nPos){if(nPos>999){nPos=nPos-1000;}alert(_arr_xml_mailbox_list[nPos].xml);return app.xmlNodeTextByTag(_arr_xml_mailbox_list[nPos],"address");};global.GetMailboxEmailNameByPos=function(nPos){if(nPos>999){nPos=nPos-1000;}return app.xmlNodeTextByTag(_arr_xml_mailbox_list[nPos],"name");};global.GetMailboxEmailDisplayNameByPos=function(nPos){if(nPos>999){nPos=nPos-1000;}var strRet=app.xmlNodeTextByTag(_arr_xml_mailbox_list[nPos],"displayName");if(strRet==""){strRet=this.GetMailboxEmailNameByPos(nPos);}return strRet;};global.GetEmailForm_DefaultAddressValue=function(strMailbox,intUseFirstAdd){var arr_unique_mailbox_names=new Array();var strLocalMailBox="";if(strMailbox==undefined){strMailbox=="";}var strPickList="";for(var x=0;x<_arr_xml_mailbox_list.length;x++){var y=x;var strDisplay=app.xmlNodeTextByTag(_arr_xml_mailbox_list[x],"displayName");var strName=app.xmlNodeTextByTag(_arr_xml_mailbox_list[x],"name");if(!app._email_checkright(app._EM_CANSEND,strName)){continue;}if(arr_unique_mailbox_names[strName]==undefined){arr_unique_mailbox_names[strName]=1;y=x+1000;}if(strMailbox!=""){if(app.xmlNodeTextByTag(_arr_xml_mailbox_list[x],"name").toLowerCase()==strMailbox.toLowerCase()){if(intUseFirstAdd!=undefined&&intUseFirstAdd==1){y=x;}return y;}}else{if(intUseFirstAdd!=undefined&&intUseFirstAdd==1){y=x;}return y;}}return 0;};global.GetEmailForm_AddressPickList=function(strMailbox){var arr_unique_mailbox_names=new Array();var strLocalMailBox="";var strPickList="";for(var x=0;x<_arr_xml_mailbox_list.length;x++){var strDisplay=app.xmlNodeTextByTag(_arr_xml_mailbox_list[x],"displayName");var strName=app.xmlNodeTextByTag(_arr_xml_mailbox_list[x],"name");var strAddress=app.xmlNodeTextByTag(_arr_xml_mailbox_list[x],"address");if(!app._email_checkright(app._EM_CANSEND,strName)){continue;}if(arr_unique_mailbox_names[strName]==undefined){arr_unique_mailbox_names[strName]=1;if(strLocalMailBox!=""){strLocalMailBox+="|";}strLocalMailBox+=strDisplay+" (local)"+"^"+(x+1000);}if(strAddress.indexOf("@")!=-1){if(strMailbox!=""){if(app.xmlNodeTextByTag(_arr_xml_mailbox_list[x],"name").toLowerCase()==strMailbox.toLowerCase()){if(strPickList!=""){strPickList+="|";}strPickList+=strDisplay+" ("+app.xmlNodeTextByTag(_arr_xml_mailbox_list[x],"address")+")"+"^"+x;}}else{if(strPickList!=""){strPickList+="|";}strPickList+=strDisplay+" ("+app.xmlNodeTextByTag(_arr_xml_mailbox_list[x],"address")+")"+"^"+x;}}}if(strPickList!=""){strPickList=strLocalMailBox+"|"+strPickList;}else{strPickList=strLocalMailBox;}return strPickList;};global.confirm=function(strMessage){return confirm(strMessage);};global.DebugPrint=function(strMessage){};global.EpocTimeFromString=function(strTime){var jsDate=_parseDate(strTime);if(jsDate){var intEpoch=parseInt(Date.UTC(jsDate.getFullYear(),jsDate.getMonth(),jsDate.getDate(),jsDate.getHours(),jsDate.getMinutes(),jsDate.getSeconds())/1000);return intEpoch;}else{return 0;}};global.EpocTimeFromStringGmt=function(strTime){var jsDate=_parseDate(strTime);if(jsDate){return _date_to_utc_epoch(jsDate);}else{return 0;}};global.GetCacheRecordCount=function(strTable,strWhere){var strSQLWhere=(strWhere=="")?"":strWhere;var strParams="dsn=sw_systemdb&table="+strTable+"&filter="+strWhere;var rs=new SqlQuery();rs.RemoteWebclientQuery("system/getCallClassAndLastUpdateText",strParams);if(rs.Fetch()){return rs.GetValueAsNumber("counter");}else{return -1;}};global.GetCallStatusInfo=function(sCallref,bSwdata){if(bSwdata==undefined){bSwdata=false;}var o=new Object();o.nStatus=0;o.strCallClass="";o.strPriority="";var strDB=(bSwdata)?"swdata":"syscache";var rs=new SqlQuery();var strParams="dsn="+strDB+"&callref="+sCallref;rs.WebclientStoredQuery("system/getCallStatusInfo",strParams);if(rs.Fetch()){o.nStatus=rs.GetValueAsNumber("status");o.strCallClass=rs.GetValueAsString("callclass");o.strPriority=rs.GetValueAsString("priority");}else{if(!bSwdata){return this.GetCallStatusInfo(sCallref,true);}}return o;};global.GetCurrentEpocTime=function(){var t=new Date();var intEpoch=app._date_to_epoch(t);return intEpoch;};global.GetProblemProfileDescription=function(strCode){var oRes=new Object();var oRS=new SqlQuery();var strParams="code="+strCode;oRS.WebclientStoredQuery("system/getProblemProfileDescription",strParams);if(oRS.Fetch()){oRes.strCodeDesc=oRS.GetValueAsString("codedesc");oRes.strDescription=oRS.GetValueAsString("codetext");}else{oRes.strCodeDesc="";oRes.strDescription="";}return oRes;};global.GetResolutionProfileDescription=function(strCode){var oRes=new Object();var oRS=new SqlQuery();var strParams="code="+strCode;oRS.WebclientStoredQuery("system/getResolutionProfileDescription",strParams);if(oRS.Fetch()){oRes.strCodeDesc=oRS.GetValueAsString("codedesc");oRes.strDescription=oRS.GetValueAsString("codetext");}else{oRes.strCodeDesc="";oRes.strDescription="";}return oRes;};global.GuiFlush=function(){return true;};global.HttpGet=function(strGetUrl,bAppendSessionInfo){if(bAppendSessionInfo){var strPrefix=(strGetUrl.indexOf("?")>-1)?"&":"?";strGetUrl+=strPrefix+"sessid="+app._swsessionid;}var strParams="_geturl="+app.pfu(strGetUrl);var strURL=app.get_service_url("swclass/httpget","");return app.get_http(strURL,strParams,true,false);};global._mailserverrunning=undefined;global.IsConnectedToMailServer=function(){if(this._mailserverrunning!=undefined){return this._mailserverrunning;}var strParams="";var strURL=app.get_service_url("email/isservicerunning","");var res=app.get_http(strURL,strParams,true,false);this._mailserverrunning=(res=="true");return this._mailserverrunning;};global.IsCallInKnowledgeBase=function(varCallref){var xmlmc=new XmlMethodCall();xmlmc.SetParam("callref",varCallref);if(xmlmc.Invoke("knowledgebase","isCallInKnowledgeBase")){return(xmlmc.GetParam("included")=="false")?false:true;}return false;};global.IsObjectDefined=function(strObjectName){try{var tmp=eval(strObjectName);}catch(e){return false;}return true;};global._wc_boolSurveyModuleEnabled=-1;global.IsSurveyModuleEnabled=function(){if(this._wc_boolSurveyModuleEnabled==-1){this._wc_boolSurveyModuleEnabled=false;var strURL=app.get_service_url("session/getlicinfo","");var xmlLicInfo=app.get_http(strURL,"",true,true);if(xmlLicInfo){var arrLic=xmlLicInfo.getElementsByTagName("features");if(arrLic[0]){var strSurvey=xmlNodeTextByTag(arrLic[0],"survey");if(strSurvey=="true"){this._wc_boolSurveyModuleEnabled=true;}}}}return this._wc_boolSurveyModuleEnabled;};global.LockCalls=function(strCallRefs,strReason,bDisplayMessage){if(strReason==undefined){strReason="UPDATE";}if(bDisplayMessage==undefined){bDisplayMessage=false;}strCallRefs+="";var arrCalls=strCallRefs.split(",");var xmlmc=new XmlMethodCall();for(var x=0;x<arrCalls.length;x++){xmlmc.SetParam("callref",arrCalls[x]);}xmlmc.SetParam("reason",strReason);if(xmlmc.Invoke("helpdesk","lockCalls")){var arrMessage=xmlmc.xmlDOM.getElementsByTagName("message");if(arrMessage[0]){var msg=app.xmlText(arrMessage[0]);var test="locked by "+app.session.analystid.toLowerCase();if(msg.toLowerCase().indexOf(test)==-1){alert(msg);return false;}}return true;}else{if(bDisplayMessage){alert(xmlmc.GetLastError());}}return false;};global.LogNewCall=function(strFormName,callback,aWin,_specialParams,strPassOnParams){if(strPassOnParams==undefined){strPassOnParams="";}app._open_logcall_form(strFormName,strPassOnParams,aWin,_specialParams,callback);};global.MessageBeep=function(nSoundType){};global.MessageBox=function(strMessage,nOptions,callback,aWin){return MessageBox(strMessage,nOptions,callback,aWin);};global.OpenCallDetailsView=function(nCallRef,callback){app._open_call_detail(nCallRef,callback);};global.ShellExecute=function(strCommand){ShellExecute(strCommand);};global.OpenDatabaseSearchView=function(strSql,nLimit){var strParams="query="+strSql;if(nLimit!=undefined&&!isNaN(nLimit)){strParams+"&limit="+nLimit;}_hslaction("sqlsearch",strParams);};global.OpenEmbeddedURL=function(strUrl,loadIntoCurrentView,loadIntoLeftView){if(loadIntoCurrentView==undefined){loadIntoCurrentView=false;}if(loadIntoLeftView==undefined){loadIntoLeftView=false;}if(strUrl.toLowerCase().indexOf("hsl:")>-1){var arrInf=strUrl.split("?");var arrAction=arrInf[0].split(":");_hslaction(arrAction[1],arrInf[1],null);}else{if(!loadIntoCurrentView){app.application_navbar.activatebar("supportworks_today");}var targetFrame=(loadIntoLeftView)?app.oCurrentOutlookControl:app.oCurrentOutlookWorkSpace;strUrl=_swc_parse_variablestring(strUrl);targetFrame.setAttribute("externalUrl",true);targetFrame.src=strUrl;}};global.OpenVCM=function(strConfigItemKey,strConfigFile,nShowType,nShowLevel,nObjInGroup,nZoom){alert("OpenVCM : Is not currently suported by the webclient");};global.PrepareForXML=function(strValue){return pfx(strValue);};function pfx(strValue){strValue+="";strValue=strValue.replace(/\&/g,"&amp;");strValue=strValue.replace(/</g,"&lt;");strValue=strValue.replace(/>/g,"&gt;");strValue=strValue.replace(/\"/g,"&quot;");strValue=strValue.replace(/\'/g,"&apos;");return strValue;}function unpfx(strValue){strValue+="";strValue=strValue.replace(/\&lt;/g,"<");strValue=strValue.replace(/\&gt;/g,">");strValue=strValue.replace(/\&quot;/g,'"');strValue=strValue.replace(/\&apos;/g,"'");strValue=strValue.replace(/\&amp;/g,"&");return strValue;}global.PrepareForSQL=function(strValue){return pfs(strValue);};function pfs(strValue){strValue+="";if(app._dbtype=="swsql"){strValue=app.string_replace(strValue,"'","''",true);}else{strValue=app.string_replace(strValue,"'","''",true);}return strValue;}global.prompt=function(strMessage,strValue){return prompt(strMessage,strValue);};global.RunHIB=function(strURL,strCompVarName,strCompIDValue){var strParams="_url="+strURL+"&_assetvar="+strCompVarName+"&_assetid="+strCompIDValue;var aForm=_open_system_form("interface.php","hib","",strParams,false,null,null,null,1000,800);};global.ScheduleCallback=function(nCallRef){alert("ScheduleCallback : Is not currently suported by the webclient");};global.RunProgram=function(){return true;};global.Sleep=function(nMilliseconds){};global.StoredQueryExecute=function(queryName,queryParams,optBoolSqlCount){var tmpQ=new SqlQuery();var res=tmpQ.StoredQuery("execute/"+queryName,queryParams);if(!res){return -1;}if(optBoolSqlCount){if(tmpQ.Fetch()){return tmpQ.GetValueAsNumber(0);}else{return -1;}}else{return tmpQ._recordset.params.rowsEffected;}};global.SqlExecute=function(strDatabase,strSQL){var tmpQ=new SqlQuery();if(tmpQ.Query(strSQL,strDatabase)){if(strSQL.toLowerCase().indexOf("select count(*) from")==0){if(tmpQ.Fetch()){return tmpQ.GetValueAsNumber(0);}else{return -1;}}else{if(strSQL.toLowerCase().indexOf("select")==0){return tmpQ.GetRowCount();}else{return 1;}}}else{return -1;}};global.UnlockCalls=function(strCallRefs){strCallRefs+="";var arrCalls=strCallRefs.split(",");var xmlmc=new XmlMethodCall();for(var x=0;x<arrCalls.length;x++){xmlmc.SetParam("callref",arrCalls[x]);}if(xmlmc.Invoke("helpdesk","unlockCalls")){var arrMessage=xmlmc.xmlDOM.getElementsByTagName("message");if(arrMessage[0]){return false;}return true;}return false;};global.ValidateSLAName=function(strSLAName){var rs=new SqlQuery();var strParams="sla="+strSLAName;rs.WebclientStoredQuery("system/getProblemProfileDescription",strParams);if(rs.GetRowCount()>0){return true;}return false;};global.xpathGetXml=function(xpath){return"";};global._runQuickLogCall=function(strName,strFolder){var xmlmc=new XmlMethodCall();xmlmc.SetParam("name",strName);xmlmc.SetParam("mailbox",strFolder);if(!xmlmc.Invoke("helpdesk","quicklogCallGet")){alert("xmlmc helpdesk:quicklogCallGet Failed:\n\n"+xmlmc.GetLastError());return false;}var strForm=xmlmc.GetParam("formName");var strClass=xmlmc.GetParam("callClass");var arrParams=new Array();arrParams["_qlc_data"]=xmlmc.xmlDOM;global.LogNewCall(strForm,null,window,arrParams);return true;};global._deleteQuickLogCall=function(strName,strFolder){var xmlmc=new XmlMethodCall();xmlmc.SetParam("name",strName);xmlmc.SetParam("mailbox",strFolder);if(!xmlmc.Invoke("helpdesk","quicklogCallDelete")){alert("xmlmc helpdesk:quicklogCallDelete Failed:\n\n"+xmlmc.GetLastError());return false;}return true;};global._selectFileToUpload=function(strUploadPhpSrc,strGenFieldOneValue,funcCallback){global._fileUploadPhpSrc=strUploadPhpSrc;global._genFieldOneValue=strGenFieldOneValue;var oForm=document.getElementById("form_fileuploader");if(oForm==null){return;}if((!app.isIE)||(app.isIE8||app.isIE6)){var arrField=new Array();arrField["_uniqueformid"]=-1;arrField["_callback"]=funcCallback;arrField["_genfieldvalue"]=strGenFieldOneValue;arrField["_top"]=top;var popupForm=app._open_system_form("fileupload.php","fileupload","","",true,null,null,window,400,20,arrField);if(popupForm._uploadfilenode==null||app.isSafari){return;}if(app.isIE6){res=oForm.insertAdjacentElement("beforeEnd",popupForm._uploadfilenode);}else{var res=oForm.appendChild(popupForm._uploadfilenode);}global._webclientUploadFile();return;}var eFile=app.getEleDoc(oForm).getElementById("swfileupload");if(eFile==null){eFile=app.getEleDoc(oForm).createElement("input");eFile.setAttribute("type","file");eFile.setAttribute("name","swfileupload");eFile.setAttribute("id","swfileupload");app.addEvent(eFile,"change",global._webclientUploadFile);if(app.isIE6){oForm.insertAdjacentElement("beforeEnd",eFile);}else{oForm.appendChild(eFile);}}if(app.isChrome||app.isIE6){oForm.style.display="block";}eFile.click();};global._webclientUploadFile=function(){var oForm=document.getElementById("form_fileuploader");if(oForm==null){return;}oForm.setAttribute("action",global._fileUploadPhpSrc);if(global._genFieldOneValue==undefined){global._genFieldOneValue="";}var eGenField=app.getEleDoc(oForm).getElementById("frm_genfieldone");if(eGenField!=null){eGenField.value=global._genFieldOneValue;}var oIF=app.getEleDoc(oForm).getElementById("iframe_webclient_fileuploader");if(oIF==null){var strIframeHTML="<iframe id='iframe_webclient_fileuploader' name='iframe_webclient_fileuploader' style='position:absolute;top:0;left:0;display:none;'></iframe>";app.insertBeforeEnd(app.getEleDoc(oForm).body,strIframeHTML);oIF=app.getEleDoc(oForm).getElementById("iframe_webclient_fileuploader");}oForm.submit();if(app.isChrome){setTimeout("global._webclientUploadFileHideForm()",1000);}};global._webclientUploadFileHideForm=function(){var oForm=document.getElementById("form_fileuploader");if(oForm==null){return;}oForm.style.display="none";};global._cached_getTimeZoneOffset=null;global._getTimeZoneOffset=function(strTimeZone){if(global._cached_getTimeZoneOffset!=null){return global._cached_getTimeZoneOffset;}var res=0;var xmlmc=new XmlMethodCall();xmlmc.SetParam("timeZone",strTimeZone);if(xmlmc.Invoke("system","getTimezoneOffset")){res=xmlmc.GetParam("offset");res++;res--;global._cached_getTimeZoneOffset=res;}return res;};global.ConvertDateTimeInText=function(strBlock){var Iso8601InBracketsUtc=new RegExp("\\[\\d{4}-\\d{2}-\\d{2} \\d{2}:\\d{2}:\\d{2}\\]-UTC","g");var UkStyleInBracketsUtc=new RegExp("\\[\\d{1,2}\\/\\d{1,2}\\/\\d{4} \\d{1,2}:\\d{1,2}:\\d{1,2}\\]-UTC","g");var Iso8601Z=new RegExp("\\d{4}-\\d{2}-\\d{2} \\d{2}:\\d{2}:\\d{2}Z","g");var fUtc=function($0,$1,$2,$3,$4,$5,$6){var strDate=$0.replace("[","").replace("]","").replace("-UTC","").replace("Z","");var arrParts=strDate.split(" ");var arrDateParts=arrParts[0].split("-");var arrTimeParts=arrParts[1].split(":");return format_dateparts(app._analyst_datetimeformat,app._analyst_timezoneoffset,arrDateParts[0],arrDateParts[1],arrDateParts[2],arrTimeParts[0],arrTimeParts[1],arrTimeParts[2]);};var fUK=function($0,$1,$2,$3,$4,$5,$6){var strDate=$0.replace("[","").replace("]","").replace("-UTC","").replace("Z","");var arrParts=strDate.split(" ");var arrDateParts=arrParts[0].split("/");var arrTimeParts=arrParts[1].split(":");return format_dateparts(app._analyst_datetimeformat,app._analyst_timezoneoffset,arrDateParts[2],arrDateParts[1],arrDateParts[0],arrTimeParts[0],arrTimeParts[1],arrTimeParts[2]);};return strBlock.replace(Iso8601InBracketsUtc,fUtc).replace(Iso8601Z,fUtc).replace(UkStyleInBracketsUtc,fUK);};