{"espForm":{"configuration":{"settings":{"name":"create_session","title":"Remote Support","options":{"allowResize":"true","showMenubar":"false","showToolbar":"false","showStatusBar":"false"}},"javascript":{"methods":{"method":{"name":"(Globals)","code":"var rsname = \"\";\nvar callref = \"\";\nvar keyurl = \"\";\nvar shortkey = \"\";\nvar _keyStr = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+\/=\";\n\nfunction MF()\n{\n\treturn mainform;\n}\n\nfunction send_email()\n{\n\t\tvar xmlmc = new XmlMethodCall;\n\t\n\t\t\/\/ Set up our input parameters\n\t\txmlmc.SetValue(\"rsname\", _swdoc.rsname);\n\t\txmlmc.SetValue(\"email\", _swdoc.MF().fld_email.value);\n\t\tif(_swdoc.callref!=\"\")\n\t\t{\n\t\t\txmlmc.SetValue(\"callref\", _swdoc.callref);\n\t\t}\n\t\txmlmc.SetValue(\"keyurl\", _swdoc.keyurl);\n\t\txmlmc.SetValue(\"shortkey\", _swdoc.shortkey);\n\t\n\t\t\/\/ Invoke the method\n\t\tif(xmlmc.Invoke(\"VPME\", \"emailRemoteSupport\"))\n\t\t{\n\t\t\tvar strXML = (app.bWebClient)? xmlmc._lastresult:xmlmc.GetReturnXml();\n\n\t\t\tvar objRes = XMCResult(strXML);\n\t\t\tif(!objRes.success)\n\t\t\t{\n\t\t\t\t\/\/app.global.MessageBox(\"Failed to send remote support email \\r\\n\\r\\nError Message: \" + objRes.message, MB_ICONEXCLAMATION);\n\t\t\t\t_ecol(_swdoc.MF().lbl_email_result,\"red\");\n\t\t\t\t_ete(_swdoc.MF().lbl_email_result , \"Email sending failed... \" + objRes.message);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\t_ecol(_swdoc.MF().lbl_email_result,\"green\");\n\t\t\t\t_ete(_swdoc.MF().lbl_email_result , \"Email Sent\");\n\t\t\t}\t     \n\t\t}\n\t\telse\n\t\t{\n\t\t\tMessageBox(xmlmc.GetLastError());\n\t\t}\n\n\n}"}}}},"layouts":{"layout":[{"appearance":{"width":"528","height":"375","backgroundColor":"#ffffff","fillColour":"#ffffff","textColour":"#000000","font":{"@size":"8","#text":"Arial"}},"controls":{"control":[{"general":{"name":"CaptionPanel1","type":"CaptionBar","flags":{"transparent":"true","xpStyle":"false","hasShadow":"false","toolbarButtonStyle":"false","cache":"false","hasBorder":"true","hasCheckbox":"false"}},"appearance":{"index":"0","caption":"Invite customer to join the Support Session","backgroundColor":"#f1f1f1","foregroundColor":"#003366","font":{"@size":"10","@bold":"1","#text":"Trebuchet (MS)"},"alignment":"Left","fillStyle":"Vertical Gradient"},"objectPlacement":{"position":{"top":"8","left":"6","right":"521","bottom":"369"},"scaling":{"top":"0","left":"0","right":"100","bottom":"100"}},"controlInfo":{"mouseOverCursor":"Window Default","properties":{"backgroundColor2":"#d8d8d8","imageHSpace":"10","slope":"12","borderColor":"#d3c9b6","headerHeight":"23","hasBorder":"1","panelBorderColor":"#d3c9b6","fillStyle":"0","panelBackgroundColor":"#f2eedd","panelBackgroundColor2":"#000000"}}},{"general":{"name":"fld_short_key","type":"Field"},"appearance":{"index":"1","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Arial"},"borderStyle":"Rectangle"},"objectPlacement":{"position":{"top":"206","left":"32","right":"252","bottom":"224"},"scaling":{"top":"0","left":"0","right":"0","bottom":"0"}},"controlInfo":{"mouseOverCursor":"Window Default","type":"Text Edit","flags":{"invisible":"false","readOnly":"true","mandatory":"false","mandatoryLabelBackground":"false","mandatoryLabelText":"false","allowNullValue":"false","skipTabStop":"false","disabled":"false","protected":"false","noMacroExpand":"false","readOnlyInit":"false","autoCompleteField":"false","editUnlimitedText":"false","url":"false"},"textLineCount":"0","textInputFormat":"Text","properties":{"borderColor":"#d3c9b6","image":"#eeeeee","disabledBackgroundColor":"#eeeeee"}}},{"general":{"name":"Text1","type":"Text","flags":{"transparent":"true","xpStyle":"false","hasShadow":"false","toolbarButtonStyle":"false","cache":"false","hasBorder":"false","hasCheckbox":"false"}},"appearance":{"index":"2","caption":"Direct the customer to go to the remote support area of selfservice and enter the session key :","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Arial"},"alignment":"Left","borderStyle":"None","fillStyle":"Solid"},"objectPlacement":{"position":{"top":"185","left":"27","right":"490","bottom":"203"},"scaling":{"top":"0","left":"0","right":"0","bottom":"0"}},"controlInfo":{"mouseOverCursor":"Window Default"}},{"general":{"name":"fld_key_url","type":"Field"},"appearance":{"index":"3","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Arial"},"borderStyle":"Rectangle"},"objectPlacement":{"position":{"top":"313","left":"32","right":"495","bottom":"331"},"scaling":{"top":"0","left":"0","right":"0","bottom":"0"}},"controlInfo":{"mouseOverCursor":"Window Default","type":"Text Edit","flags":{"invisible":"false","readOnly":"true","mandatory":"false","mandatoryLabelBackground":"false","mandatoryLabelText":"false","allowNullValue":"false","skipTabStop":"false","disabled":"false","protected":"false","noMacroExpand":"false","readOnlyInit":"false","autoCompleteField":"false","editUnlimitedText":"false","url":"false"},"textLineCount":"0","textInputFormat":"Text","properties":{"borderColor":"#d3c9b6","image":"#eeeeee","disabledBackgroundColor":"#eeeeee"}}},{"general":{"name":"Text2","type":"Text","flags":{"transparent":"true","xpStyle":"false","hasShadow":"false","toolbarButtonStyle":"false","cache":"false","hasBorder":"false","hasCheckbox":"false"}},"appearance":{"index":"4","caption":"Direct the customer to go to this link and follow the prompts","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Arial"},"alignment":"Left","borderStyle":"None","fillStyle":"Solid"},"objectPlacement":{"position":{"top":"292","left":"27","right":"490","bottom":"310"},"scaling":{"top":"0","left":"0","right":"0","bottom":"0"}},"controlInfo":{"mouseOverCursor":"Window Default","flags":{"invisible":"false","skipTabStop":"false","disabled":"false","protected":"false","noMacroExpand":"false","multiLine":"true"}}},{"general":{"name":"btn_email","type":"EventButton"},"appearance":{"index":"5","caption":"Send Email","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Arial"}},"objectPlacement":{"position":{"top":"93","left":"401","right":"495","bottom":"114"},"scaling":{"top":"0","left":"0","right":"0","bottom":"0"}},"controlInfo":{"mouseOverCursor":"Window Default","properties":{"backgroundColor":"#ff9900"}}},{"general":{"name":"Text3","type":"Text","flags":{"transparent":"true","xpStyle":"false","hasShadow":"false","toolbarButtonStyle":"false","cache":"false","hasBorder":"false","hasCheckbox":"false"}},"appearance":{"index":"6","caption":"Email details of the support session to an email address","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Arial"},"alignment":"Left","borderStyle":"None","fillStyle":"Solid"},"objectPlacement":{"position":{"top":"74","left":"27","right":"490","bottom":"92"},"scaling":{"top":"0","left":"0","right":"0","bottom":"0"}},"controlInfo":{"mouseOverCursor":"Window Default","flags":{"invisible":"false","skipTabStop":"false","disabled":"false","protected":"false","noMacroExpand":"false","multiLine":"true"}}},{"general":{"name":"fld_email","type":"Field"},"appearance":{"index":"7","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Arial"},"borderStyle":"Rectangle"},"objectPlacement":{"position":{"top":"95","left":"32","right":"397","bottom":"113"},"scaling":{"top":"0","left":"0","right":"0","bottom":"0"}},"controlInfo":{"mouseOverCursor":"Window Default","type":"Text Edit","textLineCount":"0","textInputFormat":"Text","properties":{"borderColor":"#d3c9b6","image":"#eeeeee","disabledBackgroundColor":"#eeeeee","hintText":"Enter Email Address Here"}}},{"general":{"name":"Line1","type":"Line","flags":{"transparent":"true","xpStyle":"false","hasShadow":"false","toolbarButtonStyle":"false","cache":"false","hasBorder":"false","hasCheckbox":"false"}},"appearance":{"index":"8","caption":"Line 1","backgroundColor":"#ffffff","foregroundColor":"#c0c0c0","font":{"@size":"0"}},"objectPlacement":{"position":{"top":"248","left":"32","right":"493","bottom":"256"},"scaling":{"top":"0","left":"0","right":"0","bottom":"0"}},"controlInfo":{"mouseOverCursor":"Window Default"}},{"general":{"name":"Line2","type":"Line","flags":{"transparent":"true","xpStyle":"false","hasShadow":"false","toolbarButtonStyle":"false","cache":"false","hasBorder":"false","hasCheckbox":"false"}},"appearance":{"index":"9","caption":"Line 1","backgroundColor":"#ffffff","foregroundColor":"#c0c0c0","font":{"@size":"0"}},"objectPlacement":{"position":{"top":"133","left":"30","right":"496","bottom":"141"},"scaling":{"top":"0","left":"0","right":"0","bottom":"0"}},"controlInfo":{"mouseOverCursor":"Window Default"}},{"general":{"name":"lbl_email_result","type":"Text","flags":{"transparent":"true","xpStyle":"false","hasShadow":"false","toolbarButtonStyle":"false","cache":"false","hasBorder":"false","hasCheckbox":"false"}},"appearance":{"index":"10","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Arial"},"alignment":"Left","borderStyle":"None","fillStyle":"Solid"},"objectPlacement":{"position":{"top":"117","left":"32","right":"397","bottom":"137"},"scaling":{"top":"0","left":"0","right":"0","bottom":"0"}},"controlInfo":{"mouseOverCursor":"Window Default"}},{"general":{"name":"Text4","type":"Text","flags":{"transparent":"true","xpStyle":"false","hasShadow":"false","toolbarButtonStyle":"false","cache":"false","hasBorder":"false","hasCheckbox":"false"}},"appearance":{"index":"11","caption":"Selfservice","backgroundColor":"#ffffff","foregroundColor":"#003366","font":{"@size":"12","@bold":"1","#text":"Arial"},"alignment":"Left","borderStyle":"None","fillStyle":"Solid"},"objectPlacement":{"position":{"top":"162","left":"26","right":"192","bottom":"182"},"scaling":{"top":"0","left":"0","right":"0","bottom":"0"}},"controlInfo":{"mouseOverCursor":"Window Default"}},{"general":{"name":"Text5","type":"Text","flags":{"transparent":"true","xpStyle":"false","hasShadow":"false","toolbarButtonStyle":"false","cache":"false","hasBorder":"false","hasCheckbox":"false"}},"appearance":{"index":"12","caption":"Web","backgroundColor":"#ffffff","foregroundColor":"#003366","font":{"@size":"12","@bold":"1","#text":"Arial"},"alignment":"Left","borderStyle":"None","fillStyle":"Solid"},"objectPlacement":{"position":{"top":"267","left":"26","right":"192","bottom":"287"},"scaling":{"top":"0","left":"0","right":"0","bottom":"0"}},"controlInfo":{"mouseOverCursor":"Window Default"}},{"general":{"name":"Text6","type":"Text","flags":{"transparent":"true","xpStyle":"false","hasShadow":"false","toolbarButtonStyle":"false","cache":"false","hasBorder":"false","hasCheckbox":"false"}},"appearance":{"index":"13","caption":"Email","backgroundColor":"#ffffff","foregroundColor":"#003366","font":{"@size":"12","@bold":"1","#text":"Arial"},"alignment":"Left","borderStyle":"None","fillStyle":"Solid"},"objectPlacement":{"position":{"top":"45","left":"26","right":"192","bottom":"65"},"scaling":{"top":"0","left":"0","right":"0","bottom":"0"}},"controlInfo":{"mouseOverCursor":"Window Default"}}]},"javascript":{"methods":{"method":[{"name":"OnFormLoaded","code":"OnFormLoaded(bDataReloaded)\n{\n\t\/\/ TODO: Add your event handler code here\n\tvar strCallref = _swdoc.GetArg(\"in_callref\");\n\tif(strCallref!=\"\")\n\t\tstrCallref = \"in_requestref=\"+strCallref;\n\t\t\n\tif(strCallref==undefined)\n\t\tstrCallref = \"\";\n\t\t\n\t_swdoc.rsname = _swdoc.GetArg(\"in_rstool\");\n\tusername = \"in_analyst=\"+app.session.analystId;\n\n\t\n\tvar strURL = pfu(\"in_rstool=\"+_swdoc.rsname+\"&\"+strCallref+\"&\"+username);\n\tstrURL = encodeBase64(strURL);\n\tvar strXML = app.global.HttpGet(\"http:\/\/\"+app.session.server+\":\"+app.session.httpPort+\"\/sw\/clisupp\/remotesupport\/create_session.php?encodedparams=\"+strURL);\n\tvar oRec = new XmlFile(); \n\tbRet = oRec.loadFromString(strXML); \n\tif(bRet)\n\t{\n\t\toRec = oRec.data;\n\t\t_swdoc.shortkey = oRec.short_key.nodeValue;\n\t\t_ete(mainform.fld_short_key, oRec.short_key.nodeValue);\n\t\t_swdoc.keyurl = oRec.key_url.nodeValue;\n\t\t_ete(mainform.fld_key_url, oRec.key_url.nodeValue);\n\t\t_ete(mainform.fld_email, _swdoc.GetArg(\"in_email\"));\n\t}\n\telse\n\t{\n\t\tMessageBox('Failed to create remote support session info.\\nPlease contact your Supportworks Administrator.');\n\t\t_swdoc.CloseForm();\n\t}\n\n}"},{"name":"btn_email_OnPressed","code":"btn_email_OnPressed()\n{\n\t\/\/ TODO: Add your event handler code here\n\n\t_swdoc.send_email();\n}"},{"name":"(User Defined Functions)","code":"\n    \/\/-- private property\n    \n\n    \/\/ public method for encoding\n     function encodeBase64(input) \n\t {\n        var output = \"\";\n        var chr1, chr2, chr3, enc1, enc2, enc3, enc4;\n        var i = 0;\n\n        input = _utf8_encode(input);\n\n        while (i < input.length) {\n\n            chr1 = input.charCodeAt(i++);\n            chr2 = input.charCodeAt(i++);\n            chr3 = input.charCodeAt(i++);\n\n            enc1 = chr1 >> 2;\n            enc2 = ((chr1 & 3) << 4) | (chr2 >> 4);\n            enc3 = ((chr2 & 15) << 2) | (chr3 >> 6);\n            enc4 = chr3 & 63;\n\n            if (isNaN(chr2)) {\n                enc3 = enc4 = 64;\n            } else if (isNaN(chr3)) {\n                enc4 = 64;\n            }\n\n            output = output +\n            _swdoc._keyStr.charAt(enc1) + _swdoc._keyStr.charAt(enc2) +\n            _swdoc._keyStr.charAt(enc3) + _swdoc._keyStr.charAt(enc4);\n\n        }\n\n        return output;\n    }\n\n\n\n    \/\/ private method for UTF-8 encoding\n    function _utf8_encode(string)\n\t{\n        string = string.replace(\/\\r\\n\/g,\"\\n\");\n        var utftext = \"\";\n\n        for (var n = 0; n < string.length; n++) {\n\n            var c = string.charCodeAt(n);\n\n            if (c < 128) {\n                utftext += String.fromCharCode(c);\n            }\n            else if((c > 127) && (c < 2048)) {\n                utftext += String.fromCharCode((c >> 6) | 192);\n                utftext += String.fromCharCode((c & 63) | 128);\n            }\n            else {\n                utftext += String.fromCharCode((c >> 12) | 224);\n                utftext += String.fromCharCode(((c >> 6) & 63) | 128);\n                utftext += String.fromCharCode((c & 63) | 128);\n            }\n\n        }\n\n        return utftext;\n    }"}]}}},{"appearance":{"width":"360","height":"220","backgroundColor":"#ffffff","fillColour":"#ffffff","textColour":"#000000","font":{"@size":"8","#text":"Arial"}},"javascript":{}}]}}}