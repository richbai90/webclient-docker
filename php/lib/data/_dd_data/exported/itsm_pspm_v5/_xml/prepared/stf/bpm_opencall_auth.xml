<?xml version="1.0" encoding="utf-8" ?>
<espForm>
	<configuration>
		<settings>
			<name>bpm_opencall_auth</name>
			<title>BPM Stage Authorisation</title>
			<description>allow analyst to auth or reject a bpm stage</description>
			<printTemplates>
			</printTemplates>
			<options>
				<allowResize>true</allowResize>
				<showMenubar>false</showMenubar>
				<showToolbar>true</showToolbar>
				<showStatusBar>false</showStatusBar>
			</options>
		</settings>
		<tables>
			<table>
				<name>bpm_oc_auth</name>
				<type>Main Details Table</type>
				<flags>2</flags>
				<assignments>
				</assignments>
			</table>
			<table>
				<name>bpm_stage</name>
				<type>Related Table</type>
				<mainDetailsColumn>fk_stage_id</mainDetailsColumn>
				<flags>2</flags>
				<assignments>
				</assignments>
			</table>
		</tables>
		<showMeItems>
		</showMeItems>
		<javascript>
			<methods>
				<method>
					<name>(Globals)</name>
					<code>
						<![CDATA[function oAuth()
{
	return _swdoc.bpm_oc_auth;
}

function MF()
{
	return _swdoc.mainform;
}]]>
					</code>
				</method>
				<method>
					<name>OnDataSaved</name>
					<code>
						<![CDATA[OnDataSaved()
{
	//-- 09-07-2009
	//-- update related call to process authorisation decision - replaces vpme script
	//-- only when using activex control - requires activex ver 7,3,9,3991
	if (app.bWebClient)
	{           
		//-- store values to set in call update
		var arrCallValues = new Array();
		arrCallValues['bpm_lactionbyid']   =  _swdoc.oAuth().fk_auth_id;
		arrCallValues['bpm_lactionbytype'] =  _swdoc.oAuth().authortype;
		arrCallValues['bpm_laction']       =  "AUTHORISATION";
		arrCallValues['bpm_lactionres']    =  new Number(_swdoc.oAuth().flg_status);
		arrCallValues['bpm_execvpme']    =  1;
		//-- call new global to process call value updates
		app.g.update_callvalues(_swdoc.oAuth().fk_callref,arrCallValues,"bpmauth");
	}

}]]>
					</code>
				</method>
				<method>
					<name>OnSaveData</name>
					<code>
						<![CDATA[OnSaveData()
{
	// TODO: Add your event handler code here
	var oAnalyst = app.g.get_sys_record("swanalysts",app.session.analystId);
	var strAppend = "";
	if(bpm_oc_auth.fk_auth_id!=app.session.analystId)
	{
		strAppend = oAnalyst.name+" has processed this authorisation request on the behalf of "+bpm_oc_auth.authorname+"\n\n";
	}
	if(bpm_oc_auth.status=="Authorised")
	{
		var strCode			= "Request Authorised";
		app.g.new_dairyevent(bpm_oc_auth.fk_callref,strAppend+bpm_oc_auth.comments,"Authorisation Decision",strCode);    
	}
	else if(bpm_oc_auth.status=="Rejected")
	{
		var strCode			= "Request Rejected";
		app.g.new_dairyevent(bpm_oc_auth.fk_callref,strAppend+bpm_oc_auth.comments,"Authorisation Decision",strCode);    
	}
	bpm_oc_auth.actionbyname=oAnalyst.name;
	bpm_oc_auth.actionby = app.session.analystId;
	bpm_oc_auth.actiondatex = app.global.GetCurrentEpocTime();
	return true;
}]]>
					</code>
				</method>
			</methods>
		</javascript>
	</configuration>
	<layouts>
		<layout>
			<appearance>
				<width>475</width>
				<height>251</height>
				<backgroundColor>#ffffff</backgroundColor>
				<fillColour>#ffffff</fillColour>
				<textColour >#000000</textColour >
				<font  size="8">Arial</font>
			</appearance>
			<controls>
				<control>
					<general>
						<name>Field3</name>
						<type>Field</type>
					</general>
					<appearance>
						<index>0</index>
						<backgroundColor>#ffffff</backgroundColor>
						<foregroundColor>#000000</foregroundColor>
						<font  size="8">Arial</font>
						<borderStyle>Rectangle</borderStyle>
					</appearance>
					<objectPlacement>
						<position>
							<top>394</top>
							<left>170</left>
							<right>544</right>
							<bottom>412</bottom>
						</position>
						<scaling>
							<top>0</top>
							<left>0</left>
							<right>100</right>
							<bottom>0</bottom>
						</scaling>
					</objectPlacement>
					<data>
						<binding>bpm_oc_auth.fk_workflow_id</binding>
					</data>
					<controlInfo>
						<mouseOverCursor>Window Default</mouseOverCursor>
						<type>Text Edit</type>
						<flags>
							<invisible>true</invisible>
							<readOnly>false</readOnly>
							<mandatory>false</mandatory>
							<mandatoryLabelBackground>false</mandatoryLabelBackground>
							<mandatoryLabelText>false</mandatoryLabelText>
							<allowNullValue>false</allowNullValue>
							<skipTabStop>false</skipTabStop>
							<disabled>true</disabled>
							<protected>false</protected>
							<noMacroExpand>false</noMacroExpand>
							<readOnlyInit>false</readOnlyInit>
							<autoCompleteField>false</autoCompleteField>
							<editUnlimitedText>false</editUnlimitedText>
							<url>false</url>
						</flags>
						<textLineCount>0</textLineCount>
						<textInputFormat>Text</textInputFormat>
						<properties>
							<content>#eeeeee</content>
							<disabledBackgroundColor>#eaeaea</disabledBackgroundColor>
						</properties>
					</controlInfo>
				</control>
				<control>
					<general>
						<name>Field3</name>
						<type>Field</type>
					</general>
					<appearance>
						<index>1</index>
						<backgroundColor>#ffffff</backgroundColor>
						<foregroundColor>#000000</foregroundColor>
						<font  size="8">Arial</font>
						<borderStyle>Rectangle</borderStyle>
					</appearance>
					<objectPlacement>
						<position>
							<top>12</top>
							<left>83</left>
							<right>457</right>
							<bottom>30</bottom>
						</position>
						<scaling>
							<top>0</top>
							<left>0</left>
							<right>100</right>
							<bottom>0</bottom>
						</scaling>
					</objectPlacement>
					<data>
						<binding>bpm_oc_auth.fk_stage_id</binding>
					</data>
					<controlInfo>
						<mouseOverCursor>Window Default</mouseOverCursor>
						<type>Distinct Pick List</type>
						<flags>
							<invisible>false</invisible>
							<readOnly>false</readOnly>
							<mandatory>false</mandatory>
							<mandatoryLabelBackground>false</mandatoryLabelBackground>
							<mandatoryLabelText>false</mandatoryLabelText>
							<allowNullValue>false</allowNullValue>
							<skipTabStop>false</skipTabStop>
							<disabled>true</disabled>
							<protected>false</protected>
							<noMacroExpand>false</noMacroExpand>
							<readOnlyInit>false</readOnlyInit>
							<comboAutoUpdate>false</comboAutoUpdate>
							<comboNewValues>true</comboNewValues>
							<pickListOrderDesc>false</pickListOrderDesc>
						</flags>
						<textLineCount>0</textLineCount>
						<textInputFormat>Text</textInputFormat>
						<properties>
							<content>#eeeeee</content>
							<disabledBackgroundColor>#eaeaea</disabledBackgroundColor>
							<sqlSource>swdata</sqlSource>
							<distinctTable>bpm_stage</distinctTable>
							<distinctColumn>pk_stage_id</distinctColumn>
							<displayColumn>title</displayColumn>
							<storedQuery>common.filterByTableValues</storedQuery>
						</properties>
					</controlInfo>
				</control>
				<control>
					<general>
						<type>Field</type>
					</general>
					<appearance>
						<index>2</index>
						<backgroundColor>#ffffff</backgroundColor>
						<foregroundColor>#000000</foregroundColor>
						<font  size="8">Arial</font>
						<borderStyle>Rectangle</borderStyle>
					</appearance>
					<objectPlacement>
						<position>
							<top>118</top>
							<left>83</left>
							<right>226</right>
							<bottom>136</bottom>
						</position>
						<scaling>
							<top>50</top>
							<left>0</left>
							<right>50</right>
							<bottom>50</bottom>
						</scaling>
					</objectPlacement>
					<data>
						<binding>bpm_oc_auth.authorname</binding>
					</data>
					<controlInfo>
						<mouseOverCursor>Window Default</mouseOverCursor>
						<type>Text Edit</type>
						<flags>
							<invisible>false</invisible>
							<readOnly>false</readOnly>
							<mandatory>false</mandatory>
							<mandatoryLabelBackground>false</mandatoryLabelBackground>
							<mandatoryLabelText>false</mandatoryLabelText>
							<allowNullValue>false</allowNullValue>
							<skipTabStop>false</skipTabStop>
							<disabled>true</disabled>
							<protected>false</protected>
							<noMacroExpand>false</noMacroExpand>
							<readOnlyInit>false</readOnlyInit>
							<autoCompleteField>false</autoCompleteField>
							<editUnlimitedText>false</editUnlimitedText>
							<url>false</url>
						</flags>
						<textLineCount>0</textLineCount>
						<textInputFormat>Text</textInputFormat>
						<properties>
							<disabledBackgroundColor>#eaeaea</disabledBackgroundColor>
						</properties>
					</controlInfo>
				</control>
				<control>
					<general>
						<name>lb_status</name>
						<type>Field</type>
					</general>
					<appearance>
						<index>3</index>
						<backgroundColor>#ffffff</backgroundColor>
						<foregroundColor>#000000</foregroundColor>
						<font  size="8">Arial</font>
						<borderStyle>Rectangle</borderStyle>
					</appearance>
					<objectPlacement>
						<position>
							<top>118</top>
							<left>314</left>
							<right>457</right>
							<bottom>136</bottom>
						</position>
						<scaling>
							<top>50</top>
							<left>50</left>
							<right>100</right>
							<bottom>50</bottom>
						</scaling>
					</objectPlacement>
					<data>
						<binding>bpm_oc_auth.flg_status</binding>
					</data>
					<controlInfo>
						<mouseOverCursor>Window Default</mouseOverCursor>
						<type>Pick List (Numeric Mode)</type>
						<flags>
							<invisible>false</invisible>
							<readOnly>false</readOnly>
							<mandatory>true</mandatory>
							<mandatoryLabelBackground>false</mandatoryLabelBackground>
							<mandatoryLabelText>false</mandatoryLabelText>
							<allowNullValue>false</allowNullValue>
							<skipTabStop>false</skipTabStop>
							<disabled>false</disabled>
							<protected>false</protected>
							<noMacroExpand>false</noMacroExpand>
							<readOnlyInit>false</readOnlyInit>
							<comboAutoUpdate>false</comboAutoUpdate>
							<comboNewValues>true</comboNewValues>
							<useDDPickList>false</useDDPickList>
						</flags>
						<textLineCount>0</textLineCount>
						<textInputFormat>Text</textInputFormat>
						<properties>
							<listItems>Pending Authorisation^0|Authorised^1|Rejected^2|</listItems>
							<content>#eeeeee</content>
							<disabledBackgroundColor>#eaeaea</disabledBackgroundColor>
						</properties>
					</controlInfo>
				</control>
				<control>
					<general>
						<name>Field5</name>
						<type>Field</type>
					</general>
					<appearance>
						<index>4</index>
						<backgroundColor>#ffffff</backgroundColor>
						<foregroundColor>#000000</foregroundColor>
						<font  size="8">Arial</font>
						<borderStyle>Rectangle</borderStyle>
					</appearance>
					<objectPlacement>
						<position>
							<top>314</top>
							<left>310</left>
							<right>453</right>
							<bottom>332</bottom>
						</position>
						<scaling>
							<top>0</top>
							<left>50</left>
							<right>100</right>
							<bottom>0</bottom>
						</scaling>
					</objectPlacement>
					<data>
						<binding>bpm_oc_auth.authortype</binding>
					</data>
					<controlInfo>
						<mouseOverCursor>Window Default</mouseOverCursor>
						<type>Pick List</type>
						<flags>
							<invisible>true</invisible>
							<readOnly>false</readOnly>
							<mandatory>false</mandatory>
							<mandatoryLabelBackground>false</mandatoryLabelBackground>
							<mandatoryLabelText>false</mandatoryLabelText>
							<allowNullValue>false</allowNullValue>
							<skipTabStop>false</skipTabStop>
							<disabled>true</disabled>
							<protected>false</protected>
							<noMacroExpand>false</noMacroExpand>
							<readOnlyInit>false</readOnlyInit>
							<comboAutoUpdate>false</comboAutoUpdate>
							<comboNewValues>true</comboNewValues>
							<useDDPickList>true</useDDPickList>
						</flags>
						<textLineCount>0</textLineCount>
						<textInputFormat>Text</textInputFormat>
						<properties>
							<defaultValue>Analyst</defaultValue>
							<listItems>Analyst|Customer|</listItems>
							<content>#eeeeee</content>
							<disabledBackgroundColor>#eaeaea</disabledBackgroundColor>
						</properties>
					</controlInfo>
				</control>
				<control>
					<general>
						<name>tb_actdate</name>
						<type>Field</type>
					</general>
					<appearance>
						<index>5</index>
						<backgroundColor>#ffffff</backgroundColor>
						<foregroundColor>#000000</foregroundColor>
						<font  size="8">Arial</font>
						<borderStyle>Rectangle</borderStyle>
					</appearance>
					<objectPlacement>
						<position>
							<top>334</top>
							<left>310</left>
							<right>453</right>
							<bottom>352</bottom>
						</position>
						<scaling>
							<top>0</top>
							<left>50</left>
							<right>100</right>
							<bottom>0</bottom>
						</scaling>
					</objectPlacement>
					<data>
						<binding>bpm_oc_auth.actiondatex</binding>
					</data>
					<controlInfo>
						<mouseOverCursor>Window Default</mouseOverCursor>
						<type>Date/Time Control</type>
						<flags>
							<invisible>true</invisible>
							<readOnly>false</readOnly>
							<mandatory>true</mandatory>
							<mandatoryLabelBackground>false</mandatoryLabelBackground>
							<mandatoryLabelText>false</mandatoryLabelText>
							<allowNullValue>false</allowNullValue>
							<skipTabStop>false</skipTabStop>
							<disabled>false</disabled>
							<protected>false</protected>
							<noMacroExpand>false</noMacroExpand>
							<readOnlyInit>false</readOnlyInit>
							<colorDateIndicator>false</colorDateIndicator>
						</flags>
						<textLineCount>0</textLineCount>
						<textInputFormat>Text</textInputFormat>
						<properties>
							<disabledBackgroundColor>#eaeaea</disabledBackgroundColor>
							<dateFormatMode>0</dateFormatMode>
						</properties>
					</controlInfo>
				</control>
				<control>
					<general>
						<name>tb_comments</name>
						<type>Field</type>
					</general>
					<appearance>
						<index>6</index>
						<backgroundColor>#ffffff</backgroundColor>
						<foregroundColor>#000000</foregroundColor>
						<font  size="8">Arial</font>
						<borderStyle>Rectangle</borderStyle>
					</appearance>
					<objectPlacement>
						<position>
							<top>140</top>
							<left>83</left>
							<right>457</right>
							<bottom>220</bottom>
						</position>
						<scaling>
							<top>50</top>
							<left>0</left>
							<right>100</right>
							<bottom>100</bottom>
						</scaling>
					</objectPlacement>
					<data>
						<binding>bpm_oc_auth.comments</binding>
					</data>
					<controlInfo>
						<mouseOverCursor>Window Default</mouseOverCursor>
						<type>Text Edit</type>
						<flags>
							<invisible>false</invisible>
							<readOnly>false</readOnly>
							<mandatory>false</mandatory>
							<mandatoryLabelBackground>false</mandatoryLabelBackground>
							<mandatoryLabelText>false</mandatoryLabelText>
							<allowNullValue>false</allowNullValue>
							<skipTabStop>false</skipTabStop>
							<disabled>false</disabled>
							<protected>false</protected>
							<noMacroExpand>false</noMacroExpand>
							<readOnlyInit>false</readOnlyInit>
							<autoCompleteField>false</autoCompleteField>
							<editUnlimitedText>true</editUnlimitedText>
							<url>false</url>
						</flags>
						<textLineCount>2</textLineCount>
						<textInputFormat>Text</textInputFormat>
						<properties>
							<content>#eeeeee</content>
							<disabledBackgroundColor>#eeeeee</disabledBackgroundColor>
						</properties>
					</controlInfo>
				</control>
				<control>
					<general>
						<type>FieldName</type>
						<flags>
							<transparent>true</transparent>
							<xpStyle>false</xpStyle>
							<hasShadow>false</hasShadow>
							<toolbarButtonStyle>false</toolbarButtonStyle>
							<cache>false</cache>
							<hasBorder>false</hasBorder>
							<hasCheckbox>false</hasCheckbox>
						</flags>
					</general>
					<appearance>
						<index>7</index>
						<caption>Actioned On</caption>
						<backgroundColor>#ffffff</backgroundColor>
						<foregroundColor>#000000</foregroundColor>
						<font  size="8">Arial</font>
						<alignment>Right</alignment>
						<borderStyle>None</borderStyle>
						<fillStyle>Solid</fillStyle>
					</appearance>
					<objectPlacement>
						<position>
							<top>334</top>
							<left>230</left>
							<right>308</right>
							<bottom>352</bottom>
						</position>
						<scaling>
							<top>0</top>
							<left>50</left>
							<right>50</right>
							<bottom>0</bottom>
						</scaling>
					</objectPlacement>
					<data>
						<binding>bpm_oc_auth.actiondatex</binding>
					</data>
					<controlInfo>
						<mouseOverCursor>Window Default</mouseOverCursor>
						<flags>
							<invisible>true</invisible>
							<skipTabStop>false</skipTabStop>
							<disabled>false</disabled>
							<protected>false</protected>
							<noMacroExpand>false</noMacroExpand>
							<multiLine>false</multiLine>
						</flags>
						<properties>
						</properties>
					</controlInfo>
				</control>
				<control>
					<general>
						<type>FieldName</type>
						<flags>
							<transparent>true</transparent>
							<xpStyle>false</xpStyle>
							<hasShadow>false</hasShadow>
							<toolbarButtonStyle>false</toolbarButtonStyle>
							<cache>false</cache>
							<hasBorder>false</hasBorder>
							<hasCheckbox>false</hasCheckbox>
						</flags>
					</general>
					<appearance>
						<index>8</index>
						<caption>Name</caption>
						<backgroundColor>#ffffff</backgroundColor>
						<foregroundColor>#000000</foregroundColor>
						<font  size="8">Arial</font>
						<alignment>Right</alignment>
						<borderStyle>None</borderStyle>
						<fillStyle>Solid</fillStyle>
					</appearance>
					<objectPlacement>
						<position>
							<top>118</top>
							<left>1</left>
							<right>79</right>
							<bottom>136</bottom>
						</position>
						<scaling>
							<top>50</top>
							<left>0</left>
							<right>0</right>
							<bottom>50</bottom>
						</scaling>
					</objectPlacement>
					<data>
						<binding>bpm_oc_auth.authorname</binding>
					</data>
					<controlInfo>
						<mouseOverCursor>Window Default</mouseOverCursor>
						<properties>
						</properties>
					</controlInfo>
				</control>
				<control>
					<general>
						<name>Label1</name>
						<type>FieldName</type>
						<flags>
							<transparent>true</transparent>
							<xpStyle>false</xpStyle>
							<hasShadow>false</hasShadow>
							<toolbarButtonStyle>false</toolbarButtonStyle>
							<cache>false</cache>
							<hasBorder>false</hasBorder>
							<hasCheckbox>false</hasCheckbox>
						</flags>
					</general>
					<appearance>
						<index>9</index>
						<caption>Status</caption>
						<backgroundColor>#ffffff</backgroundColor>
						<foregroundColor>#000000</foregroundColor>
						<font  size="8">Arial</font>
						<alignment>Right</alignment>
						<borderStyle>None</borderStyle>
						<fillStyle>Solid</fillStyle>
					</appearance>
					<objectPlacement>
						<position>
							<top>118</top>
							<left>233</left>
							<right>311</right>
							<bottom>136</bottom>
						</position>
						<scaling>
							<top>50</top>
							<left>50</left>
							<right>50</right>
							<bottom>50</bottom>
						</scaling>
					</objectPlacement>
					<data>
						<binding>bpm_oc_auth.flg_status</binding>
					</data>
					<controlInfo>
						<mouseOverCursor>Window Default</mouseOverCursor>
						<properties>
						</properties>
					</controlInfo>
				</control>
				<control>
					<general>
						<name>Label1</name>
						<type>FieldName</type>
						<flags>
							<transparent>true</transparent>
							<xpStyle>false</xpStyle>
							<hasShadow>false</hasShadow>
							<toolbarButtonStyle>false</toolbarButtonStyle>
							<cache>false</cache>
							<hasBorder>false</hasBorder>
							<hasCheckbox>false</hasCheckbox>
						</flags>
					</general>
					<appearance>
						<index>10</index>
						<caption>Workflow ID</caption>
						<backgroundColor>#ffffff</backgroundColor>
						<foregroundColor>#000000</foregroundColor>
						<font  size="8">Arial</font>
						<alignment>Right</alignment>
						<borderStyle>None</borderStyle>
						<fillStyle>Solid</fillStyle>
					</appearance>
					<objectPlacement>
						<position>
							<top>394</top>
							<left>90</left>
							<right>168</right>
							<bottom>412</bottom>
						</position>
						<scaling>
							<top>0</top>
							<left>0</left>
							<right>0</right>
							<bottom>0</bottom>
						</scaling>
					</objectPlacement>
					<data>
						<binding>bpm_oc_auth.fk_workflow_id</binding>
					</data>
					<controlInfo>
						<mouseOverCursor>Window Default</mouseOverCursor>
						<flags>
							<invisible>true</invisible>
							<skipTabStop>false</skipTabStop>
							<disabled>false</disabled>
							<protected>false</protected>
							<noMacroExpand>false</noMacroExpand>
							<multiLine>false</multiLine>
						</flags>
						<properties>
						</properties>
					</controlInfo>
				</control>
				<control>
					<general>
						<name>Label3</name>
						<type>FieldName</type>
						<flags>
							<transparent>true</transparent>
							<xpStyle>false</xpStyle>
							<hasShadow>false</hasShadow>
							<toolbarButtonStyle>false</toolbarButtonStyle>
							<cache>false</cache>
							<hasBorder>false</hasBorder>
							<hasCheckbox>false</hasCheckbox>
						</flags>
					</general>
					<appearance>
						<index>11</index>
						<caption>Authoriser Type</caption>
						<backgroundColor>#ffffff</backgroundColor>
						<foregroundColor>#000000</foregroundColor>
						<font  size="8">Arial</font>
						<alignment>Right</alignment>
						<borderStyle>None</borderStyle>
						<fillStyle>Solid</fillStyle>
					</appearance>
					<objectPlacement>
						<position>
							<top>314</top>
							<left>230</left>
							<right>311</right>
							<bottom>332</bottom>
						</position>
						<scaling>
							<top>0</top>
							<left>50</left>
							<right>50</right>
							<bottom>0</bottom>
						</scaling>
					</objectPlacement>
					<data>
						<binding>bpm_oc_auth.authortype</binding>
					</data>
					<controlInfo>
						<mouseOverCursor>Window Default</mouseOverCursor>
						<flags>
							<invisible>true</invisible>
							<skipTabStop>false</skipTabStop>
							<disabled>false</disabled>
							<protected>false</protected>
							<noMacroExpand>false</noMacroExpand>
							<multiLine>false</multiLine>
						</flags>
						<properties>
						</properties>
					</controlInfo>
				</control>
				<control>
					<general>
						<name>Label1</name>
						<type>FieldName</type>
						<flags>
							<transparent>true</transparent>
							<xpStyle>false</xpStyle>
							<hasShadow>false</hasShadow>
							<toolbarButtonStyle>false</toolbarButtonStyle>
							<cache>false</cache>
							<hasBorder>false</hasBorder>
							<hasCheckbox>false</hasCheckbox>
						</flags>
					</general>
					<appearance>
						<index>12</index>
						<caption>Comments</caption>
						<backgroundColor>#ffffff</backgroundColor>
						<foregroundColor>#000000</foregroundColor>
						<font  size="8">Arial</font>
						<alignment>Right</alignment>
						<borderStyle>None</borderStyle>
						<fillStyle>Solid</fillStyle>
					</appearance>
					<objectPlacement>
						<position>
							<top>142</top>
							<left>1</left>
							<right>79</right>
							<bottom>160</bottom>
						</position>
						<scaling>
							<top>50</top>
							<left>0</left>
							<right>0</right>
							<bottom>50</bottom>
						</scaling>
					</objectPlacement>
					<data>
						<binding>bpm_oc_auth.comments</binding>
					</data>
					<controlInfo>
						<mouseOverCursor>Window Default</mouseOverCursor>
						<properties>
						</properties>
					</controlInfo>
				</control>
				<control>
					<general>
						<name>lbl_auth</name>
						<type>Text</type>
						<flags>
							<transparent>true</transparent>
							<xpStyle>false</xpStyle>
							<hasShadow>false</hasShadow>
							<toolbarButtonStyle>false</toolbarButtonStyle>
							<cache>false</cache>
							<hasBorder>false</hasBorder>
							<hasCheckbox>false</hasCheckbox>
						</flags>
					</general>
					<appearance>
						<index>13</index>
						<caption>You do not have permission to modify the authorisation state of this stage</caption>
						<backgroundColor>#ffffff</backgroundColor>
						<foregroundColor>#000000</foregroundColor>
						<font  size="8" bold="1">Arial</font>
						<alignment>Center</alignment>
						<borderStyle>None</borderStyle>
						<fillStyle>Solid</fillStyle>
					</appearance>
					<objectPlacement>
						<position>
							<top>260</top>
							<left>50</left>
							<right>496</right>
							<bottom>281</bottom>
						</position>
						<scaling>
							<top>0</top>
							<left>0</left>
							<right>100</right>
							<bottom>0</bottom>
						</scaling>
					</objectPlacement>
					<data>
					</data>
					<controlInfo>
						<mouseOverCursor>Window Default</mouseOverCursor>
						<flags>
							<invisible>true</invisible>
							<skipTabStop>false</skipTabStop>
							<disabled>false</disabled>
							<protected>false</protected>
							<noMacroExpand>false</noMacroExpand>
							<multiLine>false</multiLine>
						</flags>
						<properties>
						</properties>
					</controlInfo>
				</control>
				<control>
					<general>
						<name>Text1</name>
						<type>Text</type>
						<flags>
							<transparent>true</transparent>
							<xpStyle>false</xpStyle>
							<hasShadow>false</hasShadow>
							<toolbarButtonStyle>false</toolbarButtonStyle>
							<cache>false</cache>
							<hasBorder>false</hasBorder>
							<hasCheckbox>false</hasCheckbox>
						</flags>
					</general>
					<appearance>
						<index>14</index>
						<caption>Title</caption>
						<backgroundColor>#ffffff</backgroundColor>
						<foregroundColor>#000000</foregroundColor>
						<font  size="8">Arial</font>
						<alignment>Right</alignment>
						<borderStyle>None</borderStyle>
						<fillStyle>Solid</fillStyle>
					</appearance>
					<objectPlacement>
						<position>
							<top>12</top>
							<left>1</left>
							<right>79</right>
							<bottom>30</bottom>
						</position>
						<scaling>
							<top>0</top>
							<left>0</left>
							<right>0</right>
							<bottom>0</bottom>
						</scaling>
					</objectPlacement>
					<data>
					</data>
					<controlInfo>
						<mouseOverCursor>Window Default</mouseOverCursor>
						<properties>
						</properties>
					</controlInfo>
				</control>
				<control>
					<general>
						<name>Text2</name>
						<type>Text</type>
						<flags>
							<transparent>true</transparent>
							<xpStyle>false</xpStyle>
							<hasShadow>false</hasShadow>
							<toolbarButtonStyle>false</toolbarButtonStyle>
							<cache>false</cache>
							<hasBorder>false</hasBorder>
							<hasCheckbox>false</hasCheckbox>
						</flags>
					</general>
					<appearance>
						<index>15</index>
						<caption>Description</caption>
						<backgroundColor>#ffffff</backgroundColor>
						<foregroundColor>#000000</foregroundColor>
						<font  size="8">Arial</font>
						<alignment>Right</alignment>
						<borderStyle>None</borderStyle>
						<fillStyle>Solid</fillStyle>
					</appearance>
					<objectPlacement>
						<position>
							<top>34</top>
							<left>1</left>
							<right>79</right>
							<bottom>52</bottom>
						</position>
						<scaling>
							<top>0</top>
							<left>0</left>
							<right>0</right>
							<bottom>0</bottom>
						</scaling>
					</objectPlacement>
					<data>
					</data>
					<controlInfo>
						<mouseOverCursor>Window Default</mouseOverCursor>
						<properties>
						</properties>
					</controlInfo>
				</control>
				<control>
					<general>
						<name>tb_desc</name>
						<type>Field</type>
					</general>
					<appearance>
						<index>16</index>
						<backgroundColor>#ffffff</backgroundColor>
						<foregroundColor>#000000</foregroundColor>
						<font  size="8">Arial</font>
						<borderStyle>Rectangle</borderStyle>
					</appearance>
					<objectPlacement>
						<position>
							<top>34</top>
							<left>83</left>
							<right>457</right>
							<bottom>114</bottom>
						</position>
						<scaling>
							<top>0</top>
							<left>0</left>
							<right>100</right>
							<bottom>50</bottom>
						</scaling>
					</objectPlacement>
					<data>
						<binding>bpm_stage.description</binding>
					</data>
					<controlInfo>
						<mouseOverCursor>Window Default</mouseOverCursor>
						<type>Text Edit</type>
						<flags>
							<invisible>false</invisible>
							<readOnly>false</readOnly>
							<mandatory>false</mandatory>
							<mandatoryLabelBackground>false</mandatoryLabelBackground>
							<mandatoryLabelText>false</mandatoryLabelText>
							<allowNullValue>false</allowNullValue>
							<skipTabStop>false</skipTabStop>
							<disabled>true</disabled>
							<protected>false</protected>
							<noMacroExpand>false</noMacroExpand>
							<readOnlyInit>false</readOnlyInit>
							<autoCompleteField>false</autoCompleteField>
							<editUnlimitedText>true</editUnlimitedText>
							<url>false</url>
						</flags>
						<textLineCount>2</textLineCount>
						<textInputFormat>Text</textInputFormat>
						<properties>
							<content>#eeeeee</content>
							<disabledBackgroundColor>#eeeeee</disabledBackgroundColor>
						</properties>
					</controlInfo>
				</control>
				<control>
					<general>
						<name>Label2</name>
						<type>FieldName</type>
						<flags>
							<transparent>true</transparent>
							<xpStyle>false</xpStyle>
							<hasShadow>false</hasShadow>
							<toolbarButtonStyle>false</toolbarButtonStyle>
							<cache>false</cache>
							<hasBorder>false</hasBorder>
							<hasCheckbox>false</hasCheckbox>
						</flags>
					</general>
					<appearance>
						<index>17</index>
						<caption>Actioned By</caption>
						<backgroundColor>#ffffff</backgroundColor>
						<foregroundColor>#000000</foregroundColor>
						<font  size="8">Arial</font>
						<alignment>Right</alignment>
						<borderStyle>None</borderStyle>
						<fillStyle>Solid</fillStyle>
					</appearance>
					<objectPlacement>
						<position>
							<top>225</top>
							<left>2</left>
							<right>79</right>
							<bottom>243</bottom>
						</position>
						<scaling>
							<top>100</top>
							<left>0</left>
							<right>0</right>
							<bottom>100</bottom>
						</scaling>
					</objectPlacement>
					<data>
						<binding>bpm_oc_auth.actionbyname</binding>
					</data>
					<controlInfo>
						<mouseOverCursor>Window Default</mouseOverCursor>
						<properties>
						</properties>
					</controlInfo>
				</control>
				<control>
					<general>
						<name>Field1</name>
						<type>Field</type>
					</general>
					<appearance>
						<index>18</index>
						<backgroundColor>#ffffff</backgroundColor>
						<foregroundColor>#000000</foregroundColor>
						<font  size="8">Arial</font>
						<borderStyle>Rectangle</borderStyle>
					</appearance>
					<objectPlacement>
						<position>
							<top>225</top>
							<left>83</left>
							<right>226</right>
							<bottom>243</bottom>
						</position>
						<scaling>
							<top>100</top>
							<left>0</left>
							<right>50</right>
							<bottom>100</bottom>
						</scaling>
					</objectPlacement>
					<data>
						<binding>bpm_oc_auth.actionbyname</binding>
					</data>
					<controlInfo>
						<mouseOverCursor>Window Default</mouseOverCursor>
						<type>Text Edit</type>
						<flags>
							<invisible>false</invisible>
							<readOnly>false</readOnly>
							<mandatory>false</mandatory>
							<mandatoryLabelBackground>false</mandatoryLabelBackground>
							<mandatoryLabelText>false</mandatoryLabelText>
							<allowNullValue>false</allowNullValue>
							<skipTabStop>false</skipTabStop>
							<disabled>true</disabled>
							<protected>false</protected>
							<noMacroExpand>false</noMacroExpand>
							<readOnlyInit>false</readOnlyInit>
							<autoCompleteField>false</autoCompleteField>
							<editUnlimitedText>false</editUnlimitedText>
							<url>false</url>
						</flags>
						<textLineCount>0</textLineCount>
						<textInputFormat>Text</textInputFormat>
						<properties>
							<image>#eeeeee</image>
							<disabledBackgroundColor>#eeeeee</disabledBackgroundColor>
						</properties>
					</controlInfo>
				</control>
				<control>
					<general>
						<name>Label4</name>
						<type>FieldName</type>
						<flags>
							<transparent>true</transparent>
							<xpStyle>false</xpStyle>
							<hasShadow>false</hasShadow>
							<toolbarButtonStyle>false</toolbarButtonStyle>
							<cache>false</cache>
							<hasBorder>false</hasBorder>
							<hasCheckbox>false</hasCheckbox>
						</flags>
					</general>
					<appearance>
						<index>19</index>
						<caption>Actioned On</caption>
						<backgroundColor>#ffffff</backgroundColor>
						<foregroundColor>#000000</foregroundColor>
						<font  size="8">Arial</font>
						<alignment>Right</alignment>
						<borderStyle>None</borderStyle>
						<fillStyle>Solid</fillStyle>
					</appearance>
					<objectPlacement>
						<position>
							<top>227</top>
							<left>243</left>
							<right>311</right>
							<bottom>245</bottom>
						</position>
						<scaling>
							<top>100</top>
							<left>50</left>
							<right>50</right>
							<bottom>100</bottom>
						</scaling>
					</objectPlacement>
					<data>
						<binding>bpm_oc_auth.actiondatex</binding>
					</data>
					<controlInfo>
						<mouseOverCursor>Window Default</mouseOverCursor>
						<properties>
						</properties>
					</controlInfo>
				</control>
				<control>
					<general>
						<name>Field2</name>
						<type>Field</type>
					</general>
					<appearance>
						<index>20</index>
						<backgroundColor>#ffffff</backgroundColor>
						<foregroundColor>#000000</foregroundColor>
						<font  size="8">Arial</font>
						<borderStyle>Rectangle</borderStyle>
					</appearance>
					<objectPlacement>
						<position>
							<top>227</top>
							<left>314</left>
							<right>457</right>
							<bottom>245</bottom>
						</position>
						<scaling>
							<top>100</top>
							<left>50</left>
							<right>100</right>
							<bottom>100</bottom>
						</scaling>
					</objectPlacement>
					<data>
						<binding>bpm_oc_auth.actiondatex</binding>
					</data>
					<controlInfo>
						<mouseOverCursor>Window Default</mouseOverCursor>
						<type>Date/Time Control</type>
						<flags>
							<invisible>false</invisible>
							<readOnly>false</readOnly>
							<mandatory>false</mandatory>
							<mandatoryLabelBackground>false</mandatoryLabelBackground>
							<mandatoryLabelText>false</mandatoryLabelText>
							<allowNullValue>false</allowNullValue>
							<skipTabStop>false</skipTabStop>
							<disabled>true</disabled>
							<protected>false</protected>
							<noMacroExpand>false</noMacroExpand>
							<readOnlyInit>false</readOnlyInit>
							<colorDateIndicator>false</colorDateIndicator>
						</flags>
						<textLineCount>0</textLineCount>
						<textInputFormat>Text</textInputFormat>
						<properties>
							<dateFormatMode>0</dateFormatMode>
							<image>#eeeeee</image>
							<disabledBackgroundColor>#eeeeee</disabledBackgroundColor>
						</properties>
					</controlInfo>
				</control>
			</controls>
			<formActions>
			</formActions>
			<javascript>
				<methods>
					<method>
						<name>OnFormLoaded</name>
						<code>
							<![CDATA[OnFormLoaded()
{
	//-- set auth permissions
	var boolCanAnalystAuth = (app.session.HaveAppRight(PG_BPM, BPM_ANALYSTAUTH));
	var boolCanCustomerAuth = (app.session.HaveAppRight(PG_BPM, BPM_CUSTAUTH));	
		
	var strPermText= "As the required authoriser you can make an authorisation decision for this stage";
	var boolAuthoriser=(_swdoc.oAuth().fk_auth_id == app.session.AnalystId);
	
	if(!boolAuthoriser)
	{
		//-- not the authoriser - but check if can auth on behalf of
		if(bpm_oc_auth.authortype=="Analyst")
		{
			strPermText= "As an overiding analyst authoriser you can make an authorisation decision";		
			boolAuthoriser = boolCanAnalystAuth;
		}
		else
		{
			strPermText= "As an overiding customer authoriser you can make an authorisation decision";		
			boolAuthoriser = boolCanCustomerAuth;
		}
	}

	_ete(lbl_auth, (boolAuthoriser)?strPermText:"You do not have permission to modify the authorisation state of this stage");

	//-- nwj - 06.06.2008 - if in history mode then do not allow edit
	if(_swdoc.GetArg("history")=="1") 
	{
		_ete(lbl_auth, "Historical view. No changes can be made.");			
		boolAuthoriser = false;
	}
	
	var boolActioned = bpm_oc_auth.flg_status>0;
	
	_ero(tb_comments, (!boolAuthoriser) || boolActioned);
	_een(lb_status, boolAuthoriser && !boolActioned);
	_een(tb_actdate, boolAuthoriser);
		
			
	
}]]>
						</code>
					</method>
					<method>
						<name>lb_status_OnValueChanged</name>
						<code>
							<![CDATA[lb_status_OnValueChanged(strValue)
{
	// TODO: Add your event handler code here
	switch(strValue)
	{
		case "1":
			bpm_oc_auth.status="Authorised";
			break;
		case "2":
			bpm_oc_auth.status="Rejected";		
			break;	
		default:
			bpm_oc_auth.status="Pending Authorisation";
			break;
	}
	
}]]>
						</code>
					</method>
				</methods>
			</javascript>
		</layout>
		<layout>
			<appearance>
				<width>360</width>
				<height>220</height>
				<backgroundColor>#ffffff</backgroundColor>
				<fillColour>#ffffff</fillColour>
				<textColour >#000000</textColour >
				<font  size="8">Arial</font>
			</appearance>
			<controls>
			</controls>
			<formActions>
			</formActions>
			<javascript>
				<methods>
				</methods>
			</javascript>
		</layout>
	</layouts>
</espForm>
