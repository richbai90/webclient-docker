{"espForm":{"configuration":{"settings":{"name":"TbLicensedApprover","title":"Licensed Approvers","options":{"allowResize":"true","showMenubar":"false","showToolbar":"false","showStatusBar":"false"}},"javascript":{"methods":{"method":[{"name":"OnFormLoading","code":"OnFormLoading(strFormName, strClass)\n{\n\n\tvar select_mode = _swdoc.GetArg(\"s\");\n\tselect_mode = (1 == select_mode);\n\t\n\tif(!(select_mode || app.session.isAdmin)) \n\t{\n\t\tMessageBox(\"You do not have permission to manage licensed approvers (System Administrator Required).\");\n\t\treturn false;\n\t}\n\n\treturn true;\n}"},{"name":"(Globals)","code":"var selectedkey = \"\";\nvar selectedfirstname = \"\";\nvar selectedsurname = \"\";\n"}]}}},"layouts":{"layout":[{"appearance":{"width":"467","height":"138","backgroundColor":"#ffffff","fillColour":"#ffffff","textColour":"#000000","font":{"@size":"8","#text":"Arial"}},"controls":{"control":[{"general":{"name":"SqlList1","type":"SqlTable","flags":{"transparent":"false","xpStyle":"false","hasShadow":"false","toolbarButtonStyle":"false","cache":"false","hasBorder":"false","hasCheckbox":"false","showHeader":"true","verticalGridLines":"true","horizontalGridLines":"true","autoLoad":"true","allowMultiSelect":"false"}},"appearance":{"index":"0","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Arial"},"borderStyle":"3-D Sunken"},"objectPlacement":{"position":{"top":"5","left":"5","right":"352","bottom":"133"},"scaling":{"top":"0","left":"0","right":"100","bottom":"100"}},"columns":{"controlInfo":[{"mouseOverCursor":"Window Default","type":"Text Edit","flags":{"invisible":"false","readOnly":"false","mandatory":"false","mandatoryLabelBackground":"false","mandatoryLabelText":"false","allowNullValue":"false","skipTabStop":"false","disabled":"false","protected":"false","noMacroExpand":"false","readOnlyInit":"false","autoCompleteField":"false","editUnlimitedText":"false","url":"false","hidden":"true","allowResize":"true","allowSort":"true"},"textLineCount":"0","textInputFormat":"Text","properties":{"column":"id"},"name":"Approver","width":"91","image":"-1","dataColumn":"0"},{"mouseOverCursor":"Window Default","type":"Text Edit","flags":{"invisible":"false","readOnly":"false","mandatory":"false","mandatoryLabelBackground":"false","mandatoryLabelText":"false","allowNullValue":"false","skipTabStop":"false","disabled":"false","protected":"false","noMacroExpand":"false","readOnlyInit":"false","autoCompleteField":"false","editUnlimitedText":"false","url":"false","hidden":"false","allowResize":"true","allowSort":"true"},"textLineCount":"0","textInputFormat":"Text","properties":{"column":"firstname"},"name":"First name","width":"120","image":"-1","dataColumn":"1"},{"mouseOverCursor":"Window Default","type":"Text Edit","flags":{"invisible":"false","readOnly":"false","mandatory":"false","mandatoryLabelBackground":"false","mandatoryLabelText":"false","allowNullValue":"false","skipTabStop":"false","disabled":"false","protected":"false","noMacroExpand":"false","readOnlyInit":"false","autoCompleteField":"false","editUnlimitedText":"false","url":"false","hidden":"false","allowResize":"true","allowSort":"true"},"textLineCount":"0","textInputFormat":"Text","properties":{"column":"surname"},"name":"Surname","width":"120","image":"-1","dataColumn":"2"}]},"sortColumn":"-1","sortDescending":"false","headerHeight":"18","rowHeight":"16","selectedColor":"#00008b","selectedTextColor":"#ffffff","controlInfo":{"mouseOverCursor":"Window Default","properties":{"sqlSource":"syscache","table":"licensed_approvers","newRecordForm":"Form.TfCustomer","editRecordForm":"Form.TfCustomer","storedQuery":"me.browse.table"}}},{"general":{"name":"btnProperties","type":"EventButton"},"appearance":{"index":"1","caption":"Properties","backgroundColor":"#000000","foregroundColor":"#000000","font":{"@size":"8","#text":"Arial"}},"objectPlacement":{"position":{"top":"5","left":"372","right":"452","bottom":"29"},"scaling":{"top":"0","left":"100","right":"100","bottom":"0"}},"controlInfo":{"mouseOverCursor":"Window Default"}},{"general":{"name":"btnNew","type":"EventButton"},"appearance":{"index":"2","caption":"Search","backgroundColor":"#000000","foregroundColor":"#000000","font":{"@size":"8","#text":"Arial"}},"objectPlacement":{"position":{"top":"32","left":"372","right":"452","bottom":"56"},"scaling":{"top":"0","left":"100","right":"100","bottom":"0"}},"controlInfo":{"mouseOverCursor":"Window Default"}},{"general":{"name":"btnDelete","type":"EventButton"},"appearance":{"index":"3","caption":"Delete","backgroundColor":"#000000","foregroundColor":"#000000","font":{"@size":"8","#text":"Arial"}},"objectPlacement":{"position":{"top":"59","left":"372","right":"452","bottom":"83"},"scaling":{"top":"0","left":"100","right":"100","bottom":"0"}},"controlInfo":{"mouseOverCursor":"Window Default"}},{"general":{"name":"btnClose","type":"EventButton"},"appearance":{"index":"4","caption":"Close","backgroundColor":"#000000","foregroundColor":"#000000","font":{"@size":"8","#text":"Arial"}},"objectPlacement":{"position":{"top":"109","left":"372","right":"452","bottom":"133"},"scaling":{"top":"100","left":"100","right":"100","bottom":"100"}},"controlInfo":{"mouseOverCursor":"Window Default"}},{"general":{"name":"btnSelect","type":"EventButton"},"appearance":{"index":"5","caption":"Select","backgroundColor":"#000000","foregroundColor":"#000000","font":{"@size":"8","#text":"Arial"}},"objectPlacement":{"position":{"top":"85","left":"372","right":"452","bottom":"109"},"scaling":{"top":"100","left":"100","right":"100","bottom":"100"}},"controlInfo":{"mouseOverCursor":"Window Default"}}]},"javascript":{"methods":{"method":[{"name":"btnProperties_OnPressed","code":"btnProperties_OnPressed()\n{\n\/\/    SqlList1.EditRecord(SqlList1.curSel);\n\/\/\tapp.OpenFormForEdit(\"TfCustomer\", SqlList1.GetItemTextRaw(SqlList1.curSel, 0), \"\", true);\n\n\tapp.OpenFormForEdit(\"tfCustomer\", SqlList1.GetItemTextRaw(SqlList1.curSel, 0), \"\", true, function(){\n   \t\t\treturn true;\n \t});\n\n}"},{"name":"btnNew_OnPressed","code":"btnNew_OnPressed()\n{\n\nvar strURL = \"searchtype=1&canreset=1\";\n\napp.g.search_for(\"customers\",false,strURL,function(sResults){\n\t    \tif(sResults.selectedkeys==\"\")\n\t    \t{\n\t    \t\t\/\/Nothing selected\n\t    \t\treturn ;\n\t    \t}\n\t    \telse\n\t    \t{\n    \t\t\tvar arrKey = sResults.selectedkeys.split(\",\");\n    \t\t\tvar c = arrKey.length;\n    \t\t\tvar bSkip = false;\n    \t\t\tvar oCust = null;\n    \n    \n    \t\t\tfor (i = 0; i < c; i++) {\n    \t\t\t\t\n    \t\t\t\tif (!bSkip){\n    \t\t\t\t\tvar customerToAdd = arrKey[i];\n    \t\t\t\t\tif (\"\" != customerToAdd){\n    \t\t\t\t\t\tvar h = app.g.submit_php(\"php\/itsm\/license_check.php\", false);\n\t\t\t\t\t\t\tvar t = h.indexOf(\"licenses_in_use\");\n\t\t\t\t\t\t\tvar licensed_for = h.substring(0,t);\n\t\t\t\t\t\t\tvar licenses_in_use = h.substring(t);\n\t\t\t\t\t\t\tvar lf = parseInt(licensed_for.replace(\/\\D\/g,\"\"));\n\t\t\t\t\t\t\tvar lu = parseInt(licenses_in_use.replace(\/\\D\/g,\"\"));\n\t\t\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tif (lu + 1 <= lf){\n    \t\t\t\t\t\t\tvar p = {};\n\t\t\t\t\t\t\t\tp.kv = customerToAdd;\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\toCust = app.g.get_record(\"userdb\", customerToAdd);\n\t\t\t\t\t\t\t\tp.firstname=oCust.firstname;\n\t\t\t\t\t\t\t\tp.surname=oCust.surname;\n\t\t\t\t\t\t\t\tif (app.g.submitsqs(\"general\/add_bpm_c_approver\", p)) {\n\t\t\t\t\t\t\t\t} \n\t\t\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t\t\t \/\/MessageBox(\"XMLMC Execute Insert failed. Please contact your Supportworks Administrator.\");\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\/\/check_bpm_c_approver\n\t\t\t\t\t\t\t\t\/*if (app.g.submitsqs(\"general\/check_bpm_c_approver\", p)) {\n\t\t\t\t\t\t\t\t\t\/\/MessageBox(\"This customer has been already approved.\");\n\t\t\t\t\t\t\t\t\tMessageBox(p.firstname+ \" \" + p.surname + \"(\"+p.kv+\") is already a Licensed Approver\");\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t\t\t  if (app.g.submitsqs(\"general\/add_bpm_c_approver\", p)) {\n\t\t\t\t\t\t\t\t\t  } \n\t\t\t\t\t\t\t\t      else {\n\t\t\t\t\t\t\t\t\t \t\t\t\/\/MessageBox(\"XMLMC Execute Insert failed. Please contact your Supportworks Administrator.\");\n\t\t\t\t\t\t\t\t\t\t   }\n\t\t\t\t\t\t\t\t}*\/\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse{\n\t\t\t\t\t\t\t\tMessageBox(\"You have reached the maximum of licenses you are allocated. Please contact your Supportworks Administrator.\");\n\t\t\t\t\t\t\t\tbSkip = true;\n\t\t\t\t\t\t\t}\n    \t\t\t\t\t\/\/End third if\n    \t\t\t\t\t}\n    \t\t\t\t\/\/End second if\n    \t\t\t\t}\n    \t\t\t\t\n    \t\t\t\t\n    \t\t\t\n    \t\t\t\/\/End for\n    \t\t\t}\n    \t\t\/\/End first else\n    \t\t\n\t\t\tSqlList1.Refresh();\n    \t\t}\n\/\/End search for\n});\n}"},{"name":"btnDelete_OnPressed","code":"btnDelete_OnPressed()\n{\n\n\n    \/\/-- nwj :- use key col name instead of numbering\n    var strKeyValue = SqlList1.GetItemTextRaw(SqlList1.curSel, 0);\n    if(strKeyValue != \"\")\n    {\n    \tvar p = {};\n\t\tp.kv = strKeyValue;\n\t\tif (app.g.submitsqs(\"general\/delete_bpm_c_approver\", p)) {\n    \t\tSqlList1.RemoveRow(SqlList1.curSel);\n    \t\tSqlList1.Refresh();\n\t\t} else {\n\t\t\tMessageBox(\"XMLMC Execute Delete failed. Please contact your Supportworks Administrator.\");\n\t\t}\n\t}\n}"},{"name":"btnClose_OnPressed","code":"btnClose_OnPressed()\r\n{\r\n    _swdoc.CloseForm();\r\n}\r\n"},{"name":"SqlList1_OnItemDoubleClicked","code":"SqlList1_OnItemDoubleClicked(nRow, nCol)\n{\n\n\tapp.OpenFormForEdit(\"TfCustomer\", SqlList1.GetItemTextRaw(SqlList1.curSel, 0), \"\", true);\n\n}"},{"name":"OnFormLoaded","code":"OnFormLoaded(bDataReloaded)\n{\n\n\t_evi(btnNew , app.session.isAdmin);\n\t_evi(btnDelete , app.session.isAdmin);\n\t\n\tvar select_mode = _swdoc.GetArg(\"s\");\n\tselect_mode = (1 == select_mode);\n\t_evi(btnSelect , select_mode);\n\t\n\t_ete(btnClose , (select_mode)?\"Cancel\":\"Close\");\n\n}"},{"name":"btnSelect_OnPressed","code":"btnSelect_OnPressed()\n{\n\n\t_swdoc.selectedkey = SqlList1.GetItemTextRaw(SqlList1.curSel, 0);\n\t_swdoc.selectedfirstname = SqlList1.GetItemTextRaw(SqlList1.curSel, 1);\n\t_swdoc.selectedsurname = SqlList1.GetItemTextRaw(SqlList1.curSel, 2);\n    _swdoc.CloseForm();\n\n}"}]}}},{"appearance":{"width":"360","height":"220","backgroundColor":"#ffffff","fillColour":"#ffffff","textColour":"#000000","font":{"@size":"8","#text":"Arial"}},"javascript":{}}]}}}