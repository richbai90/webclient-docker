{"espForm":{"configuration":{"settings":{"name":"UnlockTickets","title":"Managed Locked Calls","description":"allows analyst to manage their locked calls","options":{"allowResize":"true","showMenubar":"false","showToolbar":"false","showStatusBar":"false"}},"javascript":{}},"layouts":{"layout":[{"appearance":{"width":"422","height":"178","backgroundColor":"#eaeaea","fillColour":"#ffffff","textColour":"#000000","font":{"@size":"8","#text":"Arial"}},"controls":{"control":[{"general":{"name":"sl_locks","type":"SqlTable","flags":{"transparent":"false","xpStyle":"true","hasShadow":"false","toolbarButtonStyle":"false","cache":"false","hasBorder":"false","hasCheckbox":"false","showHeader":"true","verticalGridLines":"true","horizontalGridLines":"true","autoLoad":"true","allowMultiSelect":"false"}},"appearance":{"index":"0","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Arial"},"borderStyle":"Rectangle"},"objectPlacement":{"position":{"top":"10","left":"8","right":"340","bottom":"171"},"scaling":{"top":"0","left":"0","right":"100","bottom":"100"}},"columns":{"controlInfo":[{"mouseOverCursor":"Window Default","type":"Text Edit","flags":{"invisible":"false","readOnly":"false","mandatory":"false","mandatoryLabelBackground":"false","mandatoryLabelText":"false","allowNullValue":"false","skipTabStop":"false","disabled":"false","protected":"false","noMacroExpand":"false","readOnlyInit":"false","autoCompleteField":"false","editUnlimitedText":"false","url":"false","hidden":"false","allowResize":"true","allowSort":"true"},"textLineCount":"0","textInputFormat":"Text","properties":{"column":"CallRef"},"name":"Reference","width":"123","image":"-1","dataColumn":"0"},{"mouseOverCursor":"Window Default","type":"Text Edit","flags":{"invisible":"false","readOnly":"false","mandatory":"false","mandatoryLabelBackground":"false","mandatoryLabelText":"false","allowNullValue":"false","skipTabStop":"false","disabled":"false","protected":"false","noMacroExpand":"false","readOnlyInit":"false","autoCompleteField":"false","editUnlimitedText":"false","url":"false","hidden":"false","allowResize":"true","allowSort":"true"},"textLineCount":"0","textInputFormat":"Text","properties":{"column":"LockReason"},"name":"Reason","width":"198","image":"-1","dataColumn":"1"}]},"sortColumn":"-1","sortDescending":"false","headerHeight":"18","rowHeight":"16","selectedColor":"#cae1ee","selectedTextColor":"#ffffff","controlInfo":{"mouseOverCursor":"Window Default","properties":{"highlightStyle":"0","borderColor":"#d3c9b6","sqlSource":"syscache","table":"opencall_locks","selectionMode":"1"}}},{"general":{"name":"btn_unlock","type":"EventButton"},"appearance":{"index":"1","caption":"Unlock","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Arial"}},"objectPlacement":{"position":{"top":"9","left":"351","right":"416","bottom":"34"},"scaling":{"top":"0","left":"100","right":"100","bottom":"0"}},"controlInfo":{"mouseOverCursor":"Window Default","flags":{"invisible":"true","skipTabStop":"false","disabled":"true","protected":"false","noMacroExpand":"false","multiLine":"false"},"properties":{"backgroundColor":"#ff9900"}}},{"general":{"name":"btn_close","type":"EventButton"},"appearance":{"index":"2","caption":"Close","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Arial"}},"objectPlacement":{"position":{"top":"37","left":"351","right":"416","bottom":"62"},"scaling":{"top":"0","left":"100","right":"100","bottom":"0"}},"controlInfo":{"mouseOverCursor":"Window Default","properties":{"backgroundColor":"#ff9900"}}}]},"javascript":{"methods":{"method":[{"name":"btn_unlock_OnPressed","code":"btn_unlock_OnPressed()\n{\n\tfor ( var x = 0; x < sl_locks.rowCount(); x++ ) {   \n        if (sl_locks.IsRowSelected(x)) {   \n            \/\/ we found a winner – get the callref id;   \n            var strCallRef = sl_locks.GetItemTextRaw(x, 0);    \n            \/\/ disable the unlock button during processing;   \n            app._een(btn_unlock , false);   \n            \/\/ trigger the Unlock calls function;   \n            var rs = new SqlQuery();  \n            rs.Query(\"delete from opencall_locks where callref = \" + strCallRef,\"syscache\");  \n            \/\/ app.global.UnlockCalls(strCallRef);   \n        }   \n    }   \n    \/\/ refresh the form grid view;   \n    sl_locks.Refresh();\n\n}"},{"name":"sl_locks_OnItemSelected","code":"sl_locks_OnItemSelected(nRow)\n{\n\tapp._een(btn_unlock , (nRow>-1)?true:false);\n}"},{"name":"btn_close_OnPressed","code":"btn_close_OnPressed()\n{\n\t_swdoc.CloseForm();\n\n\n}"},{"name":"OnFormLoaded","code":"OnFormLoaded(bDataReloaded)\n{\n\t\/\/ TODO: Add your event handler code here\n\t\/\/ validate the logged-in user's rights to unlock tickets;    \n    var analystId = app.session.analystid;    \n    var isAdmin = 0;       \n    var rs = new SqlQuery();    \n    var qryResult = rs.Query(\"SELECT COUNT(*) FROM UnlockTicketAdmins WHERE AnalystID = '\" + analystId + \"'\", \"syscache\");   \n     \n    while(rs.Fetch()) { \n        \/\/ MessageBox(\"IsAdmin: \" + rs.GetValueAsNumber(0)); \n        isAdmin = rs.GetValueAsNumber(0); \n    } \n      \n    if (isAdmin === 1) {   \n        app._evi(btn_unlock , true);   \n    }\n}"}]}}},{"appearance":{"width":"360","height":"220","backgroundColor":"#ffffff","fillColour":"#ffffff","textColour":"#000000","font":{"@size":"8","#text":"Arial"}},"javascript":{}}]}}}