<?xml version="1.0" encoding="utf-8" ?>
<espForm>
	<configuration>
		<settings>
			<name>UnlockTickets</name>
			<title>Managed Locked Calls</title>
			<description>allows analyst to manage their locked calls</description>
			<printTemplates>
			</printTemplates>
			<options>
				<allowResize>true</allowResize>
				<showMenubar>false</showMenubar>
				<showToolbar>false</showToolbar>
				<showStatusBar>false</showStatusBar>
			</options>
		</settings>
		<tables>
		</tables>
		<showMeItems>
		</showMeItems>
		<javascript>
			<methods>
			</methods>
		</javascript>
	</configuration>
	<layouts>
		<layout>
			<appearance>
				<width>422</width>
				<height>178</height>
				<backgroundColor>#eaeaea</backgroundColor>
				<fillColour>#ffffff</fillColour>
				<textColour >#000000</textColour >
				<font  size="8">Arial</font>
			</appearance>
			<controls>
				<control>
					<general>
						<name>sl_locks</name>
						<type>SqlTable</type>
						<flags>
							<transparent>false</transparent>
							<xpStyle>true</xpStyle>
							<hasShadow>false</hasShadow>
							<toolbarButtonStyle>false</toolbarButtonStyle>
							<cache>false</cache>
							<hasBorder>false</hasBorder>
							<hasCheckbox>false</hasCheckbox>
							<showHeader>true</showHeader>
							<verticalGridLines>true</verticalGridLines>
							<horizontalGridLines>true</horizontalGridLines>
							<autoLoad>true</autoLoad>
							<allowMultiSelect>false</allowMultiSelect>
						</flags>
					</general>
					<appearance>
						<index>0</index>
						<backgroundColor>#ffffff</backgroundColor>
						<foregroundColor>#000000</foregroundColor>
						<font  size="8">Arial</font>
						<borderStyle>Rectangle</borderStyle>
					</appearance>
					<objectPlacement>
						<position>
							<top>10</top>
							<left>8</left>
							<right>340</right>
							<bottom>171</bottom>
						</position>
						<scaling>
							<top>0</top>
							<left>0</left>
							<right>100</right>
							<bottom>100</bottom>
						</scaling>
					</objectPlacement>
					<data>
					</data>
					<columns>
						<controlInfo>
							<mouseOverCursor>Window Default</mouseOverCursor>
							<type>Text Edit</type>
							<flags>
								<invisible>false</invisible>
								<readOnly>false</readOnly>
								<mandatory>false</mandatory>
								<mandatoryLabelBackground>false</mandatoryLabelBackground>
								<mandatoryLabelText>false</mandatoryLabelText>
								<allowNullValue>false</allowNullValue>
								<skipTabStop>false</skipTabStop>
								<disabled>false</disabled>
								<protected>false</protected>
								<noMacroExpand>false</noMacroExpand>
								<readOnlyInit>false</readOnlyInit>
								<autoCompleteField>false</autoCompleteField>
								<editUnlimitedText>false</editUnlimitedText>
								<url>false</url>
								<hidden>false</hidden>
								<allowResize>true</allowResize>
								<allowSort>true</allowSort>
							</flags>
							<textLineCount>0</textLineCount>
							<textInputFormat>Text</textInputFormat>
							<properties>
								<column>CallRef</column>
							</properties>
							<name>Reference</name>
							<width>123</width>
							<image>-1</image>
							<dataColumn>0</dataColumn>
						</controlInfo>
						<controlInfo>
							<mouseOverCursor>Window Default</mouseOverCursor>
							<type>Text Edit</type>
							<flags>
								<invisible>false</invisible>
								<readOnly>false</readOnly>
								<mandatory>false</mandatory>
								<mandatoryLabelBackground>false</mandatoryLabelBackground>
								<mandatoryLabelText>false</mandatoryLabelText>
								<allowNullValue>false</allowNullValue>
								<skipTabStop>false</skipTabStop>
								<disabled>false</disabled>
								<protected>false</protected>
								<noMacroExpand>false</noMacroExpand>
								<readOnlyInit>false</readOnlyInit>
								<autoCompleteField>false</autoCompleteField>
								<editUnlimitedText>false</editUnlimitedText>
								<url>false</url>
								<hidden>false</hidden>
								<allowResize>true</allowResize>
								<allowSort>true</allowSort>
							</flags>
							<textLineCount>0</textLineCount>
							<textInputFormat>Text</textInputFormat>
							<properties>
								<column>LockReason</column>
							</properties>
							<name>Reason</name>
							<width>198</width>
							<image>-1</image>
							<dataColumn>1</dataColumn>
						</controlInfo>
					</columns>
					<sortColumn>-1</sortColumn>
					<sortDescending>false</sortDescending>
					<headerHeight>18</headerHeight>
					<rowHeight>16</rowHeight>
					<selectedColor>#cae1ee</selectedColor>
					<selectedTextColor>#ffffff</selectedTextColor>
					<controlInfo>
						<mouseOverCursor>Window Default</mouseOverCursor>
						<properties>
							<highlightStyle>0</highlightStyle>
							<borderColor>#d3c9b6</borderColor>
							<sqlSource>syscache</sqlSource>
							<table>opencall_locks</table>
							<selectionMode>1</selectionMode>
						</properties>
					</controlInfo>
				</control>
				<control>
					<general>
						<name>btn_unlock</name>
						<type>EventButton</type>
					</general>
					<appearance>
						<index>1</index>
						<caption>Unlock</caption>
						<backgroundColor>#ffffff</backgroundColor>
						<foregroundColor>#000000</foregroundColor>
						<font  size="8">Arial</font>
					</appearance>
					<objectPlacement>
						<position>
							<top>9</top>
							<left>351</left>
							<right>416</right>
							<bottom>34</bottom>
						</position>
						<scaling>
							<top>0</top>
							<left>100</left>
							<right>100</right>
							<bottom>0</bottom>
						</scaling>
					</objectPlacement>
					<data>
					</data>
					<controlInfo>
						<mouseOverCursor>Window Default</mouseOverCursor>
						<flags>
							<invisible>true</invisible>
							<skipTabStop>false</skipTabStop>
							<disabled>true</disabled>
							<protected>false</protected>
							<noMacroExpand>false</noMacroExpand>
							<multiLine>false</multiLine>
						</flags>
						<properties>
							<backgroundColor>#ff9900</backgroundColor>
						</properties>
					</controlInfo>
				</control>
				<control>
					<general>
						<name>btn_close</name>
						<type>EventButton</type>
					</general>
					<appearance>
						<index>2</index>
						<caption>Close</caption>
						<backgroundColor>#ffffff</backgroundColor>
						<foregroundColor>#000000</foregroundColor>
						<font  size="8">Arial</font>
					</appearance>
					<objectPlacement>
						<position>
							<top>37</top>
							<left>351</left>
							<right>416</right>
							<bottom>62</bottom>
						</position>
						<scaling>
							<top>0</top>
							<left>100</left>
							<right>100</right>
							<bottom>0</bottom>
						</scaling>
					</objectPlacement>
					<data>
					</data>
					<controlInfo>
						<mouseOverCursor>Window Default</mouseOverCursor>
						<properties>
							<backgroundColor>#ff9900</backgroundColor>
						</properties>
					</controlInfo>
				</control>
			</controls>
			<formActions>
			</formActions>
			<javascript>
				<methods>
					<method>
						<name>btn_unlock_OnPressed</name>
						<code>
							<![CDATA[btn_unlock_OnPressed()
{
	for ( var x = 0; x < sl_locks.rowCount(); x++ ) {   
        if (sl_locks.IsRowSelected(x)) {   
            // we found a winner â€“ get the callref id;   
            var strCallRef = sl_locks.GetItemTextRaw(x, 0);    
            // disable the unlock button during processing;   
            app._een(btn_unlock , false);   
            // trigger the Unlock calls function;   
            var rs = new SqlQuery();  
            rs.Query("delete from opencall_locks where callref = " + strCallRef,"syscache");  
            // app.global.UnlockCalls(strCallRef);   
        }   
    }   
    // refresh the form grid view;   
    sl_locks.Refresh();

}]]>
						</code>
					</method>
					<method>
						<name>sl_locks_OnItemSelected</name>
						<code>
							<![CDATA[sl_locks_OnItemSelected(nRow)
{
	app._een(btn_unlock , (nRow>-1)?true:false);
}]]>
						</code>
					</method>
					<method>
						<name>btn_close_OnPressed</name>
						<code>
							<![CDATA[btn_close_OnPressed()
{
	_swdoc.CloseForm();


}]]>
						</code>
					</method>
					<method>
						<name>OnFormLoaded</name>
						<code>
							<![CDATA[OnFormLoaded(bDataReloaded)
{
	// TODO: Add your event handler code here
	// validate the logged-in user's rights to unlock tickets;    
    var analystId = app.session.analystid;    
    var isAdmin = 0;       
    var rs = new SqlQuery();    
    var qryResult = rs.Query("SELECT COUNT(*) FROM UnlockTicketAdmins WHERE AnalystID = '" + analystId + "'", "syscache");   
     
    while(rs.Fetch()) { 
        // MessageBox("IsAdmin: " + rs.GetValueAsNumber(0)); 
        isAdmin = rs.GetValueAsNumber(0); 
    } 
      
    if (isAdmin === 1) {   
        app._evi(btn_unlock , true);   
    }
}]]>
						</code>
					</method>
				</methods>
			</javascript>
		</layout>
		<layout>
			<appearance>
				<width>360</width>
				<height>220</height>
				<backgroundColor>#ffffff</backgroundColor>
				<fillColour>#ffffff</fillColour>
				<textColour >#000000</textColour >
				<font  size="8">Arial</font>
			</appearance>
			<controls>
			</controls>
			<formActions>
			</formActions>
			<javascript>
				<methods>
				</methods>
			</javascript>
		</layout>
	</layouts>
</espForm>
