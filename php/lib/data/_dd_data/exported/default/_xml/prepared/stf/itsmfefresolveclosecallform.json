{"espForm":{"configuration":{"settings":{"name":"itsmfEfResolveCloseCallForm","title":"Resolve Close Call Form","options":{"allowResize":"true","showMenubar":"true","showToolbar":"false","showStatusBar":"false"}},"tables":{"table":[{"name":"updatedb","type":"Main Details Table","flags":"5"},{"name":"opencall","type":"Extended Details Table","mainDetailsColumn":"callref","flags":"0"}]},"javascript":{"methods":{"method":[{"name":"OnFormLoading","code":"OnFormLoading(strFormName, strClass)\n{\n\t_swdoc.intGetCurrentEpocTime = app.global.GetCurrentEpocTime();\n\t\n\t\/\/-- If the analyst does not have permissions to modify the status of call\n\t\/\/-- then they should not be able to resolve\/close a call\n\tif (!app.session.HaveRight(ANALYST_RIGHT_A_GROUP,ANALYST_RIGHT_A_CANMODIFYCALLS))\n\t{\n    \tMessageBox(\"You do not have sufficient privileges to modify calls.  Please contact your system administrator\",MB_ICONSTOP);\n    \treturn false;\n\t}\n\t\n\t\/\/-- make sure user is allowed to resolve or close calls\n\tif( (!app.session.HaveRight(ANALYST_RIGHT_A_GROUP,ANALYST_RIGHT_A_CANCLOSECALLS)) && (!app.session.HaveRight(ANALYST_RIGHT_A_GROUP,ANALYST_RIGHT_A_CANRESOLVECALLS)) )\n\t{\n\t\tMessageBox(\"You do not have sufficient privileges to resolve or close calls.  Please contact your system administrator\",MB_ICONSTOP);\t\n\t\treturn false;\n\t}\n\t\n\t\/\/-- app.itsm can resolve\n\tif(!_swdoc.check_callclass_resolve(_swdoc._form[\"callrefs\"]))return false;\n\t\n\t\/\/-- returns true or false - true keeps form open \/ false will close form\n\tvar boolRetVal = _swdoc.setup_document_variables();\n\t\n\t_swdoc.resetData();\n\n\treturn boolRetVal;\n\t\n}"},{"name":"OnFormClosing","code":"OnFormClosing()\n{\n\tif (_swdoc.boolForceClose)\n\t{\n\t\treturn true;\n\t}\t\n\n\tvar funcUnlockReset = function()\n\t{\n\t\tif(!_swdoc.CallrefsCommaString.length)\n\t\t{\t\n\t\t\t_swdoc.ResetData();\n\t\t\treturn true;\n\t\t}\n\t\t\n\t\tapp.global.UnlockCalls(_swdoc.CallrefsCommaString);\n\t\t\n\t\t\/\/-- This is not documented\n\t\t_swdoc.ResetData();\n\n\t\treturn true;\n\t}\t\n\t\n\t\/\/-- Check for Changes to any of the data fields\n\tif(_swdoc.boolFormFieldChanged)\n\t{\n\t\tMessageBox(\"You have unsaved data on this form. Do you still want to close this form?\", MB_ICONQUESTION | MB_YESNO, function(intDecision)\n\t\t{\n\t\t\tif (intDecision == IDNO)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tfuncUnlockReset();\n\t\t\t\t_swdoc.boolForceClose = true;\n\t\t\t\t_swdoc.CloseForm();\n\t\t\t}              \n\t\t});\n\t}\n\telse\n\t{\n\t\treturn funcUnlockReset();\n\t}\n\t\n}"},{"name":"(User Defined Functions)","code":"\t\/*\n\t\tCreated by Hornbill Systems\n\t\t\n\t\tUpdates\n\t\t\n\t\t\n\t\tBug\t\tDate\t\tAuthor\t\t\t\t\tDescription\n\t\t----------------------------------------------------------------------------\n\t\t56943\t14\/05\/07\tIvan Nicholas Dorosh\tAbility to set default value for survey.\n\t\n\t\n\t*\/\n\nvar boolUnAuthorisedCalls = false; \/\/-- indicates if trying to resolve or close an unauthorised call.\n\nvar boolLogMode = false; \/\/-- boolean - is the form being displayed in a logcall forn\nvar boolClosing = false; \/\/-- boolean - is the call action to close calls\/s (if false resolving)\nvar boolCloseOnly = false;\nvar boolResolveOnly = false; \/\/-- boolean - is the call for resolving only (not allowed to close)\n\nvar arrCallrefs = new Array(); \/\/-- array - holds the callrefs we want to close or resolve\nvar CallrefsCommaString = \"\";  \/\/-- string - comma delimted callrefs\nvar strIssueref = \"\";\t\t   \/\/-- string - has issue refs in it if we are closing an issue\n\t\nvar arrSurveyNameSurvIDs = new Array(); \/\/-- array - holds list of survey ids \nvar arrCallStatuss \t\t = new Array(); \/\/-- array - holds list of the all the calls status\nvar arrCallOpenTasks \t = new Array(); \/\/-- araray - holds list of all the calls tasks\n\nvar boolFormFieldChanged = false;\t\/\/-- boolean - set to true when formfield is changed. Used when closing form\n\nvar boolSourceEmail = false; \/\/-- from opened from email\nvar boolHaveSubject = false; \/\/-- Is there a subject\nvar boolHaveSurveys = false; \/\/-- are there surveys available\n\nvar boolMixedCallClasses = false; \/\/-- boolean are we working with mixed call classes\nvar boolHavePendingCalls = false; \/\/-- we have calls that are pending\nvar boolHaveResolvedCalls = false; \/\/-- we have calls that are resolved\nvar boolMultipleCalls = false; \/\/-- we are working with multiple calls\n\nvar boolClosingIssue = false; \/\/-- boolean are we closing calls as part of an issue\nvar boolMixedCallStatus  = false  \/\/-- boolean are we working with a mixtuer of call states\n\nvar boolSetToMaxBackdatePeriod = false;\nvar intGetCurrentEpocTime = app.global.GetCurrentEpocTime();\nvar nBackdatePeriod = 0;\n\n\/\/-- reset bound record so we dont get messages when leaving\nfunction resetData()\n{\n\t_swdoc.ResetModiedFlag(\"updatedb\");\n\t_swdoc.ResetModiedFlag(\"opencall\");\n}\n\n\/\/-- validate form data that user has set\nfunction ValidateForm()\n{\n\tif((_swdoc.updatedb.timespent < 1 || _swdoc.updatedb.timespent > 60000) && (mainform.tb_timespent.mandatory))\n\t{\n\t\tMessageBox(\"You must enter the amount of time you spent on this action\", MB_OK);\n\t\treturn false;\t\/\/ Make sure that the time spent is within range\n\t}\n\n\tif(_swdoc.updatedb.updatetxt == \"\")\n\t{\n\t\tMessageBox(\"You must enter a description in the Other Information section.\", MB_OK | MB_ICONINFORMATION );\n\t\treturn false;\t\/\/ Make sure we have some update text\n\t}\n\n\t\/\/-- check other required fields\n\tif (!_swdoc.check_mandatory_fields(\"updatedb\",mainform))return false;\t\t\n\tif (!_swdoc.check_mandatory_fields(\"opencall\",mainform))return false;\n\t\n\treturn TRUE;\n}\n\n\n\/\/-- 08.02.2007 - NWJ - Check mandatory fields on the form for a given table\n\/\/--\t\t\t\t\talert user if need be and return false\t\t\t\t\t\t\nfunction check_mandatory_fields(strTable,oForm)\n{\n    for (var x = 0; x<oForm.elements.length;x++)\n    {\n        var element = oForm.elements[x];\n        if ((element.mandatory) && (element.text ==\"\"))\n        {\n            var colName = \"\";\n            var fieldName = \"(not specified)\";\n            if(element.dataRef!=\"\")\n            {\n            \tvar arrInfo = element.dataRef.split(\".\");\n            \tvar strTable = arrInfo[0];\n            \tvar colName = arrInfo[1];\n            \tvar fieldName = dd.tables[strTable].columns[colName.toLowerCase()].DisplayName;\n            }\n            MessageBox(\"The field '\" + fieldName + \"' is a mandatory field and must be completed.\");\n            return false;\n        }\n    }\n    return true;\n}\n\nfunction setup_call_action()\n{\n\t\/\/-- should list box be selectatable\n\t\/\/-- closing\n\t\n\tif ((_swdoc.boolCloseOnly) || (_swdoc.boolClosing))\n\t{\n\t\tif(_swdoc.boolCloseOnly)_swdoc.boolClosing = true;\n\t\t\/\/ind01 Ivan Nicholas Dorosh 02\/04\/07 - Set the text regardless of what the form is set to\n\t\tapp._ete(mainform.cb_callaction , \"Close Call\");\n\t\t\n\t\t\/\/-- closing\n\t\t\/\/-- If closing call do not allow user to select fix code profile\n\t\t\/\/-- due to core product server restrictions\n\t\t\/\/ind02 mainform.btnBrowseProfile.enable=_swdoc.boolMixedCallStatus;\n\t\t\/\/ind02 mainform.btnGetProfileText.enable = false;\t\t\n\t\t\/\/ind02 This code just didn't make sense.  Checked with AndreiT, and confirmed\n\t\t\/\/ That this should not be enabled for Mixed Call Statuses only.\n\t\t\n\t\t\/\/mainform.btnBrowseProfile.enable=(_swdoc.boolMixedCallStatus==false);\n\t\t\/\/mainform.btnGetProfileText.enable = (_swdoc.boolMixedCallStatus==false);\t\t\n\t}\n\telse\n\t{\n\t\n\t\t\/\/ind01 Ivan Nicholas Dorosh 02\/04\/07 - Set the text regardless of what the form is set to\n\t\tapp._ete(mainform.cb_callaction , \"Resolve Call\");\n\t\t\n\t\n\t\t\/\/ind02 \/\/-- resolving or could be closing\n\t\t\/\/ind02 mainform.btnBrowseProfile.enable=true;\n\t\t\n\t\t\/\/ind02 This code just didn't make sense.  Checked with AndreiT, and confirmed\n\t\t\/\/ That this should not be enabled for Mixed Call Statuses only.\n\t\t\/\/mainform.btnBrowseProfile.enable= (_swdoc.boolMixedCallStatus==false);\n\t\t\/\/mainform.btnGetProfileText.enable = (_swdoc.boolMixedCallStatus==false);\t\n\t\t\n\t}\n\t\n\t\/\/-- set menu shortcut\n\tstrAppends = (_swdoc.boolMultipleCalls)?\"s\":\"\";\n\t_emt(mainform.btnResolveClose , \"&\" + mainform.cb_callaction.text + strAppends);\n\tapp._ete(mainform.btnResolveClose , mainform.cb_callaction.text + strAppends);\n\n\t\/\/-- setup other flags based on call action\t\n\t_swdoc.setup_charge_flag();\n\t_swdoc.setup_kbase_flag()\t\n}\n\nfunction setup_form_mode()\n{\n\t\/\/-- always make sure fixcode desc is disabled\n\tapp._een(mainform.tb_fixcodedescription,false);\t\n\tapp._evi(mainform.btnResolveClose , true);\n\t\n\t\t\n\tvar bResolveByDefault = app.session.IsDefaultOption(ANALYST_DEFAULT_RESOLVEBYDEFAULT);\t\t\t\n\t\/\/-- if user does not have the right to close calls then only allow resolve\n\tif(!app.session.HaveRight(ANALYST_RIGHT_A_GROUP,ANALYST_RIGHT_A_CANCLOSECALLS))\n\t{\n\t\tapp._een(mainform.cb_callaction,false);\n\t\tbResolveByDefault = true;\n\t}\n\n\t\/\/-- do they have option to resolve\n\tif(!app.session.HaveRight(ANALYST_RIGHT_A_GROUP,ANALYST_RIGHT_A_CANRESOLVECALLS))\n\t{\n\t\tapp._een(mainform.cb_callaction,false);\n\t\tbResolveByDefault = false;\n\t}\n\t\n\t_swdoc.boolClosing = !bResolveByDefault;\n\t\n\t\/\/-- set the default selection for the call action pick list based on the DD entry \n\tif((bResolveByDefault) && (!_swdoc.boolHaveResolvedCalls))\n\t{\n\t\tapp._ete(mainform.cb_callaction , \"Resolve Call\");\n\t}\n\telse\n\t{\n\t\tapp._ete(mainform.cb_callaction , \"Close Call\");\n\t}\t\t\n\t\n\t\/\/--\n\t\/\/-- disable \/ enable form fields\n\tapp._een(mainform.cb_callaction , (!_swdoc.boolHaveResolvedCalls));\t\n\tapp._een(mainform.dt_actiontime , (app.session.CanBackdateCallActions())); \/\/-- can backdate ?\n\n\t\/\/-- link passed in file attachments and set user perm to add\n\t_swdoc.setup_file_attachments();\n}\n\nfunction setup_file_attachments()\n{\n\t\/\/--read the passed in attachemnets\n\t\n\tvar x=0;\n\twhile(_swdoc._form[\"attach\"+x])\n\t{\n\t\tmainform.fl_attachments.AddAttachment(_swdoc._form[\"Attach\" + x]);\n\t\tx++;\n\t}\n\tif (!app.session.HaveRight(ANALYST_RIGHT_A_GROUP,ANALYST_RIGHT_A_CANATTACHFILESTOCALLS,false))\n\t{\n\t\tif(_swdoc._form[\"Attach1\"])\n\t\t{\n\t\t\tapp._evi(mainform.btnAddFile , false);\n\t\t\tapp._evi(mainform.btnRemoveFile , false);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tmainform.Tab1.ShowTabItem(1,false);\n\t\t}\n\t}\n}\n\n\/\/-- 08.02.2007 - NWJ - One function to handle which standard check boxes should be enabled\/disabled\n\/\/--\t\t\t\t\tchecked or unchecked, as old code fglas were set all over the place\nfunction setup_public_flag()\n{\n\tapp._een(mainform.flg_updatepublic,true);\n\tapp._ete(mainform.flg_updatepublic , app.session.IsDefaultOption(ANALYST_DEFAULT_CLOSEPRIVATE) ? \"1\":\"0\");\n\n\tif (_swdoc.boolClosing)\n\t{\n\t\t\/\/-- closing\n\t}\n\telse\n\t{\n\t\t\/\/-- resolving\n\t}\n}\n\nfunction setup_kbase_flag()\n{\n\t\/\/- -does the user have the right to add to the kbase or we are worknig with multiple calls so dont add\n\tif((!app.session.HaveRight(ANALYST_RIGHT_C_GROUP,ANALYST_RIGHT_C_CANADDTOKNOWLEDGEBASE)) || (_swdoc.boolMultipleCalls))\n\t{\n\t\tapp._ete(mainform.flg_addKBase , \"0\");\n\t\tapp._een(mainform.flg_addKBase , false);\n\t\treturn;\n\t}\n\n\t\/\/-- We need to check whether this call has been added to the knowledge\n\t\/\/-- base when it was resolved.\t\n     if(app.global.IsCallInKnowledgeBase(_swdoc.arrCallrefs[0]))\n     {\n\t\tapp._ete(mainform.flg_addKBase , \"0\");\n        app._een(mainform.flg_addKBase , false);\n     }\n     else\n     {\n        app._ete(mainform.flg_addKBase , app.session.IsDefaultOption(ANALYST_DEFAULT_CLOSEKNOWLEDGEBASE) ? \"1\":\"0\");\n        app._een(mainform.flg_addKBase,true);\n     }\n}\n\nfunction setup_charge_flag()\n{\n\tif (_swdoc.boolClosing)\n\t{\n\t\t\/\/-- closing\n\t\tapp._een(mainform.flg_chargeable,true);\n\t\tapp._ete(mainform.flg_chargeable , app.session.IsDefaultOption(ANALYST_DEFAULT_CLOSECHARGABLE) ? \"1\":\"0\");\t\t\n\t}\n\telse\n\t{\n\t\t\/\/-- resolving\n\t\tapp._een(mainform.flg_chargeable,false);\n\t\tapp._ete(mainform.flg_chargeable,0);\t\t\n\t}\n}\n\nfunction setup_email_flag()\n{\n\t\/\/--\n\t\/\/-- if we have a mailserver and can send mail set flg\n\tif(app.global.IsConnectedToMailServer() && app.global.CanSendMail())\n\t{\n\t\tapp._een(mainform.flg_emailcustomer , true);\n\t\tapp._ete(mainform.flg_emailcustomer , (app.session.IsDefaultOption(ANALYST_DEFAULT_CLOSESENDEMAIL)) ? \"1\":\"0\");\n\t}\n\telse\n\t{\n\t\tapp._een(mainform.flg_emailcustomer , false);\n\t\tapp._ete(mainform.flg_emailcustomer , \"0\");\n\t}\n}\n\n\/\/--\n\/\/-- initialise the surveys options\nfunction setup_survey_options()\n{\n\t\/\/-- if they do not have surveys hide options\n\tif(!app.global.IsSurveyModuleEnabled())\n\t{\n\t\tapp._ete(mainform.flg_customersurvey , \"0\");\t\n\t\tapp._evi(mainform.flg_customersurvey , false);\n\t\tapp._evi(mainform.cb_surveys , false);\n\t}\n\telse\n\t{\n\t\tvar strSelect = \"select * from survey_r where callref in (\"+_swdoc._form[\"callrefs\"]+\")\";\n\t\tvar oRS = app.g.get_recordset(strSelect,\"syscache\");\n\t\tif(oRS.Fetch())\n\t\t{\n\t\t\t\/\/one or more requests has already had a survey sent\n\t\t\tapp._ete(mainform.flg_customersurvey , \"0\");\t\n\t\t\tapp._evi(mainform.flg_customersurvey , false);\n\t\t\tapp._evi(mainform.cb_surveys , false);\n\t\t\treturn false;\n\t\t}\n\t\n\t\t\/\/-- get survey options\n\t\t_swdoc.load_survey_list();\t\n\n\t\t\/\/-- if we dont have surveys on the system then hide\n\t\tif(!_swdoc.boolHaveSurveys)\t\n\t\t{\n\t\t\tapp._ete(mainform.flg_customersurvey , \"0\");\t\n\t\t\tapp._een(mainform.flg_customersurvey , false);\t\t\t\t\n\t\t\tapp._evi(mainform.cb_surveys , false);\t\t\n\t\t\treturn false;\n\t\t}\n\t\t\n\t\t\/\/-- have to set to true because if you set to hidden in code and then dev form it saves the state\n\t\tapp._evi(mainform.flg_customersurvey , true);\t\t\t\t\t\t\n\t\tapp._evi(mainform.cb_surveys , true);\t\n\t\t\t\n\t\t\/\/-- not allowed to change send survey options or there arent any surveys to send\n\t\tif(app.session.IsDefaultOption(ANALYST_DEFAULT_DISABLESENDSURVEY)) \n\t\t{\n\t\t\t\/\/--code change DavidJH 09.06.05\n\t\t\tapp._een(mainform.flg_customersurvey , false);\n\t\t\tapp._ete(mainform.flg_customersurvey,\"0\");\n\t\t\t\/\/F0094736\n\t\t\t\/\/return false;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tapp._een(mainform.flg_customersurvey , true);\n\t\t}\n\t\t\n\t\t\/\/-- default ticked setting\n\t\tif(app.session.IsDefaultOption(ANALYST_DEFAULT_SETSENDSURVEY))\n\t\t{\n\t\t\tapp._ete(mainform.flg_customersurvey , \"1\");\n\t\t\tapp._een(mainform.cb_surveys , true);\t\t\t\t\t\t\n\t\t}\n\t\telse\n\t\t{\n\t\t\tapp._ete(mainform.flg_customersurvey , \"0\");\n\t\t\tapp._een(mainform.cb_surveys , false);\t\t\t\t\t\t\n\t\t}\n\t}\n}\n\nfunction load_survey_list()\n{\n\t\/\/-- empty the picklist\n\tmainform.cb_surveys.pickList = \"\";\n\t\n\t\/\/-- select all of the system mailboxes and add all shared mailboxes to an array\n\tvar SqlRecordSetObj\t= new SqlQuery;\n\t\n\t\/\/-- select all of the surveys and the mailbox they are associated to\n\tSqlRecordSetObj.Reset();\n\tSqlRecordSetObj.Query(\"Select DISTINCT surveyname,surveyid,Mailbox from survey_config\", \"sw_systemdb\");\n\t\t\n\tvar str = \"\";\n\tvar selected = \"\";\n\tvar strTemps = new Array();\n\tbselecteddefaultsurvey = false;\n\t\n\t\/\/-- loop through the surveys and and match those associated to shared mailboxes\n\t\/\/-- for each survey add it into an array and to the pick list string and when the \n\t\/\/-- first survey is found identify it as the default option for the survey picklist\n\twhile(SqlRecordSetObj.Fetch())\n\t{\n\t\t\/\/-- get the recordset value for survey name and id\n\t\tvar surveyname = SqlRecordSetObj.GetValueAsString(\"surveyName\");\n\t\tvar surveyid = SqlRecordSetObj.GetValueAsString(\"surveyid\");\n\t\t\n\t\t\/\/-- add the survey name\/id pair into the array\n\t\t_swdoc.arrSurveyNameSurvIDs[surveyname] = surveyid;\n\t\t\n\t\t\/\/-- build the picklist\toptions string\t\n\t\tstr += surveyname + \"|\";\n\t\t\/\/MessageBox(surveyname)\n\t\t_swdoc.boolHaveSurveys=true;\n\t\t\/\/-- identify the default survey (currently the first one added)\n\t\tfor(ID in _swdoc.arrSurveyNameSurvIDs)\n\t\t{\n\t\t\t\n\t\t\tif(_swdoc.arrSurveyNameSurvIDs[ID])\n\t\t\t{\n\t\t\t\t\/* 56943-1 Not required, set in form.\n\t\t\t\tif(!bselecteddefaultsurvey)\n\t\t\t\t{\n\t\t\t\t\tbselecteddefaultsurvey = true;\n\t\t\t\t\tselected = surveyname;\n\t\t\t\t}\n\t\t\t\t*\/\n\t\t\t}\n\t\t}\n\t\t\t\n\t}\n\t\n\t\/\/-- populate the surveys pick list\n\tmainform.cb_surveys.pickList = str;\n\t\n\t\/\/-- set the default selected survey\n\t\/\/56943-1 mainform.cb_surveys.text = selected;\n}\n\n\nfunction setup_profile_selection()\n{\n\n}\n\n\nfunction setup_resolution_profile()\n{\n\t\/\/-- disable profile text button\n\tapp._een(mainform.btnGetProfileText,false);\n\n\t\/\/-- if we have pending calls dont bother\n\tif (_swdoc.boolHavePendingCalls) return;\n\tif (!_swdoc.boolHaveResolvedCalls) return;\n\n\t\/\/-- DJH\n\t\/\/-- 24.01.2006 \n\t\/\/-- if the call is resolved, pull the resolution text and prepopulate the boxes with this text.\n\tvar aRSfixcodes\t= new SqlQuery;\n\t\n\t\/\/-- NWJ -  24.01.2006\n\t\/\/--\t\tGet distinct profile codes for passed in calls\n\tif (!aRSfixcodes.Query(\"SELECT distinct opencall.fixcode FROM opencall WHERE callref IN(\" + _swdoc.CallrefsCommaString + \")\", \"syscache\"))\n    {\n\t\tMessageBox(\"Unable to query call fixcode values. Please contact your Supportworks Administrator.\", MB_ICONSTOP);\n\t}\n\telse\n\t{\n\t\t\/\/-- NWJ - 24.01.2006\n\t\t\/\/-- \t   See if we have more than 1 fixcode\n\t\tvar strFixCode \t= \"\"\n\t\tvar strFixText\t= \"\";\n\t\tvar intFixCodeCount = 0;\n\t\twhile(aRSfixcodes.Fetch())\n\t\t{\n\t\t\tintFixCodeCount++;\t\t\t\n\t\t\t\/\/-- we have multiple fixcodes\n\t\t\tif (intFixCodeCount > 1) \n\t\t\t{\n\t\t\t\tstrFixCode = \"\";\n\t\t\t\tstrFixText = \"<multiple profiles>\";\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tstrFixCode = aRSfixcodes.GetValueAsString(\"fixcode\");\n\t\t}\n\t\t\n\t\t\/\/-- if we have one fix code we should load this profile\n\t\tif (intFixCodeCount == 1)\n\t\t{\n\t\t\tvar objFix = app.global.GetResolutionProfileDescription(strFixCode);\n\t\t\tstrFixText = objFix.strCodeDesc;\t\n\t\t\t\/\/-- nwj if it has a dec text enable button to copy\n\t\t\tapp._een(mainform.btnGetProfileText,(objFix.strDescription!=\"\"));\n\t\n\t\t}\n\n\t\t\/\/-- set text desc of code and then set actual code against opencall record\n\t\tapp._ete(mainform.tb_fixcodedescription , strFixText);\n\t\t_swdoc.opencall.fixcode = strFixCode;\t\t\n\t\t\t\n\t}\/\/end else query was successful\n\t\n\tif(!_swdoc.boolAllowResolutionProfileSelection)\n\t{\n\t\tapp._een(mainform.btnGetProfileText , false);\n\t\tapp._een(mainform.tb_fixcodedescription , false);\n\t\tapp._een(mainform.btnBrowseProfile,false);\n\t}\n}\n\n\/\/-- 09.02.2007 - NWJ - initialise the _swdoc variables and state\nfunction setup_document_variables(boolLogging)\n{\n\t\/\/-- store callrefs string and create array\n\t_swdoc.CallrefsCommaString = _swdoc._form[\"callrefs\"];\n\t_swdoc.arrCallrefs = _swdoc.CallrefsCommaString.split(\",\");\n\t_swdoc.boolMultipleCalls = (_swdoc.arrCallrefs.length>1);\n\t\n\t\/\/-- arrays to hold call info\n\t_swdoc.arrSurveyNameSurvIDs \t= new Array();\n\t_swdoc.arrCallStatuss \t\t= new Array();\n\t_swdoc.arrCallOpenTasks \t\t= new Array();\n\t\t\t\t\n\t\/\/-- do we have an issue reference\n\tif(_swdoc._form[\"issueref\"])\n\t{\n\t\t_swdoc.boolClosingIssue = true;\n\t\t\/\/MessageBox(\"Issue Ref \" + _swdoc._form[\"issueref\"])\n\t\t_swdoc.strIssueref = _swdoc._form[\"issueref\"];\n\t}\n\n\t\/\/-- if the call does not have active tasks then its ok to lock them - otherwise close form\n\tvar strTaskMsg = _swdoc.check_call_has_active_tasks(_swdoc.CallrefsCommaString);\n\tif(strTaskMsg!=\"\")\n\t{\n\t\tMessageBox(strTaskMsg,MB_ICONSTOP);\n\t\tapp.global.UnlockCalls(_swdoc.CallrefsCommaString);\n\t\treturn false;\n\t}\n\telse\n\t{\n\t\t\/\/-- lock selected calls for close activity\t\n\t\tif(!app.global.LockCalls(_swdoc.CallrefsCommaString, \"CLOSE\"))\n\t\t{\n\t\t\t\/\/-- Failed to lock close the form\n\t\t\treturn false;\n\t\t}\n\n\t\t\t\t\n\t\t\/\/- got get call states and classes - so user can choose what to do if they are different.\n\t\tif(!_swdoc.check_call_states_and_classes(_swdoc.CallrefsCommaString))\t\n\t\t{\n\t\t\tapp.global.UnlockCalls(_swdoc.CallrefsCommaString);\n\t\t\treturn false;\n\t\t}\n\t\telse\n\t\t{\n\t\t\t\n\t\t\t\/\/-- create form title\n\t\t\t_swdoc.create_form_title();\n\t\t\t\t\n\t\t\t\/\/-- are we resolving only\n\t\t\t_swdoc.boolResolveOnly = (_swdoc._form[\"resolve\"] == \"1\");\n\t\t\t\t\n\t\t\t\/\/-- did we come from an email\n\t\t\t_swdoc.boolSourceEmail = (_swdoc._form[\"_source_email\"] == \"true\");\n\t\t\n\t\t\t\/\/-- do we have a subject\t\t\n\t\t\t_swdoc.boolHaveSubject = (_swdoc._form[\"subject\"] == \"true\");\n\t\t\t\t\n\t\t\t\/\/--- set update text\n\t\t\t_swdoc.strUpdateText = _swdoc._form[\"updatetext\"];\n\t\t}\t\t\n\t\t\n\t}\/\/-- if(strTaskMsg!=\"\")\n\n\treturn TRUE;\n}\n\n\/\/-- 09.02.2007 - NWJ - Check if call\/s have any active tasks - if so return message.\nfunction check_call_has_active_tasks(strCheckCallrefs)\n{\n\t\n\tvar returnMessage = \"\";\n\tvar aRS\t= new SqlQuery;\n\n\t\/\/-- perform a sql check to see if we have any open calltasks\n\tvar SqlCommand  = \"SELECT callref, count(*) as ct FROM calltasks WHERE status <> \" + TASK_STATUS_COMPLETE + \" AND callref IN(\";\n\t\tSqlCommand += strCheckCallrefs + \") GROUP BY callref HAVING ct > 0\";;\n\n\tif(!aRS.Query(SqlCommand, \"sw_systemdb\"))\n    {\n\t\tif(_swdoc.strIssueref.length == 0)\n     \t{\n     \t\treturnMessage = \"Unable to query call task status values. Please contact your Supportworks Administrator.\";\n     \t}\n    }\n\telse\n\t{\n\t\t_swdoc.arrCallOpenTasks.length = 0;\n\t\t\t\n\t\twhile(aRS.Fetch())\n\t\t{\n\t\t\t\tvar nCount =  aRS.GetValueAsString(\"ct\");\n\t\t\t\tvar calref =  aRS.GetValueAsString(\"callref\");\n\t\t\t\t_swdoc.arrCallOpenTasks[calref] = nCount;\n\t\t}\n\t\t\n\t\tvar nLength = _swdoc.arrCallOpenTasks.length;\n\t\tif(nLength)\n\t\t{\n\t\t\tvar Ref = \"\";\n\t\t\tvar Message = \"\";\n\t\t\tif(nLength > 1)\n\t\t\t{\n\t\t\t\tfor(ID in _swdoc.arrCallOpenTasks)\n\t\t\t\t{\n\t\t\t\t\t\/\/-- 30.01.2006 - DJH code to add comma between call refs when dealing with multiple calls\n\t\t\t\t\t\/\/var Value = dd.tables[\"opencall\"].columns[\"callref\"].FormatValue(ID);\n\t\t\t\t\tvar Value = app.g.pad_callref(ID);\n\t\t\t\t\tif(Ref != \"\")Ref += \",\";\n\t\t\t\t\tRef += Value;\n\t\t\t\t}\n\t\t\t\treturnMessage = \"The following calls still have outstanding work items assigned to them and can not be closed:-\\n\\n\" + Ref; \/\/Removed  + \"1\" from end\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tfor(ID in _swdoc.CallOpenTaskMap)\n\t\t\t\t{\n\t\t\t\t\t\treturnMessage = \"The call \" + ID + \" still has \" + _swdoc.arrCallOpenTasks[ID] + \" outstanding work item(s) and can not be closed.\";\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\/\/--if(nLength > 1)\t\t\n\t\t}\/\/-- if(nLength)\n\t}\/\/-- if(!aRS.Query(SqlCommand, \"sw_systemdb\"))\n\t\n \treturn returnMessage;\n}\n\n\/\/-- 09.02.2007 - NWJ - Construct form title based on state etc\nfunction create_form_title()\n{\n\t\/\/-- start to contruct form title (call local function to format callrefs and finish title)\n\tvar strFormTitle = (_swdoc.arrCallrefs.length > 1) ? \"Resolve\/Close Calls \" : \"Resolve\/Close Call \";\n\n\t\/\/-- loop through array and format callrefs\t\n\tfor(var i=0;i<_swdoc.arrCallrefs.length; i++)\n\t{\n\t\tif( i > 0) strFormTitle += \", \";\n\t\tstrFormTitle += app.g.pad_callref(_swdoc.arrCallrefs[i]);\n\t}\n\n\t\/\/-- if we are closing an issue and to title\n\tif(_swdoc.strIssueref.length) strFormTitle += \" Closing issue \" + _swdoc.strIssueref\n\t\t\t\n\t\/\/-- set the title\n\t_swdoc.SetTitle(strFormTitle);\n}\n\n\/\/-- 09.02.2007 - NWJ - check the state and callclass for the action calls - true \/ false (false = close down)\nfunction check_call_states_and_classes(strCheckCallrefs)\n{\n\t\/\/-- get the status and class for our callref\/s\n    var aRScallstate = new SqlQuery;\n\tvar strSelect = \"SELECT callref, status, callclass, fixcode FROM opencall WHERE callref IN(\" + strCheckCallrefs + \")\";\n\t\n    if(!aRScallstate.Query(strSelect, \"sw_systemdb\"))\n    {\n     \t\/\/-- failed - check if we have an issue\n     \tif(_swdoc.strIssueref.length == 0)\n     \t{\n     \t\tMessageBox(\"Unable to query call status values. Please contact your Supportworks Administrator..\", MB_ICONSTOP);\n     \t\treturn false;\n     \t}\n    }\n    else\n    {\n\t\t\/\/--\n\t\t\/\/-- loop through our returned rows and get state and classes\n\t\t\n\t\tvar strCurrentCallClass = \"\";\n\t\tvar strLastCallClass = \"\";\n\t\t\n\t\tvar strCurrentFixCode = \"\";\n\t\tvar strLastFixCode = \"\";\n\t\tvar bMixedResCodes = false;\n\t\t\n\t\tvar nPendingStatus = 0;\n\t\tvar nResolvedStatus = 0;\n\t\tvar nOtherStatus = 0;\n\t\t\n\t\twhile(aRScallstate.Fetch())\n\t\t{\t\t\t\n\t\t\t\/\/-- get status and callref and add info an array\n\t\t\tvar iStatus =  aRScallstate.GetValueAsNumber(\"status\");\n\t\t\tvar iCalref =  aRScallstate.GetValueAsNumber(\"callref\");\n\t\t\t_swdoc.arrCallStatuss[iCalref] = iStatus;\n\t\t\t\t\t\t\n\t\t\t\/\/-- get call class and check if it same as others\n\t\t\t\/\/-- simply want to check if we have selected to resolve or close perate call classes\n\t\t\tstrCurrentCallClass = aRScallstate.GetValueAsString(\"callclass\");\n\t\t\tif ((strLastCallClass != \"\") && (!_swdoc.boolMixedCallClasses))\n\t\t\t{\n\t\t\t\t_swdoc.boolMixedCallClasses = (strLastCallClass != strCurrentCallClass);\n\t\t\t}\n\t\t\tstrLastCallClass = strCurrentCallClass;\n\n\t\t\t\/\/-- nwj - 16.03.2010 - check mixed rescodes\n\t\t\tstrCurrentFixCode = aRScallstate.GetValueAsString(\"fixcode\");\n\t\t\tif ((strLastFixCode != \"\") && (strCurrentFixCode!=strLastFixCode))\n\t\t\t{\n\t\t\t\tbMixedResCodes = true;\n\t\t\t}\n\t\t\tstrLastFixCode = strCurrentFixCode;\n\n\t\t\t\n\t\t\tswitch(iStatus)\n\t\t\t{\n\t\t\t\tcase CS_PENDING:\n\t\t\t\t\tnPendingStatus++;\n\t\t\t\t\tbreak;\n\t\t\t\tcase CS_RESOLVED:\n\t\t\t\t\tnResolvedStatus++;\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tnOtherStatus++;\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\taRScallstate.Reset();\/\/-- reset recordset object\n\t\n\t\n\t\t\/\/-- we have different call classes and not working with an issue prompt use as to what to do\n\t\t\/\/if((_swdoc.boolMixedCallClasses) && (_swdoc.strIssueref.length == 0))\n\t\t\/\/{\n\t\t\/\/\tvar Message = \"The calls you have selected to resolve or close have different call classes, so any resolution profile you may specify will not be applied if you continue. Do you want to continue?\\n\\n(If you want resolution profiles to apply, you should click No and resolve\/close each call separately)\";\n\t\t\/\/\tif(MessageBox(Message, MB_ICONSTOP | MB_ICONQUESTION | MB_YESNO) != IDYES)\n\t\t\/\/\t{\n\t\t\/\/\t\treturn false;\n\t\t\/\/\t}\n\t\t\/\/}\n\t\n\t\t\/\/--- if not pending or resolved && not dealing with issue\n\t\tif((nOtherStatus) &&(_swdoc.strIssueref.length == 0))\n\t\t{\t\t\t\n\t\t\tMessageBox(\"One or more selected calls can not be closed because they have a status other than Pending or Resolved.\", MB_ICONSTOP);\n\t\t\treturn false;\n\t\t}\n\t\n\t\t_swdoc.boolHavePendingCalls = (nPendingStatus);\n\t\t_swdoc.boolHaveResolvedCalls = (nResolvedStatus);\n\t\t_swdoc.boolCloseOnly = (nResolvedStatus);\t\t\n\t\t\/\/-- we have pending and resolved callss\t\n\t\tif(nPendingStatus && nResolvedStatus)\n\t\t{\n\t\t\t_swdoc.boolMixedCallStatus = true;\n\t\t\tif(_swdoc.strIssueref.length == 0)\n\t\t\t{\n\t\t\t\tvar Message = \"The calls you have selected have a mixture of 'Pending' and 'Resolved' statuses. As resolved calls have already been attributed a resolution profile, the resolution profile selected for closing these calls will only be applied to the calls that currently have a status of 'Pending'. The 'Resolved' calls will be completed leaving the previously applied resolution profile. \\n\\nDo you want to continue?\";\n\t\t\t\tif(MessageBox(Message, MB_ICONQUESTION | MB_YESNO) != IDYES)\n\t\t\t\t{\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif(bMixedResCodes)\n\t\t\t{\n\t\t\t\tvar Message = \"The requests that you have selected have different resolution profiles codes. As such any profile change you make on the form will be applied to all requests. Do you want the ability to change the resolution profile?\\n\\nYes = Allow me to change the resolution profile.\\nNo = Do not allow me to change the resolution profile.\";\n\t\t\t\tif(MessageBox(Message, MB_ICONSTOP | MB_ICONQUESTION | MB_YESNO) != IDYES)\t\n\t\t\t\t{\n\t\t\t\t\t_swdoc.boolAllowResolutionProfileSelection = false;\n\t\t\t\t}\n\t\t\t}\n\n\t\t}\n\t} \/\/-- if(!aRScallstate.Query(strSelect, \"sw_systemdb\"))\n\t\n\treturn true;\n}"},{"name":"OnExecuteAction","code":"OnExecuteAction(nAction)\n{\n\t\/\/-- trigger an action from a menu bar (shortcusts)\n\t\n\t\/\/-- closing call\n\tMessageBox(nAction);\n\tif(nAction == CLOSE_CALL_ACTION) return mainform.ResolveClose();\n\t\t\n\t\/\/-- attaching a call to the action.\n\tif(nAction == ATTACHFILETOCALL_ACTION)\n\t{\n\t\tmainform.btnAddFile_OnPressed();\n\t\treturn true;\n\t}\n\n\treturn true;\n}"},{"name":"OnValidate","code":"OnValidate()\n{\n\t\/\/-- validate the form\n\tif(!_swdoc.ValidateForm())return VALIDATE_FAIL;\n\t\t\n\treturn VALIDATE_DEFAULT;\n}"},{"name":"(Globals)","code":"\/\/-- ALL vars and funcs are in the userdefined js area\nvar bUserSelectedFixCode = false;\nvar boolAllowResolutionProfileSelection = true;\nvar boolForceClose = false;\n\nfunction check_callclass_resolve(strCheckCallrefs)\n{\n    var aRScallstate = new SqlQuery;\n\tvar strSelect = \"SELECT  callclass FROM opencall WHERE callref IN(\" + strCheckCallrefs + \")\";\n\t\n    if(aRScallstate.Query(strSelect, \"sw_systemdb\"))\n    {\n\t\t\/\/--\n\t\t\/\/-- loop through our returned rows and get state and classes\n\t\tvar strCurrentCallClass = \"\";\n\t\tvar strLastCallClass = \"\";\t\t\t\t\t\n\t\t\n\t\tvar nPendingStatus = 0;\n\t\tvar nResolvedStatus = 0;\n\t\tvar nOtherStatus = 0;\t\n\t\t\n\t\twhile(aRScallstate.Fetch())\n\t\t{\t\t\t\n\t\t\t\/\/-- get status and callref and add info an array\n\t\t\tvar strCallClass =  aRScallstate.GetValueAsString(\"callclass\");\n\t\t\tif(!app.itsm.can_resolve(strCallClass,true))return false;\n\t\t}\n\t}\n\treturn true;\n}"},{"name":"OnSaveData","code":"OnSaveData()\n{\n\tMessageBox(\"Please use the [\" + mainform.btnResolveClose.text + \"] button to process the action\");\n\treturn false;\n\n\n\t\n}"}]}}},"layouts":{"layout":[{"appearance":{"width":"561","height":"410","backgroundColor":"#ffffff","fillColour":"#ffffff","textColour":"#000000","font":{"@size":"8","#text":"Arial"}},"controls":{"control":[{"general":{"name":"tb_updatetext","type":"Field","group":"Tab1:0"},"appearance":{"index":"0","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Arial"},"borderStyle":"Rectangle"},"objectPlacement":{"position":{"top":"249","left":"17","right":"542","bottom":"389"},"scaling":{"top":"0","left":"0","right":"100","bottom":"100"}},"data":{"binding":"updatedb.updatetxt"},"controlInfo":{"mouseOverCursor":"Window Default","type":"Text Edit","flags":{"invisible":"false","readOnly":"false","mandatory":"true","mandatoryLabelBackground":"false","mandatoryLabelText":"false","allowNullValue":"false","skipTabStop":"false","disabled":"false","protected":"true","noMacroExpand":"true","readOnlyInit":"false","autoCompleteField":"false","editUnlimitedText":"true","url":"false"},"textLineCount":"4","textInputFormat":"Text","properties":{"activeTextColor":"#eeeeee","disabledBackgroundColor":"#eeeeee","borderColor":"#c0c0c0"}}},{"general":{"name":"CaptionPanel2","type":"CaptionBar","flags":{"transparent":"true","xpStyle":"false","hasShadow":"false","toolbarButtonStyle":"false","cache":"false","hasBorder":"true","hasCheckbox":"false"}},"appearance":{"index":"1","caption":"Details","backgroundColor":"#f1f1f1","foregroundColor":"#003366","font":{"@size":"10","@bold":"1","#text":"Trebuchet (MS)"},"alignment":"Left","fillStyle":"Vertical Gradient"},"objectPlacement":{"position":{"top":"29","left":"3","right":"394","bottom":"183"},"scaling":{"top":"0","left":"0","right":"50","bottom":"0"}},"controlInfo":{"mouseOverCursor":"Window Default","properties":{"backgroundColor2":"#d8d8d8","imageHSpace":"10","slope":"12","borderColor":"#d3c9b6","headerHeight":"23","hasBorder":"1","panelBorderColor":"#d3c9b6","fillStyle":"0","panelBackgroundColor":"#f2eedd","panelBackgroundColor2":"#000000"}}},{"general":{"name":"dt_actiontime","type":"Field"},"appearance":{"index":"2","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Arial"},"borderStyle":"Rectangle"},"objectPlacement":{"position":{"top":"73","left":"11","right":"218","bottom":"91"},"scaling":{"top":"0","left":"0","right":"25","bottom":"0"}},"data":{"binding":"updatedb.updatetimex"},"controlInfo":{"mouseOverCursor":"Window Default","type":"Date\/Time Control","flags":{"invisible":"false","readOnly":"false","mandatory":"false","mandatoryLabelBackground":"false","mandatoryLabelText":"false","allowNullValue":"false","skipTabStop":"false","disabled":"true","protected":"true","noMacroExpand":"false","readOnlyInit":"false","colorDateIndicator":"false"},"textLineCount":"0","textInputFormat":"Text","properties":{"activeTextColor":"#eeeeee","disabledBackgroundColor":"#eeeeee","dateFormatMode":"0","borderColor":"#c0c0c0"}}},{"general":{"name":"tb_timespent","type":"Field"},"appearance":{"index":"3","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Arial"},"borderStyle":"Rectangle"},"objectPlacement":{"position":{"top":"73","left":"227","right":"286","bottom":"91"},"scaling":{"top":"0","left":"25","right":"25","bottom":"0"}},"data":{"binding":"updatedb.timespent"},"controlInfo":{"mouseOverCursor":"Window Default","type":"Minute Time Period","flags":{"invisible":"false","readOnly":"false","mandatory":"false","mandatoryLabelBackground":"false","mandatoryLabelText":"false","allowNullValue":"false","skipTabStop":"false","disabled":"false","protected":"true","noMacroExpand":"false","readOnlyInit":"false"},"textLineCount":"0","textInputFormat":"Text","properties":{"defaultValue":"5","activeTextColor":"#eeeeee","disabledBackgroundColor":"#eeeeee","borderColor":"#c0c0c0"}}},{"general":{"name":"cb_actionsource","type":"Field"},"appearance":{"index":"4","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Arial"},"borderStyle":"Rectangle"},"objectPlacement":{"position":{"top":"110","left":"11","right":"218","bottom":"128"},"scaling":{"top":"0","left":"0","right":"25","bottom":"0"}},"data":{"binding":"updatedb.udsource"},"controlInfo":{"mouseOverCursor":"Window Default","type":"Pick List","flags":{"invisible":"false","readOnly":"false","mandatory":"true","mandatoryLabelBackground":"false","mandatoryLabelText":"false","allowNullValue":"false","skipTabStop":"false","disabled":"false","protected":"true","noMacroExpand":"false","readOnlyInit":"false","comboAutoUpdate":"false","comboNewValues":"true","useDDPickList":"true"},"textLineCount":"0","textInputFormat":"Text","properties":{"disabledBackgroundColor":"#eeeeee","defaultValue":"Telephone","distinctTable":"updatedb","distinctColumn":"udsource","borderColor":"#c0c0c0"}}},{"general":{"name":"tb_actiontype","type":"Field"},"appearance":{"index":"5","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Arial"},"borderStyle":"Rectangle"},"objectPlacement":{"position":{"top":"110","left":"227","right":"388","bottom":"128"},"scaling":{"top":"0","left":"25","right":"50","bottom":"0"}},"data":{"binding":"updatedb.udcode"},"controlInfo":{"mouseOverCursor":"Window Default","type":"Pick List","flags":{"invisible":"false","readOnly":"false","mandatory":"true","mandatoryLabelBackground":"false","mandatoryLabelText":"false","allowNullValue":"false","skipTabStop":"false","disabled":"false","protected":"true","noMacroExpand":"false","readOnlyInit":"false","comboAutoUpdate":"false","comboNewValues":"true","useDDPickList":"true"},"textLineCount":"0","textInputFormat":"Text","properties":{"defaultValue":"General Update","listItems":"General Update|Called Customer|E-mailed Customer|","activeTextColor":"#eeeeee","disabledBackgroundColor":"#eeeeee","borderColor":"#c0c0c0"}}},{"general":{"name":"btnBrowseProfile","type":"EventButton","flags":{"transparent":"false","xpStyle":"true","hasShadow":"false","toolbarButtonStyle":"false","cache":"false","hasBorder":"false","hasCheckbox":"false"}},"appearance":{"index":"6","caption":"...","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Arial"}},"objectPlacement":{"position":{"top":"156","left":"362","right":"388","bottom":"177"},"scaling":{"top":"0","left":"50","right":"50","bottom":"0"}},"controlInfo":{"mouseOverCursor":"Window Default","flags":{"invisible":"false","skipTabStop":"false","disabled":"false","protected":"true","noMacroExpand":"false","multiLine":"false"},"properties":{"commands":"-1"}}},{"general":{"name":"tb_fixcodedescription","type":"Field"},"appearance":{"index":"7","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Arial"},"borderStyle":"Rectangle"},"objectPlacement":{"position":{"top":"158","left":"11","right":"364","bottom":"176"},"scaling":{"top":"0","left":"0","right":"50","bottom":"0"}},"controlInfo":{"mouseOverCursor":"Window Default","type":"Text Edit","flags":{"invisible":"false","readOnly":"false","mandatory":"false","mandatoryLabelBackground":"false","mandatoryLabelText":"false","allowNullValue":"false","skipTabStop":"false","disabled":"true","protected":"true","noMacroExpand":"false","readOnlyInit":"false","autoCompleteField":"false","editUnlimitedText":"false","url":"false"},"textLineCount":"0","textInputFormat":"Text","properties":{"activeTextColor":"#eeeeee","disabledBackgroundColor":"#eeeeee","borderColor":"#c0c0c0"}}},{"general":{"name":"flg_emailcustomer","type":"Field","flags":{"transparent":"true","xpStyle":"false","hasShadow":"false","toolbarButtonStyle":"false","cache":"false","hasBorder":"false","hasCheckbox":"false"}},"appearance":{"index":"8","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Trebuchet MS"},"borderStyle":"None"},"objectPlacement":{"position":{"top":"76","left":"409","right":"525","bottom":"95"},"scaling":{"top":"0","left":"50","right":"50","bottom":"0"}},"controlInfo":{"mouseOverCursor":"Window Default","type":"Form Flags","flags":{"invisible":"false","readOnly":"false","mandatory":"false","mandatoryLabelBackground":"false","mandatoryLabelText":"false","allowNullValue":"false","skipTabStop":"false","disabled":"false","protected":"true","noMacroExpand":"false","readOnlyInit":"false","comboAutoUpdate":"false","comboNewValues":"false"},"textLineCount":"0","textInputFormat":"Text","properties":{"activeTextColor":"#eeeeee","flagItems":"E-mail customer^1|","disabledBackgroundColor":"#eeeeee"}}},{"general":{"name":"flg_updatepublic","type":"Field","flags":{"transparent":"true","xpStyle":"false","hasShadow":"false","toolbarButtonStyle":"false","cache":"false","hasBorder":"false","hasCheckbox":"false"}},"appearance":{"index":"9","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Trebuchet MS"},"borderStyle":"None"},"objectPlacement":{"position":{"top":"57","left":"409","right":"538","bottom":"75"},"scaling":{"top":"0","left":"50","right":"50","bottom":"0"}},"controlInfo":{"mouseOverCursor":"Window Default","type":"Form Flags","flags":{"invisible":"false","readOnly":"false","mandatory":"false","mandatoryLabelBackground":"false","mandatoryLabelText":"false","allowNullValue":"false","skipTabStop":"false","disabled":"false","protected":"true","noMacroExpand":"false","readOnlyInit":"false","comboAutoUpdate":"false","comboNewValues":"false"},"textLineCount":"0","textInputFormat":"Text","properties":{"activeTextColor":"#eeeeee","flagItems":"Update to be public^1|","disabledBackgroundColor":"#eeeeee"}}},{"general":{"name":"flg_chargeable","type":"Field","flags":{"transparent":"true","xpStyle":"false","hasShadow":"false","toolbarButtonStyle":"false","cache":"false","hasBorder":"false","hasCheckbox":"false"}},"appearance":{"index":"10","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Trebuchet MS"},"borderStyle":"None"},"objectPlacement":{"position":{"top":"96","left":"409","right":"550","bottom":"114"},"scaling":{"top":"0","left":"50","right":"50","bottom":"0"}},"controlInfo":{"mouseOverCursor":"Window Default","type":"Form Flags","flags":{"invisible":"false","readOnly":"false","mandatory":"false","mandatoryLabelBackground":"false","mandatoryLabelText":"false","allowNullValue":"false","skipTabStop":"false","disabled":"true","protected":"true","noMacroExpand":"false","readOnlyInit":"false","comboAutoUpdate":"false","comboNewValues":"false"},"textLineCount":"0","textInputFormat":"Text","properties":{"activeTextColor":"#eeeeee","flagItems":"Call to be chargeable^1|","disabledBackgroundColor":"#eeeeee","defaultValue":"0"}}},{"general":{"name":"flg_addKBase","type":"Field","flags":{"transparent":"true","xpStyle":"false","hasShadow":"false","toolbarButtonStyle":"false","cache":"false","hasBorder":"false","hasCheckbox":"false"}},"appearance":{"index":"11","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Trebuchet MS"},"borderStyle":"None"},"objectPlacement":{"position":{"top":"116","left":"409","right":"551","bottom":"135"},"scaling":{"top":"0","left":"50","right":"50","bottom":"0"}},"controlInfo":{"mouseOverCursor":"Window Default","type":"Form Flags","flags":{"invisible":"false","readOnly":"false","mandatory":"false","mandatoryLabelBackground":"false","mandatoryLabelText":"false","allowNullValue":"false","skipTabStop":"false","disabled":"true","protected":"true","noMacroExpand":"false","readOnlyInit":"false","comboAutoUpdate":"false","comboNewValues":"false"},"textLineCount":"0","textInputFormat":"Text","properties":{"activeTextColor":"#eeeeee","flagItems":"Add to KnowledgeBase^1|","disabledBackgroundColor":"#eeeeee"}}},{"general":{"name":"flg_customersurvey","type":"Field","flags":{"transparent":"true","xpStyle":"false","hasShadow":"false","toolbarButtonStyle":"false","cache":"false","hasBorder":"false","hasCheckbox":"false"}},"appearance":{"index":"12","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Trebuchet MS"},"borderStyle":"None"},"objectPlacement":{"position":{"top":"135","left":"409","right":"567","bottom":"156"},"scaling":{"top":"0","left":"50","right":"50","bottom":"0"}},"controlInfo":{"mouseOverCursor":"Window Default","type":"Form Flags","flags":{"invisible":"false","readOnly":"false","mandatory":"false","mandatoryLabelBackground":"false","mandatoryLabelText":"false","allowNullValue":"false","skipTabStop":"false","disabled":"false","protected":"true","noMacroExpand":"false","readOnlyInit":"false","comboAutoUpdate":"false","comboNewValues":"false"},"textLineCount":"0","textInputFormat":"Text","properties":{"activeTextColor":"#eeeeee","flagItems":"Send customer survey:^1|","disabledBackgroundColor":"#eeeeee"}}},{"general":{"name":"cb_surveys","type":"Field"},"appearance":{"index":"13","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Arial"},"borderStyle":"Rectangle"},"objectPlacement":{"position":{"top":"158","left":"413","right":"543","bottom":"176"},"scaling":{"top":"0","left":"50","right":"100","bottom":"0"}},"controlInfo":{"mouseOverCursor":"Window Default","type":"Pick List","flags":{"invisible":"false","readOnly":"false","mandatory":"false","mandatoryLabelBackground":"false","mandatoryLabelText":"false","allowNullValue":"false","skipTabStop":"false","disabled":"false","protected":"true","noMacroExpand":"false","readOnlyInit":"false","comboAutoUpdate":"false","comboNewValues":"true","useDDPickList":"false"},"textLineCount":"0","textInputFormat":"Text","properties":{"activeTextColor":"#eeeeee","disabledBackgroundColor":"#eeeeee","listItems":"First Survey|Second Survey|Third Survey|","borderColor":"#c0c0c0"}}},{"general":{"name":"Rect1","type":"Rectange","flags":{"transparent":"false","xpStyle":"false","hasShadow":"false","toolbarButtonStyle":"true","cache":"true","hasBorder":"false","hasCheckbox":"false"}},"appearance":{"index":"14","backgroundColor":"#d4d0c8","foregroundColor":"#dddddd","font":{"@size":"0"},"borderStyle":"Rectangle","fillStyle":"Solid"},"objectPlacement":{"position":{"top":"0","left":"-1","right":"565","bottom":"25"},"scaling":{"top":"0","left":"0","right":"100","bottom":"0"}},"controlInfo":{"mouseOverCursor":"Window Default"}},{"general":{"name":"cb_callaction","type":"Field"},"appearance":{"index":"15","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Arial"},"borderStyle":"Rectangle"},"objectPlacement":{"position":{"top":"4","left":"226","right":"387","bottom":"22"},"scaling":{"top":"0","left":"25","right":"25","bottom":"0"}},"controlInfo":{"mouseOverCursor":"Window Default","type":"Pick List","flags":{"invisible":"false","readOnly":"false","mandatory":"true","mandatoryLabelBackground":"false","mandatoryLabelText":"false","allowNullValue":"false","skipTabStop":"false","disabled":"false","protected":"true","noMacroExpand":"false","readOnlyInit":"false","comboAutoUpdate":"false","comboNewValues":"true","useDDPickList":"false"},"textLineCount":"0","textInputFormat":"Text","properties":{"activeTextColor":"#eeeeee","disabledBackgroundColor":"#eeeeee","listItems":"Close Call|Resolve Call|Close Call|Resolve Call|","borderColor":"#c0c0c0"}}},{"general":{"name":"btnGetProfileText","type":"EventButton","flags":{"transparent":"false","xpStyle":"true","hasShadow":"false","toolbarButtonStyle":"false","cache":"false","hasBorder":"false","hasCheckbox":"false"}},"appearance":{"index":"16","caption":"Add Profile Text","backgroundColor":"#ffffff","foregroundColor":"#0000ff","font":{"@size":"8","#text":"Arial"}},"objectPlacement":{"position":{"top":"190","left":"458","right":"550","bottom":"211"},"scaling":{"top":"0","left":"100","right":"100","bottom":"0"}},"controlInfo":{"mouseOverCursor":"Window Default","flags":{"invisible":"false","skipTabStop":"false","disabled":"false","protected":"true","noMacroExpand":"false","multiLine":"false"}}},{"general":{"name":"Tab1","type":"TabControl","flags":{"transparent":"true","xpStyle":"false","hasShadow":"false","toolbarButtonStyle":"false","cache":"false","hasBorder":"false","hasCheckbox":"false"}},"appearance":{"index":"17","caption":"Tab1","backgroundColor":"#ded7ce","foregroundColor":"#ffffff","font":{"@size":"8","#text":"Arial"},"borderStyle":"None"},"objectPlacement":{"position":{"top":"218","left":"7","right":"553","bottom":"399"},"scaling":{"top":"0","left":"0","right":"100","bottom":"100"}},"tabStyle":"Top","tabSize":"19","items":{"item":[{"name":"Description","properties":"56=#d1e0ee|_flags=0","textBorder":"None","textBackgroundColor":"#ffffff","controlInfo":{"mouseOverCursor":"Window Default","properties":{"tabColor":"#d1e0ee"}}},{"name":"File Attachment","properties":"56=#ffcc66|_flags=0","textBorder":"None","textBackgroundColor":"#ffffff","controlInfo":{"mouseOverCursor":"Window Default","properties":{"tabColor":"#ffcc66"}}}]},"selectedTextFont":{"@size":"8","#text":"Arial"},"selectedTextColor":"#000000","deselectedTextColor":"#000000","tabSlopeLeft":"2","tabSlopeRight":"2","deselectedTabHeightOffset":"1","tabSpacing":"0","controlInfo":{"mouseOverCursor":"Window Default","flags":{"invisible":"false","skipTabStop":"false","disabled":"false","protected":"true","noMacroExpand":"false","multiLine":"false"},"properties":{"tabStyle":"0"}}},{"general":{"name":"fl_attachments","type":"FileListTable","flags":{"transparent":"false","xpStyle":"false","hasShadow":"false","toolbarButtonStyle":"false","cache":"false","hasBorder":"false","hasCheckbox":"false","showHeader":"true","verticalGridLines":"true","horizontalGridLines":"true","autoLoad":"true","allowMultiSelect":"true"},"group":"Tab1:1"},"appearance":{"index":"18","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Arial"},"borderStyle":"Rectangle"},"objectPlacement":{"position":{"top":"246","left":"15","right":"473","bottom":"390"},"scaling":{"top":"0","left":"0","right":"100","bottom":"100"}},"columns":{"controlInfo":[{"mouseOverCursor":"Window Default","type":"Text Edit","flags":{"invisible":"false","readOnly":"false","mandatory":"false","mandatoryLabelBackground":"false","mandatoryLabelText":"false","allowNullValue":"false","skipTabStop":"false","disabled":"false","protected":"false","noMacroExpand":"false","readOnlyInit":"false","autoCompleteField":"false","editUnlimitedText":"false","url":"false","hidden":"false","allowResize":"true","allowSort":"true"},"textLineCount":"0","textInputFormat":"Text","name":"File Name","width":"160","image":"-1","dataColumn":"0"},{"mouseOverCursor":"Window Default","type":"Text Edit","flags":{"invisible":"false","readOnly":"false","mandatory":"false","mandatoryLabelBackground":"false","mandatoryLabelText":"false","allowNullValue":"false","skipTabStop":"false","disabled":"false","protected":"false","noMacroExpand":"false","readOnlyInit":"false","autoCompleteField":"false","editUnlimitedText":"false","url":"false","hidden":"false","allowResize":"true","allowSort":"true"},"textLineCount":"0","textInputFormat":"Text","name":"Size","width":"80","image":"-1","dataColumn":"1"},{"mouseOverCursor":"Window Default","type":"Text Edit","flags":{"invisible":"false","readOnly":"false","mandatory":"false","mandatoryLabelBackground":"false","mandatoryLabelText":"false","allowNullValue":"false","skipTabStop":"false","disabled":"false","protected":"false","noMacroExpand":"false","readOnlyInit":"false","autoCompleteField":"false","editUnlimitedText":"false","url":"false","hidden":"false","allowResize":"true","allowSort":"true"},"textLineCount":"0","textInputFormat":"Text","name":"Last Modified","width":"120","image":"-1","dataColumn":"2"},{"mouseOverCursor":"Window Default","type":"Text Edit","flags":{"invisible":"false","readOnly":"false","mandatory":"false","mandatoryLabelBackground":"false","mandatoryLabelText":"false","allowNullValue":"false","skipTabStop":"false","disabled":"false","protected":"false","noMacroExpand":"false","readOnlyInit":"false","autoCompleteField":"false","editUnlimitedText":"false","url":"false","hidden":"false","allowResize":"true","allowSort":"true"},"textLineCount":"0","textInputFormat":"Text","name":"Full Local Path","width":"100","image":"-1","dataColumn":"3"}]},"sortColumn":"-1","sortDescending":"false","headerHeight":"16","rowHeight":"16","selectedColor":"#00008b","selectedTextColor":"#ffffff","controlInfo":{"mouseOverCursor":"Window Default","flags":{"invisible":"false","skipTabStop":"false","disabled":"false","protected":"true","noMacroExpand":"false","multiLine":"false"},"properties":{"content":"NAME=css-bug-raising.gif;PATH=C:\\Documents and Settings\\NeilWJ\\My Documents\\css\\css-bug-raising.gif;SIZE=18746;LASTMODIFIED=1091525370","borderColor":"#c0c0c0"}}},{"general":{"name":"btnAddFile","type":"EventButton","flags":{"transparent":"false","xpStyle":"true","hasShadow":"false","toolbarButtonStyle":"false","cache":"false","hasBorder":"false","hasCheckbox":"false"},"group":"Tab1:1"},"appearance":{"index":"19","caption":"Add","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Arial"}},"objectPlacement":{"position":{"top":"243","left":"481","right":"545","bottom":"267"},"scaling":{"top":"0","left":"100","right":"100","bottom":"0"}},"controlInfo":{"mouseOverCursor":"Window Default","flags":{"invisible":"false","skipTabStop":"false","disabled":"false","protected":"true","noMacroExpand":"false","multiLine":"false"},"properties":{"commands":"74","eventButtonIcon":"74"}}},{"general":{"name":"btnRemove","type":"EventButton","flags":{"transparent":"false","xpStyle":"true","hasShadow":"false","toolbarButtonStyle":"false","cache":"false","hasBorder":"false","hasCheckbox":"false"},"group":"Tab1:1"},"appearance":{"index":"20","caption":"Remove","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Arial"}},"objectPlacement":{"position":{"top":"273","left":"481","right":"545","bottom":"297"},"scaling":{"top":"0","left":"100","right":"100","bottom":"0"}},"controlInfo":{"mouseOverCursor":"Window Default","flags":{"invisible":"false","skipTabStop":"false","disabled":"false","protected":"true","noMacroExpand":"false","multiLine":"false"}}},{"general":{"name":"btnResolveClose","type":"EventButton","flags":{"transparent":"false","xpStyle":"true","hasShadow":"false","toolbarButtonStyle":"true","cache":"true","hasBorder":"false","hasCheckbox":"false"}},"appearance":{"index":"21","caption":"Resolve Calls","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Trebuchet MS"}},"objectPlacement":{"position":{"top":"1","left":"7","right":"103","bottom":"24"},"scaling":{"top":"0","left":"0","right":"0","bottom":"0"}},"controlInfo":{"mouseOverCursor":"Window Default","flags":{"invisible":"false","skipTabStop":"false","disabled":"false","protected":"true","noMacroExpand":"false","multiLine":"false"},"properties":{"eventButtonIcon":"ImageList=Helpdesk Tools;IconIndex=6","eventButtonIconAlign":"0","backgroundColor":"#ff9900"}}},{"general":{"type":"FieldName","flags":{"transparent":"true","xpStyle":"false","hasShadow":"false","toolbarButtonStyle":"false","cache":"false","hasBorder":"false","hasCheckbox":"false"}},"appearance":{"index":"22","caption":"Action Source","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Trebuchet MS"},"alignment":"Right","borderStyle":"None","fillStyle":"Solid"},"objectPlacement":{"position":{"top":"94","left":"9","right":"82","bottom":"106"},"scaling":{"top":"0","left":"0","right":"0","bottom":"0"}},"data":{"binding":"updatedb.udsource"},"controlInfo":{"mouseOverCursor":"Window Default"}},{"general":{"name":"LabelCode","type":"FieldName","flags":{"transparent":"true","xpStyle":"false","hasShadow":"false","toolbarButtonStyle":"false","cache":"false","hasBorder":"false","hasCheckbox":"false"}},"appearance":{"index":"23","caption":"Action Type","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Trebuchet MS"},"alignment":"Left","borderStyle":"None","fillStyle":"Solid"},"objectPlacement":{"position":{"top":"94","left":"225","right":"291","bottom":"106"},"scaling":{"top":"0","left":"25","right":"25","bottom":"0"}},"data":{"binding":"updatedb.udcode"},"controlInfo":{"mouseOverCursor":"Window Default"}},{"general":{"name":"Text1","type":"Text","flags":{"transparent":"true","xpStyle":"false","hasShadow":"false","toolbarButtonStyle":"false","cache":"false","hasBorder":"false","hasCheckbox":"false"}},"appearance":{"index":"24","caption":"Date\/Time of Action","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Trebuchet MS"},"alignment":"Left","borderStyle":"None","fillStyle":"Solid"},"objectPlacement":{"position":{"top":"57","left":"8","right":"120","bottom":"71"},"scaling":{"top":"0","left":"0","right":"0","bottom":"0"}},"controlInfo":{"mouseOverCursor":"Window Default"}},{"general":{"name":"Label2","type":"FieldName","flags":{"transparent":"true","xpStyle":"false","hasShadow":"false","toolbarButtonStyle":"false","cache":"false","hasBorder":"false","hasCheckbox":"false"}},"appearance":{"index":"25","caption":"Time Spent","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Trebuchet MS"},"alignment":"Left","borderStyle":"None","fillStyle":"Solid"},"objectPlacement":{"position":{"top":"57","left":"225","right":"289","bottom":"71"},"scaling":{"top":"0","left":"25","right":"25","bottom":"0"}},"data":{"binding":"updatedb.timespent"},"controlInfo":{"mouseOverCursor":"Window Default"}},{"general":{"name":"ResolProfile","type":"Text","flags":{"transparent":"true","xpStyle":"false","hasShadow":"false","toolbarButtonStyle":"false","cache":"false","hasBorder":"false","hasCheckbox":"false"}},"appearance":{"index":"26","caption":"Resolution Profile","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Trebuchet MS"},"alignment":"Left","borderStyle":"None","fillStyle":"Solid"},"objectPlacement":{"position":{"top":"140","left":"8","right":"208","bottom":"154"},"scaling":{"top":"0","left":"0","right":"0","bottom":"0"}},"controlInfo":{"mouseOverCursor":"Window Default"}},{"general":{"name":"mbtnAddFile","type":"EventButton","flags":{"transparent":"false","xpStyle":"true","hasShadow":"false","toolbarButtonStyle":"true","cache":"true","hasBorder":"false","hasCheckbox":"false"}},"appearance":{"index":"27","caption":"Attach File","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Arial"}},"objectPlacement":{"position":{"top":"1","left":"457","right":"538","bottom":"24"},"scaling":{"top":"0","left":"100","right":"100","bottom":"0"}},"controlInfo":{"mouseOverCursor":"Window Default","flags":{"invisible":"false","skipTabStop":"false","disabled":"false","protected":"true","noMacroExpand":"false","multiLine":"false"},"properties":{"commands":"74","eventButtonIcon":"74","backgroundColor":"#ff9900"}}},{"general":{"name":"LabelAction","type":"Text","flags":{"transparent":"true","xpStyle":"false","hasShadow":"false","toolbarButtonStyle":"false","cache":"false","hasBorder":"false","hasCheckbox":"false"}},"appearance":{"index":"28","caption":"Call Action:","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Trebuchet MS"},"alignment":"Left","borderStyle":"None","fillStyle":"Solid"},"objectPlacement":{"position":{"top":"2","left":"161","right":"223","bottom":"25"},"scaling":{"top":"0","left":"25","right":"25","bottom":"0"}},"controlInfo":{"mouseOverCursor":"Window Default","flags":{"invisible":"false","skipTabStop":"false","disabled":"false","protected":"true","noMacroExpand":"false","multiLine":"false"}}},{"general":{"name":"cp_summary","type":"CaptionBar","flags":{"transparent":"true","xpStyle":"false","hasShadow":"false","toolbarButtonStyle":"false","cache":"false","hasBorder":"true","hasCheckbox":"false"}},"appearance":{"index":"29","caption":"Other Information","backgroundColor":"#f1f1f1","foregroundColor":"#003366","font":{"@size":"10","@bold":"1","#text":"Trebuchet (MS)"},"alignment":"Left","fillStyle":"Vertical Gradient"},"objectPlacement":{"position":{"top":"189","left":"3","right":"557","bottom":"405"},"scaling":{"top":"0","left":"0","right":"100","bottom":"100"}},"controlInfo":{"mouseOverCursor":"Window Default","properties":{"backgroundColor2":"#d8d8d8","imageHSpace":"10","slope":"12","borderColor":"#d3c9b6","headerHeight":"23","hasBorder":"1","panelBorderColor":"#d3c9b6","fillStyle":"0","panelBackgroundColor":"#f2eedd","panelBackgroundColor2":"#000000"}}},{"general":{"name":"CaptionPanel3","type":"CaptionBar","flags":{"transparent":"true","xpStyle":"false","hasShadow":"false","toolbarButtonStyle":"false","cache":"false","hasBorder":"true","hasCheckbox":"false"}},"appearance":{"index":"30","caption":"Options","backgroundColor":"#f1f1f1","foregroundColor":"#003366","font":{"@size":"10","@bold":"1","#text":"Trebuchet (MS)"},"alignment":"Left","fillStyle":"Vertical Gradient"},"objectPlacement":{"position":{"top":"29","left":"403","right":"557","bottom":"183"},"scaling":{"top":"0","left":"50","right":"100","bottom":"0"}},"controlInfo":{"mouseOverCursor":"Window Default","properties":{"backgroundColor2":"#d8d8d8","imageHSpace":"10","slope":"12","borderColor":"#d3c9b6","headerHeight":"23","hasBorder":"1","panelBorderColor":"#d3c9b6","fillStyle":"0","panelBackgroundColor":"#f2eedd","panelBackgroundColor2":"#000000"}}}]},"javascript":{"methods":{"method":[{"name":"OnFormLoaded","code":"OnFormLoaded()\n{\n\t\/\/-- NWJ - setup mainform properties and elements\n\tapp._ete(tb_fixcodedescription, \"\");\n\t\t\n\t_swdoc.setup_form_mode();\n\t\n\t_swdoc.setup_call_action();\n\t\t\n\t_swdoc.setup_email_flag()\n\n\t_swdoc.setup_public_flag();\n\n\t_swdoc.setup_survey_options();\n\n\t\/\/-- reset call actions list\n\t\/\/-- then populate with options based on analyst permissions\n\n\t\/\/-- set updatetime\t\n\t_swdoc.updatedb.updatetimex = app.global.GetCurrentEpocTime();\n\t\t\n\t\/\/-- if we have update text (from an email i guess) apply it\n\tif(_swdoc.strUpdateText.length) _swdoc.updatedb.updatetxt = _swdoc.strUpdateText;\n\t\n\t\/\/-- if came from E-mail set source as email\n\tif(_swdoc.boolSourceEmail)\n\t{\n\t\t_swdoc.updatedb.udsource = 'E-mail'; \n\t}\n\t\n\t\n\t_swdoc.UpdateFormFromData();\n\t_swdoc.setup_resolution_profile();\n\t\t\n\n\t\n}"},{"name":"btnBrowseProfile_OnPressed","code":"btnBrowseProfile_OnPressed()\n{\n\t\/\/-- get resolution profile filter\n\t\n\t\/\/-- NWJ - 29.06.2006 - get close filter or resolve filter depending on call closure option (requested by Dan 47766)\n\tif (cb_callaction.text == \"Resolve Call\")\n\t{\n\t\tvar Filter = dd.GetGlobalParamAsString(\"Close Call Form\/ResolveProfileFilter\");\n\t}\n\telse if (cb_callaction.text == \"Close Call\")\n\t{\n\t\tvar Filter = dd.GetGlobalParamAsString(\"Close Call Form\/CloseProfileFilter\");\n\t}\n\telse\n\t{\n\t\tvar Filter = dd.GetGlobalParamAsString(\"Close Call Form\/ProfileCodeFilter\");\n\t}\n\t\n\tvar pc = new ChooseProfileCodeDialog;\n\t\/\/-- default analyst permission to auto fill the resolution text on resolve\/close call is set\n\n    pc.useDescriptionText =  app.session.IsDefaultOption(ANALYST_DEFAULT_AUTOFILLRESOLUTIONTEXT); \n    \n    pc.Open(true, true, _swdoc.opencall.fixcode, Filter, function(objPC)\n\t{\n\t\tif (typeof objPC == \"object\")\n\t\t{\n\t\t \t\/\/-- Get the fix code and split it into an array\n\t\t\tvar strCodeDesc = objPC.codeDescription;\n\t\t\tvar strCode = objPC.code;\n\t\t\t\n\t\t\t\/\/-- If no codes are found then stop or same as current code\n\t\t\tif(strCode==_swdoc.opencall.fixcode) return;\n\t\t\t\n\t\t\t\/\/-- F0092364\n\t\t\tif(strCode==\"\")\n\t\t\t{\n\t\t\t\t_swdoc.opencall.fixcode = \"\";       \n\t\t\t\tapp._ete(tb_fixcodedescription , \"\");\n\t\t\t\t_swdoc.bUserSelectedFixCode = true;\n\t\t\t\tapp._een(btnGetProfileText ,false);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t\n\t\t\t\/\/-- Set the text in the resolution profile text box\n\t\t\t\/\/-- 08.02.2007 - NWJ - set the opencall record value instead of the element name \n\t\t\t_swdoc.opencall.fixcode = strCode;       \n\t\t\tapp._ete(tb_fixcodedescription , strCodeDesc);\n\t\t\t_swdoc.bUserSelectedFixCode = true;\n\t\t\t\n\t\t\t\/\/-- Attempt to add the resolution profile description to the Action Description box if the\n\t\t\t\/\/-- default analyst permission to auto fill the resolution text on resolve\/close call is set\n\t\t\tif(objPC.useDescriptionText)\n\t\t\t{\n\t\t\t\t\/\/-- 08.02.2007 - NWJ - set the opencall record value instead of the element name \n\t\t\t\tvar strCurrentUpdateText = _swdoc.updatedb.updatetxt;\n\t\t\t\t\n\t\t\t\tif(objPC.description.length)\n\t\t\t\t{\n\t\t\t\t\t\/\/if(tb_updatetext.text.length)\n\t\t\t\t\tif(strCurrentUpdateText.length)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar Message = \"You have chosen to transfer the default profile text into the description field of the close call form. However, you have already entered some text into this field. Do you want to append the text you have typed?\\n\\nTo append the default text to the text you have already typed, click Yes\\nTo transfer the default text and overwrite what you have already typed, click No\\nTo ignore the default text and leave the text you have typed alone, click Cancel\";\n\t\t\t\t\t\tswitch(MessageBox(Message, MB_ICONQUESTION | MB_YESNOCANCEL))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tcase IDYES:\n\t\t\t\t\t\t\t\tif(_swdoc.updatedb.updatetxt.length)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\t\/\/-- add a line feed\n\t\t\t\t\t\t\t\t\t\t\t\tstrCurrentUpdateText += \"\\r\\n\";\n\t\t\t\t\t\t\t\t\t\t\t\t\/\/tempText = _swdoc.updatedb.updatetxt + \"\\r\\n\"; \n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tstrCurrentUpdateText += objPC.description;\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tcase IDNO:\n\t\t\t\t\t\t\t\tstrCurrentUpdateText = objPC.description;\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tcase IDCANCEL:\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tstrCurrentUpdateText = objPC.description;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\/\/-- add back to update record\n\t\t\t\t_swdoc.updatedb.updatetxt = strCurrentUpdateText;\n\t\t\t\t_swdoc.UpdateFormFromData();        \n\t\t\t}\n\t\n\t\t\t\/\/-- if we are working with webclient\n\t\t\tif(app.bWebClient)\n\t\t\t{\n\t\t\t\t\t\t\tapp._een(btnGetProfileText , false);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\t\/\/-- enable \/ disable button if it has text\n\t\t\t\tapp._een(btnGetProfileText ,(objPC.description!=\"\"));\n\t\n\t\t\t\t\/\/btnGetProfileText.enable = (_swdoc.updatedb.updatetxt? true:false);\n\t\t\t}\n\t\t}\n\t});\n}"},{"name":"btnRemove_OnPressed","code":"btnRemove_OnPressed()\n{\n\t\/\/ -- remove selected files\n\tfor(i=fl_attachments.rowCount()-1; i>=0;i--)\n    {\n    \tif(fl_attachments.IsRowSelected(i))\n    \t{\n    \t\t\/\/-- remove\n    \t\tfl_attachments.RemoveRow(i);\n    \t}\n    }\n\n}"},{"name":"btnGetProfileText_OnPressed","code":"btnGetProfileText_OnPressed()\n{\n\tvar funcProcessing = function()\n\t{\t\t\t\n\t\t\/\/-- get resolution profile description\t\n\t\tvar currentResProfileDesc = app.global.GetResolutionProfileDescription(_swdoc.opencall.fixcode);\n\t\t_swdoc.updatedb.updatetxt = currentResProfileDesc.strDescription;\n\t\t_swdoc.UpdateFormFromData();\n\t}\n\t\n\tif(_swdoc.updatedb.updatetxt.length)\n\t{\n\t\tMessageBox(\"If you retrieve the default text description from the profile database you will overwrite the current Action Description text.\\n\\nDo you wish to continue?\", MB_ICONQUESTION | MB_YESNO,function(intDecision)\n\t\t{\t\t\n\t\t\tif(intDecision != IDYES)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tfuncProcessing();\n\t\t});\t\n\t}\n\telse\n\t{\n\t\tfuncProcessing();\n\t}\n}"},{"name":"checkCustomerSurvey_OnValueChanged","code":"checkCustomerSurvey_OnValueChanged(strValue)\n{\n\tvar bChecked = checkCustomerSurvey.text == \"1\";\n\tapp._een(Surveys , bChecked);\n}"},{"name":"(User Defined Functions)","code":"\n\/\/-- function to check that user has selected correct number of profile codes\nfunction check_profile_levels()\n{\n\t\/\/-- get the number of profile levels the analyst HAS to choose\n\tvar nLevelNeeded = app.session.GetCloseProfileLevelRequired();\n\n\t\/\/-- determine the number of Profile levels the user has selected\n\t\/\/-- NWJ - can we turn this into a app.global.i.e. app.global.returnProfileLevelCount(strProfileCode);\n\tvar strTempProfileCodes = new String(_swdoc.opencall.fixcode);\n\tvar nLevels = 0;\n\twhile(strTempProfileCodes.indexOf('-') != -1)\n\t{\n\t\tnLevels++;\n\t\tstrTempProfileCodes = strTempProfileCodes.substr((strTempProfileCodes.indexOf('-')+1),strTempProfileCodes.length);\n\t}\n\t\n\tif(strTempProfileCodes.length)nLevels++;\n\t\n\t\/\/-- If insufficient profile levels are specified then alert the user\n\tif(nLevels < nLevelNeeded)\n\t{\n\t\tMessageBox(\"You must profile this call resolution. Your access control rights require you to choose at least \" + nLevelNeeded + \" profile level(s)\", MB_ICONSTOP);\n\t\treturn false;\n\t}\n\t\n\treturn true;\n}\n\n\/\/ -- Prompt user to confirm Resolve\/Close\nfunction confirm_resolve_close(funcCallback)\n{\n\t\/\/ -- Resolving\t\n\tif(!_swdoc.boolClosing)\n\t{\n\t\t\/\/ -- Have un auth calls - warn that they will not be able to resolve only close\n\t\tif(_swdoc.boolUnAuthorisedCalls)\n\t\t{\n\t\t\tMessageBox(\"One or more of the calls can not be resolved because they have not been authorised.\", MB_ICONSTOP);\n\t\t\treturn false;\n\t\t}\n\t\t\n\t\tvar strMsg = _swdoc.arrCallrefs.length >1 ? \"Are you sure you want to resolve these calls?\" : \"Are you sure you want to resolve this call?\";\n\t\tMessageBox(strMsg, MB_ICONQUESTION | MB_YESNO, function(intDecision)\n\t\t{\n\t\t\t\/\/ -- Get the response from MessageBox and pass it back to callback variable\n\t\t\tif(intDecision!=IDYES)\n\t\t\t{\n\t\t\t\tfuncCallback(false);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tfuncCallback(true);\n\t\t\t}\n\t\t});\n\t}\n\telse\n\t{\n\t\t\/\/ -- Closing\n\t\tvar strMsg = \"\";\n\t\tif(_swdoc.arrCallrefs.length > 1)\n\t\t\tstrMsg = \"Are you sure you want to close these calls?\";\n\t\telse\n\t\t\tstrMsg = \"Are you sure you want to close this call?\";\n\n\t\tMessageBox(strMsg, MB_ICONQUESTION | MB_YESNO, function(intDecision)\n\t\t{\n\t\t\t\/\/ -- Get the response from MessageBox and pass it back to callback variable\n\t\t\tif(intDecision!=IDYES)\n\t\t\t{\n\t\t\t\tfuncCallback(false);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tfuncCallback(true);\n\t\t\t}\n\t\t});\t\t\n\t}\n}\n\n\/\/-- add call to kbase\nfunction add_call_to_knowledgebase()\n{\n\tvar strProbText = \"\";\n\tvar strProbCode = \"\";\n\tvar nFirstCallref = _swdoc.arrCallrefs[0];\n\t\/\/-- get the problem text and problem code from updatedb\/opencall\n\t\n\tvar aRSInfo = new SqlQuery;\n\taRSInfo.Query(\"SELECT updatetxt, probcode FROM updatedb,opencall WHERE udindex = 0 AND updatedb.callref = opencall.callref and opencall.callref = \" + nFirstCallref, \"sw_systemdb\");\n\tif(aRSInfo.Fetch())\n\t{\n\t\tstrProbText = aRSInfo.GetValueAsString(0);\n\t\tstrProbCode = aRSInfo.GetValueAsString(1);\t\t\n\t}\n\taRSInfo.Reset();\t\n\t\n\t\/\/-- call api\n\t\/\/MessageBox(\"Add KB \" + _swdoc.updatedb.updatetxt)\n   \tapp.global.AddResolutionToKnowledgeBase(strProbText, strProbCode, _swdoc.updatedb.updatetxt, _swdoc.opencall.fixcode, nFirstCallref);\n}\n\n\/\/--\n\/\/-- resolve or close the call\nfunction ResolveClose()\n{\t\n\t\/\/ -- Validate the form\n\tif(!_swdoc.ValidateForm())\n\t\treturn false;\n\t\n\t\/\/ -- Check profile levels\n\tif(!mainform.check_profile_levels())\n\t{\n\t\treturn false;\n\t}\n\t\n\t\/\/ -- Confirm\n\tmainform.confirm_resolve_close(function(boolResponse)\n\t{\n\t\tif(!boolResponse)\n\t\t{\n\t\t\t\/\/ -- Did not Confirm to Resolve\/Close call\n\t\t\treturn false;\n\t\t}\n\t\telse\n\t\t{\n\t\t\t\/\/ -- Confirmed to Resolve\/Close call\n\t\t\t\n\t\t\t\/\/ -- Determine status\n\t\t\tvar nStatus = CS_CLOSED;\n\t\t\tif(!_swdoc.boolClosing)\n\t\t\t{\n\t\t\t\tnStatus = CS_RESOLVED;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tif(flg_chargeable.text == \"1\")\tnStatus = CS_CLOSEDCHARGABLE;\n\t\t\t}\n\t\t\t\n\t\t\t\/\/ -- Check that analyst has sufficient rights to resolve a call\n\t\t\tif ((nStatus == CS_RESOLVED) && (!app.session.HaveRight(ANALYST_RIGHT_A_GROUP,ANALYST_RIGHT_A_CANRESOLVECALLS)))\n\t\t\t{\n\t\t\t\tMessageBox(\"You don't have sufficient rights to resolve a call. Please contact your system administrator\",MB_ICONSTOP);\t\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\t\n\t\t\t\/\/ -- Check that analyst has sufficient rights to close a call\n\t\t\tif (((nStatus == CS_CLOSED) ||( nStatus == CS_CLOSEDCHARGABLE)) && (!app.session.HaveRight(ANALYST_RIGHT_A_GROUP,ANALYST_RIGHT_A_CANCLOSECALLS)))\n\t\t\t{\n\t\t\t\tMessageBox(\"You don't have sufficient rights to close a call. Please contact your system administrator\",MB_ICONSTOP);\t\n\t\t\t\treturn false;\n\t\t\t}\t\n\t\t\t\t\n\t\t\t\/\/ -- Handle the Web Client\n\t\t\tif((app.bWebClient && app.global==undefined)&&(_swdoc.boolClosing))\n\t\t\t{\n\t\t\t\tnStatus = CS_CLOSED;\n\t\t\t\tflg_chargeable.text == \"0\";\n\t\t\t}\n\t\t\t\/\/ -- Check if we should send a Survey\t\n\t\t\tvar bSendSurveyToCustomer = false;\n\t\t\tvar SurveyID = 0;\n\t\t\tvar SurveyName = \"\";\n\t\t\tif(app.global.IsSurveyModuleEnabled() && flg_customersurvey.text == \"1\" && cb_surveys.text.length)\n\t\t\t{\n\t\t\t\t\/\/ -- Get surveyId from the SurveyNameSurvIdMap\n\t\t\t\tSurveyName = cb_surveys.text;\t\t\n\t\t\t\tSurveyID = _swdoc.arrSurveyNameSurvIDs[SurveyName]; \n\t\t\t\tif(SurveyID!=undefined)\n\t\t\t\t\tbSendSurveyToCustomer = true;\n\t\t\t\n\t\t\t\t\/\/ -- Determined that a Survey should be sent to the customer\n\t\t\t\tif (bSendSurveyToCustomer)\n\t\t\t\t{\n\t\t\t\t\t\/\/ -- Send a Survey using survey::sendCustomerCallSurvey API\n\t\t\t\t\tvar xmlmccs = new XmlMethodCall;\n\t\t\t\t\txmlmccs.SetValue(\"surveyId\", SurveyID);\n\t\t\t\t\tvar arrCallrefs = _swdoc.CallrefsCommaString;\n\t\t\t\t\tfor(x in arrCallrefs)\n\t\t\t\t\t\txmlmccs.SetValue(\"callref\", arrCallrefs[x]);\n\t\t\t\t\t\/\/ -- Invoke XMLMC API\n\t\t\t\t\tif(!xmlmccs.Invoke(\"survey\",\"sendCustomerCallSurvey\"))\n\t\t\t\t\t{\n\t\t\t\t\t\t\/\/ -- Failed to Invoke XMLMC API\n\t\t\t\t\t\t\/\/ -- Display the error message\n\t\t\t\t\t\t(app.bWebClient)? MessageBox(xmlmccs._lastresult):MessageBox(xmlmccs.GetReturnXml());\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\t\/\/ -- Find modified values in OPENCALL table\n\t\t\tvar boolUpdatedValues = true;\n\t\t\tvar arrUpdateCallValues = new Array();\n\t\t\tvar strUpdateCallValues = \"\";\n\t\t\tif(rec = _swdoc.GetRecord(\"opencall\"))\n\t\t\t{\n\t\t\t\tvar nColCount = rec.GetCount();\n\t\t\t\tfor(x = 0; x < nColCount; x++)\n\t\t\t\t{\n\t\t\t\t\tif(!rec.IsModified(x))\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\tif(!_swdoc.bUserSelectedFixCode && rec.GetColumnName(x)==\"fixcode\") \n\t\t\t\t\t\tcontinue;\n\t\t\t\t\tarrUpdateCallValues[rec.GetColumnName(x)] = rec.GetValue(x);\n\t\t\t\t}\n\t\t\t}\n\t\t\tfor (fieldName in arrUpdateCallValues)\n\t\t\t{\n\t\t\t\tstrUpdateCallValues += \"<\"+fieldName+\">\"+ app.global.PrepareForXML(arrUpdateCallValues[fieldName])+\"<\/\"+fieldName+\">\";\n\t\t\t}\n\t\t\t\/\/ -- Update call values using XMLMC API if we found modified values in OPENCALL table \n\t\t\tif(strUpdateCallValues!=\"\")\n\t\t\t{\n\t\t\t\tstrUpdateCallValues = \"<opencall>\"+strUpdateCallValues+\"<\/opencall>\";\n\t\t\t\tvar arrCallrefs = _swdoc.CallrefsCommaString.split(\",\");\n\t\t\t\t\/\/ -- Update call values using helpdesk::updateCallValues API \t\t\n\t\t\t\tvar strMethod = \"updateCallValues\";\n\t\t\t\tfor(var refCount = 0; refCount < arrCallrefs.length; refCount++)\n\t\t\t\t{\n\t\t\t\t\tvar xmlmc = new XmlMethodCall;\n\t\t\t\t\txmlmc.SetValue(\"callref\", arrCallrefs[refCount]);\n\t\t\t\t\txmlmc.SetParamAsComplexType(\"additionalCallValues\", strUpdateCallValues);\t\n\t\t\t\t\tif(xmlmc.Invoke(\"helpdesk\", strMethod))\n\t\t\t\t\t{\n\t    \t\t\t\tvar strXML = (app.bWebClient)? xmlmc._lastresult:xmlmc.GetReturnXml();\n\t\t\t\t\t\tvar objRes = app.XMCResult(strXML);\n\t\t\t\t\t\tif(!objRes.success)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tboolUpdatedValues = false;\n\t\t\t\t\t\t\tMessageBox(\"The \" + strMethod + \" API method was rejected by the server.\");\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tboolUpdatedValues = false;\n\t\t\t\t\t\t(app.bWebClient)? MessageBox(xmlmc._lastresult):MessageBox(xmlmc.GetReturnXml());\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\t\/\/ -- Resolve\/Close the call using XMLMC API\n\t\t\tvar xmlmc = new XmlMethodCall;\n\t\t\t\/\/ -- API method\n\t\t\tvar strMethod = \"closeCalls\";\n\t\t\tif(nStatus == CS_RESOLVED)\n\t\t\t\tstrMethod = \"resolveCalls\";\n\t\t\t\/\/ -- Find modified values in UPDATEDB table\n\t\t\tvar arrExtraUpdateDbValues = new Array();\n\t\t\tvar strUpdateDbValues = \"\";\n\t\t\tif(rec = _swdoc.GetRecord(\"updatedb\"))\n\t\t\t{\n\t\t\t\tvar nColCount = rec.GetCount();\n\t\t\t\tfor(x = 0; x < nColCount; x++)\n\t\t\t\t{\n\t\t\t\t\tif(!rec.IsModified(x) && rec.GetColumnName(x)!='udsource' && rec.GetColumnName(x)!='udcode')\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\tarrExtraUpdateDbValues[rec.GetColumnName(x)] = rec.GetValue(x);\n\t\t\t\t}\n\t\t\t}\n\t\t\tfor (fieldName in arrExtraUpdateDbValues)\n\t\t\t{\n\t\t\t\tstrUpdateDbValues += \"<\"+fieldName+\">\"+ app.global.PrepareForXML(arrExtraUpdateDbValues[fieldName])+\"<\/\"+fieldName+\">\";\n\t\t\t}\n\t\t\t\n\t\t\t\/\/ -- Workout \"timeOfAction\" value\n\t\t\tvar strBackDate = _swdoc.nBackdatePeriod;\n\t\t\tif(strBackDate==0 && _swdoc.boolSetToMaxBackdatePeriod)\n\t\t\t{\n\t\t\t\tstrBackDate = app.global.GetCurrentEpocTime() - app.session.GetMaxBackdatePeriodAllowed();\n\t\t\t}\n\t\t\t\n\t\t\t\/\/ ** API params ** \/\/\n\t\t\tvar arrCallrefs = _swdoc.CallrefsCommaString.split(\",\");\n \t\t\tfor(x in arrCallrefs)\n\t\t\t\txmlmc.SetValue(\"callref\", arrCallrefs[x]);\n\t\t\txmlmc.SetValue(\"timeSpent\", mainform.tb_timespent.value);\n\t\t\txmlmc.SetValue(\"description\", rec.updatetxt);\n\t\t\tif(strBackDate!=0) xmlmc.SetValue(\"timeOfAction\", app.global.GetAsISO8601TimeString(strBackDate));\n\t\t\tvar boolPublicUpdate = (flg_updatepublic.text == \"1\" )? true : false;\n\t\t\txmlmc.SetValue(\"publicUpdate\", boolPublicUpdate);\n\t\t\tif(rec.udsource!=\"\")\n\t\t\t\txmlmc.SetValue(\"updateSource\", rec.udsource);\n\t\t\tif(rec.udcode!=\"\")\n\t\t\t\txmlmc.SetValue(\"updateCode\", rec.udcode);\n\t\t\t\n\t\t\tapp.itsm.addAttachmentsToCallXmlmc(mainform.fl_attachments, xmlmc);\n\t\t\t\n\t\t\tif(strUpdateDbValues!=\"\")\n\t\t\t\txmlmc.SetParamAsComplexType(\"extraUpdateDbValues\", strUpdateDbValues);\t\n\t\t\t\/\/ ** EO API params ** \/\/\n\t\t\t\n\t\t\t\/\/-- function required for modeless email template dialog\n\t\t\tvar funcCloseForm = function()\n\t\t\t{\n\t\t\t\t\/\/ -- Close Form\n\t\t\t\t_swdoc.boolFormFieldChanged = false;\n\t\t\t\t_swdoc.resetData();    \t\t\t\n    \t\t\t_swdoc.CloseForm();\n    \t\t\treturn true;\t\n    \t\t}\n\t\t\t\n\t\t\t\n\t\t\t\/\/ -- Invoke XMLMC API\n\t\t\tif(xmlmc.Invoke(\"helpdesk\",strMethod))\n\t\t\t{\n\t\t\t\tvar strXML = (app.bWebClient)? xmlmc._lastresult:xmlmc.GetReturnXml();\n\t\t\t\tvar objRes = app.XMCResult(strXML);\n\t\t\t\tif(!objRes.success)\n\t\t\t\t{\n\t\t\t\t\tMessageBox(\"The \" + strMethod + \" API method was rejected by the server.\");\n\t\t\t\t\treturn false;\n\t    \t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tvar myXmlFile = new XmlFile(); \n\t\t\t\t\tbRet = myXmlFile.loadFromString(strXML); \n\t\t\t\t\tvar arrChildCallInfo = null;\n\t\t\t\t\tvar arrCallInfo = new Array();\n\t\t\t\t\tvar strDocs = \"\";\n\t\t\t\t\tfor (count = 0; count < myXmlFile.methodCallResult.params.length; count ++) \n\t\t\t\t\t{\n\t\t\t\t\t\tif(myXmlFile.methodCallResult.params[count].nodeName==\"callActionStatus\")\n\t\t\t\t\t\t{  \n\t\t\t\t\t\t\tvar boolSuccess = myXmlFile.methodCallResult.params[count]['success'].nodeValue;\n\t\t\t\t\t\t\tif(boolSuccess==\"false\")\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tvar strMessage =  myXmlFile.methodCallResult.params[count]['message'].nodeValue;\n\t\t\t\t\t\t\t\tMessageBox(strMessage);\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tvar strCallref = myXmlFile.methodCallResult.params[count]['callref'].nodeValue;\n\t\t\t\t\t\t\tvar strIndex = myXmlFile.methodCallResult.params[count]['udIndex'].nodeValue;\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tarrCallInfo[strCallref] = strIndex;\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if(myXmlFile.methodCallResult.params[count].nodeName==\"callFileAttachment\")\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar intCount = app.array_count(arrCallInfo);\n\t\t\t\t\t\t\tif(intCount==1)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\ttry\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tvar updateId = myXmlFile.methodCallResult.params[count]['updateId'].nodeValue;\n\t\t\t\t\t\t\t\t\tif(updateId==arrCallInfo[strCallref])\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tvar pathName = myXmlFile.methodCallResult.params[count]['pathName'].nodeValue;\n\t\t\t\t\t\t\t\t\t\tvar fileName = myXmlFile.methodCallResult.params[count]['fileName'].nodeValue;\n\t\t\t\t\t\t\t\t\t\tvar fileSize = myXmlFile.methodCallResult.params[count]['fileSize'].nodeValue;\n\t\t\t\t\t\t\t\t\t\tif(strDocs!=\"\") strDocs +=\"\\r\\n\";\n\t\t\t\t\t\t\t\t\t\tstrDocs +='displayname=\"'+fileName+'\"; path=\"'+pathName+'\"; size=\"'+fileSize+'\";';\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tcatch(e)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\/\/ --\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\t\/\/-- add knowledge base\tbut only if we have one call\n    \t\t\t\tif((flg_addKBase.text == \"1\") && (_swdoc.arrCallrefs.length == 1))\n    \t\t\t\t{\n    \t\t\t\t\tadd_call_to_knowledgebase();\n    \t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\t\/\/ If we have been invoked to update a call from an e-mail message, this update will \n\t\t\t\t\t\/\/ only relate to a single call. We can only handle e-mail audit trail if we are working\n\t\t\t\t\t\/\/ on a single-call update. \n\t\t\t\t\tif(arrCallrefs.length == 1 && \t\t\t\/\/ Are we only dealing with a single call reference?\n\t\t\t\t\t\t_swdoc._form[\"messagesource\"] && \t\/\/ Are we working from an e-mail message?\n\t\t\t\t\t\tdd.GetGlobalParamAsNumber(\"Email Audit Trail\/StoreEmailAuditTrail\")) \/\/ Are we configured?\n\t\t\t\t\t{\n\t\t\t\t\t\tapp.g.attach_message_to_call(_swdoc._form,arrCallrefs[0],arrCallInfo[arrCallrefs[0]]);\n\t\t\t\t\t}\n\t\t\t\n    \t\t\t\t\/\/ if we want to send an email to the customer AND there are file attachments, obtain the \n    \t\t\t\t\/\/ attachments to attach to the email as well\n    \t\t\t\tvar flSessionFilesInfo = \"\";\n    \t\t\t\tif(mainform.flg_emailcustomer.value && app.global.IsConnectedToMailServer())\n    \t\t\t\t{\n\t\t\t\t\t\t\/\/ Now, compose an email to the customer\t\t\t\t\n\t\t\t\t\t\tapp.global.ComposeCallUpdateEmail(arrCallInfo, \t\t\t\t\t\/\/ Array: Call reference-UdIndex\n\t\t\t\t\t\t\t\t\t\t\t\t_swdoc.updatedb.updatetxt, \t\/\/ Message text\n\t\t\t\t\t\t\t\t\t\t\t\tstrDocs, \t\t\/\/ File attachments\n\t\t\t\t\t\t\t\t\t\t\t\t_swdoc.updatedb.timespent,\n\t\t\t\t\t\t\t\t\t\t\t\t\"CloseCallMailTemplate\", \t\t\/\/ Template name\n\t\t\t\t\t\t\t\t\t\t\t\tTEMPLATE_CLOSECALL,\t\t\t\t\/\/ Template type\n\t\t\t\t\t\t\t\t\t\t\t\tfunction()\n\t\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\t\tfuncCloseForm();\n\t\t\t\t\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tfuncCloseForm();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\t(app.bWebClient)? MessageBox(xmlmc._lastresult):MessageBox(xmlmc.GetReturnXml());\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t});\n}\n\nfunction getNumericMonth(strMonth)\n{\n\tvar arrMonth = new Array(\"Jan\",\"Feb\",\"Mar\",\"Apr\",\"May\",\"Jun\",\"Jul\",\"Aug\",\"Sep\",\"Oct\",\"Nov\",\"Dec\");\n\tfor(i=0; i<arrMonth.length; i++)\n\t{\n\t\tif(strMonth == arrMonth[i])\n\t\t\treturn i+1;\n\t}\n}\n\nfunction replaceIllegalFileCharacters(strText)\n{\n\t\/\/-- This function is used to replace characters in the passed in string that \n\t\/\/-- are not suitable for use in filenames and return the modified string \n\t\n\tstrOutput = strText;\n\tstrReplacement = \"-\";\n\tvar i = 0;\n\t\n\twhile(i < strOutput.length)\n\t{\n\t\tstrOutput = strOutput.replace('\/', strReplacement);\n\t\tstrOutput = strOutput.replace(':', strReplacement);\n\t\tstrOutput = strOutput.replace('*', strReplacement);\n\t\tstrOutput = strOutput.replace('?', strReplacement);\n\t\tstrOutput = strOutput.replace('\"', strReplacement);\n\t\tstrOutput = strOutput.replace('\\'', strReplacement);\n\t\tstrOutput = strOutput.replace('<', strReplacement);\n\t\tstrOutput = strOutput.replace('>', strReplacement);\n\t\t\n\t\ti++;\n\t}\n\t\n\treturn strOutput;\n}"},{"name":"cb_callaction_OnValueChanged","code":"cb_callaction_OnValueChanged(strValue)\n{\n\t\/\/-- set mode and then setup defaults for that mode\n\t_swdoc.boolClosing = (strValue!=\"Resolve Call\");\n\t_swdoc.setup_call_action();\n\n}"},{"name":"flg_customersurvey_OnValueChanged","code":"flg_customersurvey_OnValueChanged(strValue)\n{\n\t\/\/-- enable disable\n\tvar bChecked = flg_customersurvey.text == \"1\";\n\tapp._een(cb_surveys , bChecked);\n\n}"},{"name":"OnFieldValueChanged","code":"OnFieldValueChanged(strName, strValue)\n{\n\t\/\/-- This value is set when a field value has been changed.\n\t\/\/-- We check this variable on from closing to see if there are any data changes that need to be saved.\n\t_swdoc.boolFormFieldChanged = true;\n\n\n}"},{"name":"dt_actiontime_OnValueChanged","code":"dt_actiontime_OnValueChanged(strValue)\n{\n\t\/\/ -- Var used in this to calculate backDatePeriod\n\tvar nBackdatePeriod = 0;\n\t\n\t\/\/ -- Calculate the backDatePeriod for processing\n\tvar updateDateTime = mainform.dt_actiontime.text;\n\tvar updateDateTimeValue = mainform.dt_actiontime.value;\n\tnBackdatePeriod = _swdoc.intGetCurrentEpocTime - updateDateTimeValue;\n\t\n\t\/\/ -- Processing to set \"updatedb.updatetimex\" and set _swdoc level nBackdatePeriod variable for use in Resolve\/Close action\n\tvar funcProcessBackdate = function()\n\t{\n\t\tif(nBackdatePeriod==0)\n\t\t{\n\t\t\t_swdoc.updatedb.updatetimex = _swdoc.intGetCurrentEpocTime;\n\t\t}\n\t\tif(_swdoc.boolSetToMaxBackdatePeriod)\n\t\t{\n\t\t\t_swdoc.updatedb.updatetimex = app.global.GetCurrentEpocTime() - app.session.GetMaxBackdatePeriodAllowed();\n\t\t}\n\t\t_swdoc.nBackdatePeriod = nBackdatePeriod;\t\n\t\t_swdoc.UpdateFormFromData();\n\t}\n\t\n\t\/\/ -- Deny if the user has attempted to forward the Date\/Time\n\tif(nBackdatePeriod < 0)\n\t{\n\t\tMessageBox(\"You have attempted to forward date this call update which is not allowed.\");\n\t\t_swdoc.boolSetToMaxBackdatePeriod = false;\n\t\tnBackdatePeriod=0;\n\t\tfuncProcessBackdate();\n\t}\n\telse\n\t{\t\n\t\t\/\/ -- Check that the selected Date\/Time value does not exceed the maximum allowed backDatePeriod and prompt with an option to set to allowed Date\/Time value\n\t\tif(nBackdatePeriod > app.session.GetMaxBackdatePeriodAllowed())\n\t\t{\n\t\t\tvar dTime = app.global.GetCurrentEpocTime() - app.session.GetMaxBackdatePeriodAllowed();\n\t\t\tvar strMsg = \"You have attempted to backdate this call update further than you have sufficient privileges to do so.\\n\\nDo you want to use the oldest date\/time that you are allowed: \" + app.global.ConvertDateTimeInText(app.global.GetAsISO8601TimeString(dTime));\n\t\t\tMessageBox(strMsg, MB_ICONQUESTION | MB_YESNO, function(intDecision)\n\t\t\t{\t\n\t\t\t\tif(intDecision != IDYES)\n\t\t\t\t{\n\t\t\t\t\tnBackdatePeriod = 0;\n\t\t\t\t\t_swdoc.boolSetToMaxBackdatePeriod = false;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\t\/\/ -- Maximum backdate period allowed should only be calculated when invoking the API otherwise the value will be inacurrate\n\t\t\t\t\tnBackdatePeriod = 0;\n                    _swdoc.boolSetToMaxBackdatePeriod = true;\n\t\t\t\t}\n\t\t\t\tfuncProcessBackdate();\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\t\/\/ -- timeOfAction param in resolveCalls API expects .value property of Date\/Time control field\n\t\t\tnBackdatePeriod = updateDateTimeValue;\n\t\t\t_swdoc.boolSetToMaxBackdatePeriod = false;\n\t\t\tfuncProcessBackdate();\n\t\t}\n\t}\t\n}"},{"name":"btnResolveClose_OnPressed","code":"btnResolveClose_OnPressed()\n{\n\tmainform.ResolveClose();\n}"},{"name":"btnAddFile_OnPressed","code":"btnAddFile_OnPressed()\n{\n\t\/\/-- add files\n\t\/\/fl_attachments.newFile = InvokeCallAttachmentFileDialog();\n\tfl_attachments.AddFiles();\n\n\n}"},{"name":"mbtnAddFile_OnPressed","code":"mbtnAddFile_OnPressed()\n{\n\t\/\/-- add files\n\t\/\/fl_attachments.newFile = InvokeCallAttachmentFileDialog();\n\tfl_attachments.AddFiles();\n\n}"}]}}},{"appearance":{"width":"360","height":"220","backgroundColor":"#ffffff","fillColour":"#ffffff","textColour":"#000000","font":{"@size":"8","#text":"Arial"}},"javascript":{}}]}}}