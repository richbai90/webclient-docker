{"espForm":{"configuration":{"settings":{"name":"EfHoldCallForm","title":"Hold Call Form","options":{"allowResize":"true","showMenubar":"true","showToolbar":"false","showStatusBar":"false"}},"tables":{"table":[{"name":"updatedb","type":"Main Details Table","flags":"5"},{"name":"opencall","type":"Extended Details Table","mainDetailsColumn":"callref","flags":"0"}]},"javascript":{"methods":{"method":[{"name":"OnFormLoading","code":"OnFormLoading(strFormName, strClass)\n{\n\t\/\/-- If the analyst does not have permissions to modify the status of call\n\t\/\/--  then they should not be able to place a call on hold\/take off hold\n\tif (!app.session.HaveRight(ANALYST_RIGHT_A_GROUP,ANALYST_RIGHT_A_CANMODIFYCALLS))\n\t{\n    MessageBox(\"I am sorry, you do not have sufficient privileges to perform that action.  Please contact your system administrator\");\n    return false;\n\t}\n\t\n\t\/\/-- Initialise variables\n\t_swdoc.MessageSource = \"\";\n\t_swdoc.bSourceEmail = false;\n\t_swdoc.UpdateText\t= \"\";\n\t_swdoc.strActionSource = \"\";\n\t\/\/--\n\t\/\/-- get the form callrefs (those calls refs we are putting on hold)\n\t\/\/-- store the callrefs \"1,2,3\" \n\tvar Callrefs = _swdoc._form[\"callrefs\"];\n\t\n\t\/\/-- re-assign callrefs string and also create an array\n\t_swdoc.CallrefsCommaString = Callrefs;\n\t_swdoc.Callrefs = Callrefs.split(\",\");\n\t\n\t\n\t\/\/-- Go lock these calls while we want to put them on hold\n\tif(!app.global.LockCalls(_swdoc.CallrefsCommaString, \"HOLD\", true))  \/\/_swdoc.updatedb.callref\n\t{\n\t\t\/\/-- one of the calls may already be locked\n\t\t\/\/MessageBox(\"Call '\" + _swdoc.CallrefsCommaString + \"' already locked\");\n\t\treturn false;\n\t}\n\t\n\t\/\/-- init form title based on number of calls we are working with\n\tvar strFormTitle = (_swdoc.Callrefs.length > 1) ? \"Place Calls On Hold \" : \"Place Call On Hold \";\n\t\n\t\/\/-- now format each of the callrefs to F#### and add to title\n\tfor(var i=0;i<_swdoc.Callrefs.length; i++)\n\t{\n\t\tif( i > 0)strFormTitle += \", \";\n\t\tstrFormTitle += app.g.pad_callref(_swdoc.Callrefs[i]);\n\t}\n\t\n\t\/\/-- set the title\n\t_swdoc.SetTitle(strFormTitle);\n\n\t\/\/-- check if putting on hold from an email\n\tif(_swdoc._form[\"_source_email\"])\n\t{\n\t\t_swdoc.bSourceEmail = (_swdoc._form[\"_source_email\"] == \"true\");\n\t\t\/\/MessageBox(\"_source_email = \" + _swdoc.bSourceEmail);\n\t}\n\t\n\t\/\/-- store action source\n\t_swdoc.strActionSource = (_swdoc.bSourceEmail) ? \"E-mail\": \"Telephone\";\n\t\n\n\t\/\/-- if we have passed in update text store it\t\t\n\tif(_swdoc._form[\"updatetext\"])\n\t{\n\t\t_swdoc.UpdateText = _swdoc._form[\"updatetext\"];\n\t\t_swdoc.updatedb.updatetxt = _swdoc._form[\"updatetext\"];\n\t}\n\t\n\t\/\/-- Q? : What is ResetModiedFlag\n\t_swdoc.ResetModiedFlag(\"updatedb\");\n\n\treturn true;\n}"},{"name":"OnFormClosing","code":"OnFormClosing()\n{\n\tif (_swdoc.boolForceClose)\n\t{\n\t\treturn true;\n\t}\t\n\t\n\tvar funcUnlockReset = function()\n\t{\n\t\t\/\/-- unlock the calls\n\t\tapp.global.UnlockCalls(_swdoc.CallrefsCommaString);\n\t\n\t\t\/\/-- clear down data\n\t\t_swdoc.ResetData();\n\t\n\t\treturn true;\n\t}\n\t\n\t\/\/-- Check for Changes to any of the data fields\n\tif(_swdoc.bFormFieldChanged)\n\t{\n\t\tMessageBox(\"You have unsaved data on this form. Do you still want to close this form?\", MB_ICONQUESTION | MB_YESNO, function(intDecision)\n\t\t{\n\t\t\tif (intDecision == IDNO)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tfuncUnlockReset();\n\t\t\t\t_swdoc.boolForceClose = true;\n\t\t\t\t_swdoc.CloseForm();\n\t\t\t}              \n\t\t});\n\t}\n\telse\n\t{\n\t\treturn funcUnlockReset();\n\t}\n\n}"},{"name":"(Globals)","code":"var bFormFieldChanged = false;\t\/\/This var is used to check for changes to data fields and is set to true when any \n\t\t\t\t\t\t\t\t\/\/field data is changed\nvar boolForceClose = false;"},{"name":"(User Defined Functions)","code":"function replaceIllegalFileCharacters(strText)\n{\n\t\/\/-- This function is used to replace characters in the passed in string that \n\t\/\/-- are not suitable for use in filenames and return the modified string \n\t\n\tstrOutput = strText;\n\tstrReplacement = \"-\";\n\tvar i = 0;\n\t\n\twhile(i < strOutput.length)\n\t{\n\t\tstrOutput = strOutput.replace('\/', strReplacement);\n\t\tstrOutput = strOutput.replace(':', strReplacement);\n\t\tstrOutput = strOutput.replace('*', strReplacement);\n\t\tstrOutput = strOutput.replace('?', strReplacement);\n\t\tstrOutput = strOutput.replace('\"', strReplacement);\n\t\tstrOutput = strOutput.replace('\\'', strReplacement);\n\t\tstrOutput = strOutput.replace('<', strReplacement);\n\t\tstrOutput = strOutput.replace('>', strReplacement);\n\t\t\n\t\ti++;\n\t}\n\t\n\treturn strOutput;\n}"},{"name":"OnSaveData","code":"OnSaveData()\n{\n\tMessageBox(\"Please use the [Place Call On Hold] button to process the hold action\");\n\treturn false;\n}"}]}}},"layouts":{"layout":[{"appearance":{"width":"555","height":"391","backgroundColor":"#ffffff","fillColour":"#ffffff","textColour":"#000000","font":{"@size":"8","#text":"Arial"}},"controls":{"control":[{"general":{"name":"CaptionPanel2","type":"CaptionBar","flags":{"transparent":"true","xpStyle":"false","hasShadow":"false","toolbarButtonStyle":"false","cache":"false","hasBorder":"true","hasCheckbox":"false"}},"appearance":{"index":"0","caption":"Details","backgroundColor":"#f1f1f1","foregroundColor":"#003366","font":{"@size":"10","@bold":"1","#text":"Trebuchet (MS)"},"alignment":"Left","fillStyle":"Vertical Gradient"},"objectPlacement":{"position":{"top":"28","left":"3","right":"394","bottom":"165"},"scaling":{"top":"0","left":"0","right":"50","bottom":"0"}},"controlInfo":{"mouseOverCursor":"Window Default","properties":{"backgroundColor2":"#d8d8d8","imageHSpace":"10","slope":"12","borderColor":"#d3c9b6","headerHeight":"23","hasBorder":"1","panelBorderColor":"#d3c9b6","fillStyle":"0","panelBackgroundColor":"#f2eedd","panelBackgroundColor2":"#000000"}}},{"general":{"name":"CaptionPanel3","type":"CaptionBar","flags":{"transparent":"true","xpStyle":"false","hasShadow":"false","toolbarButtonStyle":"false","cache":"false","hasBorder":"true","hasCheckbox":"false"}},"appearance":{"index":"1","caption":"Options","backgroundColor":"#f1f1f1","foregroundColor":"#003366","font":{"@size":"10","@bold":"1","#text":"Trebuchet (MS)"},"alignment":"Left","fillStyle":"Vertical Gradient"},"objectPlacement":{"position":{"top":"28","left":"402","right":"551","bottom":"165"},"scaling":{"top":"0","left":"50","right":"100","bottom":"0"}},"controlInfo":{"mouseOverCursor":"Window Default","properties":{"backgroundColor2":"#d8d8d8","imageHSpace":"10","slope":"12","borderColor":"#d3c9b6","headerHeight":"23","hasBorder":"1","panelBorderColor":"#d3c9b6","fillStyle":"0","panelBackgroundColor":"#f2eedd","panelBackgroundColor2":"#000000"}}},{"general":{"name":"CaptionPanel1","type":"CaptionBar","flags":{"transparent":"true","xpStyle":"false","hasShadow":"false","toolbarButtonStyle":"false","cache":"false","hasBorder":"true","hasCheckbox":"false"}},"appearance":{"index":"2","caption":"Other Information","backgroundColor":"#f1f1f1","foregroundColor":"#003366","font":{"@size":"10","@bold":"1","#text":"Trebuchet (MS)"},"alignment":"Left","fillStyle":"Vertical Gradient"},"objectPlacement":{"position":{"top":"172","left":"3","right":"551","bottom":"388"},"scaling":{"top":"0","left":"0","right":"100","bottom":"100"}},"controlInfo":{"mouseOverCursor":"Window Default","properties":{"backgroundColor2":"#d8d8d8","imageHSpace":"10","slope":"12","borderColor":"#d3c9b6","headerHeight":"23","hasBorder":"1","panelBorderColor":"#d3c9b6","fillStyle":"0","panelBackgroundColor":"#f2eedd","panelBackgroundColor2":"#000000"}}},{"general":{"name":"tb_UpdateText","type":"Field","group":"Tab1:0"},"appearance":{"index":"3","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Arial"},"borderStyle":"Rectangle"},"objectPlacement":{"position":{"top":"232","left":"20","right":"533","bottom":"372"},"scaling":{"top":"0","left":"0","right":"100","bottom":"100"}},"data":{"binding":"updatedb.updatetxt"},"controlInfo":{"mouseOverCursor":"Window Default","type":"Text Edit","flags":{"invisible":"false","readOnly":"false","mandatory":"true","mandatoryLabelBackground":"false","mandatoryLabelText":"false","allowNullValue":"false","skipTabStop":"false","disabled":"false","protected":"true","noMacroExpand":"true","readOnlyInit":"false","autoCompleteField":"false","editUnlimitedText":"true","url":"false"},"textLineCount":"4","textInputFormat":"Text","properties":{"activeTextColor":"#eeeeee","disabledBackgroundColor":"#eeeeee","borderColor":"#c0c0c0"}}},{"general":{"name":"dt_HoldUntil","type":"Field"},"appearance":{"index":"4","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Arial"},"borderStyle":"Rectangle"},"objectPlacement":{"position":{"top":"78","left":"11","right":"218","bottom":"96"},"scaling":{"top":"0","left":"0","right":"25","bottom":"0"}},"controlInfo":{"mouseOverCursor":"Window Default","type":"Date\/Time Control","flags":{"invisible":"false","readOnly":"false","mandatory":"false","mandatoryLabelBackground":"false","mandatoryLabelText":"false","allowNullValue":"false","skipTabStop":"false","disabled":"false","protected":"true","noMacroExpand":"false","readOnlyInit":"false","colorDateIndicator":"false"},"textLineCount":"0","textInputFormat":"Text","properties":{"activeTextColor":"#eeeeee","disabledBackgroundColor":"#eeeeee","dateFormatMode":"0","borderColor":"#c0c0c0"}}},{"general":{"name":"tb_TimeSpent","type":"Field"},"appearance":{"index":"5","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Arial"},"borderStyle":"Rectangle"},"objectPlacement":{"position":{"top":"78","left":"227","right":"286","bottom":"96"},"scaling":{"top":"0","left":"25","right":"25","bottom":"0"}},"controlInfo":{"mouseOverCursor":"Window Default","type":"Minute Time Period","flags":{"invisible":"false","readOnly":"false","mandatory":"false","mandatoryLabelBackground":"false","mandatoryLabelText":"false","allowNullValue":"false","skipTabStop":"false","disabled":"false","protected":"true","noMacroExpand":"false","readOnlyInit":"false"},"textLineCount":"0","textInputFormat":"Text","properties":{"disabledBackgroundColor":"#eeeeee","defaultValue":"5","borderColor":"#c0c0c0"}}},{"general":{"name":"cb_ActionSource","type":"Field"},"appearance":{"index":"6","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Arial"},"borderStyle":"Rectangle"},"objectPlacement":{"position":{"top":"123","left":"11","right":"218","bottom":"141"},"scaling":{"top":"0","left":"0","right":"25","bottom":"0"}},"data":{"binding":"updatedb.udsource"},"controlInfo":{"mouseOverCursor":"Window Default","type":"Pick List","flags":{"invisible":"false","readOnly":"false","mandatory":"false","mandatoryLabelBackground":"false","mandatoryLabelText":"false","allowNullValue":"false","skipTabStop":"false","disabled":"false","protected":"true","noMacroExpand":"false","readOnlyInit":"false","comboAutoUpdate":"false","comboNewValues":"true","useDDPickList":"true"},"textLineCount":"0","textInputFormat":"Text","properties":{"disabledBackgroundColor":"#eeeeee","defaultValue":"Telephone","listItems":"Telephone|E-mail|","borderColor":"#c0c0c0"}}},{"general":{"name":"cb_ActionType","type":"Field"},"appearance":{"index":"7","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Arial"},"borderStyle":"Rectangle"},"objectPlacement":{"position":{"top":"123","left":"227","right":"388","bottom":"141"},"scaling":{"top":"0","left":"25","right":"50","bottom":"0"}},"data":{"binding":"updatedb.udcode"},"controlInfo":{"mouseOverCursor":"Window Default","type":"Pick List","flags":{"invisible":"false","readOnly":"false","mandatory":"false","mandatoryLabelBackground":"false","mandatoryLabelText":"false","allowNullValue":"false","skipTabStop":"false","disabled":"false","protected":"true","noMacroExpand":"false","readOnlyInit":"false","comboAutoUpdate":"false","comboNewValues":"true","useDDPickList":"true"},"textLineCount":"0","textInputFormat":"Text","properties":{"disabledBackgroundColor":"#eeeeee","defaultValue":"General Update","listItems":"General Update|Called Customer|E-mailed Customer|","borderColor":"#c0c0c0"}}},{"general":{"name":"flg_emailcustomer","type":"Field","flags":{"transparent":"true","xpStyle":"false","hasShadow":"false","toolbarButtonStyle":"false","cache":"false","hasBorder":"false","hasCheckbox":"false"}},"appearance":{"index":"8","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Trebuchet MS"},"borderStyle":"None"},"objectPlacement":{"position":{"top":"76","left":"406","right":"522","bottom":"95"},"scaling":{"top":"0","left":"50","right":"50","bottom":"0"}},"controlInfo":{"mouseOverCursor":"Window Default","type":"Form Flags","flags":{"invisible":"false","readOnly":"false","mandatory":"false","mandatoryLabelBackground":"false","mandatoryLabelText":"false","allowNullValue":"false","skipTabStop":"false","disabled":"false","protected":"true","noMacroExpand":"false","readOnlyInit":"false","comboAutoUpdate":"false","comboNewValues":"false"},"textLineCount":"0","textInputFormat":"Text","properties":{"activeTextColor":"#eeeeee","flagItems":"E-mail customer^1|","disabledBackgroundColor":"#eeeeee"}}},{"general":{"name":"flg_updatepublic","type":"Field","flags":{"transparent":"true","xpStyle":"false","hasShadow":"false","toolbarButtonStyle":"false","cache":"false","hasBorder":"false","hasCheckbox":"false"}},"appearance":{"index":"9","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Trebuchet MS"},"borderStyle":"None"},"objectPlacement":{"position":{"top":"56","left":"406","right":"535","bottom":"74"},"scaling":{"top":"0","left":"50","right":"50","bottom":"0"}},"controlInfo":{"mouseOverCursor":"Window Default","type":"Form Flags","flags":{"invisible":"false","readOnly":"false","mandatory":"false","mandatoryLabelBackground":"false","mandatoryLabelText":"false","allowNullValue":"false","skipTabStop":"false","disabled":"false","protected":"true","noMacroExpand":"false","readOnlyInit":"false","comboAutoUpdate":"false","comboNewValues":"false"},"textLineCount":"0","textInputFormat":"Text","properties":{"activeTextColor":"#eeeeee","flagItems":"Update to be public^1|","disabledBackgroundColor":"#eeeeee"}}},{"general":{"name":"Tab1","type":"TabControl","flags":{"transparent":"true","xpStyle":"false","hasShadow":"false","toolbarButtonStyle":"false","cache":"false","hasBorder":"false","hasCheckbox":"false"}},"appearance":{"index":"10","caption":"Tab1","backgroundColor":"#ded7ce","foregroundColor":"#ffffff","font":{"@size":"8","#text":"Arial"},"borderStyle":"None"},"objectPlacement":{"position":{"top":"201","left":"10","right":"545","bottom":"382"},"scaling":{"top":"0","left":"0","right":"100","bottom":"100"}},"tabStyle":"Top","tabSize":"19","items":{"item":[{"name":"Description","properties":"56=#d1e0ee|_flags=0","textBorder":"None","textBackgroundColor":"#ffffff","controlInfo":{"mouseOverCursor":"Window Default","properties":{"tabColor":"#d1e0ee"}}},{"name":"File Attachments","properties":"56=#ffcc66|_flags=0","textBorder":"None","textBackgroundColor":"#ffffff","controlInfo":{"mouseOverCursor":"Window Default","properties":{"tabColor":"#ffcc66"}}}]},"selectedTextFont":{"@size":"8","#text":"Arial"},"selectedTextColor":"#000000","deselectedTextColor":"#000000","tabSlopeLeft":"2","tabSlopeRight":"2","deselectedTabHeightOffset":"1","tabSpacing":"0","controlInfo":{"mouseOverCursor":"Window Default","flags":{"invisible":"false","skipTabStop":"false","disabled":"false","protected":"true","noMacroExpand":"false","multiLine":"false"},"properties":{"tabStyle":"0"}}},{"general":{"name":"fl_attachments","type":"FileListTable","flags":{"transparent":"false","xpStyle":"false","hasShadow":"false","toolbarButtonStyle":"false","cache":"false","hasBorder":"false","hasCheckbox":"false","showHeader":"true","verticalGridLines":"true","horizontalGridLines":"true","autoLoad":"true","allowMultiSelect":"true"},"group":"Tab1:1"},"appearance":{"index":"11","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Arial"},"borderStyle":"Rectangle"},"objectPlacement":{"position":{"top":"230","left":"19","right":"458","bottom":"373"},"scaling":{"top":"0","left":"0","right":"100","bottom":"100"}},"columns":{"controlInfo":[{"mouseOverCursor":"Window Default","type":"Text Edit","flags":{"invisible":"false","readOnly":"false","mandatory":"false","mandatoryLabelBackground":"false","mandatoryLabelText":"false","allowNullValue":"false","skipTabStop":"false","disabled":"false","protected":"false","noMacroExpand":"false","readOnlyInit":"false","autoCompleteField":"false","editUnlimitedText":"false","url":"false","hidden":"false","allowResize":"true","allowSort":"true"},"textLineCount":"0","textInputFormat":"Text","name":"File Name","width":"160","image":"-1","dataColumn":"0"},{"mouseOverCursor":"Window Default","type":"Text Edit","flags":{"invisible":"false","readOnly":"false","mandatory":"false","mandatoryLabelBackground":"false","mandatoryLabelText":"false","allowNullValue":"false","skipTabStop":"false","disabled":"false","protected":"false","noMacroExpand":"false","readOnlyInit":"false","autoCompleteField":"false","editUnlimitedText":"false","url":"false","hidden":"false","allowResize":"true","allowSort":"true"},"textLineCount":"0","textInputFormat":"Text","name":"Size","width":"80","image":"-1","dataColumn":"1"},{"mouseOverCursor":"Window Default","type":"Text Edit","flags":{"invisible":"false","readOnly":"false","mandatory":"false","mandatoryLabelBackground":"false","mandatoryLabelText":"false","allowNullValue":"false","skipTabStop":"false","disabled":"false","protected":"false","noMacroExpand":"false","readOnlyInit":"false","autoCompleteField":"false","editUnlimitedText":"false","url":"false","hidden":"false","allowResize":"true","allowSort":"true"},"textLineCount":"0","textInputFormat":"Text","name":"Last Modified","width":"120","image":"-1","dataColumn":"2"},{"mouseOverCursor":"Window Default","type":"Text Edit","flags":{"invisible":"false","readOnly":"false","mandatory":"false","mandatoryLabelBackground":"false","mandatoryLabelText":"false","allowNullValue":"false","skipTabStop":"false","disabled":"false","protected":"false","noMacroExpand":"false","readOnlyInit":"false","autoCompleteField":"false","editUnlimitedText":"false","url":"false","hidden":"false","allowResize":"true","allowSort":"true"},"textLineCount":"0","textInputFormat":"Text","name":"Full Local Path","width":"100","image":"-1","dataColumn":"3"}]},"sortColumn":"-1","sortDescending":"false","headerHeight":"16","rowHeight":"16","selectedColor":"#00008b","selectedTextColor":"#ffffff","controlInfo":{"mouseOverCursor":"Window Default","flags":{"invisible":"false","skipTabStop":"false","disabled":"false","protected":"true","noMacroExpand":"false","multiLine":"false"},"properties":{"content":"NAME=DeerSir1.doc;PATH=C:\\Documents and Settings\\NeilWJ\\My Documents\\DeerSir1.doc;SIZE=58880;LASTMODIFIED=1114767614","borderColor":"#c0c0c0"}}},{"general":{"name":"btnAdd","type":"EventButton","flags":{"transparent":"false","xpStyle":"true","hasShadow":"false","toolbarButtonStyle":"false","cache":"false","hasBorder":"false","hasCheckbox":"false"},"group":"Tab1:1"},"appearance":{"index":"12","caption":"Add","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Arial"}},"objectPlacement":{"position":{"top":"230","left":"466","right":"530","bottom":"254"},"scaling":{"top":"0","left":"100","right":"100","bottom":"0"}},"controlInfo":{"mouseOverCursor":"Window Default","flags":{"invisible":"false","skipTabStop":"false","disabled":"false","protected":"true","noMacroExpand":"false","multiLine":"false"},"properties":{"commands":"74","eventButtonIcon":"74"}}},{"general":{"name":"btnRemove","type":"EventButton","flags":{"transparent":"false","xpStyle":"true","hasShadow":"false","toolbarButtonStyle":"false","cache":"false","hasBorder":"false","hasCheckbox":"false"},"group":"Tab1:1"},"appearance":{"index":"13","caption":"Remove","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Arial"}},"objectPlacement":{"position":{"top":"260","left":"466","right":"530","bottom":"284"},"scaling":{"top":"0","left":"100","right":"100","bottom":"0"}},"controlInfo":{"mouseOverCursor":"Window Default","flags":{"invisible":"false","skipTabStop":"false","disabled":"false","protected":"true","noMacroExpand":"false","multiLine":"false"}}},{"general":{"name":"ActionTypeLabel","type":"FieldName","flags":{"transparent":"true","xpStyle":"false","hasShadow":"false","toolbarButtonStyle":"false","cache":"false","hasBorder":"false","hasCheckbox":"false"}},"appearance":{"index":"14","caption":"Action Type","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Trebuchet MS"},"alignment":"Right","borderStyle":"None","fillStyle":"Solid"},"objectPlacement":{"position":{"top":"101","left":"225","right":"287","bottom":"119"},"scaling":{"top":"0","left":"25","right":"25","bottom":"0"}},"data":{"binding":"updatedb.udcode"},"controlInfo":{"mouseOverCursor":"Window Default"}},{"general":{"name":"ActionSourceLabel","type":"FieldName","flags":{"transparent":"true","xpStyle":"false","hasShadow":"false","toolbarButtonStyle":"false","cache":"false","hasBorder":"false","hasCheckbox":"false"}},"appearance":{"index":"15","caption":"Action Source","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Trebuchet MS"},"alignment":"Right","borderStyle":"None","fillStyle":"Solid"},"objectPlacement":{"position":{"top":"101","left":"9","right":"82","bottom":"119"},"scaling":{"top":"0","left":"0","right":"0","bottom":"0"}},"data":{"binding":"updatedb.udsource"},"controlInfo":{"mouseOverCursor":"Window Default"}},{"general":{"type":"FieldName","flags":{"transparent":"true","xpStyle":"false","hasShadow":"false","toolbarButtonStyle":"false","cache":"false","hasBorder":"false","hasCheckbox":"false"}},"appearance":{"index":"16","caption":"Time Spent","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Trebuchet MS"},"alignment":"Right","borderStyle":"None","fillStyle":"Solid"},"objectPlacement":{"position":{"top":"56","left":"225","right":"282","bottom":"74"},"scaling":{"top":"0","left":"25","right":"25","bottom":"0"}},"data":{"binding":"updatedb.timespent"},"controlInfo":{"mouseOverCursor":"Window Default"}},{"general":{"name":"Text1","type":"Text","flags":{"transparent":"true","xpStyle":"false","hasShadow":"false","toolbarButtonStyle":"false","cache":"false","hasBorder":"false","hasCheckbox":"false"}},"appearance":{"index":"17","caption":"Place on hold until","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Trebuchet MS"},"alignment":"Left","borderStyle":"None","fillStyle":"Solid"},"objectPlacement":{"position":{"top":"56","left":"8","right":"120","bottom":"74"},"scaling":{"top":"0","left":"0","right":"0","bottom":"0"}},"controlInfo":{"mouseOverCursor":"Window Default"}},{"general":{"name":"btnHoldCall","type":"EventButton","flags":{"transparent":"false","xpStyle":"true","hasShadow":"false","toolbarButtonStyle":"true","cache":"true","hasBorder":"false","hasCheckbox":"false"}},"appearance":{"index":"18","caption":"Place Call On Hold","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Trebuchet MS"}},"objectPlacement":{"position":{"top":"-1","left":"8","right":"127","bottom":"22"},"scaling":{"top":"0","left":"0","right":"0","bottom":"0"}},"controlInfo":{"mouseOverCursor":"Window Default","flags":{"invisible":"false","skipTabStop":"false","disabled":"false","protected":"true","noMacroExpand":"false","multiLine":"false"},"properties":{"eventButtonIcon":"ImageList=Hold Call;IconIndex=5","backgroundColor":"#ff9900"}}},{"general":{"name":"btnAdd","type":"EventButton","flags":{"transparent":"false","xpStyle":"true","hasShadow":"false","toolbarButtonStyle":"true","cache":"true","hasBorder":"false","hasCheckbox":"false"}},"appearance":{"index":"19","caption":"Attach File","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Arial"}},"objectPlacement":{"position":{"top":"-1","left":"460","right":"551","bottom":"22"},"scaling":{"top":"0","left":"100","right":"100","bottom":"0"}},"controlInfo":{"mouseOverCursor":"Window Default","flags":{"invisible":"false","skipTabStop":"false","disabled":"false","protected":"true","noMacroExpand":"false","multiLine":"false"},"properties":{"commands":"74","eventButtonIcon":"74","backgroundColor":"#ff9900"}}},{"general":{"name":"Rect1","type":"Rectange","flags":{"transparent":"false","xpStyle":"false","hasShadow":"false","toolbarButtonStyle":"true","cache":"true","hasBorder":"false","hasCheckbox":"false"}},"appearance":{"index":"20","backgroundColor":"#d4d0c8","foregroundColor":"#dddddd","font":{"@size":"0"},"borderStyle":"Rectangle","fillStyle":"Solid"},"objectPlacement":{"position":{"top":"-1","left":"0","right":"560","bottom":"24"},"scaling":{"top":"0","left":"0","right":"100","bottom":"0"}},"controlInfo":{"mouseOverCursor":"Window Default"}}]},"javascript":{"methods":{"method":[{"name":"btnHoldCall_OnPressed","code":"btnHoldCall_OnPressed()\n{\n\tif(!ValidateForm())\n\t{\n\t\treturn false;\n\t}\n\t\n\t\/\/ -- Check that analyst has sufficient rights to place a call on hold\n\tif(!app.session.HaveRight(ANALYST_RIGHT_A_GROUP, ANALYST_RIGHT_A_CANPLACECALLONHOL, TRUE))\n\t{\n\t\tMessageBox(\"You don't have sufficient rights to place a call on hold.\");\n\t\treturn false;\n\t}\n\t\n\t\/\/ -- Place the call on hold using XMLMC API(s)\n\tvar xmlmc = new XmlMethodCall;\n\t\/\/ -- API method\n\tvar strMethod = \"holdCalls\";\n\t\/\/ -- Find modified values in UPDATEDB table\n\tvar arrExtraUpdateDbValues = new Array();\n\tvar strUpdateDbValues = \"\";\n\tif(rec = _swdoc.GetRecord(\"updatedb\"))\n\t{\n\t\tvar nColCount = rec.GetCount();\n\t\tfor(x = 0; x < nColCount; x++)\n\t\t{\n\t\t\tif(!rec.IsModified(x))\n\t\t\t\tcontinue;\n\t\t\tarrExtraUpdateDbValues[rec.GetColumnName(x)] = rec.GetValue(x);\n\t\t}\n\t}\n\tfor (fieldName in arrExtraUpdateDbValues)\n\t{\n\t\tstrUpdateDbValues += \"<\"+fieldName+\">\"+ app.global.PrepareForXML(arrExtraUpdateDbValues[fieldName])+\"<\/\"+fieldName+\">\";\n\t}\n\t\n\t\/\/ -- Workout \"holdUntil\" value\n\tvar strHoldUntilDate = app.global.GetAsISO8601TimeString(mainform.dt_HoldUntil.value);\n\t\n\t\/\/ ** API params ** \/\/\n\tvar arrCallrefs = _swdoc._form[\"callrefs\"].split(\",\");\n \tfor(x in arrCallrefs)\n\t\txmlmc.SetValue(\"callref\", arrCallrefs[x]);\n\txmlmc.SetValue(\"timeSpent\", mainform.tb_TimeSpent.value);\n\txmlmc.SetValue(\"description\", rec.updatetxt);\n\txmlmc.SetValue(\"holdUntil\", strHoldUntilDate);\n\tvar boolPublicUpdate = (flg_updatepublic.text == \"1\" )? true : false;\n\txmlmc.SetValue(\"publicUpdate\", boolPublicUpdate);\n\tif(rec.udsource!=\"\")\n\t\txmlmc.SetValue(\"updateSource\", rec.udsource);\n\tif(rec.udcode!=\"\")\n\t\txmlmc.SetValue(\"updateCode\", rec.udcode);\n\t\n\tapp.itsm.addAttachmentsToCallXmlmc(mainform.fl_attachments, xmlmc);\n\t\n\tif(strUpdateDbValues!=\"\")\n\t\txmlmc.SetParamAsComplexType(\"extraUpdateDbValues\", strUpdateDbValues);\t\n\t\/\/ ** EO API params ** \/\/\n\t\n\t\/\/ -- Invoke XMLMC API\n\tif(xmlmc.Invoke(\"helpdesk\",strMethod))\n\t{\n\t\tvar strXML = (app.bWebClient)? xmlmc._lastresult:xmlmc.GetReturnXml();\n\t\tvar objRes = app.XMCResult(strXML);\n\t\tif(!objRes.success)\n\t\t{\n\t\t\tMessageBox(\"The \" + strMethod + \" API method was rejected by the server.\");\n\t\t\treturn false;\n\t    }\n\t\telse\n\t\t{\n\t\t\tvar myXmlFile = new XmlFile(); \n\t\t\tbRet = myXmlFile.loadFromString(strXML); \n\t\t\tvar arrChildCallInfo = null;\n\t\t\tvar arrCallInfo = new Array();\n\t\t\tvar strDocs = \"\";\n\t\t\tfor (count = 0; count < myXmlFile.methodCallResult.params.length; count ++) \n\t\t\t{\n\t\t\t\tif(myXmlFile.methodCallResult.params[count].nodeName==\"callActionStatus\")\n\t\t\t\t{  \n\t\t\t\t\tvar boolSuccess = myXmlFile.methodCallResult.params[count]['success'].nodeValue;\n\t\t\t\t\tif(boolSuccess==\"false\")\n\t\t\t\t\t{\n\t\t\t\t\t\tvar strMessage =  myXmlFile.methodCallResult.params[count]['message'].nodeValue;\n\t\t\t\t\t\tMessageBox(strMessage);\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t\tvar strCallref = myXmlFile.methodCallResult.params[count]['callref'].nodeValue;\n\t\t\t\t\tvar strIndex = myXmlFile.methodCallResult.params[count]['udIndex'].nodeValue;\n\t\t\t\t\t\n\t\t\t\t\tarrCallInfo[strCallref] = strIndex;\n\t\t\t\t}\n\t\t\t\telse if(myXmlFile.methodCallResult.params[count].nodeName==\"callFileAttachment\")\n\t\t\t\t{\n\t\t\t\t\tvar intCount = app.array_count(arrCallInfo);\n\t\t\t\t\tif(intCount==1)\n\t\t\t\t\t{\n\t\t\t\t\t\ttry\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar updateId = myXmlFile.methodCallResult.params[count]['updateId'].nodeValue;\n\t\t\t\t\t\t\tif(updateId==arrCallInfo[strCallref])\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tvar pathName = myXmlFile.methodCallResult.params[count]['pathName'].nodeValue;\n\t\t\t\t\t\t\t\tvar fileName = myXmlFile.methodCallResult.params[count]['fileName'].nodeValue;\n\t\t\t\t\t\t\t\tvar fileSize = myXmlFile.methodCallResult.params[count]['fileSize'].nodeValue;\n\t\t\t\t\t\t\t\tif(strDocs!=\"\") strDocs +=\"\\r\\n\";\n\t\t\t\t\t\t\t\tstrDocs +='displayname=\"'+fileName+'\"; path=\"'+pathName+'\"; size=\"'+fileSize+'\";';\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcatch(e)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\/\/ --\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\t\/\/ If we have been invoked to update a call from an e-mail message, this update will \n\t\t\t\/\/ only relate to a single call. We can only handle e-mail audit trail if we are working\n\t\t\t\/\/ on a single-call update. \n\t\t\tif(arrCallrefs.length == 1 && \t\t\t\/\/ Are we only dealing with a single call reference?\n\t\t\t\t_swdoc._form[\"messagesource\"] && \t\/\/ Are we working from an e-mail message?\n\t\t\t\tdd.GetGlobalParamAsNumber(\"Email Audit Trail\/StoreEmailAuditTrail\")) \/\/ Are we configured?\n\t\t\t{\n\t\t\t\tapp.g.attach_message_to_call(_swdoc._form,arrCallrefs[0],arrCallInfo[arrCallrefs[0]]);\n\t\t\t}\n\t\n    \t\t\/\/ if we want to send an email to the customer AND there are file attachments, obtain the \n    \t\t\/\/ attachments to attach to the email as well\n    \t\tvar flSessionFilesInfo = \"\";\n    \t\tif(mainform.flg_emailcustomer.value && app.global.IsConnectedToMailServer())\n    \t\t{\n\t\t\t\t\/\/ Now, compose an email to the customer\t\t\t\t\n\t\t\t\tapp.global.ComposeCallUpdateEmail(arrCallInfo, \t\t\t\t\t\/\/ Array: Call reference-UdIndex\n\t\t\t\t\t\t\t\t\t\t_swdoc.updatedb.updatetxt, \t\/\/ Message text\n\t\t\t\t\t\t\t\t\t\tstrDocs, \t\t\/\/ File attachments\n\t\t\t\t\t\t\t\t\t\t_swdoc.updatedb.timespent,\n\t\t\t\t\t\t\t\t\t\t\"HoldCallMailTemplate\", \t\t\/\/ Template name\n\t\t\t\t\t\t\t\t\t\tTEMPLATE_HOLDCALL,\t\t\t\/\/ Template type\n\t\t\t\t\t\t\t\t\t\tfunction()\n\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\/\/ -- Close Form\n\t\t\t\t\t\t\t\t\t\t\t_swdoc.bFormFieldChanged = false;\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t_swdoc.CloseForm();\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\t\/\/ -- Close Form\n\t\t\t\t_swdoc.bFormFieldChanged = false;\t\t\t\n\t\t\t\t_swdoc.CloseForm();\n\t\t\t}\n\t\t}\n\t}\t\n\telse\n\t{\n\t\t(app.bWebClient)? MessageBox(xmlmc._lastresult):MessageBox(xmlmc.GetReturnXml());\n\t\t\/\/ -- Close Form\n\t\t_swdoc.bFormFieldChanged = false;\t\t\t\n\t\t_swdoc.CloseForm();\n\t}\n}"},{"name":"btnAdd_OnPressed","code":"btnAdd_OnPressed()\n{\n\t\/\/-- add a new file\n\t\/\/fl_attachments.newFile = PickAnalystDialog();\n\tfl_attachments.AddFiles();\n\n}"},{"name":"btnRemove_OnPressed","code":"btnRemove_OnPressed()\n{\n\t\/\/-- remove selected files\n\tfor(var i=fl_attachments.rowCount()-1; i>=0;i--)\n    {\n    \t\/\/-- if selected remove\n    \tif(fl_attachments.IsRowSelected(i))\tfl_attachments.RemoveRow(i);\n    }\n}"},{"name":"OnFormLoaded","code":"OnFormLoaded()\n{\n\t\/\/-- clear update field\n\t\tapp._ete(tb_UpdateText , \"\");\n\t\n\t\/\/--\n\t\/\/-- set public flag depending on the rights of the analyst\n\t\tapp._ete(flg_updatepublic , (app.session.IsDefaultOption(ANALYST_DEFAULT_HOLDPRIVATE)?\"1\":\"0\")); \n\t\t\t\t\n\t\/\/-- check if we have a mail connection and analyst can send mail\n\t\tif(app.global.IsConnectedToMailServer() && app.global.CanSendMail())\n\t\t{\n\t\t\t\/\/-- set flg to editable and set to defualt setting for this analyst\n\t\t\tapp._ero(flg_emailcustomer , false);\n\t\t\tapp._ete(flg_emailcustomer , (app.session.IsDefaultOption(ANALYST_DEFAULT_HOLDSENDEMAIL)?\"1\":\"0\"));\n\t\t}\n\t\telse\n\t\t{\n\t\t\t\/\/-- not allowed to send email disable and set to 0\n\t\t\tapp._ero(flg_emailcustomer , true);\n\t\t\tapp._ete(flg_emailcustomer , \"0\");\t\n\t\t}\n\t\t\n\t\/\/--\n\t\/\/-- set update text\n\tif(_swdoc.UpdateText.length)app._ete(tb_UpdateText , _swdoc.UpdateText);\n\t\t\n\t\t\n\n\t\/\/if this form has been called with attachments, add them to the attachments list\n\t\tvar index = 0;\n\t\tvar bAreAttachments = false;\n\t\t\n \t\twhile(_swdoc._form[\"attach\"+index]) \n \t\t{\n \t\t\tbAreAttachments = true;\n    \t\tfl_attachments.AddAttachment(_swdoc._form[\"attach\" + index]);\n\t\t\tindex++;\n \t\t} \n \t\n \t\/\/if the analyst does not have permissions to add files to calls, make the file attachments box invisible\n \t\/\/UNLESS there are file attachments being included from the email which called this form, in which case\n \t\/\/show the file attachments, but make the Add and Remove buttons invisible\n \t\n \t\tif(!app.session.HaveRight(ANALYST_RIGHT_A_GROUP,ANALYST_RIGHT_A_CANATTACHFILESTOCALLS, false))\n \t\t{\n \t\t\tif(!bAreAttachments)\n \t\t\t{\n \t\t\t\tTab1.ShowTabItem(1,false);\n \t\t\t}\n \t\t\telse\n \t\t\t{\n \t\t\t\tapp._evi(btnAdd , false);\n \t\t\t\tapp._evi(btnRemove , false);\n \t\t\t}\n \t\t}\n\t\t\n\t\/\/-- set the hold until date to now\n\t\tapp._eva(dt_HoldUntil , app.global.GetCurrentEpocTime());\n\t\t\n\t\/\/-- set action source\n\t\tapp._ete(cb_ActionSource , _swdoc.strActionSource);\n\t\t\n\t\/\/-- Set the Default Value for the Time Spent field\n\t\/\/SetDefaultTimeSpent();\n}"},{"name":"(User Defined Functions)","code":"\/\/-- Validate the form data to make sure it is ok\nfunction ValidateForm()\n{\n\n\tif((tb_TimeSpent.text < 1 || tb_TimeSpent.text > 60000) &&(tb_TimeSpent.mandatory))\n\t{\n\t\tMessageBox(\"You must enter the amount of time you spent on this action\", MB_OK);\n\t\treturn false;;\t\/\/ Make sure that the time spent is within range\n\t}\n\t\n\tif(tb_UpdateText.text == \"\")\n\t{\n\t\tMessageBox(\"You must enter an update description to place this call on hold\", MB_OK);\n\t\treturn false;\t\/\/ Make sure we have some update text\n\t}\n\n\tvar nowTime = new Number(app.global.GetCurrentEpocTime());\n\tif(app.global.EpocTimeFromString(dt_HoldUntil.text) <= nowTime)\n\t{\n\t\tMessageBox(\"You must set a time in the future.\", MB_OK | MB_ICONSTOP);\n\t\treturn false;\n\t}\n\n\tif(cb_ActionSource.mandatory == true && cb_ActionSource.text.length() == 0)\n\t{\n\t\tvar Message = \"The field'\" + ActionSourceLabel.text + \"' must be completed before you can apply this action\"\n\t\tMessageBox(Message);\n\t\treturn false;\n\t}\n\n\tif(cb_ActionType.mandatory == true  && cb_ActionType.text.length() == 0)\n\t{\n\t\tvar Message = \"The field '\" + ActionTypeLable.text + \"' must be completed before you can apply this action\";\n\t\tMessageBox(Message);\n\t\treturn false;\n\t}\n\t\n\tif(!check_mandatory_fields(\"opencall\",mainform)) return false;\n\tif(!check_mandatory_fields(\"updatedb\",mainform)) return false;\n\n\treturn true;\n}\n\n\/\/-- 08.02.2007 - NWJ - Check mandatory fields on the form for a given table\n\/\/--\t\t\t\t\talert user if need be and return false\t\t\t\t\t\t\nfunction check_mandatory_fields(strTable,oForm)\n{\n    for (var x = 0; x<oForm.elements.length;x++)\n    {\n        var element = oForm.elements[x];\n        if ((element.mandatory) && (element.text ==\"\"))\n        {\n            var colName = \"\";\n            var fieldName = \"(not specified)\";\n            if(element.dataRef!=\"\")\n            {\n            \tvar arrInfo = element.dataRef.split(\".\");\n            \tvar strTable = arrInfo[0];\n            \tvar colName = arrInfo[1];\n            \tvar fieldName = dd.tables[strTable].columns[colName.toLowerCase()].DisplayName;\n            }\n            MessageBox(\"The field '\" + fieldName + \"' is a mandatory field and must be completed.\");\n            return false;\n        }\n    }\n    return true;\n}\n\n\nfunction SetDefaultTimeSpent()\n{\n\n\t\/*\n\t\n\tNWJ - 29.06.2006 ref 47766 - we have removed timespent settings from glabal params as customers can design forms and set defaults\n\t\n\t\/\/ if there is a default value for time spent in the data dictionary, make this the default value for the timespent field.\n\t\/\/ getting this as a string value at first, to make sure that if there IS a value, but it is set to zero, we won't get a\n\t\/\/ integer zero, which Javascript may interpret as \"false\"\n\n\t\tif (dd.GetGlobalParamAsString(\"Hold Call Form\/TimeSpent\"))\n\t\t{\n\t\t\tvar arrCallTime = dd.GetGlobalParamAsString(\"Hold Call Form\/TimeSpent\").split(\":\");\n\t\t\tvar nCallMins = (arrCallTime[0]*60 + arrCallTime[1]-0);\n\t\t\tif (nCallMins !== 0)\n\t\t\t{\n\t\t\t\ttb_TimeSpent.value = nCallMins;\n\t\t\t\ttb_TimeSpent.text = nCallMins;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\ttb_TimeSpent.mandatory = true;\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\ttb_TimeSpent.value = 5;\n\t\t\ttb_TimeSpent.text = 5;\n\t\t}\n\t*\/\n}"},{"name":"OnFieldValueChanged","code":"OnFieldValueChanged(strName, strValue)\n{\n\t\/\/-- This value is set when a field value has been changed.\n\t\/\/-- We check this variable on from closing to see if there are any data changes that need to be saved.\n\t_swdoc.bFormFieldChanged = true;\n\n\n}"}]}}},{"appearance":{"width":"360","height":"220","backgroundColor":"#ffffff","fillColour":"#ffffff","textColour":"#000000","font":{"@size":"8","#text":"Arial"}},"javascript":{}}]}}}