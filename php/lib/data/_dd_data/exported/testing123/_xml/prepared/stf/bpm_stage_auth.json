{"espForm":{"configuration":{"settings":{"name":"bpm_stage_auth","title":"Stage Authoriser","options":{"allowResize":"true","showMenubar":"false","showToolbar":"true","showStatusBar":"false"}},"tables":{"table":{"name":"bpm_stage_auth","type":"Main Details Table","flags":"2"}},"javascript":{"methods":{"method":{"name":"(Globals)","code":"var _swdoc = (IsObjectDefined(\"_bHtmlWebClient\"))?top:_swdoc;\n\nfunction oAuth()\n{\n\treturn _swdoc.bpm_stage_auth;\n}\n\nfunction MF()\n{\n\treturn _swdoc.mainform;\n}\n\nfunction enable_fields(strValue)\n{\n\tif(strValue==\"Customer's Manager\")\n\t{\n\t\tapp._een(_swdoc.MF().btn_search,false);\t\n\t}\n\telse if(strValue==\"Customer\")\n\t{\n\t\tapp._een(_swdoc.MF().btn_search,false);\t\n\t}\n\telse if (strValue==\"Affected Business Areas\")\n\t{\n\t\tapp._een(_swdoc.MF().btn_search,false);\t\n\t}\n\telse\n\t{\n\t\tapp._een(_swdoc.MF().btn_search,true);\t\n\t}\n}\n\nfunction get_callclass()\n{\n\tvar callclass = \"\";\n\tvar oParams = {};\n\toParams.wf_id = _swdoc.GetArg(\"fk_workflow_id\");\n\tvar oRS = app.g.get_sqrecordset(\"general\/get_bpm_callclass\",oParams);\n\t\n\twhile(oRS.Fetch())\n\t{\n\t\tcallclass = app.g.get_field(oRS, \"CALLCLASS\");\n\t}\n\treturn callclass;\n}"}}}},"layouts":{"layout":[{"appearance":{"width":"371","height":"234","backgroundColor":"#ffffff","fillColour":"#ffffff","textColour":"#000000","font":{"@size":"8","#text":"Arial"}},"controls":{"control":[{"general":{"type":"FieldName","flags":{"transparent":"true","xpStyle":"false","hasShadow":"false","toolbarButtonStyle":"false","cache":"false","hasBorder":"false","hasCheckbox":"false"}},"appearance":{"index":"0","caption":"Authoriser","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Arial"},"alignment":"Right","borderStyle":"None","fillStyle":"Solid"},"objectPlacement":{"position":{"top":"36","left":"6","right":"116","bottom":"54"},"scaling":{"top":"0","left":"0","right":"0","bottom":"0"}},"data":{"binding":"bpm_stage_auth.authorname"},"controlInfo":{"mouseOverCursor":"Window Default"}},{"general":{"type":"Field"},"appearance":{"index":"1","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Arial"},"borderStyle":"Rectangle"},"objectPlacement":{"position":{"top":"36","left":"120","right":"332","bottom":"54"},"scaling":{"top":"0","left":"0","right":"100","bottom":"0"}},"data":{"binding":"bpm_stage_auth.authorname"},"controlInfo":{"mouseOverCursor":"Window Default","type":"Text Edit","flags":{"invisible":"false","readOnly":"true","mandatory":"true","mandatoryLabelBackground":"false","mandatoryLabelText":"false","allowNullValue":"false","skipTabStop":"false","disabled":"true","protected":"false","noMacroExpand":"false","readOnlyInit":"false","autoCompleteField":"false","editUnlimitedText":"false","url":"false"},"textLineCount":"0","textInputFormat":"Text","properties":{"disabledBackgroundColor":"#eeeeee","borderColor":"#c0c0c0"}}},{"general":{"type":"FieldName","flags":{"transparent":"true","xpStyle":"false","hasShadow":"false","toolbarButtonStyle":"false","cache":"false","hasBorder":"false","hasCheckbox":"false"}},"appearance":{"index":"2","caption":"Authoriser Type","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Arial"},"alignment":"Right","borderStyle":"None","fillStyle":"Solid"},"objectPlacement":{"position":{"top":"14","left":"6","right":"116","bottom":"32"},"scaling":{"top":"0","left":"0","right":"0","bottom":"0"}},"data":{"binding":"bpm_stage_auth.authortype"},"controlInfo":{"mouseOverCursor":"Window Default"}},{"general":{"name":"lb_authtype","type":"Field"},"appearance":{"index":"3","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Arial"},"borderStyle":"Rectangle"},"objectPlacement":{"position":{"top":"14","left":"120","right":"332","bottom":"32"},"scaling":{"top":"0","left":"0","right":"100","bottom":"0"}},"data":{"binding":"bpm_stage_auth.authortype"},"controlInfo":{"mouseOverCursor":"Window Default","type":"Pick List","flags":{"invisible":"false","readOnly":"false","mandatory":"true","mandatoryLabelBackground":"false","mandatoryLabelText":"false","allowNullValue":"false","skipTabStop":"false","disabled":"false","protected":"false","noMacroExpand":"false","readOnlyInit":"false","comboAutoUpdate":"false","comboNewValues":"true","useDDPickList":"false"},"textLineCount":"0","textInputFormat":"Text","properties":{"disabledBackgroundColor":"#eeeeee","defaultValue":"Analyst","listItems":"Analyst|Customer|Customer's Manager|","borderColor":"#c0c0c0"}}},{"general":{"name":"btn_search","type":"EventButton","flags":{"transparent":"false","xpStyle":"true","hasShadow":"false","toolbarButtonStyle":"false","cache":"false","hasBorder":"false","hasCheckbox":"false"}},"appearance":{"index":"4","caption":"...","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Arial"}},"objectPlacement":{"position":{"top":"34","left":"314","right":"332","bottom":"54"},"scaling":{"top":"0","left":"100","right":"100","bottom":"0"}},"controlInfo":{"mouseOverCursor":"Window Default"}},{"general":{"type":"FieldName","flags":{"transparent":"true","xpStyle":"false","hasShadow":"false","toolbarButtonStyle":"false","cache":"false","hasBorder":"false","hasCheckbox":"false"}},"appearance":{"index":"5","caption":"Weighting","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Arial"},"alignment":"Right","borderStyle":"None","fillStyle":"Solid"},"objectPlacement":{"position":{"top":"59","left":"6","right":"116","bottom":"77"},"scaling":{"top":"0","left":"0","right":"0","bottom":"0"}},"data":{"binding":"bpm_stage_auth.weighting"},"controlInfo":{"mouseOverCursor":"Window Default"}},{"general":{"type":"Field"},"appearance":{"index":"6","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Arial"},"borderStyle":"Rectangle"},"objectPlacement":{"position":{"top":"59","left":"120","right":"332","bottom":"77"},"scaling":{"top":"0","left":"0","right":"100","bottom":"0"}},"data":{"binding":"bpm_stage_auth.weighting"},"controlInfo":{"mouseOverCursor":"Window Default","type":"Text Edit","textLineCount":"0","textInputFormat":"Numeric","properties":{"disabledBackgroundColor":"#eeeeee","defaultValue":"25","borderColor":"#c0c0c0"}}},{"general":{"name":"lbl_aba_notes2","type":"Text","flags":{"transparent":"true","xpStyle":"false","hasShadow":"false","toolbarButtonStyle":"false","cache":"false","hasBorder":"false","hasCheckbox":"false"}},"appearance":{"index":"7","caption":"The allocated weighting for all Affected Business Areas will be shared between each Affected Business Area.","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Arial"},"alignment":"Center","borderStyle":"None","fillStyle":"Solid"},"objectPlacement":{"position":{"top":"135","left":"19","right":"356","bottom":"165"},"scaling":{"top":"0","left":"0","right":"100","bottom":"0"}},"controlInfo":{"mouseOverCursor":"Window Default","flags":{"invisible":"false","skipTabStop":"false","disabled":"false","protected":"false","noMacroExpand":"false","multiLine":"true"}}},{"general":{"name":"lbl_aba_notes3","type":"Text","flags":{"transparent":"true","xpStyle":"false","hasShadow":"false","toolbarButtonStyle":"false","cache":"false","hasBorder":"false","hasCheckbox":"false"}},"appearance":{"index":"8","caption":"The result will be rounded up to the nearest whole number.","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Arial"},"alignment":"Center","borderStyle":"None","fillStyle":"Solid"},"objectPlacement":{"position":{"top":"167","left":"19","right":"356","bottom":"185"},"scaling":{"top":"0","left":"0","right":"100","bottom":"0"}},"controlInfo":{"mouseOverCursor":"Window Default","flags":{"invisible":"false","skipTabStop":"false","disabled":"false","protected":"false","noMacroExpand":"false","multiLine":"true"}}},{"general":{"name":"lbl_aba_notes4","type":"Text","flags":{"transparent":"true","xpStyle":"false","hasShadow":"false","toolbarButtonStyle":"false","cache":"false","hasBorder":"false","hasCheckbox":"false"}},"appearance":{"index":"9","caption":"For example; if the overall allocated weighting is 25 and there are 4 Affected Business Areas against the Request, a weighting of 7 will be allocated to each Affected Business Area.","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Arial"},"alignment":"Center","borderStyle":"None","fillStyle":"Solid"},"objectPlacement":{"position":{"top":"185","left":"19","right":"356","bottom":"227"},"scaling":{"top":"0","left":"0","right":"100","bottom":"0"}},"controlInfo":{"mouseOverCursor":"Window Default","flags":{"invisible":"false","skipTabStop":"false","disabled":"false","protected":"false","noMacroExpand":"false","multiLine":"true"}}},{"general":{"name":"Rect1","type":"Rectange","flags":{"transparent":"true","xpStyle":"false","hasShadow":"false","toolbarButtonStyle":"false","cache":"false","hasBorder":"false","hasCheckbox":"false"}},"appearance":{"index":"10","backgroundColor":"#ffffff","foregroundColor":"#c0c0c0","font":{"@size":"0"},"borderStyle":"Rectangle","fillStyle":"Solid"},"objectPlacement":{"position":{"top":"92","left":"11","right":"363","bottom":"234"},"scaling":{"top":"0","left":"0","right":"100","bottom":"0"}},"controlInfo":{"mouseOverCursor":"Window Default"}},{"general":{"name":"lbl_aba_notes1","type":"Text"},"appearance":{"index":"11","caption":"Important Note for Affected Business Areas","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Arial"},"alignment":"Center","borderStyle":"None","fillStyle":"Solid"},"objectPlacement":{"position":{"top":"85","left":"19","right":"243","bottom":"103"},"scaling":{"top":"0","left":"0","right":"0","bottom":"0"}},"controlInfo":{"mouseOverCursor":"Window Default","flags":{"invisible":"false","skipTabStop":"false","disabled":"false","protected":"false","noMacroExpand":"false","multiLine":"true"}}},{"general":{"name":"lbl_aba_notes5","type":"Text","flags":{"transparent":"true","xpStyle":"false","hasShadow":"false","toolbarButtonStyle":"false","cache":"false","hasBorder":"false","hasCheckbox":"false"}},"appearance":{"index":"12","caption":"Authorisation requests from Affected Business Areas are only available within Change Requests","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Arial"},"alignment":"Center","borderStyle":"None","fillStyle":"Solid"},"objectPlacement":{"position":{"top":"104","left":"19","right":"356","bottom":"134"},"scaling":{"top":"0","left":"0","right":"100","bottom":"0"}},"controlInfo":{"mouseOverCursor":"Window Default","flags":{"invisible":"false","skipTabStop":"false","disabled":"false","protected":"false","noMacroExpand":"false","multiLine":"true"}}}]},"javascript":{"methods":{"method":[{"name":"btn_search_OnPressed","code":"btn_search_OnPressed()\n{\n\tswitch(_swdoc.oAuth().authortype)\n\t{\n\t\tcase \"Analyst\":\n\t\t\t\/\/-- get analyst\n\t\t\tapp.g.pick_analyst(\"Select an Authoriser\", function(oAnalyst)\n\t\t\t{\n\t\t\t\tif(oAnalyst)\n\t\t\t\t{\n\t\t\t\t\t_swdoc.oAuth().fk_auth_id=oAnalyst.id;\n\t\t\t\t\t_swdoc.oAuth().authorname=oAnalyst.name;\n\t\t\t\t}\n\t\t\t\t_swdoc.UpdateFormFromData();\n\t\t\t});\n\t\t\tbreak;\n\t\tcase \"Customer\":\n\t\t\t\/\/-- get customer\n\t\t\tapp.g.search_for(\"customers\", false, \"\", function(oRes)\n\t\t\t{\n\t\t\t\tif(oRes)\n\t\t\t\t{\n\t\t\t\t\t_swdoc.oAuth().fk_auth_id=oRes.selectedkeys;\n\t\t\t\t\t_swdoc.oAuth().authorname=oRes.selectedtext;\n\t\t\t\t}\n\t\t\t\t_swdoc.UpdateFormFromData();\n\t\t\t});\n\t\t\tbreak;\t\t\t\n\t\tcase \"Customer's Manager\":\n\t\t\t\/\/-- get customer\n\t\t\t_swdoc.oAuth().fk_auth_id=\"CUSTMGR\";\n\t\t\t_swdoc.oAuth().authorname=\"Customer's Manager\";\n\t\t\t_swdoc.UpdateFormFromData();\n\t\t\tbreak;\t\n\t\tcase \"Licensed Approver\":\n\t\t\t\/\/-- get customer\n\t\t\tapp.g.popup(\"TbLicensedApprover\", \"s=1\",function(oRes){\n\t\t\t\tif(oRes)\n\t\t\t\t{\n\t\t\t\t\tif (\"\"!=oRes.document.selectedkey){\n\t\t\t\t\t\t_swdoc.oAuth().fk_auth_id=oRes.document.selectedkey;\n\t\t\t\t\t\t_swdoc.oAuth().authorname=oRes.document.selectedfirstname + \" \" + oRes.document.selectedsurname;\n\t\t\t\t\t\tif (\" \" == _swdoc.oAuth().authorname) _swdoc.oAuth().authorname = oRes.document.selectedkey;\n\t\t\t\t\t\t\t\t_swdoc.UpdateFormFromData();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\t\t\t\n\t\t\tbreak;\t\t\n\t}\n}"},{"name":"OnFormLoaded","code":"OnFormLoaded()\n{\n\t\/\/-- pop defaults\n\n\t$strMgr = \"|Customer's Manager\";\n\tvar intMgr = _swdoc.GetArg(\"CUSTMGR\");\n\tif(intMgr>-1)\n\t{\n\t\t$strMgr = \"\";\n\t\t_swdoc.MF().lb_authtype.pickList = \"Analyst|Customer\";\n\t}\n\t$strCust = \"|Customer\";\n\tvar intCust = _swdoc.GetArg(\"CUSTOMER\");\n\tif(intCust>-1)\n\t{\n\t\t$strCust = \"\";\n\t}\n\t\n\t\/\/ DTH: Catering for Affected Business Areas. Can only include one entry; this will request authorisation from all Affected Buseiness Areas\n\tvar callclass = _swdoc.get_callclass();\n\t$strBusArea = \"\";\n\tif(callclass==\"Change Request\" || callclass==\"Change Proposal\")\n\t{\n\t\t$strBusArea = \"|Affected Business Areas\";\n\t\tvar intBusArea = _swdoc.GetArg(\"BUSAREA\");\n\t\tif(intBusArea>-1)\n\t\t{\n\t\t\t$strBusArea = \"\";\n\t\t}\n\t}\n\n\t$strServOwn = \"|Service Owner\";\n\tvar intBusArea = _swdoc.GetArg(\"SERVOWN\");\n\tif(intBusArea>-1)\n\t{\n\t\t$strServOwn = \"\";\n\t}\n\t\n\t$strTechOwn = \"|Technical Owner\";\n\tvar intBusArea = _swdoc.GetArg(\"TECHOWN\");\n\tif(intBusArea>-1)\n\t{\n\t\t$strTechOwn = \"\";\n\t}\n\n\t$strCIOwn = \"|Configuration Item Owner\";\n\tvar intBusArea = _swdoc.GetArg(\"CIOWN\");\n\tif(intBusArea>-1)\n\t{\n\t\t$strCIOwn = \"\";\n\t}\n\t\t\n\t$strLicensedApprover = \"|Licensed Approver\";\n\tvar h = app.g.submit_php(\"php\/itsm\/license_check.php\", false);\n\tvar t = h.indexOf(\"licenses_in_use\");\n\tvar licensed_for = h.substring(0,t);\n\tvar lf = parseInt(licensed_for.replace(\/\\D\/g,\"\"));\n\tif(lf<1)\n\t{\n\t\t$strLicensedApprover = \"\";\n\t}\n\n\t\t\n\t_swdoc.MF().lb_authtype.pickList = \"Analyst\"+$strMgr+$strCust+$strBusArea+$strServOwn+$strTechOwn+$strCIOwn+$strLicensedApprover;\n\n\t\/\/-- NWJ - As requested by gerry we only support analyst authorisation\n\t\/\/_een(lb_authtype, false);\n\tif(_swdoc.oAuth().pk_auto_id<1)\n\t{\n\t\tapp.g.popuplate_form_fromargs(\"bpm_stage_auth\", _swdoc, false, true);\n\t}\n\t_swdoc.enable_fields(bpm_stage_auth.authortype);\n\t_swdoc.UpdateFormFromData();\n\n}"},{"name":"lb_authtype_OnValueChanged","code":"lb_authtype_OnValueChanged(strValue)\n{\n\t\/\/ TODO: Add your event handler code here\n\tif(strValue==\"Customer's Manager\")\n\t{\n\t\t_swdoc.oAuth().fk_auth_id=\"CUSTMGR\";\n\t\t_swdoc.oAuth().authorname=\"<Pending Customer Assignment>\";\n\t\tapp._een(mainform.btn_search,false);\t\n\t}\n\telse if(strValue==\"Customer\")\n\t{\n\t\t_swdoc.oAuth().fk_auth_id=\"CUSTOMER\";\n\t\t_swdoc.oAuth().authorname=\"<Pending Customer Assignment>\";\n\t\tapp._een(mainform.btn_search,false);\t\n\t}\n\telse if (strValue==\"Affected Business Areas\")\n\t{\n\t\t_swdoc.oAuth().fk_auth_id=\"BUSAREA\";\n\t\t_swdoc.oAuth().authorname=\"<Pending Affected Business Area Assignment>\";\n\t\tapp._een(mainform.btn_search,false);\t\n\t}\n\t\/\/SG F0112155\n\telse if (strValue==\"Service Owner\")\n\t{\n\t\t_swdoc.oAuth().fk_auth_id=\"SERVOWN\";\n\t\t_swdoc.oAuth().authorname=\"<Pending Service Association>\";\n\t\tapp._een(mainform.btn_search,false);\t\n\t}\n\telse if (strValue==\"Technical Owner\")\n\t{\n\t\t_swdoc.oAuth().fk_auth_id=\"TECHOWN\";\n\t\t_swdoc.oAuth().authorname=\"<Pending Service Association>\";\n\t\tapp._een(mainform.btn_search,false);\t\n\t}\t\n\telse if (strValue==\"Configuration Item Owner\")\n\t{\n\t\t_swdoc.oAuth().fk_auth_id=\"CIOWN\";\n\t\t_swdoc.oAuth().authorname=\"<Pending Configuration Item Association>\";\n\t\tapp._een(mainform.btn_search,false);\t\n\t}\t\t\n\t\/\/END F0112155\n\telse\n\t{\n\t\t_swdoc.oAuth().fk_auth_id=\"\";\n\t\t_swdoc.oAuth().authorname=\"\";\t\n\t\tapp._een(mainform.btn_search,true);\t\n\t}\n\t_swdoc.UpdateFormFromData();\n\n}"}]}}},{"appearance":{"width":"360","height":"220","backgroundColor":"#ffffff","fillColour":"#ffffff","textColour":"#000000","font":{"@size":"8","#text":"Arial"}},"javascript":{}}]}}}