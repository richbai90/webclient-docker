{"espForm":{"configuration":{"settings":{"name":"bti_standard_services","title":"Standard Services","description":"Services considered standard for any organization","options":{"allowResize":"true","showMenubar":"false","showToolbar":"true","showStatusBar":"false"}},"tables":{"table":{"name":"config_itemi","type":"Related Table","mainDetailsColumn":"fk_service_id","flags":"76"}},"javascript":{}},"layouts":{"layout":[{"appearance":{"width":"535","height":"239","backgroundColor":"#ffffff","fillColour":"#ffffff","textColour":"#000000","font":{"@size":"8","#text":"Arial"}},"controls":{"control":[{"general":{"name":"CaptionPanel1","type":"CaptionBar","flags":{"transparent":"true","xpStyle":"false","hasShadow":"false","toolbarButtonStyle":"false","cache":"false","hasBorder":"true","hasCheckbox":"false"}},"appearance":{"index":"0","caption":"Standard Services","backgroundColor":"#f1f1f1","foregroundColor":"#003366","font":{"@size":"10","@bold":"1","#text":"Trebuchet (MS)"},"alignment":"Left","fillStyle":"Vertical Gradient"},"objectPlacement":{"position":{"top":"3","left":"1","right":"534","bottom":"238"},"scaling":{"top":"0","left":"0","right":"100","bottom":"100"}},"controlInfo":{"mouseOverCursor":"Window Default","properties":{"backgroundColor2":"#d8d8d8","imageHSpace":"0","slope":"12","borderColor":"#d3c9b6","headerHeight":"23","hasBorder":"1","panelBorderColor":"#d3c9b6","fillStyle":"0","panelBackgroundColor":"#f2eedd","panelBackgroundColor2":"#000000","image":"&[app.webroot]\/clisupp\/formimages\/itsm\/fa-cog.png"}}},{"general":{"name":"sl_default_services","type":"SqlTable","flags":{"transparent":"false","xpStyle":"false","hasShadow":"false","toolbarButtonStyle":"false","cache":"false","hasBorder":"false","hasCheckbox":"true","showHeader":"true","verticalGridLines":"true","horizontalGridLines":"true","autoLoad":"true","allowMultiSelect":"true"}},"appearance":{"index":"1","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Arial"},"borderStyle":"Rectangle"},"objectPlacement":{"position":{"top":"40","left":"10","right":"524","bottom":"225"},"scaling":{"top":"0","left":"50","right":"100","bottom":"100"}},"columns":{"controlInfo":{"mouseOverCursor":"Window Default","type":"Text Edit","flags":{"invisible":"false","readOnly":"false","mandatory":"false","mandatoryLabelBackground":"false","mandatoryLabelText":"false","allowNullValue":"false","skipTabStop":"false","disabled":"false","protected":"false","noMacroExpand":"false","readOnlyInit":"false","autoCompleteField":"false","editUnlimitedText":"false","url":"false","hidden":"false","allowResize":"false","allowSort":"true"},"textLineCount":"0","textInputFormat":"Text","properties":{"column":"fk_service_name"},"name":"Service","width":"512","image":"-1","dataColumn":"0"}},"sortColumn":"0","sortDescending":"false","headerHeight":"18","rowHeight":"16","selectedColor":"#00008b","selectedTextColor":"#ffffff","controlInfo":{"mouseOverCursor":"Window Default","properties":{"table":"custom_standard_services","editRecordForm":"Form.cmdb_popup_ci","sqlSource":"swdata","selectionMode":"0","borderColor":"#d3c9b6","storedQuery":"common.load_all"}}},{"general":{"name":"btn_search_ci1","type":"EventButton","flags":{"transparent":"false","xpStyle":"true","hasShadow":"false","toolbarButtonStyle":"false","cache":"false","hasBorder":"false","hasCheckbox":"false"}},"appearance":{"index":"2","caption":"Add","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Arial"}},"objectPlacement":{"position":{"top":"40","left":"346","right":"402","bottom":"58"},"scaling":{"top":"0","left":"100","right":"100","bottom":"0"}},"controlInfo":{"mouseOverCursor":"Window Default","flags":{"invisible":"false","skipTabStop":"false","disabled":"false","protected":"false","noMacroExpand":"false","multiLine":"false"}}}]},"javascript":{"methods":{"method":[{"name":"sl_cust_cis1_OnHeaderItemClicked","code":"sl_cust_cis1_OnHeaderItemClicked(strOrder, nCol)\n{\n\t\/\/sl_cust_cis1.Refresh();\n\t_swdoc.load_cis();\n\t\/\/_swdoc.load_customer_items();\n\t\n\n\n}"},{"name":"sl_cust_cis1_OnItemSelected","code":"sl_cust_cis1_OnItemSelected(nRow)\n{\n\t\/\/-- NWJ\n\t\/\/-- 27.11.2006\n\t\/\/-- enable list menus if an item is selected\t\n\tvar boolActive = (sl_cust_cis1.rowCount() > 0);\n\tapp._een(mbtn_cci_views, boolActive);\n\/\/_een(mbtn_cci_actions, boolActive);\t\n\t\n}"},{"name":"sl_cust_cis1_OnItemChecked","code":"sl_cust_cis1_OnItemChecked(nRow, bChecked)\n{\n\t boolIncSLASetManually = true; \/\/-- 105734\n\t\n\tvar pk_ci_id = app.g.sl_getrawcolvalue(sl_cust_cis1, nRow, \"pk_auto_id\");\t\n\tvar fk_ci_type = app.g.sl_getrawcolvalue(sl_cust_cis1, nRow, \"ck_config_type\");\n\n\tvar oList = EF().sl_configitems;\n\t\n\tvar itemType = \"Configuration Item\";\n\n\tif(fk_ci_type.indexOf(\"Service\")>-1)\n\t{\n\t\toList = EF().sl_services;\n\t\tvar itemType = \"Service\";\n\t}\n\n\t\/\/MessageBox(pk_ci_id + \" A:A \" + nRow)\n\tif(bChecked)\n\t{\n\t\tif(app.g.sl_findrow_byvalue(oList, pk_ci_id, 'pk_auto_id') > -1) return;\n\n\t\t\/\/MessageBox(pk_ci_id)\n\t\t\/\/-- TK Replace append Filter with Stored Query\t\n\t\t\/\/app.g.sl_appendfilter(oList, pk_ci_id,'pk_auto_id');\n\t\tif (itemType == \"Configuration Item\")\n\t\t{\n\t\t\tapp.g.sl_kv_appendfilter(EF().sl_configitems, pk_ci_id,'pk_auto_id');\n\t\t\tEF().sl_configitems.Refresh();\n\t\t\t\/\/ES - F0111753 - set Process based on value set in Configuration Item and Configuration Type\n\t\t\tvar intCIID = app.g.sl_getrawcolvalue(sl_cust_cis1, nRow, \"pk_auto_id\");\n\t\t\tvar dbValue1 = new SqlQuery;\n\t\t\tdbValue1.InvokeStoredQuery(\"cmdb\/get.itemi_fkworkflowid\",\"pk_auto_id=\"+intCIID);\n\t\t\tif(dbValue1.Fetch())\n\t\t\t{\n\t\t\t\tvar strWorkflowId = app.g.get_field(dbValue1,\"fk_workflow_id\");\n\t\t\t\t\/\/Get fk_workflow_id from config_itemi if not blank\n\t\t\t\tif (strWorkflowId!=\"\")\n\t\t\t\t{\n\t\t\t\t\tif (_swdoc.bpm_workflow.pk_workflow_id==\"\")\n\t\t\t\t\t{\n\t\t\t\t\t\t_swdoc.bpm_workflow.pk_workflow_id = strWorkflowId;\n\t\t\t\t\t\t_swdoc.UpdateFormFromData();\n\t\t\t\t\t}\n\t\t\t\t\telse if (_swdoc.bpm_workflow.pk_workflow_id!=\"\")\n\t\t\t\t\t{\n\t\t\t\t\t\tif (_swdoc.bpm_workflow.pk_workflow_id!=strWorkflowId)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar msgProcess = MessageBox(\"The default Incident Process for the selected item is [\" + arrWorkflowId[y] + \"]. Would you like to apply this change?\",MB_YESNO|MB_ICONQUESTION);\n \t\t\t\t\t\t\tif (msgProcess==6)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t_swdoc.bpm_workflow.pk_workflow_id = strWorkflowId;\n\t\t\t\t\t\t\t\t_swdoc.UpdateFormFromData();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\t\n\t\t\t\t\/\/Get fk_workflow_id from config_typei if blank in config_itemi\t\t\n\t\t\t\telse if (strWorkflowId==\"\")\n\t\t\t\t{\n\t\t\t\t\tvar dbValue2 = new SqlQuery;\n\t\t\t\t\tdbValue2.InvokeStoredQuery(\"cmdb\/get.typei_fkworkflowid\",\"pk_auto_id=\"+intCIID);\n\t\t\t\t\tif (dbValue2.Fetch())\n\t\t\t\t\t{\n\t\t\t\t\t\tvar strTypeWorkflowId = app.g.get_field(dbValue2,\"fk_workflow_id\");\n\t\t\t\t\t\tif (strTypeWorkflowId!=\"\")\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (_swdoc.bpm_workflow.pk_workflow_id==\"\")\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t_swdoc.bpm_workflow.pk_workflow_id = strTypeWorkflowId;\n\t\t\t\t\t\t\t\t_swdoc.UpdateFormFromData();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse if (_swdoc.bpm_workflow.pk_workflow_id!=\"\")\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tvar msgProcessType = MessageBox(\"The default Incident Process for the selected item is [\" + arrWorkflowId[y] + \"]. Would you like to apply this change?\",MB_YESNO|MB_ICONQUESTION);\n \t\t\t\t\t\t\t\tif (msgProcessType==6)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t_swdoc.bpm_workflow.pk_workflow_id = strTypeWorkflowId;\n\t\t\t\t\t\t\t\t\t_swdoc.UpdateFormFromData();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} \/\/END - F0111753\n\t\t\t}\t\n\t\t}else if (itemType == \"Service\")\n\t\t{\n  \t\t\tapp.g.sl_kv_appendfilter(EF().sl_services, pk_ci_id,'pk_auto_id');\n  \t\t\tEF().sl_services.Refresh();\n  \t\t\t\n  \t\t\t\/\/ES - F0111753 - set Process based on value set in Service\n\t\t\tvar intCIID = app.g.sl_getrawcolvalue(sl_cust_cis1, nRow, \"pk_auto_id\");\n\t\t\tvar dbValue3 = new SqlQuery;\n\t\t\tdbValue3.InvokeStoredQuery(\"cmdb\/get.itemi_fkworkflowid\",\"pk_auto_id=\"+intCIID);\n\t\t\tif(dbValue3.Fetch())\n\t\t\t{\n\t\t\t\tvar strServiceWorkflowId = app.g.get_field(dbValue3,\"fk_workflow_id\");\n\t\t\t\t\/\/Get fk_workflow_id from config_itemi for app.service item\n\t\t\t\tif (strServiceWorkflowId!=\"\")\n\t\t\t\t{\n\t\t\t\t\tif (_swdoc.bpm_workflow.pk_workflow_id==\"\")\n\t\t\t\t\t{\n\t\t\t\t\t\t_swdoc.bpm_workflow.pk_workflow_id = strServiceWorkflowId;\n\t\t\t\t\t\t_swdoc.UpdateFormFromData();\n\t\t\t\t\t}\n\t\t\t\t\telse if (_swdoc.bpm_workflow.pk_workflow_id!=\"\")\n\t\t\t\t\t{\n\t\t\t\t\t\tif (_swdoc.bpm_workflow.pk_workflow_id!=strServiceWorkflowId)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar msgProcessService = MessageBox(\"The selected item recommends the Process [\" + strServiceWorkflowId + \"] for this Incident. Would you like to apply this change?\",MB_YESNO|MB_ICONQUESTION);\n \t\t\t\t\t\t\tif (msgProcessService==6)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t_swdoc.bpm_workflow.pk_workflow_id = strServiceWorkflowId;\n\t\t\t\t\t\t\t\t_swdoc.UpdateFormFromData();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\t\t\t\n\t\t\t} \/\/END - F0111753\n  \t\t}\n\t\t\/\/-- NWJ - determine who the preferred support is\n \t\t_swdoc.determine_prefered_support(true);\t\n\n\t\t\/\/-- nwj - 15.07.2008 - check ci contract\n\t\tapp.cfg.process_call_contract_check(pk_ci_id, true,_swdoc);\n\t\t\n\t\t\/\/ -- SG, 02\/07\/2012, F0103324\n\t\t\/\/ Create new array to hold CI and Bespoke Terms info\n\t\tapp.bespokeTermsProcessing(pk_ci_id);\n\t\t\/\/ -- END OF BESPOKE PROCESSING\n\t}\n\telse\n\t{\n\t\t\tvar intRowPos = app.g.sl_findrow_byvalue(oList, pk_ci_id, 'pk_auto_id');\n\t\t\tif(intRowPos>-1)\n\t\t\t{\n\t\t\t\toList.RemoveRow(intRowPos);\t\t\n\t\t\n\t\t\t\t\/\/-- 29.04.2008 - 2.2.0 if this ci that has been removed was used to set the pref supp group then change it\n\t\t\t\tif(_swdoc.intAssessmentCI == pk_ci_id)\n\t\t\t\t{\n\t\t\t\t\tOC().itsm_sladef = 0;\n\t\t\t\t\tOC().itsm_slaname = \"[Use Customer SLA]\";\n\t\t\t\t\tOC().priority = \"[Use Customer Priority]\";\n\t\t\t\t\tOC().itsm_prefered_suppgroup = \"\";\n\t\t\t\t\tOC().itsm_prefered_text = \"\";\n\n\t\t\t\t\tapp._eva(MF().lb_oc_slad1, 0);\n\t\t\t\t\tapp._ete(MF().lb_oc_slad1, 0);\n\t\t\t\t\tapp._een(MF().lbl_oc_priority, false);\n\t\t\t\t\tapp._een(MF().lb_oc_sla, false);\n\n\t\t\t\t\t_swdoc.UpdateFormFromData();\n\t\t\t\t}\n\t\t\t\n\t\t\t\t_swdoc.determine_prefered_support(true);\n\t\t\t\t\/\/_swdoc.check_ci_assessment();\n\t\t\t}\n\t}\n\n\tapp.g.setSLAFromRules(_swdoc.strSLACallClass, _swdoc);\n\t\n}"},{"name":"btn_search_ci1_OnPressed","code":"btn_search_ci1_OnPressed()\n{\n\t\tvar strURL = \"searchmode=1&multiselect=1\";\n\t\tvar objFormDoc = app.itsm;\n\t\tapp.g.popup(\"search_service\",strURL,function(aForm)\n\t\t{\n\t\t\t\/\/-- capture selected app.service keys\n\t\t\tif (aForm)\n\t\t\t{\n\t\t\t\tif (IsObjectDefined(\"_bHtmlWebClient\"))\n\t\t\t\t{\n\t\t\t\t\tvar _swdoc = top;\n\t\t\t\t\tvar strSelectedkeys = aForm._swdoc.strSelectedKeys;\n\t\t\t\t\tif (aForm._swdoc.strSelectedKeys == \"\")\n\t\t\t\t\t{\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tvar strSelectedkeys = aForm.document.strSelectedKeys;\n\t\t\t\t\tif (aForm.document.strSelectedKeys == \"\")\n\t\t\t\t\t{\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tvar arrSelectedkeys = strSelectedkeys.split(\",\");\n\t\t\t\t\n\t\t\t\t\/\/-- get already subscribed keys\n\t\t\t\tvar strSubscribed = \"\";\n\t\t\t\tvar oDefault = app.g.get_sqrecordset(\"service\/get_default_services.list\");\t\t\n\t\t\t\t\n\t\t\t\tvar intSubscriptionCounter = 0;\n\t\t\t\tvar arrDefaultKeys = [];\n\t\t\t\tvar arrDefaultPKs = [];\n\t\t\t\twhile (oDefault.Fetch())\n\t\t\t\t{\n\t\t\t\t\tarrDefaultKeys[intDefaultCounter] = app.g.get_field(oDefault,\"FK_SERVICE_ID\");\n\t\t\t\t\tarrDefaultPKs.push(app.g.get_field(oDefault, \"PK_AUTO_ID\"));\n\t\t\t\t\tintDefaultCounter++;\n\t\t\t\t}\n\t\t\t\t\/\/-- for each selected app.service... check if already subscribed to app.service\n\t\t\t\tvar boolAlert = false;\n\t\t\t\tvar boolDefault = false;\n\t\t\t\tvar strNoSLAs = \"\";\n\t\t\t\tfor (var i = 0, len1 = arrSelectedkeys.length; i < len1; i++)\n\t\t\t\t{\n\t\t\t\t\tboolDefault = false;\n\t\t\t\t\t\/\/-- for each Subscribed app.service...\n\t\t\t\t\tfor (var j = 0, len2 = arrDefaultKeys.length; j < len2; j++)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (arrSelectedkeys[i] == arrDefaultKeys[j])\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tboolDefault = true;\n\t\t\t\t\t\t\t\/\/-- already a default app.service so skip to next app.service\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\n\t\t\t\t\t}\n\t\t\t\t\tif (!boolDefault)\n\t\t\t\t\t{\n\t\t\t\t\t\t\/\/-- load app.service record\n\t\t\t\t\t\tvar oService = app.g.get_record(\"SC_FOLIO\", arrSelectedkeys[i]);\n\t\t\t\t\t\t\n\t\t\t\t\t\t\/\/-- Check that app.service has at least one associated SLA. \n\t\t\t\t\t\tif (!objFormDoc.service_has_sla(arrSelectedkeys[i]))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif(strNoSLAs!=\"\")strNoSLAs+=\"\\n\";\n\t\t\t\t\t\t\tstrNoSLAs+=oService.vsb_title;\n\t\t\t\t\t\t\tboolAlert = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse \/\/-- Add to default list\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tapp.g.submitsqs(\"service\/insert_default_service\", \"sc_id=\" + oService.fk_cmdb_id + \"&service_name=\" + oService.service_name);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (boolAlert)\n\t\t\t\t{\n\t\t\t\t\tMessageBox(\"Please associate service levels that the following services can be offered at before creating subscriptions:\\n\\n\" + strNoSLAs);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tsl_default_services.Refresh();\n\t\t});\n}"}]}}},{"appearance":{"width":"360","height":"220","backgroundColor":"#ffffff","fillColour":"#ffffff","textColour":"#000000","font":{"@size":"8","#text":"Arial"}},"javascript":{}}]}}}