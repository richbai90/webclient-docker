{"espForm":{"configuration":{"settings":{"name":"itsmEfUpdateCallForm","title":"Update Call Form","options":{"allowResize":"true","showMenubar":"true","showToolbar":"false","showStatusBar":"false"}},"tables":{"table":[{"name":"updatedb","type":"Main Details Table","flags":"5"},{"name":"opencall","type":"Extended Details Table","mainDetailsColumn":"callref","flags":"0"}]},"javascript":{"methods":{"method":[{"name":"OnFormClosing","code":"OnFormClosing()\n{\n\tif (_swdoc.boolForceClose)\n\t{\n\t\treturn true;\n\t}\n\t\n\tvar funcUnlockReset = function()\n\t{\n\t\t\/\/ Unlock our call(s)\n\t\tif(_swdoc.boolCallsLocked)\n\t\t\tapp.global.UnlockCalls(_swdoc._form[\"callrefs\"]);\n\t\n\t\t_swdoc.ResetData();\n\t\t\t\n\t\treturn true;\n\t}\t\n\t\n\t\/\/Check for Changes to any of the data fields\n\tif(_swdoc.bFormFieldChanged)\n\t{\n\t\tMessageBox(\"You have unsaved data on this form. Do you still want to close this form?\", MB_ICONQUESTION | MB_YESNO, function(intDecision)\n\t\t{\n\t\t\tif (intDecision === IDNO)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tfuncUnlockReset();\n\t\t\t\t_swdoc.boolForceClose = true;\n\t\t\t\t_swdoc.CloseForm();\n\t\t\t}\n\t\t});\t\n\t}\n\telse\n\t{\n\t\treturn funcUnlockReset();\n\t}\n}"},{"name":"OnFormLoading","code":"OnFormLoading(strFormName, strClass)\n{\n\t_swdoc.intGetCurrentEpocTime = app.global.GetCurrentEpocTime();\t\n\t\n\t\/\/if analyst does not have permissions to\n\t\/\/update calls, don't open form.\n\tif (!app.session.HaveRight(ANALYST_RIGHT_A_GROUP, ANALYST_RIGHT_A_CANUPDATECALLS, false))\n\t{\n\t\tMessageBox(\"I am sorry, you do not have the right to update calls.\\n Please contact your administrator\");\n\t\treturn false;\n\t}\n\n\tvar db = new SqlQuery;\t\n\tvar boolOLAs = true;\t\n\tvar strParams = \"crfs=\"+pfu(_swdoc._form[\"callrefs\"]);\n\tdb.InvokeStoredQuery(\"form\/updatecall\/get_classes_for_calls \", strParams);\n\twhile(db.Fetch())\n\t{\n\t\tvar nClass = db.GetValueAsString(0);\n\t\tif(nClass!=\"OLA Task\")\n\t\t\tboolOLAs = false;\n\t}\n\tif(boolOLAs)\n\t{\n\t\tvar strArgs = \"in_callrefs=\" + _swdoc._form[\"callrefs\"];\n\t\tapp.OpenForm(\"itsmEfUpdateCallForm_OLT\", strArgs, true);\n\t\treturn false;\t\t\n\t}\n\t\n\t\/\/if one or more calls are locked, then don't open form.\n\tif(!app.global.LockCalls(_swdoc._form[\"callrefs\"],\"UPDATE\",true))\n\t{\n\t\t\/\/MessageBox(\"I am sorry, one or more of the selected calls is locked by another user.\");\n\t\treturn false;\n\t}\n\t_swdoc.boolCallsLocked =true;\n\t\n\t\n\t\/\/ convert string of call references into an array\n\t_swdoc.arrCallRefs = _swdoc._form[\"callrefs\"].split(\",\");\n\t\n\t\/\/ set the page title\n\tvar strPageTitle = \"\";\n\tstrPageTitle = \"Update Call\";\n\tif (_swdoc.arrCallRefs.length > 1)\n\t{\n\t\t\/\/if there is more than one call, set the page title to plural\n\t\tstrPageTitle += \"s\";\n\t}\n\t\n\tfor(var i=0; i<_swdoc.arrCallRefs.length; i++)\n\t{\n\t\tstrPageTitle += (i > 0) ? \", \" : \":\";\n\t\tstrPageTitle += \" \"+app.g.pad_callref(_swdoc.arrCallRefs[i]);\n\t}\n\t_swdoc.SetTitle(strPageTitle);\n\n\t\/\/ get current time, so we can check if call is being backdated later\n\t_swdoc.dtCurrentTime = new Date();\n\n\t\/\/ Set the default update text if it has been passed in\n\t_swdoc.updatedb.updatetxt = _form['updatetext'];\n\n\t\/\/ Get the Call Status information for various checks later\n\tfor(var i = 0; i<_swdoc.arrCallRefs.length; i++)\n\t{\n\t\tvar nCStatus = app.global.GetCallStatusInfo(_swdoc.arrCallRefs[i]).nStatus;\n\t\tif (nCStatus == 1)\n\t\t{\n\t\t\t_swdoc.bPending = true;\n\t\t}\t\t\n\t\tif (nCStatus == 2)\n\t\t{\n\t\t\t_swdoc.nUnassigned++;\n\t\t} \n\t\tif (nCStatus == 3)\n\t\t{\n\t\t\t_swdoc.nUnaccepted++;\n\t\t}\n\t\tif (nCStatus > 15 || nCStatus == 6)\n\t\t{\n\t\t\t_swdoc.bNotOpen = true;\n\t\t}\n\t\tif (nCStatus == 4)\n\t\t{\n\t\t\t_swdoc.bOnHold = true;\n\t\t}\n\t\t\n\t}\n\n\treturn true;\n}"},{"name":"OnSaveData","code":"OnSaveData()\n{\n\t\/\/ This should never get called, but if for some reason it does, we only want this form\n\t\/\/ to close if it is cancelled or if the analyst clicks one of the update buttons.\n\tMessageBox(\"Please use the [Update] or [Update and Assign] buttons to process this update action.\");\n\treturn false;\n}"},{"name":"(Globals)","code":"\/\/ Define global variables used by this form\nvar _swdoc = (IsObjectDefined(\"_bHtmlWebClient\"))?top:_swdoc;\nvar arrCallRefs = null; \t\/\/ This is an array of the call references applied to this update\nvar dtCurrentTime = null; \t\/\/ This is the time the form was opened.\nvar strUpdateText = null;\t\/\/ This will store any update text that was passed to the form.\nvar nUnassigned = 0;     \/\/ The next few variables are to double-check statuses for various checks\nvar nUnaccepted = 0;\nvar bNotOpen = false;\nvar bPending = false;\nvar bOnHold = false;\nvar bFormFieldChanged = false;\t\/\/This var is used to check for changes to data fields and is set to true when any \n\t\t\t\t\t\t\t\t\/\/field data is changed\nvar boolForceClose = false;\nvar bTargetFixTimeChanged = false;\nvar boolCallsLocked = false;\nvar boolChangeSLA = false; \/\/TK used to determin if analyst has permision to change SLA\nvar origSLA = 0;\nvar newSLA = 0;\nvar boolBackdate = false;\n\nvar intGetCurrentEpocTime = app.global.GetCurrentEpocTime();\nvar boolSetToMaxBackdatePeriod = false;\nvar nBackdatePeriod = 0;\n\n\/\/-- mainform pointer\nfunction MF()\n{\n\treturn mainform;\n}\n\nfunction OC()\n{\n\treturn opencall;\n}\n\nvar strCurrentSLARespondedTo = \"0\";\nvar strCurrentSLA=\"\";"},{"name":"(User Defined Functions)","code":"\/*\n\tCreated by Hornbill Systems\n\t\n\tUpdates\n\t-------\n\t\n\tCode\tDate\t\tAuthor\t\t\t\t\tDescription\n\t-----------------------------------------------------------------------------------------\n\tind01\t11\/05\/07\tIvan Nicholas Dorosh\tError when accepting multiple calls Bug 57068\n\n*\/\n\n\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\n\/\/ this is the _swdoc.UpdateCalls function that is called when a user clicks\n\/\/ on either Update Call or Update and Assign.  It is being\n\/\/ defined here so that we can use it for either.\n\/\/ this function takes as an argument the analyst, if any, to whom you are assigning the call\n\nfunction UpdateCalls(strAssignToGroup, strAssignToAnalyst, boolThirdParty, funcCallback)\n{\n\tvar intApplySLAToChildCalls = dd.GetGlobalParamAsString(\"Application Settings\/ApplyParentSLAToChildrenWhenUpdatingRequest\");\n\tvar strSLAtext = \"\";\n\t\/\/ Set the SLA text to null if the SLA field is not applicable (multiple calls, etc.)\n\tif (mainform.tb_sla.visible == false || _swdoc.arrCallRefs.length > 1)\n\t{\n\t\tstrPrioritytext = \"^^^\";\n\t\tstrSLAtext = \"^^^\";\n\t\tstrSLAvalue = \"^^^\";\n\t} \n\telse\n\t{\n\t\tstrPrioritytext = mainform.tb_sla.text;\n\t\tstrSLAtext = mainform.tb_sladef.text;\n\t\tstrSLAvalue = mainform.tb_sladef.value;\n\t}\n\n\t\/\/-- NWJ - 08.02.2007 - We might want to update call values before updating i.e. for customisation\n\t\/\/-- update opencall fields - we need to do this by looping through form elements\t\n\t\/\/-- problem is BeginCallValueUpdates doesnt accept multiple callrefs so have to do a call update per callref\n\tvar arrUpdateCallValues = new Array();\n\tvar boolCallUpdates = false;\n\tvar strOpencall = \"\";\n\tvar rec = _swdoc.GetRecord(\"opencall\");\t\t\t\n\tif(rec)\n\t{\n\t\tvar nColCount = rec.GetCount();\n\t\tfor(x=0; x<nColCount; x++)\n\t\t{\n\t\t\tboolSkip = false;\n\t\t\tvar strColumn = rec.GetColumnName(x);\n\t\t\tif(strColumn==\"itsm_sladef\")\n\t\t\t{\n\t\t\t\tvar strValue = rec.GetValue(x);\n\t\t\t\tif(strValue==\"\")\n\t\t\t\t{\n\t\t\t\t\tboolSkip = true;\n\t\t\t\t}\n\t\t\t\tif(strValue<1)\n\t\t\t\t\tboolSkip = true;\n\t\t\t}\t\n\n\t\t\tif(!rec.IsModified(x) || boolSkip)\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tboolCallUpdates = true;\n\t\t\tif(strColumn==\"itsm_sladef\")\n\t\t\t{\n\t\t\t\tvar strValue = rec.GetValue(x);\n\t\t\t\tif(strValue!=_swdoc.origSLA)\n\t\t\t\t{\n\t\t\t\t\t_swdoc.newSLA = strValue;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t}\n\t\t\tarrUpdateCallValues[strColumn] = rec.GetValue(x);\n\t\t}\n\n\t\t\/\/-- F0097408\n\t\tif(_swdoc.newSLA!=_swdoc.origSLA)\n\t\t{\n\t\t\tvar oldSLA = app.g.get_record(\"itsmsp_slad\", _swdoc.origSLA);\n\t\t\tvar currSLA = app.g.get_record(\"itsmsp_slad\", _swdoc.newSLA);\n\t\t\tvar strText = \"\";\n\t\t\tif(!oldSLA)\n\t\t\t{\n\t\t\t\tstrText = \"\\nThe SLA was changed from  to \"+currSLA.slad_id+\".\";\n\t\t\t}else\n\t\t\t{\n\t\t\t\tstrText = \"\\nThe SLA was changed from \"+oldSLA.slad_id+\" to \"+currSLA.slad_id+\".\";\n\t\t\t}\n\t\t\n\t\t\t_swdoc.updatedb.updatetxt += strText;\n\t\t\tarrUpdateCallValues['itsm_slaname'] = currSLA.slad_id;\n\t\t}\t\n\t\n\t\t\/\/-- if we have opencal l values to update\n\t\tif(boolCallUpdates)\n\t\t{\n\t\t\t\/\/-- for each opencall field that needs updating send\n\t\t\tfor (fieldName in arrUpdateCallValues)\n\t\t\t{\n\t\t\t\tstrOpencall += \"<\"+fieldName+\">\"+ app.global.PrepareForXML(arrUpdateCallValues[fieldName])+\"<\/\"+fieldName+\">\";\n\t\t\t}\t\t\t\t\n\t\t}\n\t}\n\t\n\tif(strOpencall!=\"\")\n\t{\n\t\tstrOpencall = \"<opencall>\"+strOpencall+\"<\/opencall>\";\t\n\t\tfor(var refcount = 0; refcount < _swdoc.arrCallRefs.length;refcount++)\n\t\t{\n \t\t\tvar ocxmlmc = new XmlMethodCall;\n\t\n\t\t\tocxmlmc.SetValue(\"callref\", _swdoc.arrCallRefs[refcount]);\n\t\t\tocxmlmc.SetParamAsComplexType(\"additionalCallValues\", strOpencall);\t\n\t\t\tif(ocxmlmc.Invoke(\"helpdesk\", \"updateCallValues\"))\n\t\t\t{\n\t    \t\t\/\/-- get the result\n\t\t\t\tvar strXML = (app.bWebClient)? ocxmlmc._lastresult:ocxmlmc.GetReturnXml();\n\t\t\t\tvar objRes = XMCResult(strXML);\n\t\t\t\tif(!objRes.success)\n\t\t\t\t{\n\t\t\t\t\tMessageBox(\"Unable to send opencall values to the server.\");\n\t\t\t\t\tfuncCallback(false);\n\t\t\t\t\treturn;\n\t    \t\t}\t\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tMessageBox(\"Unable to send opencall values to the server.\");\n\t\t\t\tfuncCallback(false);\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t}\n\t\n\tvar strAction = \"updateCalls\";\n\tif(strAssignToGroup==undefined)\n\t\tstrAssignToGroup = \"\";\n\tif(strAssignToGroup!=\"\")\n\t{\n\t\tif(boolThirdParty)\n\t\t\tstrAction = \"updateAndAssignCallTo3rdParty\";\n\t\telse\n\t\t\tstrAction = \"updateAndAssignCalls\";\n\t}\n\tvar updateDBRec = _swdoc.GetRecord(\"updatedb\");\n\n\t\/\/ -- Workout \"timeOfAction\" param\n\tvar strBackDate = _swdoc.nBackdatePeriod;\n\tif(strBackDate==0 && _swdoc.boolSetToMaxBackdatePeriod)\n\t{\n\t\tstrBackDate = app.global.GetCurrentEpocTime() - app.session.GetMaxBackdatePeriodAllowed();\n\t}\n\t\n \tvar xmlmc = new XmlMethodCall;\n\n \tvar arrCallref = _swdoc._form[\"callrefs\"].split(\",\");\n \tfor(x in arrCallref)\n\t\txmlmc.SetValue(\"callref\", arrCallref[x]);\t\t\n\txmlmc.SetValue(\"timeSpent\",  mainform.tm_timespent.value);\t\t\n\t\/\/xmlmc.SetValue(\"description\", updateDBRec.updatetxt);\t\n\tvar strDesc = updateDBRec.updatetxt;\n\tif (_swdoc.bTargetFixTimeChanged)\n\t\tstrDesc = \"Target Fixed Time was changed from \" + origTargetFixTime + \" to \" + _swdoc.MF().tb_target.text + \"\\n\" + strDesc; \n\txmlmc.SetValue(\"description\", strDesc);\n\tif(mainform.flg_updatepublic.text==\"1\")\n\t\txmlmc.SetValue(\"publicUpdate\", true);\n\tif(strBackDate!=0) xmlmc.SetValue(\"timeOfAction\", app.global.GetAsISO8601TimeString(strBackDate));\n\tif(updateDBRec.udsource!=\"\")\n\t\txmlmc.SetValue(\"updateSource\", updateDBRec.udsource);\t\t\n\tif(updateDBRec.udcode!=\"\")\n\t\txmlmc.SetValue(\"updateCode\", updateDBRec.udcode);\t\n\tif(strAction==\"updateAndAssignCalls\")\n\t{\n\t\txmlmc.SetValue(\"assignGroup\", strAssignToGroup);\n\t\tif(strAssignToAnalyst!=\"\")\n\t\t{\n\t\t\txmlmc.SetValue(\"assignAnalyst\", strAssignToAnalyst);\n\t\t}\n\t\txmlmc.SetValue(\"forceAssignment\",true);\n\t}\t\n\tif(strAction==\"updateAndAssignCallTo3rdParty\")\n\t{\n\t\txmlmc.SetValue(\"assignThirdPartySupplier\", strAssignToGroup);\n\t\txmlmc.SetValue(\"assignThirdPartyContract\", strAssignToAnalyst);\n\t\txmlmc.SetValue(\"forceAssignment\",true);\n\t}\n\telse\n\t{\t\n\t\t\/\/only set for update and update and assign to analyst\n\t\tif(mainform.flg_slaresponse.text==\"1\")\n\t\t{\n\t\t\txmlmc.SetValue(\"markAsSLAResponse\", true);\t\n\t\t}\n\t\t\/\/--TK Workaround for XMLMC\n\t\tif(_swdoc.boolChangeSLA)\n\t\t{\n\t\t\tif(strPrioritytext!=\"^^^\")\n\t\t\t\txmlmc.SetValue(\"priority\", strPrioritytext);\n\t\t}\t\t\n\t\t\/\/don't send the target fix time unless changed\n\t\tif (_swdoc.bTargetFixTimeChanged)\n\t\t{\n\t\t\tvar intEpoch = mainform.tb_target.value;\t\t\t\n\t\t\tvar thisDate = new Date(app.g.fixepoch(intEpoch)*1000);\n\t\t\t\n\t\t\tvar thisYear = thisDate.getFullYear();\n\t\t\tvar thisMonth = thisDate.getMonth()+1;\n\t\t\tvar thisDay = thisDate.getDate();\n\t\t\tvar thisHours = thisDate.getHours();\n\t\t\tvar thisMinutes = thisDate.getMinutes();\n\t\t\tvar thisSeconds = thisDate.getSeconds();\n\t\t\t\n\t\t\tif(thisDay<10)thisDay = \"0\"+thisDay;\n\t\t\tif(thisMonth<10)thisMonth = \"0\"+thisMonth;\n\t\t\tif(thisHours<10)thisHours = \"0\"+thisHours;\n\t\t\tif(thisMinutes<10)thisMinutes = \"0\"+thisMinutes;\n\t\t\tif(thisSeconds<10)thisSeconds = \"0\"+thisSeconds;\n\t\t\t\n\t\t\tvar strDate = thisYear+\"-\"+thisMonth+\"-\"+thisDay+\"T\"+thisHours+\":\"+thisMinutes+\":\"+thisSeconds+\"Z\";\n\t\t\txmlmc.SetValue(\"targetFixTime\", strDate);\n\t\t}\n\t}\n\t\n\t\/\/ -- File(s) located on the server that will be attached to the Call\n\t\/\/ -- Used to set \"fileAttachment\" param of _swdoc.UpdateCalls API\n\tfor (var i=0; i<mainform.fl_attachslist.rowCount(); i++)\n\t\t{\n\t\tvar fileName = mainform.fl_attachslist.GetItemText(i,3);\n\t\tvar serverFile = fileName.indexOf(\"MFA:\");\n\t\n\t\tif (serverFile < 0)\n\t   \t\t{\n\t   \t\t\/\/ -- Uploaded File - Set filename and filedata for fileAttachment param\n\t   \t\tvar strFileName = mainform.fl_attachslist.GetItemText(i,0);\n\t   \t\tvar strData = app.global.LoadFileInBase64(mainform.fl_attachslist.GetItemText(i,3));\n\t   \t\tvar strXML = \"<fileName>\"+strFileName+ \"<\/fileName>\";\n\t   \t\tif (!app.bWebClient)\n\t\t   \t\tstrXML += \"<fileData>\"+strData+\"<\/fileData>\";\n\t   \t\txmlmc.SetParamAsComplexType(\"fileAttachment\",strXML);\n\t   \t\t}\n\t\t}\n\t\/\/ -- File(s) such as embedded files that will be attached to the call\n\t\/\/ -- Used to set \"serverFileAttachment\" param of _swdoc.UpdateCalls API\n\tfor (var i=0; i<mainform.fl_attachslist.rowCount(); i++)\n\t\t{\n\t\tvar fileName = mainform.fl_attachslist.GetItemText(i,3);\n\t\tvar serverFile = fileName.indexOf(\"MFA:\");\n\t\n\t\tif (serverFile >= 0)\n\t   \t\t{\n\t   \t\t\/\/ -- Attached File - Set filename and filesource for serverFileAttachment param\n\t   \t\tvar strFileName = mainform.fl_attachslist.GetItemText(i,0);\n\t   \t\tvar strData = mainform.fl_attachslist.GetItemText(i,3);\n\t   \t\tvar strXML = \"<fileName>\"+strFileName+ \"<\/fileName>\";\n\t\t\t\n\t   \t\tif (!app.bWebClient)\n\t\t  \t\tstrXML += \"<fileSource>\"+strData+\"<\/fileSource>\";\n\t\t\n\t   \t\txmlmc.SetParamAsComplexType(\"serverFileAttachment\",strXML);\n\t   \t\t}\n\t\t}\n\n\tvar strUpdatedb = \"\";\n\t\/\/ Send each bound value in the updatedb table that has been modified\n\tif(rec = _swdoc.GetRecord(\"updatedb\"))\n\t{\n\t\tvar nColCount = rec.GetCount();\n\t\tfor(x = 0; x < nColCount; x++)\n\t\t{\n\t\t\tif(!rec.IsModified(x))\n\t\t\t\tcontinue;\n\n\t\t\tvar fieldName = rec.GetColumnName(x);\n\t\t\tif(fieldName==\"udsource\" || fieldName ==\"udcode\" || fieldName ==\"updatetxt\")\n\t\t\t\tcontinue;\n\t\t\tstrUpdatedb += \"<\"+fieldName+\">\"+app.global.PrepareForXML(rec.GetValue(x))+\"<\/\"+fieldName+\">\";\n\t\t}\n\t}\n\tif(strUpdatedb!=\"\")\n\t{\n\t\txmlmc.SetParamAsComplexType(\"extraUpdateDbValues\", strUpdatedb);\t\n\t}\n\n\tif(xmlmc.Invoke(\"helpdesk\", strAction))\n\t{\n\t    \/\/-- get the result\n\t\tvar strXML = (app.bWebClient)? xmlmc._lastresult:xmlmc.GetReturnXml();\n\t\tvar objRes = XMCResult(strXML);\n\t\tif(!objRes.success)\n\t\t{\n\t\t\tMessageBox(\"The update transaction was rejected by the server.\");\n\t\t\tfuncCallback(false);\n\t\t\treturn;\n\t    }\t\n\t    else\n\t    {\n\t\t\tvar myXmlFile = new XmlFile(); \n\t\t\tbRet = myXmlFile.loadFromString(strXML); \n\t\t\tvar arrChildCallInfo = null;\n\t\t\tvar arrCallInfo = new Array();\n\t\t\tvar strDocs = \"\";\n\t\t\tvar strFirstCallref= \"\";\n\t\t\t\n\t\t\tfor (count = 0; count < myXmlFile.methodCallResult.params.length; count ++) \n\t\t\t{\n\t\t\t\tif(myXmlFile.methodCallResult.params[count].nodeName==\"callActionStatus\")\n\t\t\t\t{  \n\t\t\t\t\tvar boolSuccess = myXmlFile.methodCallResult.params[count]['success'].nodeValue;\n\t\t\t\t\tif(boolSuccess==\"false\")\n\t\t\t\t\t{\n\t\t\t\t\t\tvar strMessage =  myXmlFile.methodCallResult.params[count]['message'].nodeValue;\n\t\t\t\t\t\tMessageBox(strMessage);\n\t\t\t\t\t\tfuncCallback(false);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tvar strCallref = myXmlFile.methodCallResult.params[count]['callref'].nodeValue;\n\t\t\t\t\tvar strIndex = myXmlFile.methodCallResult.params[count]['udIndex'].nodeValue;\n\t\t\t\t\tarrCallInfo[strCallref] = strIndex;\n\t\t\t\t}\n\t\t\t\telse if(myXmlFile.methodCallResult.params[count].nodeName==\"callFileAttachment\")\n\t\t\t\t{\n\t\t\t\t\t\/\/-- When updating multiple calls, the same attachments are added to each call.\n\t\t\t\t\t\/\/-- So, only need to build attachments string once.\n\t\t\t\t\t\n\t\t\t\t\t\/\/-- strore first call reference\n\t\t\t\t\t\n\t\t\t\t\tif (strFirstCallref == \"\")\n\t\t\t\t\t{\n\t\t\t\t\t\tstrFirstCallref = strCallref;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\t\/\/-- Only build attachment string for first call\n\t\t\t\t\tif (strFirstCallref == strCallref)\n\n\t\t\t\t\t{\n\t\t\t\t\t\ttry\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar updateId = myXmlFile.methodCallResult.params[count]['updateId'].nodeValue;\n\t\t\t\t\t\t\tif(updateId==arrCallInfo[strCallref])\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tvar pathName = myXmlFile.methodCallResult.params[count]['pathName'].nodeValue;\n\t\t\t\t\t\t\t\tvar fileName = myXmlFile.methodCallResult.params[count]['fileName'].nodeValue;\n\t\t\t\t\t\t\t\tvar fileSize = myXmlFile.methodCallResult.params[count]['fileSize'].nodeValue;\n\t\t\t\t\t\t\t\tif(strDocs!=\"\") strDocs +=\"\\r\\n\";\n\t\t\t\t\t\t\t\tstrDocs +='displayname=\"'+fileName+'\"; path=\"'+pathName+'\"; size=\"'+fileSize+'\";';\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcatch(e)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n \t\t\t\/\/-- NWJ - ITSM - update related calls\n\t\t\tif(_swdoc.MF().flg_updatelinked_calls.text==\"1\")\n\t\t\t{\n\t\t\t\t\/\/-- for each call we are updating get slave calls and apply same update\n\t\t\t\tvar strRelatedChildCalls = \"\";\n\t\t\t\tfor(var refcount = 0; refcount < _swdoc.arrCallRefs.length;refcount++)\n\t\t\t\t{\n\t\t\t\t\tvar strCallrefFormatText = app.g.callref_pad(_swdoc.arrCallRefs[refcount]);\n\n\t\t\t\t\t\/\/-- F0086107\n\t\t\t\t\tvar strRelatedBPMParents = \"\";\n\t\t\t\t\tvar db = new SqlQuery;\t\t\n\t\t\t\t\tvar strParams = \"crfs=\"+pfu(_swdoc.arrCallRefs[refcount]);\n\t\t\t\t\tdb.InvokeStoredQuery(\"form\/updatecall\/get_tasks_for_calls\", strParams);\n\t\t\t\t\tif(db.Fetch())\n\t\t\t\t\t{\n\t\t\t\t\t\tvar nParentCallref = db.GetValueAsNumber(0);\n\t\t\t\t\t\tstrRelatedBPMParents +=nParentCallref;\n\t\t\t\t\t}\n\n\t\t\t\t\tif(strRelatedBPMParents!=\"\")\n\t\t\t\t\t{\n\t\t\t\t\t\t\/\/--- update relaTED CALLS\t\t\t\t\t\n \t\t\t\t\t\tvar xmlmc = new XmlMethodCall;\n \t\t\t\t\t\tvar arrCallref = strRelatedBPMParents.split(\",\");\n \t\t\t\t\t\tfor(x in arrCallref)\n\t\t\t\t\t\t\txmlmc.SetValue(\"callref\", arrCallref[x]);\t\t\n\t\t\t\t\t\txmlmc.SetValue(\"timeSpent\",  mainform.tm_timespent.value);\t\n    \t\t\t\t\tvar strUpdateTxt = \t\"This request was updated as part of the following task request update (\" + strCallrefFormatText + \")\\n\" + _swdoc.updatedb.updatetxt;\n\t\t\t\t\t\txmlmc.SetValue(\"description\", strUpdateTxt);\t\n\t\t\t\t\t\tif(mainform.flg_updatepublic.text==\"1\")\n\t\t\t\t\t\t\txmlmc.SetValue(\"publicUpdate\", true);\n\t\t\t\t\t\tif(_swdoc.boolBackdate)\n\t\t\t\t\t\t\txmlmc.SetValue(\"timeOfAction\", strBackDate);\n\t\t\t\t\t\tif(updateDBRec.udsource!=\"\")\n\t\t\t\t\t\t\txmlmc.SetValue(\"updateSource\", updateDBRec.udsource);\t\t\n\t\t\t\t\t\tif(updateDBRec.udcode!=\"\")\n\t\t\t\t\t\t\txmlmc.SetValue(\"updateCode\", updateDBRec.udcode);\t\t\n\t\t\t\t\t\tif(mainform.flg_slaresponse.text==\"1\")\n\t\t\t\t\t\t\txmlmc.SetValue(\"markAsSLAResponse\", true);\t\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\tif(strUpdatedb!=\"\")\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\txmlmc.SetParamAsComplexType(\"extraUpdateDbValues\", strUpdatedb);\t\n\t\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\t\tif(xmlmc.Invoke(\"helpdesk\", \"updateCalls\"))\n\t\t\t\t\t\t{\n\t    \t\t\t\t\t\/\/-- get the result\n\t\t\t\t\t\t\tvar strXML = (app.bWebClient)? xmlmc._lastresult:xmlmc.GetReturnXml();\n\t\t\t\t\t\t\tvar objRes = XMCResult(strXML);\n\t\t\t\t\t\t\tif(!objRes.success)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tMessageBox(\"The update transaction was rejected by the server.\");\n\t\t\t\t\t\t\t\tfuncCallback(false);\n\t\t\t\t\t\t\t\treturn;\n\t    \t\t\t\t\t}\t\n\t\t\t\t\t\t}\n\t\t\t\t\t}\/\/-- if(strRelatedBPMParents!=\"\")\t\t\t\t\t\t\t\n\t\t\t\t\t\/\/-- end of F0086107\n\t\t\t\t\t\n\t\t\t\t\t\/\/-- get slave calls\n\t\t\t\t\tstrRelatedChildCalls = \"\";\n\t\t\t\t\tvar strAddCalls = app.g.get_slave_calls(_swdoc.arrCallRefs[refcount],\"\",true);\n\t\t\t\t\tif(strAddCalls!=\"0\")\n\t\t\t\t\t{\n\t\t\t\t\t\tstrRelatedChildCalls+=strAddCalls;\n\t\t\t\t\t}\n\t\t\t\n\t\t\t\t\tif(strRelatedChildCalls!=\"\")\n\t\t\t\t\t{\n\t\t\t\t\t\t\/\/-- dont change sla unless set to do so in global params\n\t\t\t\t\t\tif(intApplySLAToChildCalls==1)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar strOpencall = \"<opencall><itsm_slaname>\"+strSLAtext+\"<\/itsm_slaname><itsm_sladef>\"+strSLAvalue+\"<\/itsm_sladef><\/opencall>\";\t\n\t\t\t\t\t\t\tvar arrChildCallref = strRelatedChildCalls.split(\",\");\n \t\t\t\t\t\t\tfor(var refcount = 0; refcount < arrChildCallref.length;refcount++)\n\t\t\t\t\t\t\t{\n \t\t\t\t\t\t\t\tvar ocxmlmc = new XmlMethodCall;\n\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tocxmlmc.SetValue(\"callref\", arrChildCallref[refcount]);\n\t\t\t\t\t\t\t\tocxmlmc.SetParamAsComplexType(\"additionalCallValues\", strOpencall);\t\n\t\t\t\t\t\t\t\tif(ocxmlmc.Invoke(\"helpdesk\", \"updateCallValues\"))\n\t\t\t\t\t\t\t\t{\n\t    \t\t\t\t\t\t\t\/\/-- get the result\n\t\t\t\t\t\t\t\t\tvar strXML = (app.bWebClient)? ocxmlmc._lastresult:ocxmlmc.GetReturnXml();\n\t\t\t\t\t\t\t\t\tvar objRes = XMCResult(strXML);\n\t\t\t\t\t\t\t\t\tif(!objRes.success)\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tMessageBox(\"Unable to send opencall values to the server.\");\n\t\t\t\t\t\t\t\t\t\tfuncCallback(false);\n\t\t\t\t\t\t\t\t\t\treturn;\n\t    \t\t\t\t\t\t\t}\t\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tMessageBox(\"Unable to send opencall values to the server.\");\n\t\t\t\t\t\t\t\t\tfuncCallback(false);\n\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n \t\t\t\t\t\tvar xmlmc = new XmlMethodCall;\n\t\t\t\t\t\n \t\t\t\t\t\tvar arrCallref = strRelatedChildCalls.split(\",\");\n \t\t\t\t\t\tfor(x in arrCallref)\n\t\t\t\t\t\t\txmlmc.SetValue(\"callref\", arrCallref[x]);\t\t\n\t\t\t\t\t\txmlmc.SetValue(\"timeSpent\",  mainform.tm_timespent.value);\t\n\t\t\t\t\t\tvar strDescription = \"This request was updated as part of the following parent request update (\" + strCallrefFormatText + \")\\n\" + _swdoc.updatedb.updatetxt;\n\t\t\t\t\t\txmlmc.SetValue(\"description\", strDescription);\t\n\t\t\t\t\t\tif(mainform.flg_updatepublic.text==\"1\")\n\t\t\t\t\t\t\txmlmc.SetValue(\"publicUpdate\", true);\n\t\t\t\t\t\tif(_swdoc.boolBackdate)\n\t\t\t\t\t\t\txmlmc.SetValue(\"timeOfAction\", strBackDate);\n\t\t\t\t\t\tif(updateDBRec.udsource!=\"\")\n\t\t\t\t\t\t\txmlmc.SetValue(\"updateSource\", updateDBRec.udsource);\t\t\n\t\t\t\t\t\tif(updateDBRec.udcode!=\"\")\n\t\t\t\t\t\t\txmlmc.SetValue(\"updateCode\", updateDBRec.udcode);\t\t\n\t\t\t\t\t\tif(mainform.flg_slaresponse.text==\"1\")\n\t\t\t\t\t\t\txmlmc.SetValue(\"markAsSLAResponse\", true);\t\n\t\t\t\t\t\n\t\t\t\t\t\t\/\/-- dont change sla or target fix time unless set to do so in global params\n\t\t\t\t\t\tif(intApplySLAToChildCalls==1)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif(strPrioritytext!=\"^^^\")\n\t\t\t\t\t\t\t\txmlmc.SetValue(\"priority\", strPrioritytext);\t\t\n\t\t\t\t\t\t\t\/\/don't send the target fix time unless changed\n\t\t\t\t\t\t\tif (_swdoc.bTargetFixTimeChanged)\n\t\t\t\t\t\t\t\txmlmc.SetValue(\"targetFixTime\", mainform.tb_target.value);\n\t\t\t\t\t\t}\t\n\t\t\t\t\t\tif(strUpdatedb!=\"\")\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\txmlmc.SetParamAsComplexType(\"extraUpdateDbValues\", strUpdatedb);\t\n\t\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\t\tif(xmlmc.Invoke(\"helpdesk\", \"updateCalls\"))\n\t\t\t\t\t\t{\n\t    \t\t\t\t\t\/\/-- get the result\n\t\t\t\t\t\t\tvar strXML = (app.bWebClient)? xmlmc._lastresult:xmlmc.GetReturnXml();\n\t\t\t\t\t\t\tvar objRes = XMCResult(strXML);\n\t\t\t\t\t\t\tif(!objRes.success)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tMessageBox(\"The update transaction was rejected by the server.\");\n\t\t\t\t\t\t\t\tfuncCallback(false);\n\t\t\t\t\t\t\t\treturn;\n\t    \t\t\t\t\t}\t\n\t    \t\t\t\t\telse\n\t    \t\t\t\t\t{\n\t\t\t\t\t\t\t\tvar myXmlFile = new XmlFile(); \n\t\t\t\t\t\t\t\tbRet = myXmlFile.loadFromString(strXML); \n\t\t\t\t\t\t\t\tfor (count = 0; count < myXmlFile.methodCallResult.params.length; count ++) \n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tif(myXmlFile.methodCallResult.params[count].nodeName==\"callActionStatus\")\n\t\t\t\t\t\t\t\t\t{  \n\t\t\t\t\t\t\t\t\t\tvar strCallref = myXmlFile.methodCallResult.params[count]['callref'].nodeValue;\n\t\t\t\t\t\t\t\t\t\tvar strIndex = myXmlFile.methodCallResult.params[count]['udIndex'].nodeValue;\n\t\t\t\t\t\t\t\t\t\tarrCallInfo[strCallref] = strIndex;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\/\/-- if(strRelatedChildCalls!=\"\")\t\t\t\n\t\t\t\t}\/\/-- each call\n\t\t\t}\/\/-- if update slaves\n\t\t\t\n\t\t\t\n\t\t\t\/\/ If we have been invoked to update a call from an e-mail message, this update will \n\t\t\t\/\/ only relate to a single call. We can only handle e-mail audit trail if we are working\n\t\t\t\/\/ on a single-call update. \n\t\t\tif(_swdoc.arrCallRefs.length == 1 && \t\t\t\/\/ Are we only dealing with a single call refernce?\n\t\t\t\t_swdoc._form[\"messagesource\"] && \t\/\/ Are we woring from an e-mail message?\n\t\t\t\tdd.GetGlobalParamAsNumber(\"Email Audit Trail\/StoreEmailAuditTrail\")) \/\/ Are we configured?\n\t\t\t{\n\t\t\t\tapp.g.attach_message_to_call(_swdoc._form,_swdoc.arrCallRefs[0],arrCallInfo[_swdoc.arrCallRefs[0]],\"UpdateCallMailFolder\");\n\t\t\t}\/\/end if there is an email audit trail\n\t\n    \t\t\/\/ if we want to send an email to the customer AND there are file attachments, obtain the \n    \t\t\/\/ attachments to attach to the email as well\n    \t\tvar flSessionFilesInfo = \"\";\n    \t\tif(mainform.flg_emailcustomer.value && app.global.IsConnectedToMailServer())\n    \t\t{\n    \t\t\t  \/\/-- webclient requires callref.udindex in order to retrieve fileinfo that it can use\n                if(app.bWebClient) strDocs = _swdoc.arrCallRefs[0] + \".\" + arrCallInfo[_swdoc.arrCallRefs[0]];\n\n\t\t\t\t\/\/ Now, compose an email to the customer\t\t\t\t\t\t\t\t\t\n\t\t\t\tapp.global.ComposeCallUpdateEmail(arrCallInfo, \t\t\t\t\t\/\/ Array: Call reference-UdIndex\n\t\t\t\t\t\t\t\t\t\t_swdoc.updatedb.updatetxt, \t\/\/ Message text\n\t\t\t\t\t\t\t\t\t\tstrDocs, \t\t\/\/ File attachments\n\t\t\t\t\t\t\t\t\t\tmainform.tm_timespent.value,\n\t\t\t\t\t\t\t\t\t\t\"UpdateCallMailTemplate\", \t\t\/\/ Template name\n\t\t\t\t\t\t\t\t\t\tTEMPLATE_UPDATECALL,\t\t\t\/\/ Template type\n\t\t\t\t\t\t\t\t\t\tfunction()\n\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\/\/end if emailing customer\n \t\t\t\t\t\t\t\t\t\t\t_swdoc.bFormFieldChanged = false;\n\t\t\t\t\t\t\t\t\t\t\tfuncCallback(true);\n\t\t\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\t\/\/end if emailing customer\n \t\t\t\t_swdoc.bFormFieldChanged = false;\n\t\t\t\tfuncCallback(true);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t\n  \t\t}\n    }\n    else\n    {\n\t\tMessageBox(\"The update transaction was rejected by the server.\");\n\t\tfuncCallback(false);\n\t\treturn;\n   \t}\t\t\n}\/\/end updatecalls function\n\n\/\/ Validate the information entered into the form by the user. Return 'true' if\n\/\/ the data is OK, of 'false' otherwise.  MessageBox's may be shown to indicate\n\/\/ validation failure\nfunction ValidateForm()\n{\n\t\/\/validate timespent field\n\tif((mainform.tm_timespent.text == 0) && (mainform.tm_timespent.mandatory)) \n\t{\n\t\tMessageBox(\"You must enter the amount of time you spent on this action.\", MB_OK);\n\t\treturn false;\t\/\/ Make sure that the time spent is entered\n\t}\n    \n    \/\/validate sla field\n\tif(mainform.tb_sla.mandatory == true && mainform.tb_sla.text == \"\")\n\t{\n\t\tif(!app.global.ValidateSLAName(mainform.tb_sla.text))\n\t\t{\n\t\t\tMessageBox(\"You must select a Priority\", MB_OK);\n\t\t\treturn false;\t\/\/ Make sure that the priority is set\n\t\t}\n\t}\n\n\t\/\/validate description field\n\tif(mainform.tb_description.text == \"\")\n\t{\n\t\tMessageBox(\"You must enter an update in the  Action Description\", MB_OK);\n\t\treturn false;\t\/\/ Make sure we have some update text\n\t}\n\n\t\/\/validate target field\n\tif(mainform.tb_target.mandatory == true && mainform.tb_target.text == \"\")\n\t{\n\t\tvar Message = \"The Target Fix Time must be completed before you can apply this action\";\n\t\tMessageBox(Message);\n\t\treturn false;\t\n\t}\n\n\t\/\/validate actionsource field\n\tif(mainform.tb_actionsource.mandatory == true  && mainform.tb_actionsource.text.length == 0)\n\t{\n\t\tvar Message = \"The field '\" + mainform.lbl_actionsource.text + \"' must be completed before you can apply this action\";\n\t\tMessageBox(Message);\n\t\treturn false;\n\t}\n\t\n\t\/\/validate general update field\n\tif(mainform.tb_generalupdate.mandatory == true && mainform.tb_generalupdate.text.length == 0)\n\t{\n\t\tvar Message = \"The field '\" + mainform.lbl_actiontype.text + \"' must be completed before you can apply this action\";\n\t\tMessageBox(Message);\n\t\treturn false;\n\t}\n\t\n\t\n\t\n\tif(_swdoc.check_mandatory_fields(\"opencall\",mainform))\n\t{\n\t\treturn _swdoc.check_mandatory_fields(\"updatedb\",mainform);\n\t}\n\telse\n\t{\n\t\treturn false;\n\t}\n\t\n\treturn true;\n}\t\/\/end _swdoc.ValidateForm\n\n\/\/-- 08.02.2007 - NWJ - Check mandatory fields on the form for a given table\n\/\/--\t\t\t\t\talert user if need be and return false\t\t\t\t\t\t\nfunction check_mandatory_fields(strTable,oForm)\n{\n    for (var x = 0; x<oForm.elements.length;x++)\n    {\n        var element = oForm.elements[x];\n        if ((element.mandatory) && (element.text ==\"\") && (element.visible))\n        {\n            var colName = \"\";\n            var fieldName = \"(not specified)\";\n            if(element.dataRef!=\"\")\n            {\n            \tvar arrInfo = element.dataRef.split(\".\");\n            \tvar strTable = arrInfo[0];\n            \tvar colName = arrInfo[1];\n            \tvar fieldName = dd.tables[strTable].columns[colName.toLowerCase()].DisplayName;\n            }\n            MessageBox(\"The field '\" + fieldName + \"' is a mandatory field and must be completed.\");\n            return false;\n        }\n    }\n    return true;\n}"}]}}},"layouts":{"layout":[{"appearance":{"width":"557","height":"478","backgroundColor":"#ffffff","fillColour":"#ffffff","textColour":"#000000","font":{"@size":"8","#text":"Arial"}},"controls":{"control":[{"general":{"name":"tb_description","type":"Field","group":"Tab1:0"},"appearance":{"index":"0","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Arial"},"borderStyle":"Rectangle"},"objectPlacement":{"position":{"top":"318","left":"17","right":"537","bottom":"458"},"scaling":{"top":"0","left":"0","right":"100","bottom":"100"}},"data":{"binding":"updatedb.updatetxt"},"controlInfo":{"mouseOverCursor":"Window Default","type":"Text Edit","flags":{"invisible":"false","readOnly":"false","mandatory":"true","mandatoryLabelBackground":"false","mandatoryLabelText":"false","allowNullValue":"false","skipTabStop":"false","disabled":"false","protected":"true","noMacroExpand":"true","readOnlyInit":"false","autoCompleteField":"false","editUnlimitedText":"true","url":"false"},"textLineCount":"4","textInputFormat":"Text","properties":{"activeTextColor":"#eeeeee","disabledBackgroundColor":"#eeeeee","borderColor":"#c0c0c0"}}},{"general":{"name":"CaptionPanel2","type":"CaptionBar","flags":{"transparent":"true","xpStyle":"false","hasShadow":"false","toolbarButtonStyle":"false","cache":"false","hasBorder":"true","hasCheckbox":"false"}},"appearance":{"index":"1","caption":"Details","backgroundColor":"#f1f1f1","foregroundColor":"#003366","font":{"@size":"10","@bold":"1","#text":"Trebuchet (MS)"},"alignment":"Left","fillStyle":"Vertical Gradient"},"objectPlacement":{"position":{"top":"29","left":"4","right":"395","bottom":"240"},"scaling":{"top":"0","left":"0","right":"50","bottom":"0"}},"controlInfo":{"mouseOverCursor":"Window Default","properties":{"backgroundColor2":"#d8d8d8","imageHSpace":"10","slope":"12","borderColor":"#d3c9b6","headerHeight":"23","hasBorder":"1","panelBorderColor":"#d3c9b6","fillStyle":"0","panelBackgroundColor":"#f2eedd","panelBackgroundColor2":"#000000"}}},{"general":{"name":"dt_updatedate","type":"Field"},"appearance":{"index":"2","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Arial"},"borderStyle":"Rectangle"},"objectPlacement":{"position":{"top":"73","left":"11","right":"218","bottom":"91"},"scaling":{"top":"0","left":"0","right":"25","bottom":"0"}},"controlInfo":{"mouseOverCursor":"Window Default","type":"Date\/Time Control","flags":{"invisible":"false","readOnly":"false","mandatory":"false","mandatoryLabelBackground":"false","mandatoryLabelText":"false","allowNullValue":"false","skipTabStop":"false","disabled":"false","protected":"true","noMacroExpand":"false","readOnlyInit":"false","colorDateIndicator":"false"},"textLineCount":"0","textInputFormat":"Text","properties":{"rawColumns":"#eeeeee","disabledBackgroundColor":"#eeeeee","dateFormatMode":"0","borderColor":"#c0c0c0"}}},{"general":{"name":"tm_timespent","type":"Field"},"appearance":{"index":"3","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Arial"},"borderStyle":"Rectangle"},"objectPlacement":{"position":{"top":"73","left":"227","right":"286","bottom":"91"},"scaling":{"top":"0","left":"25","right":"25","bottom":"0"}},"controlInfo":{"mouseOverCursor":"Window Default","type":"Minute Time Period","flags":{"invisible":"false","readOnly":"false","mandatory":"false","mandatoryLabelBackground":"false","mandatoryLabelText":"false","allowNullValue":"false","skipTabStop":"false","disabled":"false","protected":"true","noMacroExpand":"false","readOnlyInit":"false"},"textLineCount":"0","textInputFormat":"Text","properties":{"disabledBackgroundColor":"#eeeeee","defaultValue":"5","borderColor":"#c0c0c0"}}},{"general":{"name":"tb_actionsource","type":"Field"},"appearance":{"index":"4","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Arial"},"borderStyle":"Rectangle"},"objectPlacement":{"position":{"top":"110","left":"11","right":"218","bottom":"128"},"scaling":{"top":"0","left":"0","right":"25","bottom":"0"}},"data":{"binding":"updatedb.udsource"},"controlInfo":{"mouseOverCursor":"Window Default","type":"Distinct Pick List","flags":{"invisible":"false","readOnly":"false","mandatory":"false","mandatoryLabelBackground":"false","mandatoryLabelText":"false","allowNullValue":"false","skipTabStop":"false","disabled":"false","protected":"true","noMacroExpand":"false","readOnlyInit":"false","comboAutoUpdate":"false","comboNewValues":"true","pickListOrderDesc":"false"},"textLineCount":"0","textInputFormat":"Text","properties":{"disabledBackgroundColor":"#eeeeee","defaultValue":"E-Mail","listItems":"E-Mail|Telephone|Fax|Post|Web|In Person|Online Forum|","borderColor":"#c0c0c0","sqlSource":"swdata","distinctTable":"swlists","distinctColumn":"value","displayColumn":"display_name","listFilter":"lid=CALL-ACTION-SOURCE,CALL-ACTION-SOURCE-UPDATE","storedQuery":"common.getSwLists"}}},{"general":{"name":"tb_generalupdate","type":"Field"},"appearance":{"index":"5","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Arial"},"borderStyle":"Rectangle"},"objectPlacement":{"position":{"top":"110","left":"227","right":"388","bottom":"128"},"scaling":{"top":"0","left":"25","right":"50","bottom":"0"}},"data":{"binding":"updatedb.udcode"},"controlInfo":{"mouseOverCursor":"Window Default","type":"Distinct Pick List","flags":{"invisible":"false","readOnly":"false","mandatory":"false","mandatoryLabelBackground":"false","mandatoryLabelText":"false","allowNullValue":"false","skipTabStop":"false","disabled":"false","protected":"true","noMacroExpand":"false","readOnlyInit":"false","comboAutoUpdate":"false","comboNewValues":"true","pickListOrderDesc":"false"},"textLineCount":"0","textInputFormat":"Text","properties":{"disabledBackgroundColor":"#eeeeee","defaultValue":"E-Mailed Customer","listItems":"Called Customer|E-Mailed Customer|General Update|Sent Fax|Sent Letter|Announcement Posted to Web|","borderColor":"#c0c0c0","sqlSource":"swdata","distinctTable":"swlists","distinctColumn":"value","displayColumn":"display_name","listFilter":"lid=CALL-ACTION-TYPE,CALL-ACTION-TYPE-UPDATE","storedQuery":"common.getSwLists"}}},{"general":{"name":"tb_slamultiple","type":"Field"},"appearance":{"index":"6","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Arial"},"borderStyle":"Rectangle"},"objectPlacement":{"position":{"top":"187","left":"11","right":"218","bottom":"205"},"scaling":{"top":"0","left":"0","right":"25","bottom":"0"}},"controlInfo":{"mouseOverCursor":"Window Default","type":"Text Edit","flags":{"invisible":"true","readOnly":"false","mandatory":"true","mandatoryLabelBackground":"false","mandatoryLabelText":"false","allowNullValue":"false","skipTabStop":"false","disabled":"true","protected":"false","noMacroExpand":"false","readOnlyInit":"false","autoCompleteField":"false","editUnlimitedText":"false","url":"false"},"textLineCount":"0","textInputFormat":"Text","properties":{"activeTextColor":"#eeeeee","disabledBackgroundColor":"#eeeeee","distinctTable":"priority","distinctColumn":"priority","displayColumn":"priority","defaultValue":"<Multiple Calls>","extraOptions":"\"<Multiple Calls>\"","borderColor":"#c0c0c0"}}},{"general":{"name":"tb_sla","type":"Field"},"appearance":{"index":"7","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Arial"},"borderStyle":"Rectangle"},"objectPlacement":{"position":{"top":"187","left":"11","right":"218","bottom":"205"},"scaling":{"top":"0","left":"0","right":"25","bottom":"0"}},"controlInfo":{"mouseOverCursor":"Window Default","type":"Distinct Pick List","flags":{"invisible":"false","readOnly":"false","mandatory":"false","mandatoryLabelBackground":"false","mandatoryLabelText":"false","allowNullValue":"false","skipTabStop":"false","disabled":"false","protected":"true","noMacroExpand":"false","readOnlyInit":"false","comboAutoUpdate":"false","comboNewValues":"true","pickListOrderDesc":"false"},"textLineCount":"0","textInputFormat":"Text","displayColumnValue":"SN Critical","properties":{"activeTextColor":"#eeeeee","disabledBackgroundColor":"#eeeeee","distinctTable":"itsmsp_slad_priority","distinctColumn":"fk_priority","sqlSource":"swdata","borderColor":"#c0c0c0","listFilter":"_swc_flg_sla=1&_swc_fk_slad=0","storedQuery":"common.filterByTableValues"}}},{"general":{"name":"tb_targetmultiple","type":"Field"},"appearance":{"index":"8","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Arial"},"borderStyle":"Rectangle"},"objectPlacement":{"position":{"top":"187","left":"227","right":"388","bottom":"205"},"scaling":{"top":"0","left":"25","right":"50","bottom":"0"}},"controlInfo":{"mouseOverCursor":"Window Default","type":"Text Edit","flags":{"invisible":"false","readOnly":"true","mandatory":"false","mandatoryLabelBackground":"false","mandatoryLabelText":"false","allowNullValue":"false","skipTabStop":"false","disabled":"true","protected":"false","noMacroExpand":"false","readOnlyInit":"false","autoCompleteField":"false","editUnlimitedText":"false","url":"false"},"textLineCount":"0","textInputFormat":"Text","properties":{"activeTextColor":"#eeeeee","dateFormat":"dd\/MM\/yyyy HH:mm:ss","disabledBackgroundColor":"#eeeeee","defaultValue":"<Multiple Calls>","borderColor":"#c0c0c0"}}},{"general":{"name":"tb_target","type":"Field"},"appearance":{"index":"9","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Arial"},"borderStyle":"Rectangle"},"objectPlacement":{"position":{"top":"187","left":"227","right":"388","bottom":"205"},"scaling":{"top":"0","left":"25","right":"50","bottom":"0"}},"controlInfo":{"mouseOverCursor":"Window Default","type":"Date\/Time Control","flags":{"invisible":"false","readOnly":"true","mandatory":"false","mandatoryLabelBackground":"false","mandatoryLabelText":"false","allowNullValue":"false","skipTabStop":"false","disabled":"false","protected":"true","noMacroExpand":"false","readOnlyInit":"false","colorDateIndicator":"false"},"textLineCount":"0","textInputFormat":"Text","properties":{"activeTextColor":"#eeeeee","disabledBackgroundColor":"#eeeeee","dateFormatMode":"0","borderColor":"#c0c0c0"}}},{"general":{"name":"flg_emailcustomer","type":"Field","flags":{"transparent":"true","xpStyle":"false","hasShadow":"false","toolbarButtonStyle":"false","cache":"false","hasBorder":"false","hasCheckbox":"false"}},"appearance":{"index":"10","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Trebuchet MS"},"borderStyle":"None"},"objectPlacement":{"position":{"top":"78","left":"405","right":"521","bottom":"97"},"scaling":{"top":"0","left":"50","right":"50","bottom":"0"}},"controlInfo":{"mouseOverCursor":"Window Default","type":"Form Flags","flags":{"invisible":"false","readOnly":"false","mandatory":"false","mandatoryLabelBackground":"false","mandatoryLabelText":"false","allowNullValue":"false","skipTabStop":"false","disabled":"false","protected":"true","noMacroExpand":"false","readOnlyInit":"false","comboAutoUpdate":"false","comboNewValues":"false"},"textLineCount":"0","textInputFormat":"Text","properties":{"activeTextColor":"#eeeeee","flagItems":"E-mail customer^1|","disabledBackgroundColor":"#eeeeee"}}},{"general":{"name":"flg_updatepublic","type":"Field","flags":{"transparent":"true","xpStyle":"false","hasShadow":"false","toolbarButtonStyle":"false","cache":"false","hasBorder":"false","hasCheckbox":"false"}},"appearance":{"index":"11","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Trebuchet MS"},"borderStyle":"None"},"objectPlacement":{"position":{"top":"58","left":"405","right":"534","bottom":"76"},"scaling":{"top":"0","left":"50","right":"50","bottom":"0"}},"controlInfo":{"mouseOverCursor":"Window Default","type":"Form Flags","flags":{"invisible":"false","readOnly":"false","mandatory":"false","mandatoryLabelBackground":"false","mandatoryLabelText":"false","allowNullValue":"false","skipTabStop":"false","disabled":"false","protected":"true","noMacroExpand":"false","readOnlyInit":"false","comboAutoUpdate":"false","comboNewValues":"false"},"textLineCount":"0","textInputFormat":"Text","properties":{"activeTextColor":"#eeeeee","flagItems":"Update to be public^1|","disabledBackgroundColor":"#eeeeee"}}},{"general":{"name":"flg_slaresponse","type":"Field","flags":{"transparent":"true","xpStyle":"false","hasShadow":"false","toolbarButtonStyle":"false","cache":"false","hasBorder":"false","hasCheckbox":"false"}},"appearance":{"index":"12","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Trebuchet MS"},"borderStyle":"None"},"objectPlacement":{"position":{"top":"98","left":"405","right":"546","bottom":"116"},"scaling":{"top":"0","left":"50","right":"50","bottom":"0"}},"controlInfo":{"mouseOverCursor":"Window Default","type":"Form Flags","flags":{"invisible":"false","readOnly":"false","mandatory":"false","mandatoryLabelBackground":"false","mandatoryLabelText":"false","allowNullValue":"false","skipTabStop":"false","disabled":"false","protected":"true","noMacroExpand":"false","readOnlyInit":"false","comboAutoUpdate":"false","comboNewValues":"false"},"textLineCount":"0","textInputFormat":"Text","properties":{"activeTextColor":"#eeeeee","flagItems":"Mark as SLA response^1|","disabledBackgroundColor":"#eeeeee"}}},{"general":{"name":"Tab1","type":"TabControl","flags":{"transparent":"true","xpStyle":"false","hasShadow":"false","toolbarButtonStyle":"false","cache":"false","hasBorder":"false","hasCheckbox":"false"}},"appearance":{"index":"13","caption":"Tab1","backgroundColor":"#ded7ce","foregroundColor":"#ffffff","font":{"@size":"8","#text":"Arial"},"borderStyle":"None"},"objectPlacement":{"position":{"top":"287","left":"7","right":"546","bottom":"468"},"scaling":{"top":"0","left":"0","right":"100","bottom":"100"}},"tabStyle":"Top","tabSize":"19","items":{"item":[{"name":"Description","properties":"56=#d1e0ee|_flags=0","textBorder":"None","textBackgroundColor":"#ffffff","controlInfo":{"mouseOverCursor":"Window Default","properties":{"tabColor":"#d1e0ee"}}},{"name":"File Attachments","properties":"56=#ffcc66|_flags=0","textBorder":"None","textBackgroundColor":"#ffffff","controlInfo":{"mouseOverCursor":"Window Default","properties":{"tabColor":"#ffcc66"}}}]},"selectedTextFont":{"@size":"8","#text":"Arial"},"selectedTextColor":"#000000","deselectedTextColor":"#000000","tabSlopeLeft":"2","tabSlopeRight":"2","deselectedTabHeightOffset":"1","tabSpacing":"0","controlInfo":{"mouseOverCursor":"Window Default","flags":{"invisible":"false","skipTabStop":"false","disabled":"false","protected":"true","noMacroExpand":"false","multiLine":"false"},"properties":{"tabStyle":"0"}}},{"general":{"name":"fl_attachslist","type":"FileListTable","flags":{"transparent":"false","xpStyle":"false","hasShadow":"false","toolbarButtonStyle":"false","cache":"false","hasBorder":"false","hasCheckbox":"false","showHeader":"true","verticalGridLines":"true","horizontalGridLines":"true","autoLoad":"true","allowMultiSelect":"true"},"group":"Tab1:1"},"appearance":{"index":"14","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Arial"},"borderStyle":"Rectangle"},"objectPlacement":{"position":{"top":"315","left":"16","right":"467","bottom":"459"},"scaling":{"top":"0","left":"0","right":"100","bottom":"100"}},"columns":{"controlInfo":[{"mouseOverCursor":"Window Default","type":"Text Edit","flags":{"invisible":"false","readOnly":"false","mandatory":"false","mandatoryLabelBackground":"false","mandatoryLabelText":"false","allowNullValue":"false","skipTabStop":"false","disabled":"false","protected":"false","noMacroExpand":"false","readOnlyInit":"false","autoCompleteField":"false","editUnlimitedText":"false","url":"false","hidden":"false","allowResize":"true","allowSort":"true"},"textLineCount":"0","textInputFormat":"Text","name":"File Name","width":"188","image":"-1","dataColumn":"0"},{"mouseOverCursor":"Window Default","type":"Text Edit","flags":{"invisible":"false","readOnly":"false","mandatory":"false","mandatoryLabelBackground":"false","mandatoryLabelText":"false","allowNullValue":"false","skipTabStop":"false","disabled":"false","protected":"false","noMacroExpand":"false","readOnlyInit":"false","autoCompleteField":"false","editUnlimitedText":"false","url":"false","hidden":"false","allowResize":"true","allowSort":"true"},"textLineCount":"0","textInputFormat":"Text","name":"Size","width":"70","image":"-1","dataColumn":"1"},{"mouseOverCursor":"Window Default","type":"Text Edit","flags":{"invisible":"false","readOnly":"false","mandatory":"false","mandatoryLabelBackground":"false","mandatoryLabelText":"false","allowNullValue":"false","skipTabStop":"false","disabled":"false","protected":"false","noMacroExpand":"false","readOnlyInit":"false","autoCompleteField":"false","editUnlimitedText":"false","url":"false","hidden":"false","allowResize":"true","allowSort":"true"},"textLineCount":"0","textInputFormat":"Text","name":"Last Modified","width":"120","image":"-1","dataColumn":"2"},{"mouseOverCursor":"Window Default","type":"Text Edit","flags":{"invisible":"false","readOnly":"false","mandatory":"false","mandatoryLabelBackground":"false","mandatoryLabelText":"false","allowNullValue":"false","skipTabStop":"false","disabled":"false","protected":"false","noMacroExpand":"false","readOnlyInit":"false","autoCompleteField":"false","editUnlimitedText":"false","url":"false","hidden":"false","allowResize":"true","allowSort":"false"},"textLineCount":"0","textInputFormat":"Text","name":"Full Local Path","width":"100","image":"-1","dataColumn":"3"}]},"sortColumn":"-1","sortDescending":"false","headerHeight":"16","rowHeight":"16","selectedColor":"#00008b","selectedTextColor":"#ffffff","controlInfo":{"mouseOverCursor":"Window Default","flags":{"invisible":"false","skipTabStop":"false","disabled":"false","protected":"true","noMacroExpand":"false","multiLine":"false"},"properties":{"borderColor":"#c0c0c0"}}},{"general":{"name":"btn_update","type":"EventButton","flags":{"transparent":"false","xpStyle":"true","hasShadow":"false","toolbarButtonStyle":"true","cache":"true","hasBorder":"false","hasCheckbox":"false"}},"appearance":{"index":"15","caption":"Update","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Trebuchet MS"}},"objectPlacement":{"position":{"top":"1","left":"8","right":"78","bottom":"24"},"scaling":{"top":"0","left":"0","right":"0","bottom":"0"}},"controlInfo":{"mouseOverCursor":"Window Default","flags":{"invisible":"false","skipTabStop":"false","disabled":"false","protected":"true","noMacroExpand":"false","multiLine":"false"},"properties":{"commands":"-1","eventButtonIcon":"ImageList=Hold Call;IconIndex=4","backgroundColor":"#ff9900"}}},{"general":{"name":"btn_addfile","type":"EventButton","flags":{"transparent":"false","xpStyle":"true","hasShadow":"false","toolbarButtonStyle":"false","cache":"false","hasBorder":"false","hasCheckbox":"false"},"group":"Tab1:1"},"appearance":{"index":"16","caption":"Add","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Arial"}},"objectPlacement":{"position":{"top":"312","left":"475","right":"539","bottom":"336"},"scaling":{"top":"0","left":"100","right":"100","bottom":"0"}},"controlInfo":{"mouseOverCursor":"Window Default","flags":{"invisible":"false","skipTabStop":"false","disabled":"false","protected":"true","noMacroExpand":"false","multiLine":"false"},"properties":{"commands":"74","eventButtonIcon":"ImageList=Helpdesk Utility Icons;IconIndex=74"}}},{"general":{"name":"btn_removefile","type":"EventButton","flags":{"transparent":"false","xpStyle":"true","hasShadow":"false","toolbarButtonStyle":"false","cache":"false","hasBorder":"false","hasCheckbox":"false"},"group":"Tab1:1"},"appearance":{"index":"17","caption":"Remove","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Arial"}},"objectPlacement":{"position":{"top":"342","left":"475","right":"539","bottom":"366"},"scaling":{"top":"0","left":"100","right":"100","bottom":"0"}},"controlInfo":{"mouseOverCursor":"Window Default","flags":{"invisible":"false","skipTabStop":"false","disabled":"false","protected":"true","noMacroExpand":"false","multiLine":"false"},"properties":{"commands":"-1"}}},{"general":{"name":"btn_updateassign","type":"EventButton","flags":{"transparent":"false","xpStyle":"true","hasShadow":"false","toolbarButtonStyle":"true","cache":"true","hasBorder":"false","hasCheckbox":"false"}},"appearance":{"index":"18","caption":"Update and Assign","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Trebuchet MS"}},"objectPlacement":{"position":{"top":"1","left":"81","right":"205","bottom":"24"},"scaling":{"top":"0","left":"0","right":"0","bottom":"0"}},"controlInfo":{"mouseOverCursor":"Window Default","flags":{"invisible":"false","skipTabStop":"false","disabled":"false","protected":"true","noMacroExpand":"false","multiLine":"false"},"properties":{"commands":"-1","eventButtonIcon":"ImageList=Hold Call;IconIndex=3","eventButtonIconAlign":"0","backgroundColor":"#ff9900"}}},{"general":{"name":"lbl_actiontype","type":"FieldName","flags":{"transparent":"true","xpStyle":"false","hasShadow":"false","toolbarButtonStyle":"false","cache":"false","hasBorder":"false","hasCheckbox":"false"}},"appearance":{"index":"19","caption":"Action Type","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Trebuchet MS"},"alignment":"Right","borderStyle":"None","fillStyle":"Solid"},"objectPlacement":{"position":{"top":"94","left":"225","right":"287","bottom":"106"},"scaling":{"top":"0","left":"25","right":"25","bottom":"0"}},"data":{"binding":"updatedb.udcode"},"controlInfo":{"mouseOverCursor":"Window Default"}},{"general":{"name":"lbl_actionsource","type":"FieldName","flags":{"transparent":"true","xpStyle":"false","hasShadow":"false","toolbarButtonStyle":"false","cache":"false","hasBorder":"false","hasCheckbox":"false"}},"appearance":{"index":"20","caption":"Action Source","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Trebuchet MS"},"alignment":"Right","borderStyle":"None","fillStyle":"Solid"},"objectPlacement":{"position":{"top":"94","left":"9","right":"82","bottom":"106"},"scaling":{"top":"0","left":"0","right":"0","bottom":"0"}},"data":{"binding":"updatedb.udsource"},"controlInfo":{"mouseOverCursor":"Window Default"}},{"general":{"type":"FieldName","flags":{"transparent":"true","xpStyle":"false","hasShadow":"false","toolbarButtonStyle":"false","cache":"false","hasBorder":"false","hasCheckbox":"false"}},"appearance":{"index":"21","caption":"Time Spent","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Trebuchet MS"},"alignment":"Right","borderStyle":"None","fillStyle":"Solid"},"objectPlacement":{"position":{"top":"57","left":"225","right":"282","bottom":"71"},"scaling":{"top":"0","left":"25","right":"25","bottom":"0"}},"data":{"binding":"updatedb.timespent"},"controlInfo":{"mouseOverCursor":"Window Default"}},{"general":{"name":"lbl_sla","type":"Text","flags":{"transparent":"true","xpStyle":"false","hasShadow":"false","toolbarButtonStyle":"false","cache":"false","hasBorder":"false","hasCheckbox":"false"}},"appearance":{"index":"22","caption":"Priority","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Trebuchet MS"},"alignment":"Left","borderStyle":"None","fillStyle":"Solid"},"objectPlacement":{"position":{"top":"171","left":"8","right":"208","bottom":"185"},"scaling":{"top":"0","left":"0","right":"0","bottom":"0"}},"controlInfo":{"mouseOverCursor":"Window Default"}},{"general":{"name":"lbl_target","type":"Text","flags":{"transparent":"true","xpStyle":"false","hasShadow":"false","toolbarButtonStyle":"false","cache":"false","hasBorder":"false","hasCheckbox":"false"}},"appearance":{"index":"23","caption":"Target Fix Time","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Trebuchet MS"},"alignment":"Left","borderStyle":"None","fillStyle":"Solid"},"objectPlacement":{"position":{"top":"171","left":"224","right":"337","bottom":"185"},"scaling":{"top":"0","left":"25","right":"25","bottom":"0"}},"controlInfo":{"mouseOverCursor":"Window Default","flags":{"invisible":"false","skipTabStop":"false","disabled":"true","protected":"false","noMacroExpand":"false","multiLine":"false"}}},{"general":{"name":"lbl_datetime","type":"Text","flags":{"transparent":"true","xpStyle":"false","hasShadow":"false","toolbarButtonStyle":"false","cache":"false","hasBorder":"false","hasCheckbox":"false"}},"appearance":{"index":"24","caption":"Date\/Time of Update","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Trebuchet MS"},"alignment":"Left","borderStyle":"None","fillStyle":"Solid"},"objectPlacement":{"position":{"top":"57","left":"8","right":"120","bottom":"71"},"scaling":{"top":"0","left":"0","right":"0","bottom":"0"}},"controlInfo":{"mouseOverCursor":"Window Default"}},{"general":{"name":"btn_addfile","type":"EventButton","flags":{"transparent":"false","xpStyle":"true","hasShadow":"false","toolbarButtonStyle":"true","cache":"true","hasBorder":"false","hasCheckbox":"false"}},"appearance":{"index":"25","caption":"Attach File","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Arial"}},"objectPlacement":{"position":{"top":"1","left":"456","right":"545","bottom":"24"},"scaling":{"top":"0","left":"100","right":"100","bottom":"0"}},"controlInfo":{"mouseOverCursor":"Window Default","flags":{"invisible":"false","skipTabStop":"false","disabled":"false","protected":"true","noMacroExpand":"false","multiLine":"false"},"properties":{"commands":"74","eventButtonIcon":"ImageList=Helpdesk Utility Icons;IconIndex=74","backgroundColor":"#ff9900"}}},{"general":{"name":"Rect1","type":"Rectange","flags":{"transparent":"false","xpStyle":"false","hasShadow":"false","toolbarButtonStyle":"true","cache":"true","hasBorder":"false","hasCheckbox":"false"}},"appearance":{"index":"26","backgroundColor":"#d4d0c8","foregroundColor":"#dddddd","font":{"@size":"0"},"borderStyle":"Rectangle","fillStyle":"Solid"},"objectPlacement":{"position":{"top":"0","left":"0","right":"558","bottom":"25"},"scaling":{"top":"0","left":"0","right":"100","bottom":"0"}},"controlInfo":{"mouseOverCursor":"Window Default"}},{"general":{"name":"CaptionPanel3","type":"CaptionBar","flags":{"transparent":"true","xpStyle":"false","hasShadow":"false","toolbarButtonStyle":"false","cache":"false","hasBorder":"true","hasCheckbox":"false"}},"appearance":{"index":"27","caption":"Options","backgroundColor":"#f1f1f1","foregroundColor":"#003366","font":{"@size":"10","@bold":"1","#text":"Trebuchet (MS)"},"alignment":"Left","fillStyle":"Vertical Gradient"},"objectPlacement":{"position":{"top":"29","left":"403","right":"552","bottom":"240"},"scaling":{"top":"0","left":"50","right":"100","bottom":"0"}},"controlInfo":{"mouseOverCursor":"Window Default","properties":{"backgroundColor2":"#d8d8d8","imageHSpace":"10","slope":"12","borderColor":"#d3c9b6","headerHeight":"23","hasBorder":"1","panelBorderColor":"#d3c9b6","fillStyle":"0","panelBackgroundColor":"#f2eedd","panelBackgroundColor2":"#000000"}}},{"general":{"name":"CaptionPanel1","type":"CaptionBar","flags":{"transparent":"true","xpStyle":"false","hasShadow":"false","toolbarButtonStyle":"false","cache":"false","hasBorder":"true","hasCheckbox":"false"}},"appearance":{"index":"28","caption":"Other Information","backgroundColor":"#f1f1f1","foregroundColor":"#003366","font":{"@size":"10","@bold":"1","#text":"Trebuchet (MS)"},"alignment":"Left","fillStyle":"Vertical Gradient"},"objectPlacement":{"position":{"top":"259","left":"4","right":"552","bottom":"475"},"scaling":{"top":"0","left":"0","right":"100","bottom":"100"}},"controlInfo":{"mouseOverCursor":"Window Default","properties":{"backgroundColor2":"#d8d8d8","imageHSpace":"10","slope":"12","borderColor":"#d3c9b6","headerHeight":"23","hasBorder":"1","panelBorderColor":"#d3c9b6","fillStyle":"0","panelBackgroundColor":"#f2eedd","panelBackgroundColor2":"#000000"}}},{"general":{"name":"flg_updatelinked_calls","type":"Field","flags":{"transparent":"true","xpStyle":"false","hasShadow":"false","toolbarButtonStyle":"false","cache":"false","hasBorder":"false","hasCheckbox":"false"}},"appearance":{"index":"29","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Arial"},"borderStyle":"None"},"objectPlacement":{"position":{"top":"216","left":"5","right":"397","bottom":"233"},"scaling":{"top":"0","left":"0","right":"0","bottom":"0"}},"controlInfo":{"mouseOverCursor":"Window Default","type":"Form Flags","textLineCount":"0","textInputFormat":"Text","properties":{"content":"#eeeeee","flagItems":"Apply this update to related child requests (incident \/ known errors etc)^1|","defaultValue":"1","disabledBackgroundColor":"#eeeeee"}}},{"general":{"name":"lbl_sladef","type":"FieldName","flags":{"transparent":"true","xpStyle":"false","hasShadow":"false","toolbarButtonStyle":"false","cache":"false","hasBorder":"false","hasCheckbox":"false"}},"appearance":{"index":"30","caption":"SLA","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Trebuchet MS"},"alignment":"Left","borderStyle":"None","fillStyle":"Solid"},"objectPlacement":{"position":{"top":"133","left":"9","right":"82","bottom":"145"},"scaling":{"top":"0","left":"0","right":"0","bottom":"0"}},"data":{"binding":"opencall.itsm_sladef"},"controlInfo":{"mouseOverCursor":"Window Default"}},{"general":{"name":"tb_sladef","type":"Field"},"appearance":{"index":"31","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Arial"},"borderStyle":"Rectangle"},"objectPlacement":{"position":{"top":"147","left":"11","right":"218","bottom":"165"},"scaling":{"top":"0","left":"0","right":"25","bottom":"0"}},"data":{"binding":"opencall.itsm_sladef"},"controlInfo":{"mouseOverCursor":"Window Default","type":"Distinct Pick List","flags":{"invisible":"false","readOnly":"false","mandatory":"false","mandatoryLabelBackground":"false","mandatoryLabelText":"false","allowNullValue":"false","skipTabStop":"false","disabled":"false","protected":"true","noMacroExpand":"false","readOnlyInit":"false","comboAutoUpdate":"false","comboNewValues":"true","pickListOrderDesc":"false"},"textLineCount":"0","textInputFormat":"Text","properties":{"disabledBackgroundColor":"#eeeeee","defaultValue":"0","listItems":"E-Mail|Telephone|Fax|Post|Web|In Person|Online Forum|","borderColor":"#c0c0c0","sqlSource":"swdata","distinctTable":"itsmsp_slad","distinctColumn":"pk_slad_id","displayColumn":"slad_id","listFilter":"_swc_archive=0","storedQuery":"requests.filter_itsm_sla"}}},{"general":{"name":"tb_sladefmultiple","type":"Field"},"appearance":{"index":"32","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Arial"},"borderStyle":"Rectangle"},"objectPlacement":{"position":{"top":"147","left":"11","right":"218","bottom":"165"},"scaling":{"top":"0","left":"0","right":"25","bottom":"0"}},"controlInfo":{"mouseOverCursor":"Window Default","type":"Text Edit","flags":{"invisible":"true","readOnly":"false","mandatory":"true","mandatoryLabelBackground":"false","mandatoryLabelText":"false","allowNullValue":"false","skipTabStop":"false","disabled":"true","protected":"false","noMacroExpand":"false","readOnlyInit":"false","autoCompleteField":"false","editUnlimitedText":"false","url":"false"},"textLineCount":"0","textInputFormat":"Text","properties":{"activeTextColor":"#eeeeee","disabledBackgroundColor":"#eeeeee","distinctTable":"priority","distinctColumn":"priority","displayColumn":"priority","defaultValue":"<Multiple Calls>","extraOptions":"\"<Multiple Calls>\"","borderColor":"#c0c0c0"}}},{"general":{"name":"supportWarning","type":"Text","flags":{"transparent":"true","xpStyle":"false","hasShadow":"false","toolbarButtonStyle":"false","cache":"false","hasBorder":"false","hasCheckbox":"false"}},"appearance":{"index":"33","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Arial"},"alignment":"Left","borderStyle":"None","fillStyle":"Solid"},"objectPlacement":{"position":{"top":"240","left":"6","right":"482","bottom":"259"},"scaling":{"top":"0","left":"0","right":"0","bottom":"0"}},"controlInfo":{"mouseOverCursor":"Window Default","flags":{"invisible":"true","skipTabStop":"false","disabled":"false","protected":"false","noMacroExpand":"false","multiLine":"false"}}}]},"javascript":{"methods":{"method":[{"name":"OnFormLoaded","code":"OnFormLoaded()\n{\n\t\/*\n\t\tCreated by Hornbill Systems\n\t\t\n\t\tUpdates\n\t\t-------\n\t\t\n\t\tCode\tBug\t\tDate\t\tAuthor\t\t\t\t\tDescription\n\t\t-----------------------------------------------------------------------------------------\n\t\tind01\t57303\t11\/05\/07\tIvan Nicholas Dorosh\tProblem with multiple calls, this is due to the state of \n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tthe objects when they are saved.  The form was expecting \n\t\t\t\tthese to be in a visible, state.  This would be fixed by resetting the form values to visible, however\n\t\t\t\tif the state of the fields were invisible and the form saved, the issue would re-occur. Therefore my \n\t\t\t\tsolution is to force them to be visible on initial load.\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t*\/\n\t\n\t\/\/ind01\n\t_een(lbl_sla,true);\n\t_evi(mainform.tb_sla,true);\n\t_evi(mainform.tb_slamultiple,false);\n\t_evi(mainform.tb_sladefmultiple,false);\n\t_evi(mainform.tb_target,true);\n\t_evi(mainform.flg_slaresponse,true);\n\t_evi(mainform.flg_updatepublic,true);\n\t_evi(mainform.flg_emailcustomer,true);\n\t\/\/ind01 end\n\t\n\t\/\/ Set form with defaults set:\n\n\t\/\/ if analyst does not have permission to assign calls, then make the Update and Assign button invisible.\n\tif(!app.session.HaveRight(ANALYST_RIGHT_A_GROUP,ANALYST_RIGHT_A_CANASSIGNCALLS) || _swdoc.bOnHold)\n\t{\n\t\t_evi(btn_updateassign,false);\n\t}\n\t\n\t\/\/ if the analyst does not have permission to change call statuses, and there is more than one call passed, and these\n\t\/\/ do not have the same call status *or* any of the calls are of ineligible status, disable the \"assign\" button\n\t\/\/ ineligible status is anything but unassigned or unaccepted\n\tif(!app.session.HaveRight(ANALYST_RIGHT_A_GROUP,ANALYST_RIGHT_A_CANMODIFYCALLS))\n\t{\n\t\tif((_swdoc.nUnaccepted > 0 && _swdoc.nUnassigned > 0) || (_swdoc.nUnaccepted + _swdoc.nUnassigned !== _swdoc.arrCallRefs.length))\n\t\t{\n\t\t\t_evi(btn_updateassign,false);\n\t\t}\n\t}\n\t\n\t\/\/ set update date to current time\n\t_eva(dt_updatedate,(_swdoc.dtCurrentTime.getTime()\/1000));\n\t\n\t\/\/ if analyst has permission to backdate calls, make update time editable\n\t\n\tif(app.session.CanBackdateCallActions())\n\t{\n\t\t_ero(dt_updatedate,false);\n\t\t_een(lbl_datetime,true);\n\t}\n\t\n\t\t\n\t\n\t\/\/ If the analyst's default is to send an email on update, check the email box\n\t\/\/ else we uncheck the box\n\tif(app.session.IsDefaultOption(ANALYST_DEFAULT_UPDATESENDEMAIL))\n\t{\n\t\t_eva(flg_emailcustomer,\"1\");\n\t}\n\telse\n\t{\n\t\t_eva(flg_emailcustomer,\"0\");\n\t}\n\t\n\t\/\/If we are not connected to a mail server then reset and disable the email flag\n\tif(app.global.IsConnectedToMailServer() == false)\n\t{\n\t\t_eva(flg_emailcustomer,\"0\");\n\t\t_een(flg_emailcustomer,false);\n\t}\n\t\n\t\/\/ if the analyst's default is to make the update private, then check the Make Private box.\n\t_eva(flg_updatepublic,app.session.IsDefaultOption(ANALYST_DEFAULT_UPDATEPRIVATE));\n\t\n\t_swdoc.strCurrentSLARespondedTo = app.g.check_sla_response_flag(_swdoc._form[\"callrefs\"],_swdoc.MF().flg_slaresponse);\n\t\t\n\tvar db = new SqlQuery;\n\t\n\n\t\/\/if this form has been called with attachments, add them to the attachments list\n\tvar index = 0;\n\tvar bAreAttachments = false;\n\t\n \twhile(_swdoc._form[\"attach\"+index]) \n \t{\n \t\tbAreAttachments = true;\n    \tfl_attachslist.AddAttachment(_swdoc._form[\"attach\" + index]);\n\t\tindex++;\n \t} \n \t\n \t\/\/if the analyst does not have permissions to add files to calls, make the file attachments box invisible\n \t\/\/UNLESS there are file attachments being included from the email which called this form, in which case\n \t\/\/show the file attachments, but make the Add and Remove buttons invisible\n \t\n \tif(!app.session.HaveRight(ANALYST_RIGHT_A_GROUP,ANALYST_RIGHT_A_CANATTACHFILESTOCALLS, false))\n \t{\n \t\tif(!bAreAttachments)\n \t\t{\n \t\t\tTab1.ShowTabItem(1,false);\n \t\t}\n \t\telse\n \t\t{\n \t\t\t_evi(btn_addfile,false);\n \t\t\t_evi(btn_removefile,false);\n \t\t}\n \t}\n \t\n\t\n\t\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/  SLAs \/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\n\t\/\/ \n\t\/\/ if multiple calls, disable and write \"multiple calls\"  \n\tif (_swdoc.arrCallRefs.length > 1)\n\t{\t\n\t\t_evi(tb_sla,false);\n\t\t_evi(tb_slamultiple,true);\n\t\t_een(lbl_sla,false);\n\t\t_evi(tb_sladef,false);\n\t\t_evi(tb_sladefmultiple,true);\n\t}\n\telse\n\t{\n\t\t\n\t\tvar strParams = \"crf=\"+pfu(_swdoc.arrCallRefs[0]);\n\t\tdb.InvokeStoredQuery(\"form\/updatecall\/get_sla_details\", strParams);\n\t\t\n\t\tif(db.Fetch())\n\t\t{\n\t\t\tif(db.GetValueAsString(0))\n\t\t\t{\n\t\t\t\t_eva(tb_sla,db.GetValueAsString(0));\n\t\t\t\t_ete(tb_sla,db.GetValueAsString(0));\n\t\t\t\t_swdoc.strCurrentSLA = db.GetValueAsString(0);\n\t\t\t}\n\t\n\t\t\tif(db.GetValueAsString(1) == \"_THIRDPARTY\")\n\t\t\t{\n\t\t\t\t_ete(flg_slaresponse,\"Mark as Third Party SLA Response\");\n\t\t\t}\n\t\t\tif(db.GetValueAsString(2))\n\t\t\t{\n\t\t\t\t_slf(tb_sla , \"_swc_flg_sla=1&_swc_fk_slad=\"+ db.GetValueAsNumber(2));\n\t\t\t\topencall.itsm_sladef = db.GetValueAsNumber(2);\n\t\t\t\t_swdoc.origSLA = db.GetValueAsNumber(2);\n\t\t\t\t_swdoc.newSLA = _swdoc.origSLA;\n\t\t\t\t_swdoc.UpdateFormFromData();\n\t\t\t\t_swdoc.ResetModiedFlag(\"opencall\");\n\t\t\t}\n\t\t}\t\n\t}\n\t\n\tdb.Reset();\n\t\/\/ if the analyst does not have permissions to change SLAs or call statuses, or if there is more than one call passed, disable the SLA box & text.\n\t\/\/ note:  because Javascript will not evaluate right-hand expressions unless all prior expressions return false, the GetCallStatus\n\t\/\/ at the end of this expression will not be called unless arr.CallRefs.length is <= 1.\n\tif(!app.session.HaveRight(ANALYST_RIGHT_A_GROUP,ANALYST_RIGHT_A_CANCHANGEPRIORITY) || !app.session.HaveRight(ANALYST_RIGHT_A_GROUP,ANALYST_RIGHT_A_CANMODIFYCALLS) || _swdoc.arrCallRefs.length > 1 || \n\t\t_swdoc.bOnHold || _swdoc.bNotOpen)\n\t{\n\t\t_een(lbl_sla,false);\n\t\t_een(tb_sla,false);\n\t\t_een(lbl_sladef,false);\n\t\t_een(tb_sladef,false);\n\t\t\/\/--TK Workarround for XMLMC \n\t\t_swdoc.boolChangeSLA = false;\n\t} else\n\t{\n\t\t\/\/--TK Workarround for XMLMC\n\t\t_swdoc.boolChangeSLA = true;\n\t}\n\n\n   \t\n   \t\/\/ if the data dictionary calls the priority something other than \"SLA\", change the label\n   \tif(dd.tables[\"updatedb\"].IsColumnDefined(\"priority\"))\n   \t{\n   \t\t_ete(lbl_sla,dd.tables[\"updatedb\"].columns[\"priority\"].DisplayName);\n\t}\n\n\t\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/ FIX BY \/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\n\t\/\/ set the Fix By time to the current date, unless there is another one set already\n\tif (_swdoc.arrCallRefs.length >1)\n\t{\n\t\t_evi(tb_target,false);\n\t\t_evi(tb_targetmultiple,true);\n\t}\n\telse\n\t{\n\t\n\t\t\/\/-- system allows analyst to adjust time\n\t\t\/\/-- so check if fix time has already been missed if so disable it\t\t\n\t\tvar strParams =\"crf=\"+pfu(_swdoc.arrCallRefs[0]);\n   \t\tdb.InvokeStoredQuery(\"form\/updatecall\/get_fix_details\", strParams);\n   \t\tif(db.Fetch())\n\t\t{\n\t\t\t_eva(tb_target,db.GetValueAsString(0));\n\t\t\torigTargetFixTime = _swdoc.MF().tb_target.text;\n\t\t\t\t\t\t\t\n\t\t\t\/\/-- NWJ - 21.04.2006 -\tbug ref 45542\n\t\t\t\/\/-- We werent checking the actual fix_ctr and disabling \/ enabling fix time as needed\n\t\t\t\n\t\t\t\/\/-- if fix_ctr > 0, then make target fix time editable\n\t\t\tvar intFixCounter = db.GetValueAsNumber(1);\n\t\t\t\n\t\t\tvar boolEnable = (intFixCounter > 0);\n\t\t\t_ero(tb_target,(!boolEnable));\n\t\t\t_een(lbl_target,boolEnable);\n\t\t\t\t\t\t\n\t\t\t\/\/-- disable if the call is resolved or closed\n\t\t\tvar status = db.GetValueAsNumber(2)\n\t\t\tif ((status == 6) || (status > 15))\n\t\t\t{\n\t\t\t\t_ero(tb_target,true);\n\t\t\t\t_een(lbl_target,false);\n\t\t\t}\n\t\t\t\t\t\n\t\t}\n\t\telse\n\t\t{\n\t\t\t_eva(tb_target,app.global.GetCurrentEpocTime());\n\t\t}\n\t\n\t\tdb.Reset();\n\n\t}\n\t\t\n\t\/\/ES - F0111089 - Display label within Update Call Form if Organisation is out of Support\n\tif (_swdoc.arrCallRefs.length >1)\n\t{\n\t\t\/\/multiple calls\n\t\tvar intExpiryEpoch = new Array();\n\t\tvar orgName = new Array();\n\t\tvar supportStatus = new Array();\n\t\tvar warningMsg = \"Warning: The organisation for one or more of the selected calls is no longer supported.\";\n\t\t\n\t\tfor(var i=0; i<_swdoc.arrCallRefs.length; i++)\n\t\t{\n\t\t\tdb.InvokeStoredQuery(\"company\/get_call_organisation\",\"in_callref=\"+_swdoc.arrCallRefs[i]);\n\t\t\tif (db.Fetch())\n\t\t\t{\n\t\t\t\tintExpiryEpoch[i] = app.g.fix_epoch(app.g.get_field(db,\"SUPPORTEXPIRYX\"));\n\t\t\t\torgName[i] = app.g.get_field(db,\"COMPANYNAME\");\n\t\t\t\tsupportStatus[i] = app.g.checkOrgSupport(orgName[i], intExpiryEpoch[i], false);\n\t\t\t\t\n\t\t\t\tif(supportStatus[i]==0)\n\t\t\t\t{\n\t\t\t\t\t_eva(mainform.supportWarning , warningMsg);\n\t\t\t\t\t_ecol(mainform.supportWarning , '#FF0000');\n\t\t\t\t\t_evi(mainform.supportWarning, TRUE);\n\t\t\t\t}\n\t\t\t}\n\t\t}\t\t\n\t}\n\t\n\telse\n\t{\n\t\t\/\/single call\n\t\tvar intExpiryEpoch = \"\";\n\t\tvar orgName = \"\";\n\t\t\t\n\t\tfor(var i=0; i<_swdoc.arrCallRefs.length; i++)\n\t\t{\n\t\t\tdb.InvokeStoredQuery(\"company\/get_call_organisation\",\"in_callref=\"+_swdoc.arrCallRefs[i]);\n\t\t\tif (db.Fetch())\n\t\t\t{\n\t\t\t\tintExpiryEpoch = app.g.fix_epoch(app.g.get_field(db,\"SUPPORTEXPIRYX\"));\n\t\t\t\torgName = app.g.get_field(db,\"COMPANYNAME\");\n\t\t\t\torgID = app.g.get_field(db,\"PK_COMPANY_ID\");\n\t\t\t\tvar warningMsg = \"Warning: The '\" + orgName + \"' organisation is no longer supported.\";\n\t\t\t\tvar supportStatus = app.g.checkOrgSupport(orgID, intExpiryEpoch, false);\n\t\n\t\t\t\tif(supportStatus==0)\n\t\t\t\t{\n\t\t\t\t\t_eva(mainform.supportWarning , warningMsg);\n\t\t\t\t\t_ecol(mainform.supportWarning , '#FF0000');\n\t\t\t\t\t_evi(mainform.supportWarning, TRUE);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n}"},{"name":"dt_updatedate_OnValueChanged","code":"dt_updatedate_OnValueChanged(strValue)\n{\n\t\/\/ -- Var used in this to calculate backDatePeriod\n\tvar nBackdatePeriod = 0;\n\t\n\t\/\/ -- Calculate the backDatePeriod for processing\n\tvar updateDateTime = mainform.dt_updatedate.text;\n\tvar updateDateTimeValue = mainform.dt_updatedate.value;\n\tnBackdatePeriod = _swdoc.intGetCurrentEpocTime - updateDateTimeValue;\n\t\n\t\/\/ -- Processing to set \"updatedb.updatetimex\" and set _swdoc level nBackdatePeriod variable for use in Resolve\/Close action\n\tvar funcProcessBackdate = function()\n\t{\n\t\t\/\/ make sure that the backdate time is not prior to the last previous update time for any of the calls being updated\n\t\tSqlRecordSetObj = new SqlQuery;\n\t\tvar strParams = \"crfs=\"+pfu(_swdoc._form[\"callrefs\"]);\n\t\tSqlRecordSetObj.InvokeStoredQuery(\"form\/updatecall\/get_time_of_last_update\", strParams);\n\t\tif(SqlRecordSetObj.Fetch())\n\t\t{\n\t\t\tvar dtLastUpdate = new Date();\n\t\t\tdtLastUpdate.setTime(SqlRecordSetObj.GetValueAsNumber(0));\n\t\t\t\n\t\t\tif(dtLastUpdate > (dt_updatedate.value * 1000))\n\t\t\t{\n\t\t\t\tvar message = \"You have chosen to backdate this action \\nto a time before than the last action was carried out against one of the selected calls. This is not allowed!\\n\\n\\nThe last action was carried out on \";\n\t\t\t\tMessageBox(message + dtLastUpdate.toLocaleString(), MB_ICONQUESTION | MB_OK);\n\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t\n\t\tif(nBackdatePeriod==0)\n\t\t{\n\t\t\t_eva(dt_updatedate,app.global.GetCurrentEpocTime());\n\t\t}\n\t\tif(_swdoc.boolSetToMaxBackdatePeriod)\n\t\t{\n\t\t\t_eva(dt_updatedate,app.global.GetCurrentEpocTime() - app.session.GetMaxBackdatePeriodAllowed());\n\t\t}\n\t\t_swdoc.nBackdatePeriod = nBackdatePeriod;\t\n\t\t_swdoc.UpdateFormFromData();\n\t}\n\t\n\t\/\/ -- Deny if the user has attempted to forward the Date\/Time\n\tif(nBackdatePeriod < 0)\n\t{\n\t\tMessageBox(\"You have attempted to forward date this call update which is not allowed.\");\n\t\t_swdoc.boolSetToMaxBackdatePeriod = false;\n\t\tnBackdatePeriod=0;\n\t\tfuncProcessBackdate();\n\t}\n\telse\n\t{\t\n\t\t\/\/ -- Check that the selected Date\/Time value does not exceed the maximum allowed backDatePeriod and prompt with an option to set to allowed Date\/Time value\n\t\tif(nBackdatePeriod > app.session.GetMaxBackdatePeriodAllowed())\n\t\t{\n\t\t\tvar dTime = app.global.GetCurrentEpocTime() - app.session.GetMaxBackdatePeriodAllowed();\n\t\t\tvar strMsg = \"You have attempted to backdate this call update further than you have sufficient privileges to do so.\\n\\nDo you want to use the oldest date\/time that you are allowed: \" + app.global.ConvertDateTimeInText(app.global.GetAsISO8601TimeString(dTime));\n\t\t\tMessageBox(strMsg, MB_ICONQUESTION | MB_YESNO, function(intDecision)\n\t\t\t{\t\n\t\t\t\tif(intDecision != IDYES)\n\t\t\t\t{\n\t\t\t\t\tnBackdatePeriod = 0;\n\t\t\t\t\t_swdoc.boolSetToMaxBackdatePeriod = false;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\t\/\/ -- Maximum backdate period allowed should only be calculated when invoking the API otherwise the value will be inacurrate\n\t\t\t\t\tnBackdatePeriod = 0;\n\t\t\t\t\t_eva(dt_updatedate, dTime);\n                    _swdoc.boolSetToMaxBackdatePeriod = true;\n\t\t\t\t}\n\t\t\t\tfuncProcessBackdate();\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\t\/\/ -- timeOfAction param in resolveCalls API expects .value property of Date\/Time control field\n\t\t\tnBackdatePeriod = updateDateTimeValue;\n\t\t\t_swdoc.boolSetToMaxBackdatePeriod = false;\n\t\t\tfuncProcessBackdate();\n\t\t}\n\t}\n}"},{"name":"btn_update_OnPressed","code":"btn_update_OnPressed()\n{\n\t\/\/ Validate Form\n\tif(!_swdoc.ValidateForm())\n\t{\n\t\treturn;\n\t}\n\n\t\/\/ Update Calls Fun -- this will be defined globally, so that we can reuse the code\n\t\/\/ for the Update and Assign option\t\n\tvar strAssignTo = \"\";\n\t\n\t_swdoc.UpdateCalls(\"\",\"\",false,function(boolSuccess)\n\t{\n\t\tif(boolSuccess)\n\t\t{\n\t\t\t_swdoc.CloseForm();\n\t\t}\n\t});\n\t\t\n\t\n}"},{"name":"btn_updateassign_OnPressed","code":"btn_updateassign_OnPressed()\n{\n\t\/\/ Validate Form\n\tif(!_swdoc.ValidateForm())\n\t{\n\t\treturn;\n\t}\n\t\n\t\/\/-- required for modeless message box\n\tvar funcUpdateCalls = function(strSupportGroup,strAnalyst,bAssignedToThirdParty)\n\t{ \n\t\t\/\/ Update Calls Function -- this is being defined globally so that we can reuse it for the Update Call form\n\t\t\n\t\t_swdoc.UpdateCalls(strSupportGroup,strAnalyst,bAssignedToThirdParty,function(boolSuccess)\n\t\t{\n\t\t\tif (boolSuccess)\n\t\t\t{\n\t\t\t\t_swdoc.CloseForm();\n\t\t\t}\n\t\t});\n\t}\n\t\n\t\/\/-- required for modeless message box\n\tvar funcCheckMaxCalls = function(bAssignedToThirdParty,intMaxAssignedCalls,strAnalystID)\n\t{\n\t\t\/\/ If this analyst has a maximum number of calls set, make sure that this number has not been exceeded\n\t\tif((!bAssignedToThirdParty)&&(intMaxAssignedCalls > 0) )\n\t\t{\t\n\t\t\tvar nCount = app.g.sqs_rowcount(\"count\/assigned_calls\", \"aid=\"+app.pfu(strAnalystID), true);\n\t\t\tif(nCount >= intMaxAssignedCalls)\n\t\t\t{\n\t\t\t\tMessageBox(\"The Maximum Call Assignment count has been reached for this analyst. No call assignment possible.\", MB_ICONSTOP);\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t}\n\t\n\t\n\t\n\tvar analChosenAnalyst = new PickAnalystDialog;\n\tanalChosenAnalyst.Open(\"Group\/Analyst Picker\",function(analChosenAnalyst)\n\t{\n\t\tif(!analChosenAnalyst)\n\t\t{\n\t\t\t return;\n\t\t}\t\n\t\t\t\n\t\t\/\/ Get an Analyst to assign call to\t\t\n\t\tvar bAssignedToThirdParty = false;\n\t\tvar strAnalyst = \"\";\n\t\tvar strSupportGroup = \"\";\n\t\n\t\t\/\/ check if a group id and analyst id have been chosen, and if the group is Third Party.\n\t\tif(analChosenAnalyst.groupid.length)\n\t\t{\n\t\t\tstrSupportGroup = analChosenAnalyst.groupid;\n\t\t\tif(analChosenAnalyst.analystid.length)\n\t\t\t{\n\t\t\t\tstrAnalyst = analChosenAnalyst.analystid;\n\t\t\t}\n\t\n\t\t\t\/\/-- F0098059\n\t\t\tif(analChosenAnalyst.groupid == \"_THIRDPARTY\")\n\t\t\t{\n\t\t\t\tbAssignedToThirdParty = true;\n\t\t\t\t\/\/-- nwj 12.05.2009 - applied cbs fix from default to here\n\t\t\t\t\/\/-- F0070476 - CB - we add the 3rd party contract if any\n\t\t\t\tif(analChosenAnalyst.tpcontract.length)\n\t\t\t\t{\n\t\t\t\t\tstrAnalyst = analChosenAnalyst.tpcontract;\n\t\t\t\t\tstrSupportGroup = analChosenAnalyst.analystid;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t\t\n\t\t\/\/ ensure that there is no reason not to assign this call to this analyst\n\t\tif(analChosenAnalyst.analystid.length)\t\/\/ Only check if we have chosen an analyst\n\t\t{\n\t\t\tif(!bAssignedToThirdParty)\n\t\t\t{\n\t\t\t\tanalystObj = app.session.GetAnalystStatus(analChosenAnalyst.analystid);\n\t\t\t\tif(!analystObj)\n\t\t\t\t{\n\t\t\t\t\tMessageBox(\"Unable to determine analyst status\");\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t\t\/\/ if the logged-in analyst does not have \"Can Change Call Status\" permissions, then\n\t\t\t\/\/ he\/she can only assign unaccepted calls to an analyst, or unassigned calls to a group.\n\t\t\t\/\/ nothing else is permitted.\n\t\t\t\n\t\t\tif (!app.session.HaveRight(ANALYST_RIGHT_A_GROUP,ANALYST_RIGHT_A_CANMODIFYCALLS))\n\t\t\t{\n\t\n    \t\t\tif (_swdoc.nUnassigned == _swdoc.arrCallRefs.length)\n    \t\t\t{\n        \t\t\t\/\/can assign to a group  only \n        \t\t\tMessageBox(\"I am sorry, this call can only be assigned to a group, not an analyst.\");\n        \t\t\treturn;\n   \t\t\t\t} \n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\t\/\/ if the analyst is blocked from call assignment, do not allow assignment\n\t\t\t\n\t\t\tif((!bAssignedToThirdParty)&&(analystObj.bAssignBlocked))\n\t\t\t{\n\t\t\t\tMessageBox(\"Assigning calls to this analyst has been disallowed by the system administrator.\", MB_ICONSTOP);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t\n\t\t\t\/\/ if analyst has an unavailable status, display away message and confirm assignment\n\t\t\tif(!bAssignedToThirdParty)\n\t\t\t{\n\t\t\t\tvar strAnalystMessage = \"\";\n\t\t\t\tswitch(analystObj.nStatus)\n\t\t\t\t{\n\t\t\t\t\tcase ANALYST_STATUS_ATLUNCH:\n\t\t\t\t\t\tstrAnalystMessage = \"is at lunch\";\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase ANALYST_STATUS_ONTRAINING:\n\t\t\t\t\t\tstrAnalystMessage = \"is on training\";\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase ANALYST_STATUS_ONHOLIDAY:\n\t\t\t\t\t\tstrAnalystMessage = \"is on holiday\";\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase ANALYST_STATUS_INAMEETING:\n\t\t\t\t\t\tstrAnalystMessage = \"is in a meeting\";\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase ANALYST_STATUS_OUTOFOFFICE:\n\t\t\t\t\t\tstrAnalystMessage = \"is currently out of the office\";\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase ANALYST_STATUS_DONOTDISTURB:\n\t\t\t\t\t\tstrAnalystMessage = \"has requested not to be disturbed\";\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tif (strAnalystMessage !== \"\")\n\t\t\t\t{\n\t\t\t\t\tMessageBox(analChosenAnalyst.analystid + \" \" + strAnalystMessage + \".\\n\\n\" + analystObj.strMessage + \"\\n\\n\" + \"Do you still want to assign the call?\", MB_ICONQUESTION | MB_YESNO,function(intDecision)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (intDecision !== IDYES)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tfuncCheckMaxCalls(bAssignedToThirdParty,analystObj.nMaxAssignedCalls,analChosenAnalyst.analystid);\n\t\t\t\t\t\t\tfuncUpdateCalls(strSupportGroup,strAnalyst,bAssignedToThirdParty);\t\n\t\t\t\t\t\t}\n\t\t\t\t\t});\t\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tfuncCheckMaxCalls(bAssignedToThirdParty,analystObj.nMaxAssignedCalls,analChosenAnalyst.analystid);\n\t\t\t\t\tfuncUpdateCalls(strSupportGroup,strAnalyst,bAssignedToThirdParty);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tfuncCheckMaxCalls(bAssignedToThirdParty,analystObj.nMaxAssignedCalls,analChosenAnalyst.analystid);\n\t\t\t\tfuncUpdateCalls(strSupportGroup,strAnalyst,bAssignedToThirdParty);\t\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\t\/\/being assigned to group\n\t\t\tif (!app.session.HaveRight(ANALYST_RIGHT_A_GROUP,ANALYST_RIGHT_A_CANMODIFYCALLS))\n\t\t\t{\n\t\t\t\tif (_swdoc.nUnaccepted == _swdoc.arrCallRefs.length)\n\t\t\t\t{\n        \t\t\t\/\/can assign to an analyst  only \n        \t\t\tMessageBox(\"I am sorry, this call can only be assigned to an analyst, not a group.\");\n        \t\t\treturn;\n    \t\t\t}\n    \t\t\telse\n    \t\t\t{\n    \t\t\t\tfuncUpdateCalls(strSupportGroup,strAnalyst,bAssignedToThirdParty);\n    \t\t\t}\n    \t\t}\n    \t\telse\n    \t\t{\n    \t\t\tfuncUpdateCalls(strSupportGroup,strAnalyst,bAssignedToThirdParty);\n    \t\t}\n\t\t}\n\t});\n}"},{"name":"btn_addfile_OnPressed","code":"btn_addfile_OnPressed()\n{\n\tfl_attachslist.AddFiles();\n}"},{"name":"btn_removefile_OnPressed","code":"btn_removefile_OnPressed()\n{\n\t\/\/ remove the highlighted attachment from the list\n\tfl_attachslist.RemoveSelectedFiles();\n}"},{"name":"tm_timespent_OnValueChanged","code":"tm_timespent_OnValueChanged(strValue)\n{\n\tif (tm_timespent.value < 1 || tm_timespent.value > 60000)\n\t{\n\t\tMessageBox(\"I am sorry, you can only enter values between 1 minute and 1000 hours.\");\n\t\t_eva(tm_timespent,5);\n\t}\n}"},{"name":"OnFieldValueChanged","code":"OnFieldValueChanged(strName, strValue)\n{\n\t\/\/-- When a Field value changes we set this variable to true.  \n\t\/\/-- We will then check this when closing our form to see if there have been any changes that we need to save\n\t_swdoc.bFormFieldChanged = true;\n\n\t\n}"},{"name":"tb_target_OnValueChanged","code":"tb_target_OnValueChanged(strValue)\n{\n\t\/\/ TODO: Add your event handler code here\n\t_swdoc.bTargetFixTimeChanged = true;\n\n}"},{"name":"tb_sla_OnValueChanged","code":"tb_sla_OnValueChanged(strValue)\n{\n\n\n\t\/\/-- nwj 13.10.2008 -  if we change SLA then we need to reset the sla resp flag to make it editable and uncheck e.g. so analyst can re-mark sla response met\n\tif(strValue!=_swdoc.strCurrentSLA)\n\t{\t\n\t\t_ete(mainform.flg_slaresponse,\"0\");\n\t\t_een(mainform.flg_slaresponse,true);\n\t}\n\telse\n\t{\n\t\t_ete(mainform.flg_slaresponse,_swdoc.strCurrentSLARespondedTo);\n\t\t_een(mainform.flg_slaresponse,(_swdoc.strCurrentSLARespondedTo!=1));\n\t}\n\n}"},{"name":"tb_sladef_OnValueChanged","code":"tb_sladef_OnValueChanged(strValue)\n{\n\t\/\/ TODO: Add your event handler code here\n\tif(strValue==\"\")\n\t{\n\t\tstrValue = -1;\n\t}\n\telse\n\t\t_ema(tb_sla,true);\n\t\t\n\t_slf(tb_sla , \"_swc_flg_sla=1&_swc_fk_slad=\"+strValue);\n\t_eva(tb_sla,\"\");\n\n\n}"}]}}},{"appearance":{"width":"360","height":"220","backgroundColor":"#ffffff","fillColour":"#ffffff","textColour":"#000000","font":{"@size":"8","#text":"Arial"}},"javascript":{"methods":{"method":[{"name":"OnFormLoaded","code":"OnFormLoaded()\n{\n\t\/\/ Set form with defaults set:\n\t\t\n\t\/\/ if analyst has permissions to assign calls, then make the Update and Assign button visible.\n\tif (HaveRight(ANALYST_RIGHT_A_GROUP,ANALYST_RIGHT_A_CANASSIGNCALLS)){\n\t\t_evi(btnUpdateAssig,true);\n\t}\n\t\n\t\/\/ set update date to current time\n\t_eva(dt_updatedate,(_swdoc.dtCurrentTime.getTime()\/1000));\n\t\n\t\/\/ if analyst does not have permission to backdate calls, make update time read-only\n\tif (!IsAllowedToBackDateCallUpdate()){\n\t\t_ero(dt_updatedate,true);\n\t}\n\t\n\t\/\/ if the analyst's default is to send an email on update, check the email box\n\t_ete(checkEmailCustomer,(IsDefaultOption(ANALYST_DEFAULT_UPDATESENDEMAIL) ? \"1\":\"0\"));\n\t\t\n\t\/\/ if the analyst's default is to make the update private, then check the Make Private box.\n\t_ete(checkUpdatePublic,(IsDefaultOption(ANALYST_DEFAULT_UPDATEPRIVATE) ? \"1\":\"0\"));\n\t\t\n\t\/\/ if the form has been passed update text, set the text on this form to the passed text\n\tif(_swdoc.strUpdateText){\n\t\t_ete(txtDescription,_swdoc.strUpdateText); \/\/strUpdateText is set in the _swdoc.OnFormLoading in the Configuration\n\t\t_eva(txtDescription,strUpdatetext);\n\t}\n\n\t\/\/ if the calls have not been responded to previously, then give the analyst the option of marking this as the SLA response\n\t\t\n\tSqlRecordSetObj = new SqlQuery;\n\tvar strParams = \"crfs=\"+pfu(_swdoc._form[\"callrefs\"]);\n\tSqlRecordSetObj.InvokeStoredQuery(\"form\/updatecall\/get_resp_details\", strParams);\n\tif(SqlRecordSetObj.Fetch())\n\t{\n\t\tvar nCount = SqlRecordSetObj.GetValueAsNumber(0);\n\t\t\t\n\t\tif(nCount > 0)\n\t\t{\n\t\t\t_evi(flg_checkMarkSLAResponse,true);\n\t\t}\n\t}\t\n\n\t\/\/if this form has been called with attachments, add them to the attachments list\n\tvar index = 1;\n \twhile(_swdoc._form[\"Attach\"+index]) {\n      AttachsList.newFile = _swdoc._form[\"Attach\" + index];\n      index++;\n \t}\n\t\n\t\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/  SLAs \/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\n\t\/\/ display the SLA and fix time for the first call ref.  \n\tvar strParams = \"crf=\"+pfu(_swdoc.arrCallRefs[0]);\n\tSqlRecordSetObj.InvokeStoredQuery(\"form\/updatecall\/get_sla_details\", strParams);\n\t\t\n\tif(SqlRecordSetObj.Fetch())\n\t{\n\t\t_ete(txt_sla,SqlRecordSetObj.GetValueAsString(0));\n\t\tif (SqlRecordSetObj.GetValueAsString(1) == \"_THIRDPARTY\")\n\t\t{\n\t\t\t_ete(flg_checkMarkSLAResponse,\"Mark as Third Party SLA Response\");\n\t\t}\n\t}\n\t\n\t\/\/ if the analyst does not have permissions to change SLAs, or if there is more than one call passed, disable the SLA box & text.\n\tif (!HaveRight(ANALYST_RIGHT_A_GROUP,ANALYST_RIGHT_A_CANCHANGEPRIORITY) || _swdoc.arrCallRefs.length > 1 || _swdoc.Status == CS_ONHOLD)\n\t{\n\t\t_een(txt_SLAStaticText,false);\n\t\t_een(txt_sla,false);\n\t}\n\n\tSqlRecordSetObj.Reset();\n   \t\n   \t\/\/ if the data dictionary calls the priority something other than \"SLA\", change the label\n   \tif(dd.tables[\"updatedb\"].IsColumnDefined(\"priority\"))\n   \t{\n   \t\t_ete(txt_SLAStaticText,dd.tables[\"updatedb\"].columns[\"priority\"].DisplayName);\n\t}\n\t\n\t\n}"},{"name":"btnUpdate_OnPressed","code":"btnUpdate_OnPressed()\n{\n\t\/\/ Validate Form\n\tif(!_swdoc.ValidateForm()){\n\t\treturn;\n\t}\n\t\n\tEncodeUpdateMail(_swdoc.MessageSource);\n\t\n\t\/\/ Update Calls Fun -- this will be defined globally, so that we can reuse the code\n\t\/\/ for the Update and Assign option\t\n\t\n\tUpdateCallsFun(\"\");\n\n\t_swdoc.CloseForm();\n\n}"},{"name":"btnUpdateAssig_OnPressed","code":"btnUpdateAssig_OnPressed()\n{\n\t\/\/ Validate Form\n\tif(!_swdoc.ValidateForm())\n\t{\n\t\treturn;\n\t}\n\t\n\t\n\t\/\/ Update Calls Function -- this is being defined globally so that we can reuse it for the Update Call form\n\tUpdateCallsFun();\n\t\/\/ Validate the form\n\n\t\/*\n\n\n\t_swdoc.UpdateText = Description.text;\n\t\n\tvar bAssignedToThirdParty = false;\n\tvar AssignToAnalyst = \"\";\n\tvar AssignTo = \"\";\n\t\n\tvar dlg = new AssignCallPropertySheet;\n    if(dlg.Open() != IDOK)\n    \treturn;\n    \t\n\tif(dlg.groupid.length)\n\t{\n\t\tAssignTo = \"#\";\n\t\tAssignTo += dlg.groupid;\n\t\tif(dlg.repid.length)\n\t\t{\n\t\t\tAssignToAnalyst = dlg.repid;\n\t\t\tAssignTo += \":\";\n\t\t\tAssignTo += dlg.repid;\n\t\t}\n\n\t\tif(dlg.groupid == \"_THIRDPARTY\")\n\t\t\tbAssignedToThirdParty = true;\n\t}\n\t\n\t\n\t\n\tEncodeUpdateMail(_swdoc.MessageSource);\n\t\t\n\tif(!HaveRight(ANALYST_RIGHT_A_GROUP, ANALYST_RIGHT_A_CANASSIGNCALLS, TRUE))\n\t\treturn;\n\t\t\n\tif(AssignToAnalyst.length)\t\/\/ Only check if we are an analyst\n\t{\n\t\tvar nStatus;\n\t\tvar Message;\n\t\tvar bBassignBlocked = FALSE;\n\t\tvar nMaxAssignedCalls = 0;\n\n\t\tif(!bAssignedToThirdParty)\n\t\t{\n\t\t\tAanalystStat = new AnalystSatusHolder(AssignToAnalyst);\n\t\t\tif(!AanalystStat)\n\t\t\t{\n\t\t\t\tMessageBox(\"Unable to determine analyst status\");\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t\n\t\t\tnStatus = AanalystStat.status;\n\t\t\tMessage = AanalystStat.message;\n\t\t\tbBassignBlocked = AanalystStat.assignblocked;\n\t\t\tnMaxAssignedCalls = AanalystStat.maxassigncall;\n\t\t}\n\t\t\n\t\tif(bBassignBlocked)\n\t\t{\n\t\t\tMessageBox(\"Assigning calls to this analysts has been disallowed by the system administrator.\", MB_ICONSTOP);\n\t\t\treturn;\n\t\t}\n\n\t\t\n\t\tswitch(nStatus)\n\t\t{\n\t\tcase ANALYST_STATUS_ATLUNCH:\n\t\t\tif(MessageBox(AssignToAnalyst + \" is at lunch.\\n\\n\" + Message + \"\\n\\n\" + \"Do you still want to assign the call?\", MB_ICONQUESTION | MB_YESNO) != IDYES)\n\t\t\t\treturn;\n\t\t\tbreak;\n\t\tcase ANALYST_STATUS_ONTRAINING:\n\t\t\tif(MessageBox(AssignToAnalyst + \" is on training.\\n\\n\" + Message + \"\\n\\n\" + \"Do you still want to assign the call?\", MB_ICONQUESTION | MB_YESNO) != IDYES)\n\t\t\t\treturn;\n\t\t\tbreak;\n\t\tcase ANALYST_STATUS_ONHOLIDAY:\n\t\t\tif(MessageBox(AssignToAnalyst + \" is on holiday.\\n\\n\" + Message + \"\\n\\n\" + \"Do you still want to assign the call?\", MB_ICONQUESTION | MB_YESNO) != IDYES)\n\t\t\t\treturn;\n\t\t\tbreak;\n\t\tcase ANALYST_STATUS_INAMEETING:\n\t\t\tif(MessageBox(AssignToAnalyst + \" is in a meeting.\\n\\n\" + Message + \"\\n\\n\" + \"Do you still want to assign the call?\", MB_ICONQUESTION | MB_YESNO) != IDYES)\n\t\t\t\treturn;\n\t\t\tbreak;\n\t\tcase ANALYST_STATUS_OUTOFOFFICE:\n\t\t\tif(MessageBox(AssignToAnalyst + \" is currently out of the office.\\n\\n\" + Message + \"\\n\\n\" + \"Do you still want to assign the call?\", MB_ICONQUESTION | MB_YESNO) != IDYES)\n\t\t\t\treturn;\n\t\t\tbreak;\n\t\tcase ANALYST_STATUS_DONOTDISTURB:\n\t\t\t\tif(MessageBox(AssignToAnalyst + \" has requested not to be disturbed.\\n\\n\" + Message + \"\\n\\n\" + \"Do you still want to assign the call?\", MB_ICONQUESTION | MB_YESNO) != IDYES)\n\t\t\t\treturn;\n\t\t\tbreak;\n\n\t\tcase ANALYST_STATUS_AVAILABLE:\n\t\tdefault:\n\t\t\tbreak;\n\t\t}\n\n\t\tif(nMaxAssignedCalls > 0) \/\/ Only \n\t\t{\n\t\t\tSqlRecordSetObj = new SqlQuery;\n\t\t\tSqlRecordSetObj.Query(\"select count(*) as ct from opencall where status < 16 AND status != \" + CS_RESOLVED + \" and owner = '\" + AssignToAnalyst + \"'\", \"sw_systemdb\");\n\t\t\t\n\t\t\tif(SqlRecordSetObj.Fetch())\n\t\t\t{\n\t\t\t\tvar nCount = SqlRecordSetObj.GetValueAsNumber(0);\n\t\t\t\tif(nCount >= nMaxAssignedCalls)\n\t\t\t\t{\n\t\t\t\t\tMessageBox(\"The Maximum Call Assignment count has been reached for this analyst. No call assignment possible.\", MB_ICONSTOP);\n\t\t\t\t\tSqlRecordSetObj.Reset();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tSqlRecordSetObj.Reset();\n\t\t}\n\t}\n\t\n\tvar hdcon = new HelpdeskSession;\n\t\n\tif(hdcon.Connect())\n\t{\n\t\tvar nCallRef = _swdoc.Callrefs[0]; \n\t\tvar SLAtext = (_swdoc.Callrefs.length > 1) ? \"\" : SLA.text;\n\t\n\t\tif(!_swdoc.bAllowResponse)\n\t\t\tcheckMarkSLAResponse.text = \"0\";\n\t\t\t\n\t\t\/\/ We start a new transaction to update the specified call (complex req)\n\t\tif(hdcon.BeginUpdateCall(_swdoc.CallrefsCommaString))\n\t\t{   \n\t\t\tvar bSendSuccess = hdcon.SendTableValues(_swdoc.GetDataPtr(), \"updatedb\");\n  \t\t\t\n    \t\tif(bSendSuccess && hdcon.SendNumber(\"backdateperiod\", _swdoc.nBackdatePeriod) &&\n\t\t    \thdcon.SendBoolean(\"_acceptmode\", _swdoc.bAcceptMode) &&\n\t\t    \thdcon.SendNumber(\"_targetfixtime\", Target.text) &&\n\t\t    \thdcon.SendBoolean(\"markslaresponse\", checkMarkSLAResponse.text) &&\n\t\t    \thdcon.SendBoolean(\"publicupdate\", checkUpdatePublic.text) &&\n\t\t    \thdcon.SendString(\"priority\", SLAtext) &&\n\t\t    \thdcon.SendString(\"assignto\", AssignTo))\n\t\t    {\n\t\t    \tfor(i=0; i<AttachsList.rowCount();i++)\n\t\t    \t{\n    \t\t\t\tif(!hdcon.SendFile(\"attach\", AttachsList.GetItemText(i,0), AttachsList.GetItemText(i,3)))\n    \t\t\t\t\treturn;\n    \t\t\t}\n       \t\t\t\n    \t\t\tif(hdcon.Commit())\n    \t\t\t{\n    \t\t\t\tif(!hdcon.GetResult())\n    \t\t\t\t\treturn;\n    \t\t\t\t\t\n    \t\t\t\t\n    \t\t\t\t\n    \t\t\t\tvar SessionFilesInfo = \"\";\n    \t\t\t\tif(checkEmailCustomer.text && app.global.IsConnectedToMailServer() && AttachsList.rowCount())\n    \t\t\t\t\tSessionFilesInfo = hdcon.GetSessionFileInfo();\n    \t\t\t\t\t\n    \t\t\t\t\/\/app.global.Sleep(500);\n    \t\t\t\t\t\n    \t\t\t\tif(_swdoc.taskid)\n    \t\t\t\t{\n    \t\t\t\t\tvar ReturnData = hdcon.GetReturnDataStr();\n    \t\t\t\t\ta = ReturnData.split(\".\");\n    \t\t\t\t\t\n    \t\t\t\t\tTempCallRef \t\t= a[0];\n    \t\t\t\t\tCallUpdateIndex \t= a[1];\n    \t\t\t\t\t\n    \t\t\t\t\tif(hdcon.BeginCompleteTask())\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif(!hdcon.SendNumber(\"callref\", _swdoc.Callrefs[0]) ||\n\t\t\t\t\t\t   \t!hdcon.SendNumber(\"taskid\", _swdoc.taskid) ||\n\t\t\t\t\t\t   \t!hdcon.SendNumber(\"callupdateindex\", CallUpdateIndex))\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tMessageBox(\"Error writing data during work item completion\", MB_ICONSTOP);\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\n\t\t\t\t\t\t\tif(!hdcon.Commit())\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tMessageBox(\"Error completing work item\", MB_ICONSTOP);\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n    \t\t\t\t}\n    \t\t\t\t\n    \t\t\t\thdcon.StoreEmailAuditTrailJs(_swdoc.Callrefs[0], _swdoc.MessageSource);\n    \t\t\t\t\n    \t\t\t\tif(checkEmailCustomer.text == \"1\")\n\t\t\t\t\t{\n\t\t\t\t\t\t\/\/ OK, we are going to send the customer(s) an e-mail message to confirm the \n\t\t\t\t\t\t\/\/ call closure. If we have uploaded file attachments, we can ask the session\n\t\t\t\t\t\t\/\/ for a list of the files. If available, the session variables will include\n\t\t\t\t\t\t\/\/ a _serverpath variable for each file. The returned list, is a list of \n\t\t\t\t\t\t\/\/ strings that is suitable for passing to the compose message function\n\t\t\t\t\t\t\n\t\t\t\t\t\tEmailUpdate(_swdoc.CallrefsCommaString,\n\t\t\t\t\t\t\t\t\tDescription.text, \n\t\t\t\t\t\t\t\t\tSessionFilesInfo, TimeSpent.text,\n\t\t\t\t\t\t\t\t\t\"UpdateCallMailTemplate\", \n\t\t\t\t\t\t\t\t\tTEMPLATE_UPDATECALL );\n\t\t\t\t\t\t\n\t\t\t\t\t\t\n\t\t\t\t\t\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\t_swdoc.CloseForm();\n    \t\t\t}\t\n\t\t    }\n\t\t}\n\t\t\/\/ We have finished with the connection, close it.    \n\t\thdcon.Close();\n\t}*\/\n\t\n}"},{"name":"btnAdd_OnPressed","code":"btnAdd_OnPressed()\n{\n\t\/\/ TODO: Add your event handler code here\n\tAttachsList.newFile = InvokeCallAttachmentFileDialog();\n}"},{"name":"btnRemove_OnPressed","code":"btnRemove_OnPressed()\n{\n\t\/\/ remove the highlighted attachment from the list\n    for(var i=0; i<AttachsList.rowCount();i++)\n    {\n    \tif(AttachsList.IsRowSelected(i))\n    \t\tAttachsList.RemoveRow(i);\n    }\n}"},{"name":"(User Defined Functions)","code":"\n"},{"name":"MenuButton1_OnPressed","code":"MenuButton1_OnPressed()\n{\n\t\/\/ TODO: Add your event handler code here\n\tMessageBox(\"Hello\");\n\n}"},{"name":"SLA_OnValueChanged","code":"SLA_OnValueChanged(strValue)\n{\n\tvar str = new String (SLA.pickList);\n\tvar strNew = new String (strValue + \"|\");\n\t\n\tif(str.toLowerCase().indexOf( strNew.toLowerCase() ) == -1)\n\t{\n\t\tif(IsAdministrator())\n\t\t{\n\t\t\tif( MessageBox(\"The SLA name you have selected is not valid. Do you want to add a new SLA with that name?\", \n\t\t\tMB_ICONQUESTION | MB_YESNO) == IDYES)\n\t\t\t{\n\t\t\t\tif(Sys_AddNewSLA(strValue))\n\t\t\t\t\tSLA.pickList = str + strNew;\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\t_ete(SLA , \"\");\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tMessageBox(\"The SLA name you have selected is not valid.\");\n\t\t\t_ete(SLA , \"\");\n\t\t}\t\n\t}\n}"},{"name":"dtDateOfUpdate_OnValueChanged","code":"dtDateOfUpdate_OnValueChanged(strValue)\n{\n\n\t\/*\n\tvar dIn\t= new Date();\n    var currentTime\t= Math.round(dIn.getTime()\/1000);\n\tvar updateDateTime = DateOfUpdate.text;\n\t_swdoc.nBackdatePeriod = currentTime - updateDateTime;\n\t\t\n\tif(_swdoc.nBackdatePeriod < 0)\n\t{\n\t\tvar message = \"You have attempted to forward date this call update which is not allowed.\\n\\nDo you want to use the current date and time to update this call.\";\n\t\tif(MessageBox(message, MB_ICONQUESTION | MB_YESNO) != IDYES)\n\t\t\treturn;\n\t\t\n\t\t_swdoc.nBackdatePeriod = 0;\n\t}\n\t\t\n\tif(!IsAllowedToBackDateCallUpdate() && _swdoc.nBackdatePeriod > 0)\n\t{\n\t\tvar message = \"You have attempted to backdate this call update but you do not have sufficient privileges to do so\\n\\nDo you want to use the current date and time to update this call?\"\n\t\tif(MessageBox(message, MB_ICONQUESTION | MB_YESNO) != IDYES)\n\t\t\treturn;\n\t\t_swdoc.nBackdatePeriod = 0;\n\t}\n\telse\n\tif(_swdoc.nBackdatePeriod > GetMaximumBackdatePeriodAllowed())\n\t{\n\t\tvar dTime\t= new Date();\n\t\tdTime = (currentTime - GetMaximumBackdatePeriodAllowed()) * 1000;\n\t\tvar message = \"You have attempted to backdate this call update further than you have sufficient privileges to do so.\\n\\nDo you want to use the oldest date\/time that you are allowed: \";\n\t\tif(MessageBox(message + dTime.toLocalString(), MB_ICONQUESTION | MB_YESNO) != IDYES)\t\t\t\/\/SwGetInternalDateTimeFormat\n\t\t\treturn;\n\t\t\t\n\t\t_swdoc.nBackdatePeriod = GetMaximumBackdatePeriodAllowed();\n\t}\n\t\tvar CommaSeperatedCallrefs = _swdoc.Callrefs;\n\tSqlRecordSetObj = new SqlQuery;\n\t\n\tSqlRecordSetObj.Query(\"SELECT max(updatetimex) AS udtime FROM updatedb WHERE callref IN (\" + CommaSeperatedCallrefs + \")\", \"sw_systemdb\");\n\tif(SqlRecordSetObj.Fetch())\n\t{\n\t\tvar tLastUpdate = SqlRecordSetObj.GetValueAsNumber(0);\n\t\t\n\t\tif(tLastUpdate > updateDateTime)\n\t\t{\n\t\t\tvar dTime\t= new Date();\n\t\t\tdTime = tLastUpdate;\n\t\t\tvar message = \"You have chosen to backdate this action \\nto a time before than the last action was carried out against one of the selected calls. This is not allowed!\\n\\n\\nThe last action was carried out on \";\n\t\t\tMessageBox(message + dTime.toLocalString(), MB_ICONQUESTION | MB_OK);\n\t\t\t\t\t\t\n\t\t\treturn;\n\t\t}\n\t}\n*\/\n}"},{"name":"dt_updatedate_OnValueChanged","code":"dt_updatedate_OnValueChanged(strValue)\n{\n\t\/\/ TODO: Add your event handler code here\n\n\t\/\/ Find out what time the date\/time is being changed.  This number will be used to make sure that the analyst is\n\t\/\/ not trying to change the update to a time in the future.\n\t\/\/ The time the form was opened will be checked against the user's maximum backdate period\n\t\/\/ to make sure that they are not trying to backdate this update too far.  The reason for this is that the analyst\n\t\/\/ may ostensibly backdate from the max period before the form was opened, but for checking times in the future,\n\t\/\/ this would error if they spend any time editing the form.  \n\t\n\t\/\/ Get the backdate period that the analyst is trying to backdate to\n\tvar dtBackdatePeriod = _swdoc.dtCurrentTime.getTime() - (dt_updatedate.value * 1000);\n\t\/\/ calculate the actual time the analyst can backdate to, based on current time - maximum backdate period\n\t\n\tvar dtMaxBDTime = new Date();\n\t\t\n\t\/\/ GetMaxiumumBackdatePeriodAllowed is stored in seconds.  Convert to milliseconds to obtain actual\n\t\/\/ maximum backdate time.\n\tdtMaxBDTime.setTime(_swdoc.dtCurrentTime.getTime() - (GetMaximumBackdatePeriodAllowed() * 1000));\n\t\n\n\t\/\/ ensure that the backdate time entered is not in the future\n\tif(dt_updatedate.value > app.global.GetCurrentEpocTime())\n\t{\n\t\tvar message = \"Forwarding call updates is not permitted.\";\n\t\tMessageBox(message, MB_ICONEXCLAMATION | MB_OK);\n\t\t_eva(dt_updatedate , app.global.GetCurrentEpocTime());\n\t\treturn;\n\t}\n\n\t\/\/ ensure that the backdate period does not exceed the analyst's rights\n\n\tif((dtBackdatePeriod\/1000) > GetMaximumBackdatePeriodAllowed())\n\t{\n\t\t\n\t\tvar message = \"The earliest time to which you can backdate calls is \"+dtMaxBDTime.toLocaleString()+\".\\n\\nDo you want to use this time and date?\";\n\t\tif(MessageBox(message, MB_ICONQUESTION | MB_YESNO) == 6){ \/\/ 6 = YES\n\t\t\t_eva(dt_updatedate , dtMaxBDTime.getTime()\/1000);\n\t\t\treturn;\n\t\t}\n\t\telse{\t\n\t\t\t_eva(dt_updatedate , app.global.GetCurrentEpocTime());\n\t\t}\n\t}\n\t\/\/ make sure that the backdate time is not prior to the last previous update time for any of the calls being updated\n\tSqlRecordSetObj = new SqlQuery;\n\t\n\tSqlRecordSetObj.Query(\"SELECT max(updatetimex) AS dtthemaxtime FROM updatedb WHERE callref IN (\" + _swdoc._form[\"callrefs\"] + \")\", \"sw_systemdb\");\n\tif(SqlRecordSetObj.Fetch())\n\t{\n\t\tvar dtLastUpdate = new Date();\n\t\tdtLastUpdate.setTime(SqlRecordSetObj.GetValueAsNumber(0));\n\t\t\n\t\tif(dtLastUpdate > (dt_updatedate.value * 1000))\n\t\t{\n\t\t\tvar message = \"You have chosen to backdate this action \\nto a time before than the last action was carried out against one of the selected calls. This is not allowed!\\n\\n\\nThe last action was carried out on \";\n\t\t\tMessageBox(message + dtLastUpdate.toLocaleString(), MB_ICONQUESTION | MB_OK);\n\t\t\t\t\t\t\n\t\t\treturn;\n\t\t}\n\t}\n\n\n}"}]}}}]}}}