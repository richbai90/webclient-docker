{"espForm":{"configuration":{"settings":{"name":"swkb_managecatalogs","title":"Manage KnowledgeBase Catalogs","options":{"allowResize":"true","showMenubar":"false","showToolbar":"false","showStatusBar":"false"}},"javascript":{}},"layouts":{"layout":[{"appearance":{"width":"355","height":"187","backgroundColor":"#eaeaea","fillColour":"#ffffff","textColour":"#000000","font":{"@size":"8","#text":"Arial"}},"controls":{"control":[{"general":{"name":"SqlList1","type":"SqlTable","flags":{"transparent":"false","xpStyle":"false","hasShadow":"false","toolbarButtonStyle":"false","cache":"false","hasBorder":"false","hasCheckbox":"false","showHeader":"true","verticalGridLines":"false","horizontalGridLines":"false","autoLoad":"true","allowMultiSelect":"false"}},"appearance":{"index":"0","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Arial"},"borderStyle":"Rectangle"},"objectPlacement":{"position":{"top":"5","left":"5","right":"262","bottom":"186"},"scaling":{"top":"0","left":"0","right":"100","bottom":"100"}},"columns":{"controlInfo":[{"mouseOverCursor":"Window Default","type":"Text Edit","flags":{"invisible":"false","readOnly":"false","mandatory":"false","mandatoryLabelBackground":"false","mandatoryLabelText":"false","allowNullValue":"false","skipTabStop":"false","disabled":"false","protected":"false","noMacroExpand":"false","readOnlyInit":"false","autoCompleteField":"false","editUnlimitedText":"false","url":"false","hidden":"false","allowResize":"true","allowSort":"true"},"textLineCount":"0","textInputFormat":"Text","properties":{"column":"catalogname"},"name":"Catalog","width":"243","image":"-1","dataColumn":"0"},{"mouseOverCursor":"Window Default","type":"Text Edit","flags":{"invisible":"false","readOnly":"false","mandatory":"false","mandatoryLabelBackground":"false","mandatoryLabelText":"false","allowNullValue":"false","skipTabStop":"false","disabled":"false","protected":"false","noMacroExpand":"false","readOnlyInit":"false","autoCompleteField":"false","editUnlimitedText":"false","url":"false","hidden":"true","allowResize":"false","allowSort":"false"},"textLineCount":"0","textInputFormat":"Text","properties":{"column":"catalogid"},"name":"Catalogid","width":"60","image":"-1","dataColumn":"1"}]},"sortColumn":"-1","sortDescending":"false","headerHeight":"18","rowHeight":"16","selectedColor":"#00008b","selectedTextColor":"#ffffff","controlInfo":{"mouseOverCursor":"Window Default","properties":{"sqlSource":"swdata","table":"swkb_catalogs","newRecordForm":"Form.swkb_catalog","editRecordForm":"Form.swkb_catalog","storedQuery":"me.browse.table"}}},{"general":{"name":"btnNew1","type":"EventButton"},"appearance":{"index":"1","caption":"New","backgroundColor":"#000000","foregroundColor":"#000000","font":{"@size":"8","#text":"Arial"}},"objectPlacement":{"position":{"top":"24","left":"272","right":"352","bottom":"48"},"scaling":{"top":"0","left":"100","right":"100","bottom":"0"}},"controlInfo":{"mouseOverCursor":"Window Default"}},{"general":{"name":"btnProperties","type":"EventButton"},"appearance":{"index":"2","caption":"Properties","backgroundColor":"#000000","foregroundColor":"#000000","font":{"@size":"8","#text":"Arial"}},"objectPlacement":{"position":{"top":"51","left":"272","right":"352","bottom":"75"},"scaling":{"top":"0","left":"100","right":"100","bottom":"0"}},"controlInfo":{"mouseOverCursor":"Window Default"}},{"general":{"name":"btnDelete","type":"EventButton"},"appearance":{"index":"3","caption":"Remove","backgroundColor":"#000000","foregroundColor":"#000000","font":{"@size":"8","#text":"Arial"}},"objectPlacement":{"position":{"top":"78","left":"272","right":"352","bottom":"102"},"scaling":{"top":"0","left":"100","right":"100","bottom":"0"}},"controlInfo":{"mouseOverCursor":"Window Default"}},{"general":{"name":"btnManage","type":"EventButton"},"appearance":{"index":"4","caption":"Manage","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Arial"}},"objectPlacement":{"position":{"top":"118","left":"272","right":"352","bottom":"142"},"scaling":{"top":"0","left":"100","right":"100","bottom":"0"}},"controlInfo":{"mouseOverCursor":"Window Default","properties":{"backgroundColor":"#ff9900"}}},{"general":{"name":"btnClose","type":"EventButton"},"appearance":{"index":"5","caption":"Close","backgroundColor":"#000000","foregroundColor":"#000000","font":{"@size":"8","#text":"Arial"}},"objectPlacement":{"position":{"top":"163","left":"272","right":"352","bottom":"187"},"scaling":{"top":"100","left":"100","right":"100","bottom":"100"}},"controlInfo":{"mouseOverCursor":"Window Default"}}]},"javascript":{"methods":{"method":[{"name":"btnProperties_OnPressed","code":"btnProperties_OnPressed()\r\n{\r\n    SqlList1.EditRecord(SqlList1.curSel);\r\n}\r\n"},{"name":"btnDelete_OnPressed","code":"btnDelete_OnPressed()\n{\n    \/\/-- nwj :- use key col name instead of numbering\n    var sCol = dd.tables[SqlList1.table].PrimaryKey;\n   \n    if(sCol==\"\")\n    {\n            MessageBox(\"No primary key is defined for this table. Please contact your Supportworks Administrator\");\n    }\n    else\n    {\n            if(SqlList1.curSel != -1)\n            {\n            \n            \t\tvar strKeyValue = SqlList1.GetItemTextRaw(SqlList1.curSel, sCol);\n     \n             \t\t\/\/-- nwj - we are not allowed to delete catalogs 1,2 or 3\n                    if(strKeyValue==\"1\" || strKeyValue==\"2\" || strKeyValue==\"3\")\n                    {\n                    \tMessageBox(\"The selected catalog is a system catalog and cannot be deleted.\");\n                    \treturn true;\n                    }\n\n\t\t\t\t\t\/\/ F0104634\n\t\t\t\t\tvar intCount = app.g.sqs_rowcount(\"count\/articles_in_catalog\", 'catalog='+strKeyValue);\n\t\t\t\t\tif(intCount>0)\n\t\t\t\t\t{\n\t\t\t\t\t\tMessageBox('There is '+intCount+' article(s) still in this catalog, please reassign these before deleting the catalog.');\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\t\n\n                    \/\/--  ask them to confirm\n                    if(!confirm('Are you sure you want to delete the selected record?'))return false;\n                    \/\/-- nwj :- determine if needs quotes\n                    var strQ = (dd.tables[SqlList1.table].columns[sCol].IsNumeric())?\"\":\"'\";\n                    \n                   \n                 \n                    if(strKeyValue != \"\")\n                    {\n                            if(app.g.sqlexecute_delete(SqlList1.table, strKeyValue))\n                            {\n                                    \/\/ This next call removes the row from the list, not the database\n                                    SqlList1.RemoveRow(SqlList1.curSel);\n                            }\n                            \n                            \/\/F0104625\n                            app.g.submitsqs(\"knowledgebase\/clean_kb_catalog_rights.delete\", \"catalogid=\"+strKeyValue);\n                     }\n            }\n    }\n}"},{"name":"btnClose_OnPressed","code":"btnClose_OnPressed()\r\n{\r\n    _swdoc.CloseForm();\r\n}\r\n"},{"name":"btnNew1_OnPressed","code":"btnNew1_OnPressed()\n{\n    app.OpenFormForAdd(\"swkb_catalog\", \"\", \"\", true, function(){\n    \tSqlList1.Refresh();\n    });\n}"},{"name":"OnFormLoaded","code":"OnFormLoaded(bDataReloaded)\n{\n\t\/\/-- check catalog list against sys catalog list\n\tvar array_system_catalogs = new Array();\t\n\t\n\tvar xmlmc = new XmlMethodCall;\n\tif(xmlmc.Invoke(\"knowledgebase\", \"catalogList\"))\n\t{\n\t   \t\/\/-- get the result\n\t\tvar strXML = (app.bWebClient)? xmlmc._lastresult:xmlmc.GetReturnXml();\n\t\tvar objRes = XMCResult(strXML);\n\t\tif(!objRes.success)\n\t\t{\n\t        MessageBox(\"Failed to load catalogs (\" + objRes.message + \"). Please contact your Supportworks Supervisor.\");\n\t    }\t\n\t    else\n\t    {\n\t    \t\/\/-- create xmldom from returned xml\n\t    \tvar array_system_catalogs = new Array();\n\t\t\tvar myXmlFile = new XmlFile(); \n\t\t\tbRet = myXmlFile.loadFromString(strXML); \n\n\t\t\tvar strItems = \"\";\n\t\t\toRec = new Object();\n\t\t\tfor (count = 1; count < myXmlFile.methodCallResult.data.length; count ++) \n\t\t\t{  \n\t\t\t\tvar strCatId = myXmlFile.methodCallResult.data[count]['catalogId'].nodeValue;\n\t\t\t\tvar strName = myXmlFile.methodCallResult.data[count]['name'].nodeValue;\n\t\t\t\tarray_system_catalogs[strCatId] = strName;\t\n\t\t\t}\n\t    }\n    }\n    else\n    {\n    \tMessageBox(\"Failed to invoke knowledgebase.catalogList. \" + xmlmc.GetLastError() + \". Please contact your Supportworks Supervisor.\");\n    }\t\n\n\n\t\/\/-- check against sqllist - if any missing then create\n\tfor(intCataLogID in\tarray_system_catalogs)\n\t{\n\t\tif(app.g.sl_findrow_byvalue(SqlList1,intCataLogID,\"catalogid\")==-1)\n\t\t{\n\t\t\tvar oInsert = new oXmlmcInsert('swkb_catalogs');\n\t\t\toInsert.setfield('catalogid',intCataLogID);\n\t\t\toInsert.setfield('catalogname',array_system_catalogs[intCataLogID]);\n\t\t\toInsert.execute();\n\t\t}\n\t}\t\n\t\n\tSqlList1.Refresh();\n\n}"},{"name":"btnManage_OnPressed","code":"btnManage_OnPressed()\n{\n\tapp.g.search_for(\"swkb\", false, \"searchmode=0\");\n\n}"}]}}},{"appearance":{"width":"360","height":"220","backgroundColor":"#ffffff","fillColour":"#ffffff","textColour":"#000000","font":{"@size":"8","#text":"Arial"}},"javascript":{}}]}}}