{"espForm":{"configuration":{"settings":{"name":"EfResolveCloseCallForm","title":"Resolve Close Call Form","options":{"allowResize":"true","showMenubar":"true","showToolbar":"false","showStatusBar":"false"}},"tables":{"table":[{"name":"updatedb","type":"Main Details Table","flags":"5"},{"name":"opencall","type":"Extended Details Table","mainDetailsColumn":"callref","flags":"0"}]},"javascript":{"methods":{"method":[{"name":"OnFormLoading","code":"OnFormLoading(strFormName, strClass)\n{\n\t\/\/-- If the analyst does not have permissions to modify the status of call\n\t\/\/-- then they should not be able to resolve\/close a call\n\tif (!app.session.HaveRight(ANALYST_RIGHT_A_GROUP,ANALYST_RIGHT_A_CANMODIFYCALLS))\n\t{\n    \tMessageBox(\"You do not have sufficient privileges to modify calls.  Please contact your system administrator\",MB_ICONSTOP);\n    \treturn false;\n\t}\n\t\n\t\/\/-- make sure user is allowed to resolve or close calls\n\tif( (!app.session.HaveRight(ANALYST_RIGHT_A_GROUP,ANALYST_RIGHT_A_CANCLOSECALLS)) && (!app.session.HaveRight(ANALYST_RIGHT_A_GROUP,ANALYST_RIGHT_A_CANRESOLVECALLS)) )\n\t{\n\t\tMessageBox(\"You do not have sufficient privileges to resolve or close calls.  Please contact your system administrator\",MB_ICONSTOP);\t\n\t\treturn false;\n\t}\n\t\/\/-- returns true or false - true keeps form open \/ false will close form\n\tvar boolRetVal = _swdoc.setup_document_variables();\n\t\n\t_swdoc.resetData();\n\n\treturn boolRetVal;\n\t\n}"},{"name":"OnFormClosing","code":"OnFormClosing()\n{\n\t\/\/-- Check for Changes to any of the data fields\n\tif(_swdoc.boolFormFieldChanged)\n\t{\n\t\t\r\n\t\t\t\t\/\/-- are we running in webclient\r\n\t\t\t\tif(app && app._wc_version)\r\n\t\t\t\t{\r\n\t\t\t\t\t\/\/-- return object that contains save message and the code to execute if the user chooses to leave the page\r\n\t\t\t\t\tvar o = {};\r\n\t\t\t\t\to.message = \"You have unsaved data on this form.\";\r\n\t\t\t\t\to.onclosexecute = function()\r\n\t\t\t\t\t\t\t  {\r\n\t\t\t\t\t\t\t\tapp.global.UnlockCalls(_swdoc._form[\"callrefs\"]);\r\n\t\t\t\t\t\t\t\t_swdoc.ResetData();\r\n\t\t\t\t\t\t\t  }\r\n\t\t\t\t\treturn o;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(MessageBox(\"You have unsaved data on this form. Do you still want to close this form?\", MB_ICONQUESTION | MB_YESNO) == IDNO)\r\n\t\t\t\t\r\n\t\t\t\n\t\treturn false;\n\t}\n\t\n\tif(!_swdoc.CallrefsCommaString.length)\n\t{\t\n\t\t_swdoc.ResetData();\n\t\treturn true;\n\t}\n\t\t\n\tapp.global.UnlockCalls(_swdoc.CallrefsCommaString);\n\n\t_swdoc.resetData();\n\treturn true;\n}"},{"name":"(User Defined Functions)","code":"\t\/*\n\t\tCreated by Hornbill Systems\n\t\t\n\t\tUpdates\n\t\t\n\t\t\n\t\tBug\t\tDate\t\tAuthor\t\t\t\t\tDescription\n\t\t----------------------------------------------------------------------------\n\t\t56943\t14\/05\/07\tIvan Nicholas Dorosh\tAbility to set default value for survey.\n\t\n\t\n\t*\/\n\nvar boolLogMode = false; \/\/-- boolean - is the form being displayed in a logcall forn\nvar boolClosing = false; \/\/-- boolean - is the call action to close calls\/s (if false resolving)\nvar boolCloseOnly = false;\nvar boolResolveOnly = false; \/\/-- boolean - is the call for resolving only (not allowed to close)\n\nvar arrCallrefs = new Array(); \/\/-- array - holds the callrefs we want to close or resolve\nvar CallrefsCommaString = \"\";  \/\/-- string - comma delimted callrefs\nvar strIssueref = \"\";\t\t   \/\/-- string - has issue refs in it if we are closing an issue\n\t\nvar arrSurveyNameSurvIDs = new Array(); \/\/-- array - holds list of survey ids \nvar arrCallStatuss \t\t = new Array(); \/\/-- array - holds list of the all the calls status\nvar arrCallOpenTasks \t = new Array(); \/\/-- araray - holds list of all the calls tasks\n\nvar boolFormFieldChanged = false;\t\/\/-- boolean - set to true when formfield is changed. Used when closing form\n\nvar boolSourceEmail = false; \/\/-- from opened from email\nvar boolHaveSubject = false; \/\/-- Is there a subject\nvar boolHaveSurveys = false; \/\/-- are there surveys available\n\nvar boolMixedFTF = false;\nvar boolMixedCallClasses = false; \/\/-- boolean are we working with mixed call classes\nvar boolHavePendingCalls = false; \/\/-- we have calls that are pending\nvar boolHaveResolvedCalls = false; \/\/-- we have calls that are resolved\nvar boolMultipleCalls = false; \/\/-- we are working with multiple calls\n\nvar boolClosingIssue = false; \/\/-- boolean are we closing calls as part of an issue\nvar boolMixedCallStatus  = false  \/\/-- boolean are we working with a mixtuer of call states\n\nvar nBackdatePeriod = 0;\n\n\/\/-- reset bound record so we dont get messages when leaving\nfunction resetData()\n{\n\t_swdoc.ResetModiedFlag(\"updatedb\");\n\t_swdoc.ResetModiedFlag(\"opencall\");\n}\n\n\/\/-- validate form data that user has set\nfunction ValidateForm()\n{\n\tif((_swdoc.updatedb.timespent < 1 || _swdoc.updatedb.timespent > 60000) && (mainform.tb_timespent.mandatory))\n\t{\n\t\tMessageBox(\"You must enter the amount of time you spent on this action\", MB_OK);\n\t\treturn false;\t\/\/ Make sure that the time spent is within range\n\t}\n\n\tif(_swdoc.updatedb.updatetxt == \"\")\n\t{\n\t\tMessageBox(\"You must enter a description in the Action Description tab.\", MB_OK | MB_ICONINFORMATION );\n\t\treturn false;\t\/\/ Make sure we have some update text\n\t}\n\n\t\/\/-- check other required fields\n\tif (!_swdoc.check_mandatory_fields(\"updatedb\",mainform))return false;\t\t\n\tif (!_swdoc.check_mandatory_fields(\"opencall\",mainform))return false;\n\t\n\treturn TRUE;\n}\n\n\n\/\/-- 08.02.2007 - NWJ - Check mandatory fields on the form for a given table\n\/\/--\t\t\t\t\talert user if need be and return false\t\t\t\t\t\t\nfunction check_mandatory_fields(strTable,oForm)\n{\n    for (var x = 0; x<oForm.elements.length;x++)\n    {\n        var element = oForm.elements[x];\n        if ((element.mandatory) && (element.text ==\"\"))\n        {\n            var colName = \"\";\n            var fieldName = \"(not specified)\";\n            if(element.dataRef!=\"\")\n            {\n            \tvar arrInfo = element.dataRef.split(\".\");\n            \tvar strTable = arrInfo[0];\n            \tvar colName = arrInfo[1];\n            \tvar fieldName = dd.tables[strTable].columns[colName.toLowerCase()].DisplayName;\n            }\n            MessageBox(\"The field '\" + fieldName + \"' is a mandatory field and must be completed.\");\n            return false;\n        }\n    }\n    return true;\n}\n\nfunction setup_call_action()\n{\n\t\/\/-- should list box be selectatable\n\t\/\/-- closing\n\t\n\tif ((_swdoc.boolCloseOnly) || (_swdoc.boolClosing))\n\t{\n\t\tif(_swdoc.boolCloseOnly)_swdoc.boolClosing = true;\n\t\t\/\/ind01 Ivan Nicholas Dorosh 02\/04\/07 - Set the text regardless of what the form is set to\n\t\t_ete(mainform.cb_callaction , \"Close Call\");\n\t\t\n\t\t\/\/-- closing\n\t\t\/\/-- If closing call do not allow user to select fix code profile\n\t\t\/\/-- due to core product server restrictions\n\t\t\/\/ind02 mainform.btnBrowseProfile.enable=_swdoc.boolMixedCallStatus;\n\t\t\/\/ind02 mainform.btnGetProfileText.enable = false;\t\t\n\t\t\/\/ind02 This code just didn't make sense.  Checked with AndreiT, and confirmed\n\t\t\/\/ That this should not be enabled for Mixed Call Statuses only.\n\t\t_een(mainform.btnBrowseProfile,(_swdoc.boolMixedCallStatus==false));\n\t\t_een(mainform.btnGetProfileText , (_swdoc.boolMixedCallStatus==false));\t\t\n\t\t\n\t\tvar boolEnableFTF = dd.GetGlobalParamAsNumber(\"Application Settings\\EnableFirstTimeFixWhenClosing\", 0);\n\t\t_een(mainform.flg_ftf , ((boolEnableFTF) && (!_swdoc.boolMixedFTF)));\n\t}\n\telse\n\t{\n\t\n\t\t\/\/ind01 Ivan Nicholas Dorosh 02\/04\/07 - Set the text regardless of what the form is set to\n\t\t_ete(mainform.cb_callaction , \"Resolve Call\");\n\t\t\n\t\n\t\t\/\/ind02 \/\/-- resolving or could be closing\n\t\t\/\/ind02 mainform.btnBrowseProfile.enable=true;\n\t\t\n\t\t\/\/ind02 This code just didn't make sense.  Checked with AndreiT, and confirmed\n\t\t\/\/ That this should not be enabled for Mixed Call Statuses only.\n\t\t_een(mainform.btnBrowseProfile, (_swdoc.boolMixedCallStatus==false));\n\t\t_een(mainform.btnGetProfileText , (_swdoc.boolMixedCallStatus==false));\t\n\t\t\n\t}\n\t\n\t\/\/-- set menu shortcut\n\tstrAppends = (_swdoc.boolMultipleCalls)?\"s\":\"\";\n\t_emt(mainform.btnResolveClose , \"&\" + mainform.cb_callaction.text + strAppends);\n\t_ete(mainform.btnResolveClose , mainform.cb_callaction.text + strAppends);\n\n\t\/\/-- setup other flags based on call action\t\n\t_swdoc.setup_charge_flag();\n\t_swdoc.setup_kbase_flag()\t\n}\n\nfunction setup_form_mode()\n{\n\t\/\/-- always make sure fixcode desc is disabled\n\t_een(mainform.tb_fixcodedescription,false);\t\n\t_evi(mainform.btnResolveClose , true);\n\t\n\t\t\n\tvar bResolveByDefault = app.session.IsDefaultOption(ANALYST_DEFAULT_RESOLVEBYDEFAULT);\t\t\t\n\t\/\/-- if user does not have the right to close calls then only allow resolve\n\tif(!app.session.HaveRight(ANALYST_RIGHT_A_GROUP,ANALYST_RIGHT_A_CANCLOSECALLS))\n\t{\n\t\t_een(mainform.cb_callaction,false);\n\t\tbResolveByDefault = true;\n\t}\n\n\t\/\/-- do they have option to resolve\n\tif(!app.session.HaveRight(ANALYST_RIGHT_A_GROUP,ANALYST_RIGHT_A_CANRESOLVECALLS))\n\t{\n\t\t_een(mainform.cb_callaction,false);\n\t\tbResolveByDefault = false;\n\t}\n\t\n\t_swdoc.boolClosing = !bResolveByDefault;\n\t\n\t\/\/-- set the default selection for the call action pick list based on the DD entry \n\tif((bResolveByDefault) && (!_swdoc.boolHaveResolvedCalls))\n\t{\n\t\t_ete(mainform.cb_callaction , \"Resolve Call\");\n\t}\n\telse\n\t{\n\t\t_ete(mainform.cb_callaction , \"Close Call\");\n\t}\t\t\n\t\n\t\/\/--\n\t\/\/-- disable \/ enable form fields\n\t_een(mainform.cb_callaction , (!_swdoc.boolHaveResolvedCalls));\t\n\t_een(mainform.dt_actiontime , (app.session.CanBackdateCallActions())); \/\/-- can backdate ?\n\n\t\/\/-- link passed in file attachments and set user perm to add\n\t_swdoc.setup_file_attachments();\n}\n\nfunction setup_file_attachments()\n{\n\t\/\/--read the passed in attachemnets\n\tvar x=0;\n\twhile(_swdoc._form[\"attach\"+x])\n\t{\n\t\tmainform.fl_attachments.AddAttachment(_swdoc._form[\"Attach\" + x]);\n\t\tx++;\n\t}\n\tif (!app.session.HaveRight(ANALYST_RIGHT_A_GROUP,ANALYST_RIGHT_A_CANATTACHFILESTOCALLS,false))\n\t{\n\t\tif(_swdoc._form[\"Attach1\"])\n\t\t{\n\t\t\t_evi(mainform.btnAddFile , false);\n\t\t\t_evi(mainform.btnRemoveFile , false);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tmainform.Tab1.ShowTabItem(1,false);\n\t\t}\n\t}\n}\n\n\/\/-- 08.02.2007 - NWJ - One function to handle which standard check boxes should be enabled\/disabled\n\/\/--\t\t\t\t\tchecked or unchecked, as old code fglas were set all over the place\nfunction setup_public_flag()\n{\n\t_een(mainform.flg_updatepublic,true);\n\t_ete(mainform.flg_updatepublic , app.session.IsDefaultOption(ANALYST_DEFAULT_CLOSEPRIVATE) ? \"1\":\"0\");\n\n\tif (_swdoc.boolClosing)\n\t{\n\t\t\/\/-- closing\n\t}\n\telse\n\t{\n\t\t\/\/-- resolving\n\t}\n}\n\nfunction setup_kbase_flag()\n{\n\t\/\/- -does the user have the right to add to the kbase or we are worknig with multiple calls so dont add\n\tif((!app.session.HaveRight(ANALYST_RIGHT_C_GROUP,ANALYST_RIGHT_C_CANADDTOKNOWLEDGEBASE)) || (_swdoc.boolMultipleCalls))\n\t{\n\t\t_ete(mainform.flg_addKBase \t, \"0\");\n\t\t_een(mainform.flg_addKBase , false);\n\t\treturn;\n\t}\n\n\t\/\/-- We need to check whether this call has been added to the knowledge\n\t\/\/-- base when it was resolved.\t\n     if(app.global.IsCallInKnowledgeBase(_swdoc.arrCallrefs[0]))\n     {\n\t\t_ete(mainform.flg_addKBase , \"0\");\n        _een(mainform.flg_addKBase , false);\n     }\n     else\n     {\n        _ete(mainform.flg_addKBase , app.session.IsDefaultOption(ANALYST_DEFAULT_CLOSEKNOWLEDGEBASE) ? \"1\":\"0\");\n        _een(mainform.flg_addKBase,true);\n     }\n}\n\nfunction setup_charge_flag()\n{\n\tif (_swdoc.boolClosing)\n\t{\n\t\t\/\/-- closing\n\t\t_een(mainform.flg_chargeable,true);\n\t\t_ete(mainform.flg_chargeable , app.session.IsDefaultOption(ANALYST_DEFAULT_CLOSECHARGABLE) ? \"1\":\"0\");\t\t\n\t}\n\telse\n\t{\n\t\t\/\/-- resolving\n\t\t_een(mainform.flg_chargeable,false);\n\t\t_ete(mainform.flg_chargeable,0);\t\t\n\t}\n}\n\nfunction setup_email_flag()\n{\n\t\/\/--\n\t\/\/-- if we have a mailserver and can send mail set flg\n\tif(app.global.IsConnectedToMailServer() && app.global.CanSendMail())\n\t{\n\t\t_een(mainform.flg_emailcustomer , true);\n\t\t_ete(mainform.flg_emailcustomer , (app.session.IsDefaultOption(ANALYST_DEFAULT_CLOSESENDEMAIL)) ? \"1\":\"0\");\n\t}\n\telse\n\t{\n\t\t_een(mainform.flg_emailcustomer , false);\n\t\t_ete(mainform.flg_emailcustomer , \"0\");\n\t}\n}\n\n\/\/--\n\/\/-- initialise the surveys options\nfunction setup_survey_options()\n{\n\t\/\/-- if they do not have surveys hide options\n\tif(!app.global.IsSurveyModuleEnabled())\n\t{\n\t\t_ete(mainform.flg_customersurvey , \"0\");\t\n\t\t_evi(mainform.flg_customersurvey , false);\n\t\t_evi(mainform.cb_surveys , false);\n\t}\n\telse\n\t{\n\t\t\/\/-- get survey options\n\t\t_swdoc.load_survey_list();\t\n\n\t\t\/\/-- if we dont have surveys on the system then hide\n\t\tif(!_swdoc.boolHaveSurveys)\t\n\t\t{\n\t\t\t_ete(mainform.flg_customersurvey , \"0\");\t\n\t\t\t_een(mainform.flg_customersurvey , false);\t\t\t\t\n\t\t\t_evi(mainform.cb_surveys , false);\t\t\n\t\t\treturn false;\n\t\t}\n\t\t\n\t\t\/\/-- have to set to true because if you set to hidden in code and then dev form it saves the state\n\t\t_evi(mainform.flg_customersurvey , true);\t\t\t\t\t\t\n\t\t_evi(mainform.cb_surveys , true);\t\n\t\t\t\n\t\t\/\/-- not allowed to change send survey options or there arent any surveys to send\n\t\tif(app.session.IsDefaultOption(ANALYST_DEFAULT_DISABLESENDSURVEY)) \n\t\t{\n\t\t\t\/\/--code change DavidJH 09.06.05\n\t\t\t_een(mainform.flg_customersurvey , false);\n\t\t\t_ete(mainform.flg_customersurvey,\"0\");\n\t\t\treturn false;\n\t\t}\n\t\telse\n\t\t{\n\t\t\t_een(mainform.flg_customersurvey , true);\n\t\t}\n\t\t\n\t\t\/\/-- default ticked setting\n\t\tif(app.session.IsDefaultOption(ANALYST_DEFAULT_SETSENDSURVEY))\n\t\t{\n\t\t\t_ete(mainform.flg_customersurvey , \"1\");\n\t\t\t_een(mainform.cb_surveys , true);\t\t\t\t\t\t\n\t\t}\n\t\telse\n\t\t{\n\t\t\t_ete(mainform.flg_customersurvey , \"0\");\n\t\t\t_een(mainform.cb_surveys , false);\t\t\t\t\t\t\n\t\t}\n\t}\n}\n\nfunction load_survey_list()\n{\n\t\/\/-- empty the picklist\n\tmainform.cb_surveys.pickList = \"\";\n\t\n\t\/\/-- select all of the system mailboxes and add all shared mailboxes to an array\n\tvar SqlRecordSetObj\t= new SqlQuery;\n\t\n\t\/\/-- select all of the surveys and the mailbox they are associated to\n\tSqlRecordSetObj.Reset();\n\tSqlRecordSetObj.InvokeStoredQuery(\"form\/resolvecloseform\/getsurveys\",\"\");\n\t\t\n\tvar str = \"\";\n\tvar selected = \"\";\n\tvar strTemps = new Array();\n\tbselecteddefaultsurvey = false;\n\t\n\t\/\/-- loop through the surveys and and match those associated to shared mailboxes\n\t\/\/-- for each survey add it into an array and to the pick list string and when the \n\t\/\/-- first survey is found identify it as the default option for the survey picklist\n\twhile(SqlRecordSetObj.Fetch())\n\t{\n\t\t\/\/-- get the recordset value for survey name and id\n\t\tvar surveyname = SqlRecordSetObj.GetValueAsString(\"surveyName\");\n\t\tvar surveyid = SqlRecordSetObj.GetValueAsString(\"surveyid\");\n\t\t\n\t\t\/\/-- add the survey name\/id pair into the array\n\t\t_swdoc.arrSurveyNameSurvIDs[surveyname] = surveyid;\n\t\t\n\t\t\/\/-- build the picklist\toptions string\t\n\t\tstr += surveyname + \"|\";\n\t\t\/\/MessageBox(surveyname)\n\t\t_swdoc.boolHaveSurveys=true;\n\t\t\/\/-- identify the default survey (currently the first one added)\n\t\tfor(ID in _swdoc.arrSurveyNameSurvIDs)\n\t\t{\n\t\t\t\n\t\t\tif(_swdoc.arrSurveyNameSurvIDs[ID])\n\t\t\t{\n\t\t\t\t\/* 56943-1 Not required, set in form.\n\t\t\t\tif(!bselecteddefaultsurvey)\n\t\t\t\t{\n\t\t\t\t\tbselecteddefaultsurvey = true;\n\t\t\t\t\tselected = surveyname;\n\t\t\t\t}\n\t\t\t\t*\/\n\t\t\t}\n\t\t}\n\t\t\t\n\t}\n\t\n\t\/\/-- populate the surveys pick list\n\tmainform.cb_surveys.pickList = str;\n\t\n\t\/\/-- set the default selected survey\n\t\/\/56943-1 mainform.cb_surveys.text = selected;\n}\n\n\nfunction setup_profile_selection()\n{\n\n}\n\nfunction setup_resolution_profile()\n{\n\t\/\/-- disable profile text button\n\t_een(mainform.btnGetProfileText,false);\n\n\t\/\/-- if we have pending calls dont bother\n\tif (_swdoc.boolHavePendingCalls) return;\n\tif (!_swdoc.boolHaveResolvedCalls) return;\n\n\t\/\/-- DJH\n\t\/\/-- 24.01.2006 \n\t\/\/-- if the call is resolved, pull the resolution text and prepopulate the boxes with this text.\n\tvar aRSfixcodes\t= new SqlQuery;\n\t\n\t\/\/-- NWJ -  24.01.2006\n\t\/\/--\t\tGet distinct profile codes for passed in calls\n\tvar strParams = \"crfs=\"+pfu(_swdoc.CallrefsCommaString);\n\tif (!aRSfixcodes.InvokeStoredQuery(\"form\/resolvecloseform\/get_fixcodes\",strParams))\n    {\n\t\tMessageBox(\"Unable to query call fixcode values. Please contact your Supportworks Administrator.\", MB_ICONSTOP);\n\t}\n\telse\n\t{\n\t\t\/\/-- NWJ - 24.01.2006\n\t\t\/\/-- \t   See if we have more than 1 fixcode\n\t\tvar strFixCode \t= \"\"\n\t\tvar strFixText\t= \"\";\n\t\tvar intFixCodeCount = 0;\n\t\twhile(aRSfixcodes.Fetch())\n\t\t{\n\t\t\tintFixCodeCount++;\t\t\t\n\t\t\t\/\/-- we have multiple fixcodes\n\t\t\tif (intFixCodeCount > 1) \n\t\t\t{\n\t\t\t\tstrFixCode = \"\";\n\t\t\t\tstrFixText = \"<multiple profiles>\";\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tstrFixCode = aRSfixcodes.GetValueAsString(\"fixcode\");\n\t\t}\n\t\t\n\t\t\/\/-- if we have one fix code we should load this profile\n\t\tif (intFixCodeCount == 1)\n\t\t{\n\t\t\tvar objFix = app.global.GetResolutionProfileDescription(strFixCode);\n\t\t\tstrFixText = objFix.strCodeDesc;\t\n\t\t\t\/\/-- nwj if it has a dec text enable button to copy\n\t\t\t_een(mainform.btnGetProfileText,(objFix.strDescription!=\"\"));\n\t\n\t\t}\n\n\t\t\/\/-- set text desc of code and then set actual code against opencall record\n\t\t_ete(mainform.tb_fixcodedescription , strFixText);\n\t\t_swdoc.opencall.fixcode = strFixCode;\t\t\n\t\t\t\n\t}\/\/end else query was successful\n\n}\n\n\/\/-- 09.02.2007 - NWJ - initialise the _swdoc variables and state\nfunction setup_document_variables(boolLogging)\n{\n\t\/\/-- store callrefs string and create array\n\t_swdoc.CallrefsCommaString = _swdoc._form[\"callrefs\"];\n\t_swdoc.arrCallrefs = _swdoc.CallrefsCommaString.split(\",\");\n\t_swdoc.boolMultipleCalls = (_swdoc.arrCallrefs.length>1);\n\t\n\t\/\/-- arrays to hold call info\n\t_swdoc.arrSurveyNameSurvIDs \t= new Array();\n\t_swdoc.arrCallStatuss \t\t= new Array();\n\t_swdoc.arrCallOpenTasks \t\t= new Array();\n\t\t\t\t\n\t\/\/-- do we have an issue reference\n\tif(_swdoc._form[\"issueref\"])\n\t{\n\t\t_swdoc.boolClosingIssue = true;\n\t\t\/\/MessageBox(\"Issue Ref \" + _swdoc._form[\"issueref\"])\n\t\t_swdoc.strIssueref = _swdoc._form[\"issueref\"];\n\t}\n\n\t\/\/-- if the call does not have active tasks then its ok to lock them - otherwise close form\n\tvar strTaskMsg = _swdoc.check_call_has_active_tasks(_swdoc.CallrefsCommaString);\n\tif(strTaskMsg!=\"\")\n\t{\n\t\tMessageBox(strTaskMsg,MB_ICONSTOP);\n\t\tapp.global.UnlockCalls(_swdoc.CallrefsCommaString);\n\t\treturn false;\n\t}\n\telse\n\t{\n\t\t\/\/-- lock selected calls for close activity\t\n\t\tif(!app.global.LockCalls(_swdoc.CallrefsCommaString, \"CLOSE\"))\n\t\t{\n\t\t\t\/\/-- Failed to lock close the form\n\t\t\treturn false;\n\t\t}\n\n\t\t\t\t\n\t\t\/\/- got get call states and classes - so user can choose what to do if they are different.\n\t\tif(!_swdoc.check_call_states_and_classes(_swdoc.CallrefsCommaString))\t\n\t\t{\n\t\t\tapp.global.UnlockCalls(_swdoc.CallrefsCommaString);\n\t\t\treturn false;\n\t\t}\n\t\telse\n\t\t{\n\t\t\t\n\t\t\t\/\/-- create form title\n\t\t\t_swdoc.create_form_title();\n\t\t\t\t\n\t\t\t\/\/-- are we resolving only\n\t\t\t_swdoc.boolResolveOnly = (_swdoc._form[\"resolve\"] == \"1\");\n\t\t\t\t\n\t\t\t\/\/-- did we come from an email\n\t\t\t_swdoc.boolSourceEmail = (_swdoc._form[\"_source_email\"] == \"true\");\n\t\t\n\t\t\t\/\/-- do we have a subject\t\t\n\t\t\t_swdoc.boolHaveSubject = (_swdoc._form[\"subject\"] == \"true\");\n\t\t\t\t\n\t\t\t\/\/--- set update text\n\t\t\t_swdoc.strUpdateText = _swdoc._form[\"updatetext\"];\n\t\t}\t\t\n\t\t\n\t}\/\/-- if(strTaskMsg!=\"\")\n\n\treturn TRUE;\n}\n\n\/\/-- 09.02.2007 - NWJ - Check if call\/s have any active tasks - if so return message.\nfunction check_call_has_active_tasks(strCheckCallrefs)\n{\n\t\n\tvar returnMessage = \"\";\n\tvar aRS\t= new SqlQuery;\n\n\t\/\/-- perform a sql check to see if we have any open calltasks\n\tvar strParams = \"crfs=\"+pfu(strCheckCallrefs);\n\tif(!aRS.InvokeStoredQuery(\"form\/resolvecloseform\/cnt_calltasks_by_callref\", strParams))\n    {\n\t\tif(_swdoc.strIssueref.length == 0)\n     \t{\n     \t\treturnMessage = \"Unable to query call task status values. Please contact your Supportworks Administrator.\";\n     \t}\n    }\n\telse\n\t{\n\t\t_swdoc.arrCallOpenTasks.length = 0;\n\t\t\t\n\t\twhile(aRS.Fetch())\n\t\t{\n\t\t\t\tvar nCount =  aRS.GetValueAsString(\"ct\");\n\t\t\t\tvar calref =  aRS.GetValueAsString(\"callref\");\n\t\t\t\t_swdoc.arrCallOpenTasks[calref] = nCount;\n\t\t}\n\t\t\n\t\tvar nLength = _swdoc.arrCallOpenTasks.length;\n\t\tif(nLength)\n\t\t{\n\t\t\tvar Ref = \"\";\n\t\t\tvar Message = \"\";\n\t\t\tif(nLength > 1)\n\t\t\t{\n\t\t\t\tfor(ID in _swdoc.arrCallOpenTasks)\n\t\t\t\t{\n\t\t\t\t\t\/\/-- 30.01.2006 - DJH code to add comma between call refs when dealing with multiple calls\n\t\t\t\t\tvar Value = dd.tables[\"opencall\"].columns[\"callref\"].FormatValue(ID);\n\t\t\t\t\tif(Ref != \"\")Ref += \",\";\n\t\t\t\t\tRef += Value;\n\t\t\t\t}\n\t\t\t\treturnMessage = \"The following calls still have outstanding work items assigned to them and can not be closed:-\\n\\n\" + Ref; \/\/Removed  + \"1\" from end\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tfor(ID in _swdoc.CallOpenTaskMap)\n\t\t\t\t{\n\t\t\t\t\t\treturnMessage = \"The call \" + ID + \" still has \" + _swdoc.arrCallOpenTasks[ID] + \" outstanding work item(s) and can not be closed.\";\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\/\/--if(nLength > 1)\t\t\n\t\t}\/\/-- if(nLength)\n\t}\/\/-- if(!aRS.invokestoredquery)\n\t\n \treturn returnMessage;\n}\n\n\/\/-- 09.02.2007 - NWJ - Construct form title based on state etc\nfunction create_form_title()\n{\n\t\/\/-- start to contruct form title (call local function to format callrefs and finish title)\n\tvar strFormTitle = (_swdoc.arrCallrefs.length > 1) ? \"Resolve\/Close Calls \" : \"Resolve\/Close Call \";\n\n\t\/\/-- loop through array and format callrefs\t\n\tfor(var i=0;i<_swdoc.arrCallrefs.length; i++)\n\t{\n\t\tif( i > 0) strFormTitle += \", \";\n\t\tstrFormTitle += dd.tables[\"opencall\"].columns[\"callref\"].FormatValue(_swdoc.arrCallrefs[i]);\n\t}\n\n\t\/\/-- if we are closing an issue and to title\n\tif(_swdoc.strIssueref.length) strFormTitle += \" Closing issue \" + _swdoc.strIssueref\n\t\t\t\n\t\/\/-- set the title\n\t_swdoc.SetTitle(strFormTitle);\n}\n\n\/\/-- 09.02.2007 - NWJ - check the state and callclass for the action calls - true \/ false (false = close down)\nfunction check_call_states_and_classes(strCheckCallrefs)\n{\n\t\/\/-- get the status and class for our callref\/s\n    var aRScallstate = new SqlQuery;\n\t\n   var strParams = \"crfs=\"+pfu(strCheckCallrefs);\n   if(!aRScallstate.InvokeStoredQuery(\"form\/resolvecloseform\/get_calls_for_status_check\", strParams))\n   {\n     \t\/\/-- failed - check if we have an issue\n     \tif(_swdoc.strIssueref.length == 0)\n     \t{\n     \t\tMessageBox(\"Unable to query call status values. Please contact your Supportworks Administrator..\", MB_ICONSTOP);\n     \t\treturn false;\n     \t}\n    }\n    else\n    {\n\t\t\/\/--\n\t\t\/\/-- loop through our returned rows and get state and classes\n\t\t\n\t\tvar strCurrentCallClass = \"\";\n\t\tvar strLastCallClass = \"\";\t\t\t\t\t\n\t\tvar strCurrFTF = -1;\n\t\tvar strLastFTF = -1;\n\t\t\n\t\t\n\t\tvar nPendingStatus = 0;\n\t\tvar nResolvedStatus = 0;\n\t\tvar nOtherStatus = 0;\n\t\t\n\t\twhile(aRScallstate.Fetch())\n\t\t{\t\t\t\n\t\t\t\/\/-- get status and callref and add info an array\n\t\t\tvar iStatus =  aRScallstate.GetValueAsNumber(\"status\");\n\t\t\tvar iCalref =  aRScallstate.GetValueAsNumber(\"callref\");\n\t\t\t_swdoc.arrCallStatuss[iCalref] = iStatus;\n\t\t\t\t\t\t\n\t\t\t\/\/-- get call class and check if it same as others\n\t\t\t\/\/-- simply want to check if we have selected to resolve or close perate call classes\n\t\t\tstrCurrentCallClass = aRScallstate.GetValueAsString(\"callclass\");\n\t\t\tif ((strLastCallClass != \"\") && (!_swdoc.boolMixedCallClasses))\n\t\t\t{\n\t\t\t\t_swdoc.boolMixedCallClasses = (strLastCallClass != strCurrentCallClass);\n\t\t\t}\n\t\t\tstrLastCallClass = strCurrentCallClass;\n\t\t\t\n\t\t\t\/\/-- NWJ - 23.11.2007 - check first time fix\n\t\t\tstrCurrFTF = aRScallstate.GetValueAsNumber(\"flg_firsttimefix\");\t\t\t\n\t\t\tif((strLastFTF!=-1)&&(strLastFTF!=strCurrFTF))\n\t\t\t{\n\t\t\t\t_swdoc.boolMixedFTF=true;\n\t\t\t}\n\t\t\tstrLastFTF = strCurrFTF;\n\t\t\t\n\t\t\tswitch(iStatus)\n\t\t\t{\n\t\t\t\tcase CS_PENDING:\n\t\t\t\t\tnPendingStatus++;\n\t\t\t\t\tbreak;\n\t\t\t\tcase CS_RESOLVED:\n\t\t\t\t\tnResolvedStatus++;\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tnOtherStatus++;\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\taRScallstate.Reset();\/\/-- reset recordset object\n\t\n\t\t\n\t\t\/\/-- we have different call classes and not working with an issue prompt use as to what to do\n\t\tif((_swdoc.boolMixedCallClasses) && (_swdoc.strIssueref.length == 0))\n\t\t{\n\t\t\tvar Message = \"The calls you have selected to resolve or close have different call classes, so any resolution profile you may specify will not be applied if you continue. Do you want to continue?\\n\\n(If you want resolution profiles to apply, you should click No and resolve\/close each call separately)\";\n\t\t\tif(MessageBox(Message, MB_ICONSTOP | MB_ICONQUESTION | MB_YESNO) != IDYES)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t\n\t\t\/\/--- if not pending or resolved && not dealing with issue\n\t\tif((nOtherStatus) &&(_swdoc.strIssueref.length == 0))\n\t\t{\t\t\t\n\t\t\tMessageBox(\"One or more selected calls can not be closed because they have a status other than Pending or Resolved.\", MB_ICONSTOP);\n\t\t\treturn false;\n\t\t}\n\t\n\t\t_swdoc.boolHavePendingCalls = (nPendingStatus);\n\t\t_swdoc.boolHaveResolvedCalls = (nResolvedStatus);\n\t\t_swdoc.boolCloseOnly = (nResolvedStatus);\t\t\n\t\t\/\/-- we have pending and resolved callss\t\n\t\tif(nPendingStatus && nResolvedStatus)\n\t\t{\n\t\t\t_swdoc.boolMixedCallStatus = true;\n\t\t\tif(_swdoc.strIssueref.length == 0)\n\t\t\t{\n\t\t\t\tvar Message = \"The calls you have selected have a mixture of 'Pending' and 'Resolved' statuses. As resolved calls have already been attributed a resolution profile, the resolution profile selected for closing these calls will only be applied to the calls that currently have a status of 'Pending'. The 'Resolved' calls will be completed leaving the previously applied resolution profile. \\n\\nDo you want to continue?\";\n\t\t\t\tif(MessageBox(Message, MB_ICONQUESTION | MB_YESNO) != IDYES)\n\t\t\t\t{\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t} \/\/-- if(!aRScallstate.invokestoredquery)\n\t\n\treturn true;\n}"},{"name":"OnExecuteAction","code":"OnExecuteAction(nAction)\n{\n\t\/\/-- trigger an action from a menu bar (shortcusts)\n\t\n\t\/\/-- closing call\n\tMessageBox(nAction);\n\tif(nAction == CLOSE_CALL_ACTION) return mainform.ResolveClose();\n\t\t\n\t\/\/-- attaching a call to the action.\n\tif(nAction == ATTACHFILETOCALL_ACTION)\n\t{\n\t\tmainform.btnAddFile_OnPressed();\n\t\treturn true;\n\t}\n\n\treturn true;\n}"},{"name":"OnValidate","code":"OnValidate()\n{\n\t\/\/-- validate the form\n\tif(!_swdoc.ValidateForm())return VALIDATE_FAIL;\n\t\t\n\treturn VALIDATE_DEFAULT;\n}"},{"name":"(Globals)","code":"\/\/-- ALL vars and funcs are in the userdefined js area"}]}}},"layouts":{"layout":[{"appearance":{"width":"561","height":"434","backgroundColor":"#ffffff","fillColour":"#ffffff","textColour":"#000000","font":{"@size":"8","#text":"Arial"}},"controls":{"control":[{"general":{"name":"tb_updatetext","type":"Field","group":"Tab1:0"},"appearance":{"index":"0","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Arial"},"borderStyle":"Rectangle"},"objectPlacement":{"position":{"top":"272","left":"17","right":"542","bottom":"412"},"scaling":{"top":"0","left":"0","right":"100","bottom":"100"}},"data":{"binding":"updatedb.updatetxt"},"controlInfo":{"mouseOverCursor":"Window Default","type":"Text Edit","flags":{"invisible":"false","readOnly":"false","mandatory":"true","mandatoryLabelBackground":"false","mandatoryLabelText":"false","allowNullValue":"false","skipTabStop":"false","disabled":"false","protected":"true","noMacroExpand":"true","readOnlyInit":"false","autoCompleteField":"false","editUnlimitedText":"true","url":"false"},"textLineCount":"4","textInputFormat":"Text","properties":{"activeTextColor":"#eeeeee","disabledBackgroundColor":"#eeeeee","borderColor":"#c0c0c0"}}},{"general":{"name":"CaptionPanel2","type":"CaptionBar","flags":{"transparent":"true","xpStyle":"false","hasShadow":"false","toolbarButtonStyle":"false","cache":"false","hasBorder":"true","hasCheckbox":"false"}},"appearance":{"index":"1","caption":"Details","backgroundColor":"#f1f1f1","foregroundColor":"#003366","font":{"@size":"10","@bold":"1","#text":"Trebuchet (MS)"},"alignment":"Left","fillStyle":"Vertical Gradient"},"objectPlacement":{"position":{"top":"29","left":"3","right":"394","bottom":"205"},"scaling":{"top":"0","left":"0","right":"50","bottom":"0"}},"controlInfo":{"mouseOverCursor":"Window Default","properties":{"backgroundColor2":"#d8d8d8","imageHSpace":"10","slope":"12","borderColor":"#d3c9b6","headerHeight":"23","hasBorder":"1","panelBorderColor":"#d3c9b6","fillStyle":"0","panelBackgroundColor":"#f2eedd","panelBackgroundColor2":"#000000"}}},{"general":{"name":"dt_actiontime","type":"Field"},"appearance":{"index":"2","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Arial"},"borderStyle":"Rectangle"},"objectPlacement":{"position":{"top":"73","left":"11","right":"218","bottom":"91"},"scaling":{"top":"0","left":"0","right":"25","bottom":"0"}},"data":{"binding":"updatedb.updatetimex"},"controlInfo":{"mouseOverCursor":"Window Default","type":"Date\/Time Control","flags":{"invisible":"false","readOnly":"false","mandatory":"false","mandatoryLabelBackground":"false","mandatoryLabelText":"false","allowNullValue":"false","skipTabStop":"false","disabled":"true","protected":"true","noMacroExpand":"false","readOnlyInit":"false","colorDateIndicator":"false"},"textLineCount":"0","textInputFormat":"Text","properties":{"activeTextColor":"#eeeeee","disabledBackgroundColor":"#eeeeee","dateFormatMode":"0","borderColor":"#c0c0c0"}}},{"general":{"name":"tb_timespent","type":"Field"},"appearance":{"index":"3","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Arial"},"borderStyle":"Rectangle"},"objectPlacement":{"position":{"top":"73","left":"227","right":"286","bottom":"91"},"scaling":{"top":"0","left":"25","right":"25","bottom":"0"}},"data":{"binding":"updatedb.timespent"},"controlInfo":{"mouseOverCursor":"Window Default","type":"Minute Time Period","flags":{"invisible":"false","readOnly":"false","mandatory":"false","mandatoryLabelBackground":"false","mandatoryLabelText":"false","allowNullValue":"false","skipTabStop":"false","disabled":"false","protected":"true","noMacroExpand":"false","readOnlyInit":"false"},"textLineCount":"0","textInputFormat":"Text","properties":{"defaultValue":"5","activeTextColor":"#eeeeee","disabledBackgroundColor":"#eeeeee","borderColor":"#c0c0c0"}}},{"general":{"name":"cb_actionsource","type":"Field"},"appearance":{"index":"4","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Arial"},"borderStyle":"Rectangle"},"objectPlacement":{"position":{"top":"110","left":"11","right":"218","bottom":"128"},"scaling":{"top":"0","left":"0","right":"25","bottom":"0"}},"data":{"binding":"updatedb.udsource"},"controlInfo":{"mouseOverCursor":"Window Default","type":"Pick List","flags":{"invisible":"false","readOnly":"false","mandatory":"true","mandatoryLabelBackground":"false","mandatoryLabelText":"false","allowNullValue":"false","skipTabStop":"false","disabled":"false","protected":"true","noMacroExpand":"false","readOnlyInit":"false","comboAutoUpdate":"false","comboNewValues":"true","useDDPickList":"true"},"textLineCount":"0","textInputFormat":"Text","properties":{"disabledBackgroundColor":"#eeeeee","defaultValue":"Telephone","distinctTable":"updatedb","distinctColumn":"udsource","borderColor":"#c0c0c0"}}},{"general":{"name":"tb_actiontype","type":"Field"},"appearance":{"index":"5","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Arial"},"borderStyle":"Rectangle"},"objectPlacement":{"position":{"top":"110","left":"227","right":"388","bottom":"128"},"scaling":{"top":"0","left":"25","right":"50","bottom":"0"}},"data":{"binding":"updatedb.udcode"},"controlInfo":{"mouseOverCursor":"Window Default","type":"Pick List","flags":{"invisible":"false","readOnly":"false","mandatory":"true","mandatoryLabelBackground":"false","mandatoryLabelText":"false","allowNullValue":"false","skipTabStop":"false","disabled":"false","protected":"true","noMacroExpand":"false","readOnlyInit":"false","comboAutoUpdate":"false","comboNewValues":"true","useDDPickList":"true"},"textLineCount":"0","textInputFormat":"Text","properties":{"defaultValue":"General Update","listItems":"General Update|Called Customer|E-mailed Customer|","activeTextColor":"#eeeeee","disabledBackgroundColor":"#eeeeee","borderColor":"#c0c0c0"}}},{"general":{"name":"btnBrowseProfile","type":"EventButton","flags":{"transparent":"false","xpStyle":"true","hasShadow":"false","toolbarButtonStyle":"false","cache":"false","hasBorder":"false","hasCheckbox":"false"}},"appearance":{"index":"6","caption":"...","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Arial"}},"objectPlacement":{"position":{"top":"156","left":"362","right":"388","bottom":"177"},"scaling":{"top":"0","left":"50","right":"50","bottom":"0"}},"controlInfo":{"mouseOverCursor":"Window Default","flags":{"invisible":"false","skipTabStop":"false","disabled":"false","protected":"true","noMacroExpand":"false","multiLine":"false"},"properties":{"commands":"-1"}}},{"general":{"name":"tb_fixcodedescription","type":"Field"},"appearance":{"index":"7","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Arial"},"borderStyle":"Rectangle"},"objectPlacement":{"position":{"top":"158","left":"11","right":"364","bottom":"176"},"scaling":{"top":"0","left":"0","right":"50","bottom":"0"}},"controlInfo":{"mouseOverCursor":"Window Default","type":"Text Edit","flags":{"invisible":"false","readOnly":"false","mandatory":"false","mandatoryLabelBackground":"false","mandatoryLabelText":"false","allowNullValue":"false","skipTabStop":"false","disabled":"true","protected":"true","noMacroExpand":"false","readOnlyInit":"false","autoCompleteField":"false","editUnlimitedText":"false","url":"false"},"textLineCount":"0","textInputFormat":"Text","properties":{"activeTextColor":"#eeeeee","disabledBackgroundColor":"#eeeeee","borderColor":"#c0c0c0"}}},{"general":{"name":"flg_emailcustomer","type":"Field","flags":{"transparent":"true","xpStyle":"false","hasShadow":"false","toolbarButtonStyle":"false","cache":"false","hasBorder":"false","hasCheckbox":"false"}},"appearance":{"index":"8","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Trebuchet MS"},"borderStyle":"None"},"objectPlacement":{"position":{"top":"76","left":"409","right":"525","bottom":"95"},"scaling":{"top":"0","left":"50","right":"50","bottom":"0"}},"controlInfo":{"mouseOverCursor":"Window Default","type":"Form Flags","flags":{"invisible":"false","readOnly":"false","mandatory":"false","mandatoryLabelBackground":"false","mandatoryLabelText":"false","allowNullValue":"false","skipTabStop":"false","disabled":"false","protected":"true","noMacroExpand":"false","readOnlyInit":"false","comboAutoUpdate":"false","comboNewValues":"false"},"textLineCount":"0","textInputFormat":"Text","properties":{"activeTextColor":"#eeeeee","flagItems":"E-mail customer^1|","disabledBackgroundColor":"#eeeeee"}}},{"general":{"name":"flg_updatepublic","type":"Field","flags":{"transparent":"true","xpStyle":"false","hasShadow":"false","toolbarButtonStyle":"false","cache":"false","hasBorder":"false","hasCheckbox":"false"}},"appearance":{"index":"9","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Trebuchet MS"},"borderStyle":"None"},"objectPlacement":{"position":{"top":"57","left":"409","right":"538","bottom":"75"},"scaling":{"top":"0","left":"50","right":"50","bottom":"0"}},"controlInfo":{"mouseOverCursor":"Window Default","type":"Form Flags","flags":{"invisible":"false","readOnly":"false","mandatory":"false","mandatoryLabelBackground":"false","mandatoryLabelText":"false","allowNullValue":"false","skipTabStop":"false","disabled":"false","protected":"true","noMacroExpand":"false","readOnlyInit":"false","comboAutoUpdate":"false","comboNewValues":"false"},"textLineCount":"0","textInputFormat":"Text","properties":{"activeTextColor":"#eeeeee","flagItems":"Update to be public^1|","disabledBackgroundColor":"#eeeeee"}}},{"general":{"name":"flg_chargeable","type":"Field","flags":{"transparent":"true","xpStyle":"false","hasShadow":"false","toolbarButtonStyle":"false","cache":"false","hasBorder":"false","hasCheckbox":"false"}},"appearance":{"index":"10","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Trebuchet MS"},"borderStyle":"None"},"objectPlacement":{"position":{"top":"96","left":"409","right":"550","bottom":"114"},"scaling":{"top":"0","left":"50","right":"50","bottom":"0"}},"controlInfo":{"mouseOverCursor":"Window Default","type":"Form Flags","flags":{"invisible":"false","readOnly":"false","mandatory":"false","mandatoryLabelBackground":"false","mandatoryLabelText":"false","allowNullValue":"false","skipTabStop":"false","disabled":"true","protected":"true","noMacroExpand":"false","readOnlyInit":"false","comboAutoUpdate":"false","comboNewValues":"false"},"textLineCount":"0","textInputFormat":"Text","properties":{"activeTextColor":"#eeeeee","flagItems":"Call to be chargeable^1|","disabledBackgroundColor":"#eeeeee","defaultValue":"0"}}},{"general":{"name":"flg_addKBase","type":"Field","flags":{"transparent":"true","xpStyle":"false","hasShadow":"false","toolbarButtonStyle":"false","cache":"false","hasBorder":"false","hasCheckbox":"false"}},"appearance":{"index":"11","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Trebuchet MS"},"borderStyle":"None"},"objectPlacement":{"position":{"top":"116","left":"409","right":"551","bottom":"135"},"scaling":{"top":"0","left":"50","right":"50","bottom":"0"}},"controlInfo":{"mouseOverCursor":"Window Default","type":"Form Flags","flags":{"invisible":"false","readOnly":"false","mandatory":"false","mandatoryLabelBackground":"false","mandatoryLabelText":"false","allowNullValue":"false","skipTabStop":"false","disabled":"true","protected":"true","noMacroExpand":"false","readOnlyInit":"false","comboAutoUpdate":"false","comboNewValues":"false"},"textLineCount":"0","textInputFormat":"Text","properties":{"activeTextColor":"#eeeeee","flagItems":"Add to KnowledgeBase^1|","disabledBackgroundColor":"#eeeeee"}}},{"general":{"name":"flg_customersurvey","type":"Field","flags":{"transparent":"true","xpStyle":"false","hasShadow":"false","toolbarButtonStyle":"false","cache":"false","hasBorder":"false","hasCheckbox":"false"}},"appearance":{"index":"12","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Trebuchet MS"},"borderStyle":"None"},"objectPlacement":{"position":{"top":"158","left":"409","right":"567","bottom":"179"},"scaling":{"top":"0","left":"50","right":"50","bottom":"0"}},"controlInfo":{"mouseOverCursor":"Window Default","type":"Form Flags","flags":{"invisible":"false","readOnly":"false","mandatory":"false","mandatoryLabelBackground":"false","mandatoryLabelText":"false","allowNullValue":"false","skipTabStop":"false","disabled":"false","protected":"true","noMacroExpand":"false","readOnlyInit":"false","comboAutoUpdate":"false","comboNewValues":"false"},"textLineCount":"0","textInputFormat":"Text","properties":{"activeTextColor":"#eeeeee","flagItems":"Send customer survey:^1|","disabledBackgroundColor":"#eeeeee"}}},{"general":{"name":"cb_surveys","type":"Field"},"appearance":{"index":"13","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Arial"},"borderStyle":"Rectangle"},"objectPlacement":{"position":{"top":"181","left":"413","right":"543","bottom":"199"},"scaling":{"top":"0","left":"50","right":"100","bottom":"0"}},"controlInfo":{"mouseOverCursor":"Window Default","type":"Pick List","flags":{"invisible":"false","readOnly":"false","mandatory":"false","mandatoryLabelBackground":"false","mandatoryLabelText":"false","allowNullValue":"false","skipTabStop":"false","disabled":"false","protected":"true","noMacroExpand":"false","readOnlyInit":"false","comboAutoUpdate":"false","comboNewValues":"true","useDDPickList":"false"},"textLineCount":"0","textInputFormat":"Text","properties":{"activeTextColor":"#eeeeee","disabledBackgroundColor":"#eeeeee","listItems":"First Survey|Second Survey|Third Survey|","borderColor":"#c0c0c0"}}},{"general":{"name":"cb_callaction","type":"Field"},"appearance":{"index":"14","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Arial"},"borderStyle":"Rectangle"},"objectPlacement":{"position":{"top":"4","left":"226","right":"387","bottom":"22"},"scaling":{"top":"0","left":"25","right":"25","bottom":"0"}},"controlInfo":{"mouseOverCursor":"Window Default","type":"Pick List","flags":{"invisible":"false","readOnly":"false","mandatory":"true","mandatoryLabelBackground":"false","mandatoryLabelText":"false","allowNullValue":"false","skipTabStop":"false","disabled":"false","protected":"true","noMacroExpand":"false","readOnlyInit":"false","comboAutoUpdate":"false","comboNewValues":"true","useDDPickList":"false"},"textLineCount":"0","textInputFormat":"Text","properties":{"activeTextColor":"#eeeeee","disabledBackgroundColor":"#eeeeee","listItems":"Close Call|Resolve Call|Close Call|Resolve Call|","borderColor":"#c0c0c0"}}},{"general":{"name":"btnGetProfileText","type":"EventButton","flags":{"transparent":"false","xpStyle":"true","hasShadow":"false","toolbarButtonStyle":"false","cache":"false","hasBorder":"false","hasCheckbox":"false"}},"appearance":{"index":"15","caption":"Add Profile Text","backgroundColor":"#ffffff","foregroundColor":"#0000ff","font":{"@size":"8","#text":"Arial"}},"objectPlacement":{"position":{"top":"213","left":"458","right":"550","bottom":"234"},"scaling":{"top":"0","left":"100","right":"100","bottom":"0"}},"controlInfo":{"mouseOverCursor":"Window Default","flags":{"invisible":"false","skipTabStop":"false","disabled":"false","protected":"true","noMacroExpand":"false","multiLine":"false"}}},{"general":{"name":"Tab1","type":"TabControl","flags":{"transparent":"true","xpStyle":"false","hasShadow":"false","toolbarButtonStyle":"false","cache":"false","hasBorder":"false","hasCheckbox":"false"}},"appearance":{"index":"16","caption":"Tab1","backgroundColor":"#ded7ce","foregroundColor":"#ffffff","font":{"@size":"8","#text":"Arial"},"borderStyle":"None"},"objectPlacement":{"position":{"top":"241","left":"7","right":"553","bottom":"422"},"scaling":{"top":"0","left":"0","right":"100","bottom":"100"}},"tabStyle":"Top","tabSize":"19","items":{"item":[{"name":"Description","properties":"56=#d1e0ee|_flags=0","textBorder":"None","textBackgroundColor":"#ffffff","controlInfo":{"mouseOverCursor":"Window Default","properties":{"tabColor":"#d1e0ee"}}},{"name":"File Attachment","properties":"56=#ffcc66|_flags=0","textBorder":"None","textBackgroundColor":"#ffffff","controlInfo":{"mouseOverCursor":"Window Default","properties":{"tabColor":"#ffcc66"}}}]},"selectedTextFont":{"@size":"8","#text":"Arial"},"selectedTextColor":"#000000","deselectedTextColor":"#000000","tabSlopeLeft":"2","tabSlopeRight":"2","deselectedTabHeightOffset":"1","tabSpacing":"0","controlInfo":{"mouseOverCursor":"Window Default","flags":{"invisible":"false","skipTabStop":"false","disabled":"false","protected":"true","noMacroExpand":"false","multiLine":"false"},"properties":{"tabStyle":"0"}}},{"general":{"name":"fl_attachments","type":"FileListTable","flags":{"transparent":"false","xpStyle":"false","hasShadow":"false","toolbarButtonStyle":"false","cache":"false","hasBorder":"false","hasCheckbox":"false","showHeader":"true","verticalGridLines":"true","horizontalGridLines":"true","autoLoad":"true","allowMultiSelect":"true"},"group":"Tab1:1"},"appearance":{"index":"17","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Arial"},"borderStyle":"Rectangle"},"objectPlacement":{"position":{"top":"269","left":"15","right":"473","bottom":"413"},"scaling":{"top":"0","left":"0","right":"100","bottom":"100"}},"columns":{"controlInfo":[{"mouseOverCursor":"Window Default","type":"Text Edit","flags":{"invisible":"false","readOnly":"false","mandatory":"false","mandatoryLabelBackground":"false","mandatoryLabelText":"false","allowNullValue":"false","skipTabStop":"false","disabled":"false","protected":"false","noMacroExpand":"false","readOnlyInit":"false","autoCompleteField":"false","editUnlimitedText":"false","url":"false","hidden":"false","allowResize":"true","allowSort":"true"},"textLineCount":"0","textInputFormat":"Text","name":"File Name","width":"160","image":"-1","dataColumn":"0"},{"mouseOverCursor":"Window Default","type":"Text Edit","flags":{"invisible":"false","readOnly":"false","mandatory":"false","mandatoryLabelBackground":"false","mandatoryLabelText":"false","allowNullValue":"false","skipTabStop":"false","disabled":"false","protected":"false","noMacroExpand":"false","readOnlyInit":"false","autoCompleteField":"false","editUnlimitedText":"false","url":"false","hidden":"false","allowResize":"true","allowSort":"true"},"textLineCount":"0","textInputFormat":"Text","name":"Size","width":"80","image":"-1","dataColumn":"1"},{"mouseOverCursor":"Window Default","type":"Text Edit","flags":{"invisible":"false","readOnly":"false","mandatory":"false","mandatoryLabelBackground":"false","mandatoryLabelText":"false","allowNullValue":"false","skipTabStop":"false","disabled":"false","protected":"false","noMacroExpand":"false","readOnlyInit":"false","autoCompleteField":"false","editUnlimitedText":"false","url":"false","hidden":"false","allowResize":"true","allowSort":"true"},"textLineCount":"0","textInputFormat":"Text","name":"Last Modified","width":"120","image":"-1","dataColumn":"2"},{"mouseOverCursor":"Window Default","type":"Text Edit","flags":{"invisible":"false","readOnly":"false","mandatory":"false","mandatoryLabelBackground":"false","mandatoryLabelText":"false","allowNullValue":"false","skipTabStop":"false","disabled":"false","protected":"false","noMacroExpand":"false","readOnlyInit":"false","autoCompleteField":"false","editUnlimitedText":"false","url":"false","hidden":"false","allowResize":"true","allowSort":"true"},"textLineCount":"0","textInputFormat":"Text","name":"Full Local Path","width":"100","image":"-1","dataColumn":"3"}]},"sortColumn":"-1","sortDescending":"false","headerHeight":"16","rowHeight":"16","selectedColor":"#00008b","selectedTextColor":"#ffffff","controlInfo":{"mouseOverCursor":"Window Default","flags":{"invisible":"false","skipTabStop":"false","disabled":"false","protected":"true","noMacroExpand":"false","multiLine":"false"},"properties":{"content":"NAME=css-bug-raising.gif;PATH=C:\\Documents and Settings\\NeilWJ\\My Documents\\css\\css-bug-raising.gif;SIZE=18746;LASTMODIFIED=1091525370","borderColor":"#c0c0c0"}}},{"general":{"name":"btnAddFile","type":"EventButton","flags":{"transparent":"false","xpStyle":"true","hasShadow":"false","toolbarButtonStyle":"false","cache":"false","hasBorder":"false","hasCheckbox":"false"},"group":"Tab1:1"},"appearance":{"index":"18","caption":"Add","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Arial"}},"objectPlacement":{"position":{"top":"266","left":"481","right":"545","bottom":"290"},"scaling":{"top":"0","left":"100","right":"100","bottom":"0"}},"controlInfo":{"mouseOverCursor":"Window Default","flags":{"invisible":"false","skipTabStop":"false","disabled":"false","protected":"true","noMacroExpand":"false","multiLine":"false"},"properties":{"commands":"74","eventButtonIcon":"74"}}},{"general":{"name":"btnRemove","type":"EventButton","flags":{"transparent":"false","xpStyle":"true","hasShadow":"false","toolbarButtonStyle":"false","cache":"false","hasBorder":"false","hasCheckbox":"false"},"group":"Tab1:1"},"appearance":{"index":"19","caption":"Remove","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Arial"}},"objectPlacement":{"position":{"top":"296","left":"481","right":"545","bottom":"320"},"scaling":{"top":"0","left":"100","right":"100","bottom":"0"}},"controlInfo":{"mouseOverCursor":"Window Default","flags":{"invisible":"false","skipTabStop":"false","disabled":"false","protected":"true","noMacroExpand":"false","multiLine":"false"}}},{"general":{"name":"btnResolveClose","type":"EventButton","flags":{"transparent":"false","xpStyle":"true","hasShadow":"false","toolbarButtonStyle":"true","cache":"true","hasBorder":"false","hasCheckbox":"false"}},"appearance":{"index":"20","caption":"Resolve Calls","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Trebuchet MS"}},"objectPlacement":{"position":{"top":"1","left":"7","right":"103","bottom":"24"},"scaling":{"top":"0","left":"0","right":"0","bottom":"0"}},"controlInfo":{"mouseOverCursor":"Window Default","flags":{"invisible":"false","skipTabStop":"false","disabled":"false","protected":"true","noMacroExpand":"false","multiLine":"false"},"properties":{"eventButtonIcon":"ImageList=Helpdesk Tools;IconIndex=6","eventButtonIconAlign":"0","backgroundColor":"#ff9900"}}},{"general":{"type":"FieldName","flags":{"transparent":"true","xpStyle":"false","hasShadow":"false","toolbarButtonStyle":"false","cache":"false","hasBorder":"false","hasCheckbox":"false"}},"appearance":{"index":"21","caption":"Action Source","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Trebuchet MS"},"alignment":"Right","borderStyle":"None","fillStyle":"Solid"},"objectPlacement":{"position":{"top":"94","left":"9","right":"82","bottom":"106"},"scaling":{"top":"0","left":"0","right":"0","bottom":"0"}},"data":{"binding":"updatedb.udsource"},"controlInfo":{"mouseOverCursor":"Window Default"}},{"general":{"name":"LabelCode","type":"FieldName","flags":{"transparent":"true","xpStyle":"false","hasShadow":"false","toolbarButtonStyle":"false","cache":"false","hasBorder":"false","hasCheckbox":"false"}},"appearance":{"index":"22","caption":"Action Type","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Trebuchet MS"},"alignment":"Left","borderStyle":"None","fillStyle":"Solid"},"objectPlacement":{"position":{"top":"94","left":"225","right":"291","bottom":"106"},"scaling":{"top":"0","left":"25","right":"25","bottom":"0"}},"data":{"binding":"updatedb.udcode"},"controlInfo":{"mouseOverCursor":"Window Default"}},{"general":{"name":"Text1","type":"Text","flags":{"transparent":"true","xpStyle":"false","hasShadow":"false","toolbarButtonStyle":"false","cache":"false","hasBorder":"false","hasCheckbox":"false"}},"appearance":{"index":"23","caption":"Date\/Time of Action","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Trebuchet MS"},"alignment":"Left","borderStyle":"None","fillStyle":"Solid"},"objectPlacement":{"position":{"top":"57","left":"8","right":"120","bottom":"71"},"scaling":{"top":"0","left":"0","right":"0","bottom":"0"}},"controlInfo":{"mouseOverCursor":"Window Default"}},{"general":{"name":"Label2","type":"FieldName","flags":{"transparent":"true","xpStyle":"false","hasShadow":"false","toolbarButtonStyle":"false","cache":"false","hasBorder":"false","hasCheckbox":"false"}},"appearance":{"index":"24","caption":"Time Spent","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Trebuchet MS"},"alignment":"Left","borderStyle":"None","fillStyle":"Solid"},"objectPlacement":{"position":{"top":"57","left":"225","right":"289","bottom":"71"},"scaling":{"top":"0","left":"25","right":"25","bottom":"0"}},"data":{"binding":"updatedb.timespent"},"controlInfo":{"mouseOverCursor":"Window Default"}},{"general":{"name":"ResolProfile","type":"Text","flags":{"transparent":"true","xpStyle":"false","hasShadow":"false","toolbarButtonStyle":"false","cache":"false","hasBorder":"false","hasCheckbox":"false"}},"appearance":{"index":"25","caption":"Resolution Profile","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Trebuchet MS"},"alignment":"Left","borderStyle":"None","fillStyle":"Solid"},"objectPlacement":{"position":{"top":"140","left":"8","right":"208","bottom":"154"},"scaling":{"top":"0","left":"0","right":"0","bottom":"0"}},"controlInfo":{"mouseOverCursor":"Window Default"}},{"general":{"name":"btnAddFile","type":"EventButton","flags":{"transparent":"false","xpStyle":"true","hasShadow":"false","toolbarButtonStyle":"true","cache":"true","hasBorder":"false","hasCheckbox":"false"}},"appearance":{"index":"26","caption":"Attach File","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Arial"}},"objectPlacement":{"position":{"top":"1","left":"457","right":"538","bottom":"24"},"scaling":{"top":"0","left":"100","right":"100","bottom":"0"}},"controlInfo":{"mouseOverCursor":"Window Default","flags":{"invisible":"false","skipTabStop":"false","disabled":"false","protected":"true","noMacroExpand":"false","multiLine":"false"},"properties":{"commands":"74","eventButtonIcon":"74","backgroundColor":"#ff9900"}}},{"general":{"name":"Rect1","type":"Rectange","flags":{"transparent":"false","xpStyle":"false","hasShadow":"false","toolbarButtonStyle":"true","cache":"true","hasBorder":"false","hasCheckbox":"false"}},"appearance":{"index":"27","backgroundColor":"#d4d0c8","foregroundColor":"#dddddd","font":{"@size":"0"},"borderStyle":"Rectangle","fillStyle":"Solid"},"objectPlacement":{"position":{"top":"0","left":"-1","right":"565","bottom":"25"},"scaling":{"top":"0","left":"0","right":"100","bottom":"0"}},"controlInfo":{"mouseOverCursor":"Window Default"}},{"general":{"name":"LabelAction","type":"Text","flags":{"transparent":"true","xpStyle":"false","hasShadow":"false","toolbarButtonStyle":"false","cache":"false","hasBorder":"false","hasCheckbox":"false"}},"appearance":{"index":"28","caption":"Call Action:","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Trebuchet MS"},"alignment":"Left","borderStyle":"None","fillStyle":"Solid"},"objectPlacement":{"position":{"top":"2","left":"161","right":"223","bottom":"25"},"scaling":{"top":"0","left":"25","right":"25","bottom":"0"}},"controlInfo":{"mouseOverCursor":"Window Default","flags":{"invisible":"false","skipTabStop":"false","disabled":"false","protected":"true","noMacroExpand":"false","multiLine":"false"}}},{"general":{"name":"cp_summary","type":"CaptionBar","flags":{"transparent":"true","xpStyle":"false","hasShadow":"false","toolbarButtonStyle":"false","cache":"false","hasBorder":"true","hasCheckbox":"false"}},"appearance":{"index":"29","caption":"Other Information","backgroundColor":"#f1f1f1","foregroundColor":"#003366","font":{"@size":"10","@bold":"1","#text":"Trebuchet (MS)"},"alignment":"Left","fillStyle":"Vertical Gradient"},"objectPlacement":{"position":{"top":"212","left":"3","right":"557","bottom":"428"},"scaling":{"top":"0","left":"0","right":"100","bottom":"100"}},"controlInfo":{"mouseOverCursor":"Window Default","properties":{"backgroundColor2":"#d8d8d8","imageHSpace":"10","slope":"12","borderColor":"#d3c9b6","headerHeight":"23","hasBorder":"1","panelBorderColor":"#d3c9b6","fillStyle":"0","panelBackgroundColor":"#f2eedd","panelBackgroundColor2":"#000000"}}},{"general":{"name":"CaptionPanel3","type":"CaptionBar","flags":{"transparent":"true","xpStyle":"false","hasShadow":"false","toolbarButtonStyle":"false","cache":"false","hasBorder":"true","hasCheckbox":"false"}},"appearance":{"index":"30","caption":"Options","backgroundColor":"#f1f1f1","foregroundColor":"#003366","font":{"@size":"10","@bold":"1","#text":"Trebuchet (MS)"},"alignment":"Left","fillStyle":"Vertical Gradient"},"objectPlacement":{"position":{"top":"29","left":"403","right":"557","bottom":"205"},"scaling":{"top":"0","left":"50","right":"100","bottom":"0"}},"controlInfo":{"mouseOverCursor":"Window Default","properties":{"backgroundColor2":"#d8d8d8","imageHSpace":"10","slope":"12","borderColor":"#d3c9b6","headerHeight":"23","hasBorder":"1","panelBorderColor":"#d3c9b6","fillStyle":"0","panelBackgroundColor":"#f2eedd","panelBackgroundColor2":"#000000"}}},{"general":{"name":"flg_resolvelinked_calls1","type":"Field","flags":{"transparent":"true","xpStyle":"false","hasShadow":"false","toolbarButtonStyle":"false","cache":"false","hasBorder":"false","hasCheckbox":"false"}},"appearance":{"index":"31","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Arial"},"borderStyle":"None"},"objectPlacement":{"position":{"top":"183","left":"6","right":"392","bottom":"200"},"scaling":{"top":"0","left":"0","right":"0","bottom":"0"}},"controlInfo":{"mouseOverCursor":"Window Default","type":"Form Flags","textLineCount":"0","textInputFormat":"Text","properties":{"content":"#eeeeee","flagItems":"Apply this action to related requests (incident \/ known errors etc)^1|","defaultValue":"1","disabledBackgroundColor":"#eeeeee"}}},{"general":{"name":"flg_ftf","type":"Field","flags":{"transparent":"true","xpStyle":"false","hasShadow":"false","toolbarButtonStyle":"false","cache":"false","hasBorder":"false","hasCheckbox":"false"}},"appearance":{"index":"32","backgroundColor":"#ffffff","foregroundColor":"#000000","font":{"@size":"8","#text":"Trebuchet MS"},"borderStyle":"None"},"objectPlacement":{"position":{"top":"137","left":"409","right":"551","bottom":"156"},"scaling":{"top":"0","left":"50","right":"50","bottom":"0"}},"data":{"binding":"opencall.flg_firsttimefix"},"controlInfo":{"mouseOverCursor":"Window Default","type":"Form Flags","flags":{"invisible":"false","readOnly":"false","mandatory":"false","mandatoryLabelBackground":"false","mandatoryLabelText":"false","allowNullValue":"false","skipTabStop":"false","disabled":"false","protected":"true","noMacroExpand":"false","readOnlyInit":"false","comboAutoUpdate":"false","comboNewValues":"false"},"textLineCount":"0","textInputFormat":"Text","properties":{"activeTextColor":"#eeeeee","flagItems":"First time fix achieved^1|","disabledBackgroundColor":"#eeeeee"}}}]},"javascript":{"methods":{"method":[{"name":"OnFormLoaded","code":"OnFormLoaded()\n{\n\t\/\/-- NWJ - setup mainform properties and elements\n\t_ete(tb_fixcodedescription, \"\");\n\t\t\n\t_swdoc.setup_form_mode();\n\t\n\t_swdoc.setup_call_action();\n\t\t\n\t_swdoc.setup_email_flag()\n\n\t_swdoc.setup_public_flag();\n\n\t_swdoc.setup_survey_options();\n\n\t\/\/-- reset call actions list\n\t\/\/-- then populate with options based on analyst permissions\n\n\t\/\/-- set updatetime\t\n\t_swdoc.updatedb.updatetimex = app.global.GetCurrentEpocTime();\n\t\t\n\t\/\/-- if we have update text (from an email i guess) apply it\n\tif(_swdoc.strUpdateText.length) _swdoc.updatedb.updatetxt = _swdoc.strUpdateText;\n\t\n\t\/\/-- if came from E-mail set source as email\n\tif(_swdoc.boolSourceEmail)\n\t{\n\t\t_swdoc.updatedb.udsource = 'E-mail'; \n\t}\n\t\n\t\n\t_swdoc.UpdateFormFromData();\n\t_swdoc.setup_resolution_profile();\n\t\t\n\n\t\n}"},{"name":"btnBrowseProfile_OnPressed","code":"btnBrowseProfile_OnPressed()\n{\n\t\/\/-- get resolution profile filter\n\t\n\t\/\/-- NWJ - 29.06.2006 - get close filter or resolve filter depending on call closure option (requested by Dan 47766)\n\tif (cb_callaction.text == \"Resolve Call\")\n\t{\n\t\tvar Filter = dd.GetGlobalParamAsString(\"Close Call Form\/ResolveProfileFilter\");\n\t}\n\telse if (cb_callaction.text == \"Close Call\")\n\t{\n\t\tvar Filter = dd.GetGlobalParamAsString(\"Close Call Form\/CloseProfileFilter\");\n\t}\n\telse\n\t{\n\t\tvar Filter = dd.GetGlobalParamAsString(\"Close Call Form\/ProfileCodeFilter\");\n\t}\n\t\n\tvar pc = new ChooseProfileCodeDialog;\n\t\/\/-- default analyst permission to auto fill the resolution text on resolve\/close call is set\n\n    pc.useDescriptionText =  app.session.IsDefaultOption(ANALYST_DEFAULT_AUTOFILLRESOLUTIONTEXT); \n    \n    if(pc.Open(true, true, _swdoc.opencall.fixcode, Filter) == IDOK)\n    {\n        \/\/-- Get the fix code and split it into an array\n        var strCodeDesc = pc.codeDescription;\n        var strCode = pc.code;\n        \n        \/\/-- If no codes are found then stop or same as current code\n        if((strCode==\"\")||(strCode==_swdoc.opencall.fixcode)) return;\n        \n        \/\/-- Set the text in the resolution profile text box\n        \/\/-- 08.02.2007 - NWJ - set the opencall record value instead of the element name \n\t\t_swdoc.opencall.fixcode = strCode;       \n        _ete(tb_fixcodedescription , strCodeDesc);\n        \n        \/\/-- Attempt to add the resolution profile description to the Action Description box if the\n        \/\/-- default analyst permission to auto fill the resolution text on resolve\/close call is set\n        if(pc.useDescriptionText)\n        {\n        \t\/\/-- 08.02.2007 - NWJ - set the opencall record value instead of the element name \n        \tvar strCurrentUpdateText = _swdoc.updatedb.updatetxt;\n           \t\n        \tif(pc.description.length)\n        \t{\n        \t\t\/\/if(tb_updatetext.text.length)\n        \t\tif(strCurrentUpdateText.length)\n\t\t\t\t{\n\t\t\t\t\tvar Message = \"You have chosen to transfer the default profile text into the description field of the close call form. However, you have already entered some text into this field. Do you want to append the text you have typed?\\n\\nTo append the default text to the text you have already typed, click Yes\\nTo transfer the default text and overwrite what you have already typed, click No\\nTo ignore the default text and leave the text you have typed alone, click Cancel\";\n\t\t\t\t\tswitch(MessageBox(Message, MB_ICONQUESTION | MB_YESNOCANCEL))\n\t\t\t\t\t{\n\t\t\t\t\tcase IDYES:\n\t\t\t\t\t\tif(_swdoc.updatedb.updatetxt.length)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t \/\/-- add a line feed\n\t\t\t\t\t\t\t strCurrentUpdateText += \"\\r\\n\";\n\t\t\t\t\t\t\t \/\/tempText = _swdoc.updatedb.updatetxt + \"\\r\\n\"; \n\t\t\t\t\t\t}\n\t\t\t\t\t\tstrCurrentUpdateText += pc.description;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase IDNO:\n\t\t\t\t\t\tstrCurrentUpdateText = pc.description;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase IDCANCEL:\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tstrCurrentUpdateText = pc.description;\n\t\t\t\t}\n        \t}\n        \t\n        \t\/\/-- add back to update record\n        \t_swdoc.updatedb.updatetxt = strCurrentUpdateText;\n        \t_swdoc.UpdateFormFromData();\n        \t\n        }\n\n\t\t\/\/-- if we are working with webclient\n\t\tif(app.bWebClient)\n\t\t{\n\t\t\t_een(btnGetProfileText , false);\n\t\t}\n\t\telse\n\t\t{\n\t    \t\/\/-- enable \/ disable button if it has text\n        \t_een(btnGetProfileText ,(pc.description!=\"\"));\n\n\t\t\/\/\tbtnGetProfileText.enable = (_swdoc.updatedb.updatetxt? true:false);\n\t\t}\n    }\n}"},{"name":"btnAddFile_OnPressed","code":"btnAddFile_OnPressed()\n{\n\t\/\/-- add files\n\t\/\/fl_attachments.newFile = InvokeCallAttachmentFileDialog();\n\tfl_attachments.AddFiles();\n\n}"},{"name":"btnRemove_OnPressed","code":"btnRemove_OnPressed()\n{\n\t\/\/ -- remove selected files\n\tfor(i=fl_attachments.rowCount()-1; i>=0;i--)\n    {\n    \tif(fl_attachments.IsRowSelected(i))\n    \t{\n    \t\t\/\/-- remove\n    \t\tfl_attachments.RemoveRow(i);\n    \t}\n    }\n\n}"},{"name":"btnGetProfileText_OnPressed","code":"btnGetProfileText_OnPressed()\n{\n\tif(_swdoc.updatedb.updatetxt.length)\n\t{\n\t\tif(MessageBox(\"If you retrieve the default text description from the profile database you will overwrite the current Action Description text.\\n\\nDo you wish to continue?\", MB_ICONQUESTION | MB_YESNO) != IDYES)\n\t\treturn;\n\t}\n\t\n\t\/\/-- get resolution profile description\t\n\tvar currentResProfileDesc = app.global.GetResolutionProfileDescription(_swdoc.opencall.fixcode);\n\t_swdoc.updatedb.updatetxt = currentResProfileDesc.strDescription;\n\t_swdoc.UpdateFormFromData();\n}"},{"name":"checkCustomerSurvey_OnValueChanged","code":"checkCustomerSurvey_OnValueChanged(strValue)\n{\n\tvar bChecked = checkCustomerSurvey.text == \"1\";\n\t_een(Surveys , bChecked);\n}"},{"name":"(User Defined Functions)","code":"\n\/\/-- function to check that user has selected correct number of profile codes\nfunction check_profile_levels()\n{\n\t\/\/-- get the number of profile levels the analyst HAS to choose\n\tvar nLevelNeeded = app.session.GetCloseProfileLevelRequired();\n\n\t\/\/-- determine the number of Profile levels the user has selected\n\t\/\/-- NWJ - can we turn this into a app.global.i.e. app.global.returnProfileLevelCount(strProfileCode);\n\tvar strTempProfileCodes = new String(_swdoc.opencall.fixcode);\n\tvar nLevels = 0;\n\twhile(strTempProfileCodes.indexOf('-') != -1)\n\t{\n\t\tnLevels++;\n\t\tstrTempProfileCodes = strTempProfileCodes.substr((strTempProfileCodes.indexOf('-')+1),strTempProfileCodes.length);\n\t}\n\t\n\tif(strTempProfileCodes.length)nLevels++;\n\t\n\t\/\/-- If insufficient profile levels are specified then alert the user\n\tif(nLevels < nLevelNeeded)\n\t{\n\t\tMessageBox(\"You must profile this call resolution. Your access control rights require you to choose at least \" + nLevelNeeded + \" profile level(s)\", MB_ICONSTOP);\n\t\treturn false;\n\t}\n\t\n\treturn true;\n}\n\n\/\/-- prompt user to confirm resolution or closure\nfunction confirm_resolve_close()\n{\n\t\/\/-- resolving\t\t\n\tif(!_swdoc.boolClosing)\n\t{\n\t\tif(MessageBox(_swdoc.arrCallrefs.length >1 ? \"Are you sure you want to resolve these calls?\" : \"Are you sure you want to resolve this call?\" , MB_YESNO| MB_ICONINFORMATION ) != IDYES)\n\t\treturn false;\n\t}\n\telse\n\t{\n\t\t\/\/-- closing\n\t\tvar MsgTmp = \"\";\n\t\tif(_swdoc.strIssueref.length)\n\t\t{\n\t\t\tif(_swdoc.arrCallrefs.length > 1)\n\t\t\t\tMsgTmp = \"Are you sure you want to close these calls, and the issue they belong to?\";\n\t\t\telse\n\t\t\t\tMsgTmp = \"Are you sure you want to close this call, and the issue it belongs to?\";\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif(_swdoc.arrCallrefs.length > 1)\n\t\t\t\tMsgTmp = \"Are you sure you want to close these calls?\";\n\t\t\telse\n\t\t\t\tMsgTmp = \"Are you sure you want to close this call?\";\n\t\t}\n\n\t\tif(MessageBox(MsgTmp, MB_YESNO | MB_ICONINFORMATION ) != IDYES)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\t}\n\treturn true;\n}\n\n\/\/-- add call to kbase\nfunction add_call_to_knowledgebase()\n{\n\tvar strProbText = \"\";\n\tvar strProbCode = \"\";\n\tvar nFirstCallref = _swdoc.arrCallrefs[0];\n\t\/\/-- get the problem text and problem code from updatedb\/opencall\n\t\n\tvar aRSInfo = new SqlQuery;\n\tvar strParams = \"crf=\"+pfu(nFirstCallref);\n\tvar aRSInfo = app.g.get_sqrecordset(\"form\/resolvecloseform\/get_details_for_kb\",strParams);\n\tif(aRSInfo.Fetch())\n\t{\n\t\tstrProbText = aRSInfo.GetValueAsString(0);\n\t\tstrProbCode = aRSInfo.GetValueAsString(1);\t\t\n\t}\n\taRSInfo.Reset();\t\n\t\n\t\/\/-- call api\n\t\/\/MessageBox(\"Add KB \" + _swdoc.updatedb.updatetxt)\n   \tapp.global.AddResolutionToKnowledgeBase(strProbText, strProbCode, _swdoc.updatedb.updatetxt, _swdoc.opencall.fixcode, nFirstCallref);\n}\n\n\/\/--\n\/\/-- resolve or close the call\nfunction ResolveClose()\n{\t\n\t\/\/-- validate the form\n\tif(!_swdoc.ValidateForm())return false;\n\t\n\t\/\/-- check profile levels\n\tif(!mainform.check_profile_levels())\treturn false;\n\t\n\t\/\/-- confirm\n\tif(!mainform.confirm_resolve_close()) return false;\n\t\t\n\t\/\/-- determine status\n\tvar nStatus = CS_CLOSED;\n\tif(!_swdoc.boolClosing)\n\t{\n\t\tnStatus = CS_RESOLVED;\n\t}\n\telse\n\t{\n\t\tif(flg_chargeable.text == \"1\")\tnStatus = CS_CLOSEDCHARGABLE;\n\t}\n\t\n\t\/\/sandra 21\/08\/2007 Bug 60018 \n\t\/\/-- make sure user is allowed to resolve \n\tif ((nStatus == CS_RESOLVED) && (!app.session.HaveRight(ANALYST_RIGHT_A_GROUP,ANALYST_RIGHT_A_CANRESOLVECALLS)))\n\t{\n\t\tMessageBox(\"You do not have sufficient privileges to resolve calls.  Please contact your system administrator\",MB_ICONSTOP);\t\n\t\treturn false;\n\t}\n\t\n\t\/\/-- make sure user is allowed to close calls\n\tif (((nStatus == CS_CLOSED) ||( nStatus == CS_CLOSEDCHARGABLE)) && (!app.session.HaveRight(ANALYST_RIGHT_A_GROUP,ANALYST_RIGHT_A_CANCLOSECALLS)))\n\t{\n\t\tMessageBox(\"You do not have sufficient privileges to close calls.  Please contact your system administrator\",MB_ICONSTOP);\t\n\t\treturn false;\n\t}\t\n\t\/\/-- end sandra\t\n\t\t\n\t\/\/-- handle web client - any reason for this ??\n\tif((app.bWebClient && app.global==undefined)&&(_swdoc.boolClosing))\n\t{\n\t \tnStatus = CS_CLOSED;\n\t \tflg_chargeable.text == \"0\"\n\t}\n\t\t\n\n\t\/\/-- create a new HD connection and connection\n\tvar hdcon = new HelpdeskSession;\n\tif(!hdcon.Connect())return false;\n\n\t\/\/-- check if we are sending a survey\n\tvar bSendSurveyToCustomer = false;\n\tvar SurveyID = 0;\n\tvar SurveyName = \"\";\n\tif(app.global.IsSurveyModuleEnabled() && flg_customersurvey.text == \"1\" && cb_surveys.text.length)\n\t{\n\t\t\/\/-- get surveyid from the SurveyNameSurvIdMap\n\t\tSurveyName = cb_surveys.text;\t\t\n\t\tSurveyID = _swdoc.arrSurveyNameSurvIDs[SurveyName]; \n\t\tif(SurveyID!=undefined)bSendSurveyToCustomer = true;\n\t\n\t\t\/\/-- send survey request to the server\t\t\t\n\t\tif (bSendSurveyToCustomer)\n\t\t{\n\t\t\thdcon.SendCustomerSurvey(SurveyID, _swdoc.CallrefsCommaString);\n\t\t}\n\t}\n\t\n\t\/\/-- If we're in an issue we wan't to dissassociate the calls with the issue before we close the call.\n\tif(_swdoc.strIssueref.length)\n\t{\n\t\t\/\/-- send HD call to remove calls from an issue\n\t\tif(!hdcon.RemoveCallFromIssueStr(_swdoc.strIssueref, _swdoc.CallrefsCommaString))\n\t\tMessageBox(\"There were problems removing the call(s) from the issue they're associated with.\\n\\nError: \" + hdcon.GetLastErrorStr());\n\t}\n\n\t\n\n\t\/\/-- NWJ - 08.02.2007 - We might want to update call values before closing i.e. for customisation\n\t\/\/-- update opencall fields - we need to do this by looping through form elements\t\n\t\/\/-- problem is BeginCallValueUpdates doesnt accept multiple callrefs so have to do a call update per callref\n\tvar arrUpdateCallValues = new Array();\n\tvar boolCallUpdates = false;\n\tvar rec = _swdoc.GetRecord(\"opencall\");\t\t\t\n\tif(rec)\n\t{\n\t\tvar nColCount = rec.GetCount();\n\t\tfor(x=0; x<nColCount; x++)\n\t\t{\n\t\t\tif(!rec.IsModified(x))continue;\n\t\t\tboolCallUpdates = true;\n\t\t\tarrUpdateCallValues[rec.GetColumnName(x)] = rec.GetValue(x);\n\t\t}\n\n\t\t\n\t\t\/\/-- if we have opencall values to update\n\t\tif(boolCallUpdates)\n\t\t{\n\t\t\tfor(var refcount = 0; refcount < _swdoc.arrCallrefs.length;refcount++)\n\t\t\t{\n\t\t\t\t\/\/-- start to update this call\n\t\t\t\tif(hdcon.BeginCallValueUpdates(_swdoc.arrCallrefs[refcount],\"Before ResolveClose Call\"))\n\t\t\t\t{\n\t\t\t\t\t\/\/-- for each opencall field that needs updating send\n\t\t\t\t\tfor (fieldName in arrUpdateCallValues)\n\t\t\t\t\t{\n\t\t\t\t\t\thdcon.SendValue(\"opencall.\" + fieldName, arrUpdateCallValues[fieldName]);\n\t\t\t\t\t}\n        \t\t\thdcon.Commit();\t\t\t\t\t\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\t\n\t\/\/-- We start a new transaction to update the specified call (complex req)\n\tif(hdcon.BeginCloseCall(_swdoc.CallrefsCommaString))\n\t{   \n    \tvar bSendSuccess = true;\n    \t\n       \t\/\/-- send update db values\n\t\tvar rec = _swdoc.GetRecord(\"updatedb\");\t\t\t\n\t\tif(rec)\n\t\t{\n\t\t\tvar nColCount = rec.GetCount();\n\t\t\tfor(x=0; x<nColCount; x++)\n\t\t\t{\n\t\t\t\tif(!rec.IsModified(x))continue;\n\t\t\t\t\n\t\t\t\tif(!hdcon.SendValue(\"updatedb.\" + rec.GetColumnName(x), rec.GetValue(x)))\n\t\t\t\t{\n\t\t\t\t\tbSendSuccess = false;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\n\t\t\/\/-- if send of info worked  \t\t\t\n    \tif(bSendSuccess && hdcon.SendNumber(\"status\", nStatus) && \n\t\t\thdcon.SendText(\"fixcode\", _swdoc.opencall.fixcode) &&    \t\n\t \t\thdcon.SendNumber(\"backdateperiod\", _swdoc.nBackdatePeriod) &&\n\t   \t\thdcon.SendBoolean(\"publicupdate\", flg_updatepublic.text) &&\n\t   \t\thdcon.SendBoolean(\"delaycacheflush\", flg_emailcustomer.text) &&\n\t   \t\thdcon.SendNumber(\"timespent\", mainform.tb_timespent.value))\n\t\t{\n\t\t\n\t\t\t\/\/-- send attachments\n\t\t\tfor(i=0; i<fl_attachments.rowCount();i++)\n\t\t    {\n    \t\t\tif(!hdcon.SendFile(\"attach\", fl_attachments.GetItemText(i,0), fl_attachments.GetItemText(i,3)))\n    \t\t\t\treturn false;\n    \t\t}\n    \t\t\t\n    \t\t\/\/-- commit our data send\n    \t\tif(hdcon.Commit())\n    \t\t{\n    \t\t\t\/\/-- failed HD\n    \t\t\tif(!hdcon.GetResult()) return false;\n    \t\t\t\n   \t\t\t\n    \t\t\t\t\t\n    \t\t\t\/\/-- The returned data is in the format \"updateref=<callref>.<udindex>\"\n    \t\t\t\/\/-- The following regex will put the callref into arrCallInfo[1] and the udindex\n    \t\t\t\/\/-- into arrCallInfo[2]\n    \t\t\tvar arrCallInfo = hdcon.GetCallUpdateResultData();\t\n    \t\t\t\n    \t\t\t\/\/ If we have been invoked to update a call from an e-mail message, this update will \n\t\t\t\t\t\/\/ only relate to a single call. We can only handle e-mail audit trail if we are working\n\t\t\t\t\t\/\/ on a single-call update.\n\t\t\t\t\tif(_swdoc.arrCallrefs.length == 1 && \t\t\t\/\/ Are we only dealing with a single call refernce?\n\t\t\t\t\t\t_swdoc._form[\"messagesource\"] && \t\/\/ Are we woring from an e-mail message?\n\t\t\t\t\t\tdd.GetGlobalParamAsNumber(\"Email Audit Trail\/StoreEmailAuditTrail\")) \/\/ Are we configured?\n\t\t\t\t\t{\n\t\t\t\t\t\t\/\/ The message source string contains the \"mailbox name\\message id\". We need \n\t\t\t\t\t\t\/\/ to split these out for the following function\n\t\t\t\t\t\tvar arrMsgInfo = _swdoc._form[\"messagesource\"].split('\\\\');\n\t\t\t\t\t\t\n\t\t\t\t\t\t\/\/ Check config to see if we need to include the file attachments in the message too\n\t\t\t\t\t\tvar bIncludeAttachments = dd.GetGlobalParamAsNumber(\"Email Audit Trail\/IncludeAttachmentsInMessage\");\n\t\t\t\t\t\t\n\t\t\t\t\t\t\/\/ We need to specify the folder to which the message should be moved to based\n\t\t\t\t\t\t\/\/ on the options set in the DD. \n\t\t\t\t\t\tvar strMoveMessageToFolder = \"\";\n\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\/\/ Next, see if we have specified a specific folder to move the message to\n\t\t\t\t\t\tstrMoveMessageToFolder = dd.GetGlobalParamAsString(\"Mail Move Folders\/CloseCallMailFolder\");\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (strMoveMessageToFolder.length == 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\/\/ First we see if the config tells us to move the message to the deleted items folder\n\t\t\t\t\t\t\tif(dd.GetGlobalParamAsNumber(\"Email Audit Trail\/MoveToDeletedItems\"))\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tstrMoveMessageToFolder = \"Deleted Items\";\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\t\n\t\t\t\t\t\t\/\/ As we are going to use the Email Subject in the name of the audit trail file we are saving\n\t\t\t\t\t\t\/\/ we need to check it for characters that are invalid in a filename and replace them with \"-\"\n\t\t\t\t\t\t\tvar strEmailSubject = \"\";\n\t\t\t\t\t\t\tif(_swdoc._form[\"subject\"])\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tstrEmailSubject = replaceIllegalFileCharacters(_swdoc._form[\"subject\"]);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\t\/\/ The following function does a number of things. It tells the server to encode\n\t\t\t\t\t\t\/\/ and attach the specified message to the call. It sets the state icon of the \n\t\t\t\t\t\t\/\/ call update to \"mail-received\" in this instace. If the strMoveMessageToFolder\n\t\t\t\t\t\t\/\/ contains a valid folder, it will move the specified mail message to the folder\n\t\t\t\t\t\tif(!app.global.AttachMessageToCall(arrMsgInfo[0], \t\t\t\t\t\t\t\t\/\/ Mailbox name\n\t\t\t\t\t\t\t\t\t\t\t\tarrMsgInfo[1], \t\t\t\t\t\t\t\t\/\/ Message ID\n\t\t\t\t\t\t\t\t\t\t\t\t\"Received-\" + strEmailSubject + \".swm\", \t\/\/ File name\n\t\t\t\t\t\t\t\t\t\t\t\t_swdoc.arrCallrefs[0], \t\t\t\t\t\t\t\/\/ Call reference\n\t\t\t\t\t\t\t\t\t\t\t\tarrCallInfo[_swdoc.arrCallrefs[0]],\t\t\t\t\/\/ UdIndex\n\t\t\t\t\t\t\t\t\t\t\t\t\"mail-received\",\t\t\t\t\t\t\t\/\/ Indicate that this is a received message\n\t\t\t\t\t\t\t\t\t\t\t\tbIncludeAttachments,\t\t\t\t\t\t\/\/ Include File attachments?\n\t\t\t\t\t\t\t\t\t\t\t\tstrMoveMessageToFolder))\t\t\t\t\t\/\/ Move the message to this folder\n\t\t\t\t\t\t{\n\t\t\t\t    \t\tMessageBox(\"There was an error attaching the originating e-mail to this call.\");\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tapp.global.CloseMailMessageWindow(arrMsgInfo[1]);\n\t\t\t\t\t\t}\n\t\t\t\t    }\n\n    \t\t\t\n       \t\t\t\/\/-- add knowledge base\tbut only if we have one call\n    \t\t\tif((flg_addKBase.text == \"1\") && (_swdoc.arrCallrefs.length == 1))\n    \t\t\t{\n    \t\t\t\tadd_call_to_knowledgebase();\n    \t\t\t}\n    \t\t\t    \t\t\t\n    \t\t\t\/\/-- we are updating an issue\t\t\n    \t\t\tif(_swdoc.strIssueref.length)\n\t\t\t\t{\n\t\t\t\t\t\tif(!_swdoc.boolClosing){\n\t\t\t\t\t\t\thdcon.BeginResolveIssue(_swdoc.strIssueref);\n\t\t\t\t\t\t\tif(!hdcon.Commit())\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tMessageBox(\"There were problems resolving the issue.\\n\\nError: \" + hdcon.GetLastErrorStr());\n\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}else{\t\t\t\t\n \n\t\t\t\t\t\t\tif(hdcon.BeginUpdateIssue(_swdoc.strIssueref))\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tvar dIn\t= new Date();\n\t\t\t\t\t\t\t\thdcon.SendNumber(\"status\",ISSUE_STATUS_CLOSED);\n\t\t\t\t\t\t\t\thdcon.SendText(\"closeby\", app.session.analystId);\n\t\t\t\t\t\t\t\thdcon.SendDate(\"closetimex\",dIn.getTime());\n\t\t\t\t\t\t\t\tif(!hdcon.Commit())\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tMessageBox(\"There were problems closing the issue.\\n\\nError: \" + hdcon.GetLastErrorStr());\n\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t\/\/-- NWJ - ITSM - resolve related calls\n\t\t\t\tif(flg_resolvelinked_calls.text==\"1\")\n\t\t\t\t{\n\t\t\t\t\t\/\/-- get related children calls for all calls we are resolving\n\t\t\t\t\tvar strRelatedChildCalls = \"\";\n\t\t\t\t\tfor(var refcount = 0; refcount < _swdoc.arrCallrefs.length;refcount++)\n\t\t\t\t\t{\n\t\t\t\t\t\tif(strRelatedChildCalls!=\"\")strRelatedChildCalls+=\",\";\n\t\t\t\t\t\tvar strAddCalls = app.g.get_slave_calls(_swdoc.arrCallrefs[refcount],\"\");\n\t\t\t\t\t\tif(strAddCalls!=\"0\")\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tstrRelatedChildCalls+=strAddCalls;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\n\t\t\t\t\tif(strRelatedChildCalls!=\"\")\n\t\t\t\t\t{\n\t\t\t\t\t\t\/\/--- update relaTED CALLS\t\t\t\t\t\n\t\t\t\t\t\tif(hdcon.BeginCloseCall(strRelatedChildCalls))\n\t\t\t\t\t\t{   \n    \t\t\t\t\t\tvar bSendSuccess = true;\n    \t\t\t\t\t\t\n    \t\t\t\t\t\t_swdoc.updatedb.updatetxt += \" \\n\" + \"This request was resolved (or closed) as part of the following parent requests (\" + _swdoc.strCallrefFormatted + \")\";\n       \t\t\t\t\t\t\/\/-- send update db values\n\t\t\t\t\t\t\tvar rec = _swdoc.GetRecord(\"updatedb\");\t\t\t\n\t\t\t\t\t\t\tif(rec)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tvar nColCount = rec.GetCount();\n\t\t\t\t\t\t\t\tfor(x=0; x<nColCount; x++)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tif(!rec.IsModified(x))continue;\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\tif(!hdcon.SendValue(\"updatedb.\" + rec.GetColumnName(x), rec.GetValue(x)))\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tbSendSuccess = false;\n\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\t\t\/\/-- if send of info worked  \t\t\t\n    \t\t\t\t\t\tif(bSendSuccess && hdcon.SendNumber(\"status\", nStatus) && \n\t\t\t\t\t\t\t\thdcon.SendText(\"fixcode\", _swdoc.opencall.fixcode) &&    \t\n\t \t\t\t\t\t\t\thdcon.SendNumber(\"backdateperiod\", _swdoc.nBackdatePeriod) &&\n\t   \t\t\t\t\t\t\thdcon.SendBoolean(\"publicupdate\", flg_updatepublic.text) &&\n\t   \t\t\t\t\t\t\thdcon.SendBoolean(\"delaycacheflush\", \"0\") &&\n\t   \t\t\t\t\t\t\thdcon.SendNumber(\"timespent\", mainform.tb_timespent.value))\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tif(hdcon.Commit())\n\t\t\t\t\t     \t\t{\n    \t\t\t\t\t\t\t\t\/\/-- failed HD\n    \t\t\t\t\t\t\t\tif(!hdcon.GetResult()) return false;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\/\/-- BIG IF\t\t\t\t\t\n\t\t\t\t\t\t}\/\/-- if(hdcon.BeginCloseCall(strRelatedChildCalls))\n\t\t\t\t\t}\/\/-- if(strRelatedChildCalls!=\"\")\t\t\t\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t\t\t\t\n\t\t\t\t\t\/\/-- if we want to send an email to the customer AND there are file attachments, obtain the \n    \t\t\t\t\/\/-- attachments to attach to the email as well\t\n\t\t\t\t\tif(mainform.flg_emailcustomer.value && app.global.IsConnectedToMailServer())\n   \t\t\t\t\t{\n    \t\t\t\t\t\/\/-- OK, we are going to send the customer(s) an e-mail message to confirm the \n\t\t\t\t\t\t\/\/-- call closure. If we have uploaded file attachments, we can ask the session\n\t\t\t\t\t\t\/\/-- for a list of the files. If available, the session variables will include\n\t\t\t\t\t\t\/\/-- a _serverpath variable for each file. The returned list, is a list of \n\t\t\t\t\t\t\/\/-- strings that is suitable for passing to the compose message function\t\n\t\t\t\t\t\tapp.global.ComposeCallUpdateEmail(arrCallInfo,\t\t\t\/\/Array: Call Reference-UdIndex\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttb_updatetext.text, \t\t\/\/Message Text\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\thdcon.GetSessionFileInfo(), \/\/File Attachments\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttb_timespent.text,\t\t\t\/\/Time spent on Last Action\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"CloseCallMailTemplate\", \t\/\/Template Name\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tTEMPLATE_CLOSECALL );\t\t\/\/Template Type\n\t\t\t\t\t}\n\t\t\t\t    \n    \t\t\thdcon.Close();\t\n    \t\t\t_swdoc.boolFormFieldChanged = false;\t\t\n\t\t\t\t_swdoc.resetData();    \t\t\t\n    \t\t\t_swdoc.CloseForm();\n    \t\t\treturn true;\t\n    \t\t}\n\t\t    else\n\t\t    {\n\t\t    \tMessageBox(hdcon.GetLastErrorStr());\n\t\t    }\/\/-- if(hdcon.Commit())\n\t\t}\n\t\telse\n\t\t{\n\t\t    \tMessageBox(hdcon.GetLastErrorStr());\n\t\t}\/\/-- if send of info worked  \t\t\t\n\t}\n\t\n\t\/\/-- if we got here we failed\n\thdcon.Close();\n\treturn false;\n}\n\nfunction getReadableDatefromEpoch(dt_epochdate)\n{\n\tvar strFormattedDate = \"\";\n\tvar theDate = new Date(dt_epochdate);\n\tdateString = theDate.toString();\n\tarrDateStr = dateString.split(\" \");\n\tstrFormattedDate = arrDateStr[2] + \"\/\" + getNumericMonth(arrDateStr[1]) + \"\/\" + arrDateStr[3] + \" \" + arrDateStr[4].substr(0,2) + \":\";\n\tstrFormattedDate += arrDateStr[4].substr(3,2) + \":\" + arrDateStr[4].substr(6,2);\n\treturn strFormattedDate;\n}\n\nfunction getNumericMonth(strMonth)\n{\n\tvar arrMonth = new Array(\"Jan\",\"Feb\",\"Mar\",\"Apr\",\"May\",\"Jun\",\"Jul\",\"Aug\",\"Sep\",\"Oct\",\"Nov\",\"Dec\");\n\tfor(i=0; i<arrMonth.length; i++)\n\t{\n\t\tif(strMonth == arrMonth[i])\n\t\t\treturn i+1;\n\t}\n}\n\nfunction replaceIllegalFileCharacters(strText)\n{\n\t\/\/-- This function is used to replace characters in the passed in string that \n\t\/\/-- are not suitable for use in filenames and return the modified string \n\t\n\tstrOutput = strText;\n\tstrReplacement = \"-\";\n\tvar i = 0;\n\t\n\twhile(i < strOutput.length)\n\t{\n\t\tstrOutput = strOutput.replace('\/', strReplacement);\n\t\tstrOutput = strOutput.replace(':', strReplacement);\n\t\tstrOutput = strOutput.replace('*', strReplacement);\n\t\tstrOutput = strOutput.replace('?', strReplacement);\n\t\tstrOutput = strOutput.replace('\"', strReplacement);\n\t\tstrOutput = strOutput.replace('\\'', strReplacement);\n\t\tstrOutput = strOutput.replace('<', strReplacement);\n\t\tstrOutput = strOutput.replace('>', strReplacement);\n\t\t\n\t\ti++;\n\t}\n\t\n\treturn strOutput;\n}"},{"name":"cb_callaction_OnValueChanged","code":"cb_callaction_OnValueChanged(strValue)\n{\n\t\/\/-- set mode and then setup defaults for that mode\n\t_swdoc.boolClosing = (strValue!=\"Resolve Call\");\n\t_swdoc.setup_call_action();\n\n}"},{"name":"flg_customersurvey_OnValueChanged","code":"flg_customersurvey_OnValueChanged(strValue)\n{\n\t\/\/-- enable disable\n\tvar bChecked = flg_customersurvey.text == \"1\";\n\t_een(cb_surveys , bChecked);\n\n}"},{"name":"OnFieldValueChanged","code":"OnFieldValueChanged(strName, strValue)\n{\n\t\/\/-- This value is set when a field value has been changed.\n\t\/\/-- We check this variable on from closing to see if there are any data changes that need to be saved.\n\t_swdoc.boolFormFieldChanged = true;\n\n\n}"},{"name":"dt_actiontime_OnValueChanged","code":"dt_actiontime_OnValueChanged(strValue)\n{\n\n\t\/\/-- NWJ - 09.02.2007 - Back date call\n\tvar nBackdatePeriod = 0;\n\t\n\t\/\/--Calculate the BackDate Period\n    var currentTime\t= app.global.GetCurrentEpocTime() ;\n\tvar updateDateTime = dt_actiontime.text;\n\tnBackdatePeriod = currentTime - updateDateTime;\n\t\t\t\n\t\/\/-- If attempted to forward date then deny\n\tif(nBackdatePeriod < 0)\n\t{\n\t\tMessageBox(\"You have attempted to forward date this call update which is not allowed.\");\n\t\tnBackdatePeriod=0;\t\n\t}\n\telse\n\t{\n\t\n\t\t\/\/-- If backdate period > the analyst max backdate period then prompt to use current time or cancel\n\t\tif(nBackdatePeriod > app.session.GetMaxBackdatePeriodAllowed())\n\t\t{\n\t\t\tvar dTime\t= new Date();\n\t\t\tdTime = (currentTime - app.session.GetMaxBackdatePeriodAllowed()) * 1000;\n\t\t\tvar message = \"You have attempted to backdate this call update further than you have sufficient privileges to do so.\\n\\nDo you want to use the oldest date\/time that you are allowed: \";\n\t\t\tif(MessageBox(message + getReadableDatefromEpoch(dTime), MB_ICONQUESTION | MB_YESNO) != IDYES)\t\n\t\t\t{\n\t\t\t\tnBackdatePeriod = 0;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\t\/\/-- update field\n\t\t\t\tnBackdatePeriod = app.session.GetMaxBackdatePeriodAllowed();\n\t\t\t\t_swdoc.updatedb.updatetimex = app.global.GetCurrentEpocTime() - nBackdatePeriod;\t\t\t\t\n\t\t\t}\n\t\t}\n\t}\t\t\n\t\n\t\/\/Set the _swdoc level variable for use in the resolve\/close and return true\n\tif(nBackdatePeriod==0)\n\t{\n\t\t_swdoc.updatedb.updatetimex = app.global.GetCurrentEpocTime();\t\n\t}\n\t\n\t_swdoc.nBackdatePeriod = nBackdatePeriod;\n\t_swdoc.UpdateFormFromData();\n\t\n}"},{"name":"btnResolveClose_OnPressed","code":"btnResolveClose_OnPressed()\n{\n\tmainform.ResolveClose();\n}"}]}}},{"appearance":{"width":"360","height":"220","backgroundColor":"#ffffff","fillColour":"#ffffff","textColour":"#000000","font":{"@size":"8","#text":"Arial"}},"javascript":{}}]}}}